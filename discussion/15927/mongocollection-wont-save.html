---
layout: default
title: 'MongoCollection won&#039;t save - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/23/odm">ODM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">MongoCollection won&#039;t save</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a></span>
            <time itemprop="dateCreated" datetime="2017-04-08T22:31:39-07:00">Apr '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-04-08T22:31:39-07:00">Apr '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Apr '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">5</span>
                </td>
                <td>
                    <label>Views</label><br>892</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a></span>
                <span class="karma">8.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C15927" href="#C15927">
        <time class="action-date">Apr '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hello,</p>
<p>Migrating to PHP 7.1 and latest version of Phalcon.</p>
<p>Using bootstrap code from an older PHP 5 project, changed to using the MongoCollection from the incubator.</p>
<p>I retrieve a model, but when saving I get:
&quot;A dependency injector container is required to obtain the services related to the ODM&quot;</p>
<p>Line 73 in Phalcon\MVC\MongoCollection.php seems to have lost the DI.</p>
<p><code>$dependencyInjector = $this-&gt;_dependencyInjector;</code></p>
<p>How do I fix this?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2be7b5d170f5e65ee64b6378b91d3c48?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9019/409H" class="user-moderator-N"><span itemprop="name">H</span></a>        </span>
        <br>

        <span class="karma">3.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="47455" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '17</span>
              </span><br/><a name="C47455" href="#C47455">
                <time itemprop="dateCreated" datetime="2017-04-10T02:31:17-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I've not used PHP7.1 and Phalcon3 for an ODM <em>yet</em>, but what is your model extending? Ie: <code>class Robots extends \Phalcon\Mvc\Collection{}</code>? The parent should have the <code>save()</code> method - and access to the DI automagically, you shouldn't need to inject/instanstiate it manually.</p>
<ul>
<li><a href="https://github.com/phalcon/cphalcon/issues/3168">Related GitHub Issue</a> (old)</li>
</ul></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47455" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47455" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a>        </span>
        <br>

        <span class="karma">8.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47459" href="#C47459">
                <time itemprop="dateCreated" datetime="2017-04-10T03:44:43-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>My model is using the new Mongo class from the Incubator. It extends \Phalcon\Mvc\MongoCollection.</p>
<p>From index.php showing Loader with Incubator:</p>
<pre><code class="language-php">$loader = new \Phalcon\Loader();
$loader-&gt;registerNamespaces([
    'Phalcon' =&gt; SHARED_PATH . 'utils/incubator/Library/Phalcon/'
])-&gt;registerDirs([
    APP_PATH . 'app/controllers/',
    APP_PATH . 'app/plugins/',
    SHARED_PATH . 'library/',
    SHARED_PATH . 'models/'
])-&gt;register();</code></pre>
<p>From services.php:</p>
<pre><code class="language-php">// shared mongo service 
$di-&gt;set('mongo', function() {

    if(IS_PRODUCTION) {
        $mongo = new \Phalcon\Db\Adapter\MongoDB\Client('mongodb://xxx');
    }
    else {
        $mongo = new \Phalcon\Db\Adapter\MongoDB\Client('mongodb://127.0.0.1');
    }
    return $mongo-&gt;selectDatabase('dbName');

}, true);</code></pre>
<p>It is quite strange. I can query for a model, and it gets fetched properly, all methods and properties behave as expected. There is obviously a DI being used to access the Mongo service. I've only changed this code to add the Incubator namespace/classes. It worked perfectly before.</p>
<p>It only crashes when I try to save. There are no scope issues. Same behavior via the CLI.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47459" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47459" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2be7b5d170f5e65ee64b6378b91d3c48?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9019/409H" class="user-moderator-N"><span itemprop="name">H</span></a>        </span>
        <br>

        <span class="karma">3.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="47461" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '17</span>
              </span><br/><a name="C47461" href="#C47461">
                <time itemprop="dateCreated" datetime="2017-04-10T04:02:34-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Weird. I'm looking at the <a href="https://github.com/phalcon/incubator/blob/d34e982db3c754712328f5bfff69611fd9a675f1/tests/unit/Mvc/MongoCollectionTest.php#L68">incubator tests</a>  (<a href="https://github.com/phalcon/incubator/blob/d34e982db3c754712328f5bfff69611fd9a675f1/tests/_data/collections/Cars.php">related <code>car</code> collection</a>) and they seem to translate to your set-up from my interpretation.</p>
<p>Are you able to run the test on your machine to see if that works - using <a href="https://phpunit.de">phpunit</a> - then we can conclude if it's your implementation/set-up or not.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47461" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47461" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a>        </span>
        <br>

        <span class="karma">8.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="47481" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '17</span>
              </span><br/><a name="C47481" href="#C47481">
                <time itemprop="dateCreated" datetime="2017-04-10T09:11:13-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Everything installed. Wtih what command and from what directory do I run phpunit?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47481" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47481" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2be7b5d170f5e65ee64b6378b91d3c48?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9019/409H" class="user-moderator-N"><span itemprop="name">H</span></a>        </span>
        <br>

        <span class="karma">3.4k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C47481"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Ty Kroll                    </a>
                </div><div class="posts-buttons" align="right"><a name="C47483" href="#C47483">
                <time itemprop="dateCreated" datetime="2017-04-10T09:31:23-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I think <code>phpunit --bootstrap _bootstrap.php unit/Mvc/MongoCollectionTest.php</code> should work fine</p>
<blockquote>
<p>Everything installed. Wtih what command and from what directory do I run phpunit?</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47483" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47483" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a>        </span>
        <br>

        <span class="karma">8.7k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C47483"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/2be7b5d170f5e65ee64b6378b91d3c48?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        H                    </a>
                </div><div class="posts-buttons" align="right"><a name="C47485" href="#C47485">
                <time itemprop="dateCreated" datetime="2017-04-10T10:20:47-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hmmm... Class 'Codeception\TestCase\Test' not found</p>
<p>I find Test.php in /vendor/codeception/codeception/src/Codeception/Test not /TestCase</p>
<p>Version problem?</p>
<blockquote>
<p>I think <code>phpunit --bootstrap _bootstrap.php unit/Mvc/MongoCollectionTest.php</code> should work fine</p>
<blockquote>
<p>Everything installed. Wtih what command and from what directory do I run phpunit?</p>
</blockquote>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47485" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47485" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a>        </span>
        <br>

        <span class="karma">8.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="47487" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '17</span>
              </span><br/><a name="C47487" href="#C47487">
                <time itemprop="dateCreated" datetime="2017-04-10T21:00:22-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Still trying to get the test to run. I read in the Codeception changelog that Codeception\TestCase\Test was removed in 2.2.0. Too many breaking dependencies trying to downgrade to 2.1.11. Not sure how any of these tests would work, as they all extend Codeception\TestCase\Test.</p>
<p>I tried changing CollectionsTest in  MongoCollectionTest.php to extend Codeception\Test\Unit and running phpunit with:</p>
<p><code>phpunit --bootstrap _bootstrap.php CollectionsTest unit/Mvc/MongoCollectionTest.php --debug --verbose</code></p>
<p>I get this:</p>
<pre><code class="language-php">PHPUnit 6.1.0 by Sebastian Bergmann and contributors.

Runtime:       PHP 7.1.3-3+deb.sury.org~xenial+1

Time: 347 ms, Memory: 6.00MB

No tests executed!</code></pre>
<p>Any help appreciated. I have no idea about phpunit or (the well-named) codedeception.
Thanks!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47487" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47487" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2be7b5d170f5e65ee64b6378b91d3c48?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9019/409H" class="user-moderator-N"><span itemprop="name">H</span></a>        </span>
        <br>

        <span class="karma">3.4k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C47487"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Ty Kroll                    </a>
                </div><div class="posts-buttons" align="right"><a name="C47491" href="#C47491">
                <time itemprop="dateCreated" datetime="2017-04-11T00:59:59-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Apologies for the late reply.</p>
<p>Ah, I'm uncertain, as I've not had much experience with phpunit. I'll set up a VM with Phalcon3, PHP7, and MongoDb3 tonight and give it a test and get back to you.</p>
<blockquote>
<p>Still trying to get the test to run. I read in the Codeception changelog that Codeception\TestCase\Test was removed in 2.2.0. Too many breaking dependencies trying to downgrade to 2.1.11. Not sure how any of these tests would work, as they all extend Codeception\TestCase\Test.</p>
<p>I tried changing CollectionsTest in  MongoCollectionTest.php to extend Codeception\Test\Unit and running phpunit with:</p>
<p><code>phpunit --bootstrap _bootstrap.php CollectionsTest unit/Mvc/MongoCollectionTest.php --debug --verbose</code></p>
<p>I get this:</p>
<pre><code class="language-php">PHPUnit 6.1.0 by Sebastian Bergmann and contributors.

Runtime:       PHP 7.1.3-3+deb.sury.org~xenial+1

Time: 347 ms, Memory: 6.00MB

No tests executed!</code></pre>
<p>Any help appreciated. I have no idea about phpunit or (the well-named) codedeception.
Thanks!</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47491" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47491" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a>        </span>
        <br>

        <span class="karma">8.7k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C47491"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/2be7b5d170f5e65ee64b6378b91d3c48?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        H                    </a>
                </div><div class="posts-buttons" align="right"><a name="C47495" href="#C47495">
                <time itemprop="dateCreated" datetime="2017-04-11T01:57:50-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>No worries.</p>
<p>One thing I noticed in the MongoCollectionTest.php was the absence of a test that fetched a collection THEN saved. This is exactly when my code fails.</p>
<p>Thanks</p>
<blockquote>
<p>Apologies for the late reply.</p>
<p>Ah, I'm uncertain, as I've not had much experience with phpunit. I'll set up a VM with Phalcon3, PHP7, and MongoDb3 tonight and give it a test and get back to you.</p>
<blockquote>
<p>Still trying to get the test to run. I read in the Codeception changelog that Codeception\TestCase\Test was removed in 2.2.0. Too many breaking dependencies trying to downgrade to 2.1.11. Not sure how any of these tests would work, as they all extend Codeception\TestCase\Test.</p>
<p>I tried changing CollectionsTest in  MongoCollectionTest.php to extend Codeception\Test\Unit and running phpunit with:</p>
<p><code>phpunit --bootstrap _bootstrap.php CollectionsTest unit/Mvc/MongoCollectionTest.php --debug --verbose</code></p>
<p>I get this:</p>
<pre><code class="language-php">PHPUnit 6.1.0 by Sebastian Bergmann and contributors.

Runtime:       PHP 7.1.3-3+deb.sury.org~xenial+1

Time: 347 ms, Memory: 6.00MB

No tests executed!</code></pre>
<p>Any help appreciated. I have no idea about phpunit or (the well-named) codedeception.
Thanks!</p>
</blockquote>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47495" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47495" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a>        </span>
        <br>

        <span class="karma">8.7k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C47491"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/2be7b5d170f5e65ee64b6378b91d3c48?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        H                    </a>
                </div><div class="posts-buttons" align="right"><a name="C47547" href="#C47547">
                <time itemprop="dateCreated" datetime="2017-04-12T10:59:13-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Any news?</p>
<blockquote>
<p>Apologies for the late reply.</p>
<p>Ah, I'm uncertain, as I've not had much experience with phpunit. I'll set up a VM with Phalcon3, PHP7, and MongoDb3 tonight and give it a test and get back to you.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47547" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47547" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2be7b5d170f5e65ee64b6378b91d3c48?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9019/409H" class="user-moderator-N"><span itemprop="name">H</span></a>        </span>
        <br>

        <span class="karma">3.4k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C47547"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Ty Kroll                    </a>
                </div><div class="posts-buttons" align="right"><a name="C47551" href="#C47551">
                <time itemprop="dateCreated" datetime="2017-04-13T00:44:17-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Sorry, I got really busy over the last couple days with work. I have tonight off, so I <em>should</em> be able to experiment then </p>
<blockquote>
<p>Any news?</p>
<blockquote>
<p>Apologies for the late reply.</p>
<p>Ah, I'm uncertain, as I've not had much experience with phpunit. I'll set up a VM with Phalcon3, PHP7, and MongoDb3 tonight and give it a test and get back to you.</p>
</blockquote>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47551" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47551" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a>        </span>
        <br>

        <span class="karma">8.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="47633" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '17</span>
              </span><br/><a name="C47633" href="#C47633">
                <time itemprop="dateCreated" datetime="2017-04-18T04:11:46-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Did some testing</p>
<p>Made a simple Model:</p>
<pre><code class="language-php">class Tester extends \Phalcon\Mvc\MongoCollection {

    public static function findA() {

        return self::findFirst();
    }
}</code></pre>
<p>And two CLI tests:</p>
<pre><code class="language-php">public function test1Action(array $params = null) {

  $t = new self();
  $t-&gt;test = 'here is a string';
  $t-&gt;save();
}

public function test2Action(array $params = null) {

  $t = self::findA();
  echo 'test: ', $t-&gt;test, PHP_EOL, PHP_EOL;

  $t-&gt;test = 'another string';
  $t-&gt;save();
}</code></pre>
<p>After running <code>test1</code>, I get this in Mongo:</p>
<pre><code class="language-php">{
    "_id" : ObjectId("58f5ee18962d741fd126d472"),
    "_dependencyInjector" : {

    },
    "_modelsManager" : {

    },
    "_source" : "tester",
    "_operationMade" : 1,
    "_dirtyState" : 1,
    "_connection" : {

    },
    "_errorMessages" : [ ],
    "_skipped" : false,
    "test" : "here is a string"
}</code></pre>
<p>All good, but where did these underscore-prefixed properties come from??? Never seen before.</p>
<p>When I run <code>test2</code>, I get this:</p>
<pre><code class="language-php">test: here is a string

PHP Fatal error:  Uncaught Phalcon\Mvc\Collection\Exception: A dependency injector container is required to obtain the services related to the ODM in /var/www/proj/shared/utils/incubator/Library/Phalcon/Mvc/MongoCollection.php:76
Stack trace:
#0 /var/www/proj/cli/app/tasks/TestTask.php(3168): Phalcon\Mvc\MongoCollection-&gt;save()
#1 [internal function]: TestTask-&gt;test2Action(Array)
#2 [internal function]: Phalcon\Cli\Dispatcher-&gt;callActionMethod(Object(TestTask), 'test2Action', Array)
#3 [internal function]: Phalcon\Dispatcher-&gt;_dispatch()
#4 [internal function]: Phalcon\Dispatcher-&gt;dispatch()
#5 /var/www/proj/cli/app/cli.php(42): Phalcon\Cli\Console-&gt;handle(Array)
#6 {main} thrown in /var/www/proj/shared/utils/incubator/Library/Phalcon/Mvc/MongoCollection.php on line</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47633" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47633" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a>        </span>
        <br>

        <span class="karma">8.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47647" href="#C47647">
                <time itemprop="dateCreated" datetime="2017-04-18T08:04:02-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I found a patch that I outlined in <a href="https://github.com/phalcon/incubator/issues/760">https://github.com/phalcon/incubator/issues/760</a></p>
<p>Would still love some insight as to why MongoCollection ignores the original <code>getReservedAttributes()</code> in collection.zep at <a href="https://github.com/phalcon/cphalcon/blob/master/phalcon/mvc/collection.zep">https://github.com/phalcon/cphalcon/blob/master/phalcon/mvc/collection.zep</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47647" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47647" data-cf-modified-b039be204ae6cc7f9450a5a7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="15927" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>