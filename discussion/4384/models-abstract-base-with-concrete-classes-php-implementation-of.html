---
layout: default
title: 'Models - Abstract base with concrete classes?  PHP implementation of model::find()? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Models - Abstract base with concrete classes?  PHP implementation of model::find()?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/1779/KarlAustin" class="user-moderator-N"><span itemprop="name">Karl Austin</span></a></span>
            <time itemprop="dateCreated" datetime="2015-01-04T09:35:24-07:00">Jan '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-01-04T09:35:24-07:00">Jan '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jan '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>908</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/fd768e6fb4ee3cce5e476f2ef8292016?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/1779/KarlAustin" class="user-moderator-N"><span itemprop="name">Karl Austin</span></a></span>
                <span class="karma">1.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C4384" href="#C4384">
        <time class="action-date">Jan '15</time>
    </a>
</div>
<div class="post-content"><div><p>I have an abstract class (well it should be, but right now it's a public class), Widget - there are many types of widget (WidgetOne, WidgetTwo etc.) that necesitate multiple models in Phalcon, there's quite a lot of commanality hence the abstract class.</p>
<p>So far, not a probem.  The problem comes with working with the ORM - I can call:</p>
<p>Widget::find()</p>
<p>(hence not going with abstract in reality) which returns me all the widgets I want, but they are all obviously of type Widget, not what they are in reality, WidgetOne, WidgetTwo etc.</p>
<p>As far as I can see Phalcon has no way of handling this.</p>
<p>Does anyone have a PHP implementation of Phalcon\Mvc\Model::find() ?  If I had that then my Widget model can provide it's own find, findFirst etc. as the Widget table has a field: type which I can use to get the actual Widget subclass from.</p>
<p>Thanks,</p>
<p>Karl</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-e0a2100765f2f563a5c5d504-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-e0a2100765f2f563a5c5d504-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14547" href="#C14547">
                <time itemprop="dateCreated" datetime="2015-01-04T09:52:13-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>And why don't you create your own/override <code>find()</code>? Just call it <code>findWidget()</code>, and get which <code>Widget</code> class is calling it (<code>get_called_class()</code> I think); then, do a <code>$widgetClass::find(..)</code> and return the result, so you don't need to use the field. You could do the same creating a constant class that says which <code>Widget</code> are you using for the function (<code>$widgetClass::WIDGET_CLASS</code>) in every subwidget as opposite to the previous option. Or you could just use your field to assign correctly <code>$widgetClass</code>.</p>
<p>But I'm not sure if it is what you want.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14547" data-cf-modified-e0a2100765f2f563a5c5d504-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14547" data-cf-modified-e0a2100765f2f563a5c5d504-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/877a54304e07c8cb38c47b43e1d6b6b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2828/sergeyklay" class="user-moderator-Y"><span itemprop="name">Serghei Iakovlev</span></a>        </span>
        <br>

        <span class="karma">39.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14548" href="#C14548">
                <time itemprop="dateCreated" datetime="2015-01-04T09:52:15-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Could you try to declare in your absctract class <code>get</code> method with something like this:</p>
<pre><code class="language-php">&lt;?php

  abstract class Widget extends \Phalcon\Mvc\Model
  {
      /**
       * Default order
       * @type string
       */
      const DEFAULT_ORDER = null;

      /**
       * Thw scope that should be implicitly applied to all queries for this model
       * @type string
       */
      const DEFAULT_SCOPE = null;

      /**
       * Default limit
       * @type int
       */
      const DEFAULT_LIMIT = 30;

      public static function get($condition, $params, $order = null, $limit = null)
      {
          $condition = vsprintf($condition, $params);

          if (static::DEFAULT_SCOPE) {
              $condition = sprintf('%s %s %s', $condition, $condition ? 'AND' : '', static::DEFAULT_SCOPE);
              $condition = trim($condition);
          }

          $parameters = [$condition];

          if ($order) {
              $parameters['order'] = $order;
          } elseif (static::DEFAULT_ORDER) {
              $parameters['order'] = static::DEFAULT_ORDER;
          }

          if ($limit) {
              $parameters['limit'] = $limit;
          } elseif (static::DEFAULT_LIMIT) {
              $parameters['limit'] = static::DEFAULT_LIMIT;
          }

          return self::find($parameters);
      }
  }</code></pre>
<p>And your child model:</p>
<pre><code class="language-php">&lt;?php

class WidgetOne extends Widget
{
  // ...
    /** {@inheritdoc }*/
    const DEFAULT_ORDER = 'created_at';

    /** {@inheritdoc }*/
    const DEFAULT_SCOPE = 'type=one';
}
</code></pre>
<p>I hope has helped you</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14548" data-cf-modified-e0a2100765f2f563a5c5d504-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14548" data-cf-modified-e0a2100765f2f563a5c5d504-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fd768e6fb4ee3cce5e476f2ef8292016?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1779/KarlAustin" class="user-moderator-N"><span itemprop="name">Karl Austin</span></a>        </span>
        <br>

        <span class="karma">1.7k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C14547"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        RompePC                    </a>
                </div><div class="posts-buttons" align="right"><a name="C14549" href="#C14549">
                <time itemprop="dateCreated" datetime="2015-01-04T09:58:07-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I want to avoid specifically requesting the type from Widget, by doing something like findWidget($type) - as I could in effect do that now, by just calling WidgetOne::find() - but that means every time a new Widget type is added, I need to modify lots of code to cope with it.  It also means I have to mash several result sets together to sort them in the correct order.  Hence wanting to just have the Widgets be of the correct type when returned from their parent classes find() method.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14549" data-cf-modified-e0a2100765f2f563a5c5d504-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14549" data-cf-modified-e0a2100765f2f563a5c5d504-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fd768e6fb4ee3cce5e476f2ef8292016?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1779/KarlAustin" class="user-moderator-N"><span itemprop="name">Karl Austin</span></a>        </span>
        <br>

        <span class="karma">1.7k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C14548"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/877a54304e07c8cb38c47b43e1d6b6b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Serghei Iakovlev                    </a>
                </div><div class="posts-buttons" align="right"><a name="C14550" href="#C14550">
                <time itemprop="dateCreated" datetime="2015-01-04T10:02:56-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Same sort of isuse, it's not a problem when I call WidgetOne directly etc.  I've already solved that side of it.  It's more when I need to fetch a list of widgets in bulk, which could be of any type e.g.</p>
<p>Last 50 widgets ordered - could be any type of widget, but they'll all come back from Widget::find() right now with a type of Widget, rather than WidgetOne, WidgetTwo etc.  Right now I'd have to get the ID + type of the last 50, then do WidgetOne::find() passing it an array of IDs, same for every other type of widget in the last 50 - then sort them in to the correct order.</p>
<p>Looks like someone has done a pull for 2.0.0 that could solve this, <a href="https://github.com/vpg/cphalcon/commit/325a18fa710932a90b98b6b511d1aaa16799dc55">https://github.com/vpg/cphalcon/commit/325a18fa710932a90b98b6b511d1aaa16799dc55</a> so I may have to wait until it is merged in.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14550" data-cf-modified-e0a2100765f2f563a5c5d504-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14550" data-cf-modified-e0a2100765f2f563a5c5d504-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fd768e6fb4ee3cce5e476f2ef8292016?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1779/KarlAustin" class="user-moderator-N"><span itemprop="name">Karl Austin</span></a>        </span>
        <br>

        <span class="karma">1.7k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14562" href="#C14562">
                <time itemprop="dateCreated" datetime="2015-01-04T16:53:56-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Using 2.0.0 with the Late State Binding patch and it's working perfect for what I need.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14562" data-cf-modified-e0a2100765f2f563a5c5d504-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14562" data-cf-modified-e0a2100765f2f563a5c5d504-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="4384" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>