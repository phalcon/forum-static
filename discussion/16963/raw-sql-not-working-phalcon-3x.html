---
layout: default
title: 'Raw SQL not Working Phalcon 3.x - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Raw SQL not Working Phalcon 3.x</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/7457/ignnniter" class="user-moderator-N"><span itemprop="name">ignnniter</span></a></span>
            <time itemprop="dateCreated" datetime="2017-09-20T03:28:30-07:00">Sep '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-09-20T03:28:30-07:00">Sep '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>369</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/640523a7ab53b8016a2956782edcaff5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/7457/ignnniter" class="user-moderator-N"><span itemprop="name">ignnniter</span></a></span>
                <span class="karma">956</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C16963" href="#C16963">
        <time class="action-date">Sep '17</time>
    </a>
</div>
<div class="post-content"><div><p>Got it smoothly working with phalcon 2.x but not working with phalcon 3.x</p>
<pre><code class="language-php">        $data = new BlanketItemTb();
        $sql = "SELECT iit.item_id, iit.item_description, format(bit.ordered_quantity,0) as ordered_quantity, format(bit.remaining_quantity,0) as remaining_quantity
                FROM blanket_item_tb bit
                LEFT JOIN item_inventory_tb iit ON bit.item_id = iit.item_id
                WHERE bit.blanket_id = '$blanket_id' ORDER BY iit.item_id";

     return new Resultset(
            null,
            $data,
            $data-&gt;getReadConnection()-&gt;query($sql)
        );</code></pre></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C51103" href="#C51103">
                <time itemprop="dateCreated" datetime="2017-09-20T04:56:23-07:00" class="action-date">Sep '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Dude, use parameter binding, right not it's not safe query beacause it can be sql injected. Also what you mean not working? Show us more info like what error etc.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51103" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51103" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/640523a7ab53b8016a2956782edcaff5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/7457/ignnniter" class="user-moderator-N"><span itemprop="name">ignnniter</span></a>        </span>
        <br>

        <span class="karma">956</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C51103"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Wojciech Ślawski                    </a>
                </div><div class="posts-buttons" align="right"><a name="C51107" href="#C51107">
                <time itemprop="dateCreated" datetime="2017-09-20T05:36:14-07:00" class="action-date">Sep '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Dude, use parameter binding, right not it's not safe query beacause it can be sql injected. Also what you mean not working? Show us more info like what error etc.</p>
</blockquote>
<p>Let's put aside first the binding, there's no particular error, however the returned result comes with full of nulls.
As you can see here, phalcon 2 returns all data without null</p>
<p>Json Response Phalcon 2.X</p>
<blockquote>
<p>[{&quot;blanket_id&quot;:&quot;80&quot;,&quot;date&quot;:&quot;2017-08-12&quot;,&quot;blanket_no&quot;:&quot;BL0000078&quot;,&quot;po_no&quot;:&quot;456456&quot;,&quot;customer_name&quot;:&quot;PACIFIC PAINT&quot;,&quot;plant_location&quot;:&quot;Plant A - &quot;,&quot;action&quot;:&quot;Post&quot;,&quot;sales_person&quot;:&quot;Andy Co&quot;},{&quot;blanket_id&quot;:&quot;79&quot;,&quot;date&quot;:&quot;2017-08-12&quot;,&quot;blanket_no&quot;:&quot;BL0000077&quot;,&quot;po_no&quot;:&quot;123456&quot;,&quot;customer_name&quot;:&quot;PACIFIC PAINT&quot;,&quot;plant_location&quot;:&quot;Plant A - &quot;,&quot;action&quot;:&quot;Post&quot;,&quot;sales_person&quot;:&quot;Andy Co&quot;}]</p>
</blockquote>
<p>Json Reponse Phalcon 3.X</p>
<blockquote>
<p>[{&quot;blanket_id&quot;:&quot;80&quot;,&quot;blanket_no&quot;:&quot;BL0000078&quot;,&quot;date&quot;:&quot;2017-08-12&quot;,&quot;po_no&quot;:&quot;456456&quot;,&quot;customer_id&quot;:null,&quot;plant_id&quot;:null,&quot;action&quot;:&quot;Post&quot;,&quot;sales_person_id&quot;:null&quot;}]</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51107" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51107" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C51113" href="#C51113">
                <time itemprop="dateCreated" datetime="2017-09-20T07:34:06-07:00" class="action-date">Sep '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>But those are not fields you wrote you wrote in original post. Check in sql logs(add logger for queries if you don't have yet) what query is being made, then test it outside of phalcon if result is correct, if it's the same as phalcon - then it's not phalcon issue. If query is wrong then come back here.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51113" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51113" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/640523a7ab53b8016a2956782edcaff5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/7457/ignnniter" class="user-moderator-N"><span itemprop="name">ignnniter</span></a>        </span>
        <br>

        <span class="karma">956</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C51113"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Wojciech Ślawski                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="51127" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '17</span>
              </span><br/><a name="C51127" href="#C51127">
                <time itemprop="dateCreated" datetime="2017-09-21T01:46:15-07:00" class="action-date">Sep '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>But those are not fields you wrote you wrote in original post. Check in sql logs(add logger for queries if you don't have yet) what query is being made, then test it outside of phalcon if result is correct, if it's the same as phalcon - then it's not phalcon issue. If query is wrong then come back here.</p>
</blockquote>
<p>here's the query</p>
<blockquote>
<p>$sql = &quot;SELECT bmt.blanket_id, bmt.date, bmt.blanket_no, bmt.po_no, ct.customer_name, CONCAT(cpt.plant, ' - ', cpt.city) as plant_location, bmt.action, CONCAT(spt.first_name, ' ', spt.last_name) as sales_person
FROM blanket_main_tb bmt
LEFT JOIN customer_tb ct ON bmt.customer_id = ct.customer_id<br />
LEFT JOIN customer_plants_tb cpt ON bmt.plant_id = cpt.plant_id
LEFT JOIN sales_person_tb spt ON bmt.sales_person_id = spt.sales_person_id
LEFT JOIN blanket_so_tb bst ON bmt.blanket_id = bst.blanket_id
WHERE bst.blanket_id IS NULL ORDER BY bmt.blanket_id DESC&quot;;</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51127" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51127" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/640523a7ab53b8016a2956782edcaff5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/7457/ignnniter" class="user-moderator-N"><span itemprop="name">ignnniter</span></a>        </span>
        <br>

        <span class="karma">956</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C51307" href="#C51307">
                <time itemprop="dateCreated" datetime="2017-10-01T20:35:11-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Anyone can help me with this one?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51307" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51307" data-cf-modified-dfcabbd048a1b302aebbdf99-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="16963" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>