---
layout: default
title: 'Multisite Set up with shared views, controllers and models - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Multisite Set up with shared views, controllers and models</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/7933/karthikeyan-unimity" class="user-moderator-N"><span itemprop="name">Karthikeyan Manivasagam</span></a></span>
            <time itemprop="dateCreated" datetime="2016-08-10T23:13:09-07:00">Aug '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-08-10T23:13:09-07:00">Aug '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jan '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>1602</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/fa98f5295ce4af4d554b51b8e2410811?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/7933/karthikeyan-unimity" class="user-moderator-N"><span itemprop="name">Karthikeyan Manivasagam</span></a></span>
                <span class="karma">1.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C12677" href="#C12677">
        <time class="action-date">Aug '16</time>
    </a>
</div>
<div class="post-content"><div><p>We had a situation where we need to setup multi site  with shared views , templates , controllers, models with site specific templates ,controllers  and models too. </p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4769/Izopi4a" class="user-moderator-Y"><span itemprop="name">Izo</span></a>        </span>
        <br>

        <span class="karma">85.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C38159" href="#C38159">
                <time itemprop="dateCreated" datetime="2016-08-10T23:49:04-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://github.com/phalcon/mvc/tree/master/multiple-shared-layouts">https://github.com/phalcon/mvc/tree/master/multiple-shared-layouts</a> ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="38159" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="38159" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fa98f5295ce4af4d554b51b8e2410811?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7933/karthikeyan-unimity" class="user-moderator-N"><span itemprop="name">Karthikeyan Manivasagam</span></a>        </span>
        <br>

        <span class="karma">1.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="38161" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C38161" href="#C38161">
                <time itemprop="dateCreated" datetime="2016-08-10T23:54:33-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://monkpal.com/Multisite-Set-up-with-shared-views-controllers-and-modals-Phalcon">https://monkpal.com/Multisite-Set-up-with-shared-views-controllers-and-modals-Phalcon</a></p>
<pre><code>multisite/shared
├── apps
│   ├── common
│   │   ├── controllers        (Register namespace Common/Controller)
│   │   │   ├── IndexController.php   
│   │   │   ├── LoginController.php
│   │   │   └── ProductsController.php
│   │   ├── models             (Register namespace Common/Model)
│   │   │   └── Products.php  
│   │   └── views
│   │       ├── login
│   │       │   └── index.volt
│   │       └── products
│   │       |    └── index.volt
|   |       └──index.volt   
│   ├── example.com
│   │   ├── controllers
│   │   │   ├── IndexController.php (extend Common/Controller)
│   │   │   ├── LoginController.php  (extend Common/Controller)
│   │   │   ├── ProductsController.php (extend Common/Controller)
│   │   │   └── UsersController.php   Site Specific Controller
│   │   ├── models
│   │   │   └── Products.php (extend Common/Model)
|   |   |   └── Users.php (Site Specific Model)
│   │   └── views
│   │       └── products             (Other view templates will refer to Common view folder)
│   │           └── index.volt
│   ├── example2.com
│   │   ├── controllers
│   │   │   ├── IndexController.php (extend Common/Controller)
│   │   │   ├── ProductsController.php (extend Common/Controller)
│   │   │   └── SitespecificController.php   Site Specific Controller
│   │   ├── models
│   │   │   └── Products.php (extend Common/Model)
|   |   |   └── SiteSpecific.php (Site Specific Model)
│   │   └── views
│   │       └── sitespecific        (Other view templates will refer to Common view folder)
│   │           └── index.volt
└── public
    └── example.com   (Will contain Js CS Images to support site specific theme)
    └── example2.com  (Will contain Js CS Images to support site specific theme)
    └── index.php</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="38161" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="38161" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4769/Izopi4a" class="user-moderator-Y"><span itemprop="name">Izo</span></a>        </span>
        <br>

        <span class="karma">85.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C38165" href="#C38165">
                <time itemprop="dateCreated" datetime="2016-08-11T00:12:26-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I use this to generate my projects btw</p>
<p><a href="https://www.npmjs.com/package/generator-phalcon">https://www.npmjs.com/package/generator-phalcon</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="38165" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="38165" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fa98f5295ce4af4d554b51b8e2410811?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7933/karthikeyan-unimity" class="user-moderator-N"><span itemprop="name">Karthikeyan Manivasagam</span></a>        </span>
        <br>

        <span class="karma">1.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="38171" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C38171" href="#C38171">
                <time itemprop="dateCreated" datetime="2016-08-11T00:38:19-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Steps to setup multiple site with different domain name</p>
<p><strong>Steps to acheive it</strong></p>
<ul>
<li>Step 1 : Register the namespaces of common controllers and models</li>
<li>Step 2 : Extend the phalcon view engine to cascading the view (say for example View engine will  look for specific template file in site specific view folder if its not exist it will look in common  views folder, there is no need to replicate all the template files in all sites views directories, you can overwrite single template file alone).</li>
<li>Step 3 : Extend  Phalcon volt to provide Skin path for tempaltes</li>
<li>Step 4:  Create site specfic Volt cache folder</li>
<li>Step 5 :  Create seperate folders with sitenames in public folder for  js/css/images</li>
<li>Step 6:  Create common contollers, views, modals</li>
<li>Step 7:  Extend common controllers , modals in site specific folderss , Views wil be taken from common  folder. if you  want to overwrite any template you can overwiite that alone no need all view folder.</li>
<li>Step 8 : Set sitename by current domain name. this sitename will be used to register contollers models directries</li>
<li>Step 9:  Set two views  directory one is common and another is sitename (thi can be done only if you have extened the phalcon view to add two directories refer step 2)</li>
</ul>
<p><strong>Files  extended are  here  this should be in your public directory.</strong></p>
<p>custom/CustomVolt.php</p>
<blockquote>
<pre><code>  &lt;?php

  namespace Custom;

  use Phalcon\Mvc\View\Engine\Volt;
   use Phalcon\Mvc\View\Engine\Volt\Compiler;

      class CustomVolt extends Volt
      { 
           public function getCompiler()
          {
           if (!$this-&gt;_compiler) {
              $this-&gt;_compiler = new VoltCompilerExtension($this-&gt;getView());
              $this-&gt;_compiler-&gt;setOptions($this-&gt;getOptions());
              $this-&gt;_compiler-&gt;setDI($this-&gt;getDI());
          }
          return $this-&gt;_compiler;
       }
  }

  class VoltCompilerExtension extends Volt\Compiler
      {
      public function compileFile($path, $compiledPath, $extendsMode = null)
      {
          $skinPath = $this-&gt;getOption('skinPath');
           if ($skinPath) {
              $skinTemplate = str_replace(
              $this-&gt;getDI()-&gt;getView()-&gt;getViewsDir(),
              $skinPath,
               $path
            );

               if (is_readable($skinTemplate)) {
              $path = $skinTemplate;
               }
          }
          return parent::compileFile($path, $compiledPath, $extendsMode);
       }

      }</code></pre>
</blockquote>
<p>custom/CustomView.php</p>
<blockquote>
<pre><code>  &lt;?php 
  namespace Custom;

  use Phalcon\Mvc\View\Exception;
  use Phalcon\Mvc\View;
  use Phalcon\Cache\BackendInterface;

  class CustomView extends View
  {
      protected $_viewsDirs;
      /**
      * @var
      */
       protected $_eventsManager;
      /**
      * @param $path
       *
      * @return $this
      */
       public function addViewsDir($path)
      {
          $this-&gt;_viewsDirs = $path;
           $this-&gt;setViewsDir($path);
          return $this;
      }
      /**
      * @param $view
      * @param array $vars
      *
      * @return string
      */
      public function getPartial($view, $vars = [])
      {
          ob_start();
          $this-&gt;partial($view, $vars);
           $content = ob_get_contents();
           ob_end_clean();
          return $content;
       }

protected function _engineRender($engines, $viewPath, $silence, $mustClean, BackendInterface $cache = NULL)
{
    if (is_object($cache)) {
        throw new Exception('Cache view not supported...');
        return;
    }
    $viewsDirs = is_array($this-&gt;_viewsDirs) ? array_reverse($this-&gt;_viewsDirs) : [$this-&gt;_viewsDir];
    $notExists = true;
    $viewEnginePath = null;
    foreach ($engines as $extension =&gt; $engine) {
        foreach ($viewsDirs as $viewsDir) {
            $viewsDirPath   = $this-&gt;_basePath . $viewsDir . $viewPath;
            $viewEnginePath = $viewsDirPath . $extension;
            if (is_file($viewEnginePath)) {
                if (is_object($this-&gt;_eventsManager)) {
                    $this-&gt;_activeRenderPath = $viewEnginePath;
                    if($this-&gt;_eventsManager-&gt;fire('view:beforeRenderView', $this, $viewEnginePath) === false) {
                        break;
                    }
                }
                $engine-&gt;render($viewEnginePath, $this-&gt;_viewParams, $mustClean);
                if (is_object($this-&gt;_eventsManager)) {
                    $this-&gt;_eventsManager-&gt;fire('view:afterRenderView', $this);
                }
                $notExists = false;
                break 2;
            }
        }
    }
    if ($notExists) {
        if (is_object($this-&gt;_eventsManager)) {
            $this-&gt;_activeRenderPath = $viewEnginePath;
            $this-&gt;_eventsManager-&gt;fire('view:notFoundView', $this);
        }
        if (!$silence) {
            $exceptionMessage = 'View "'.($viewPath).'" was not found in the views directories';
            throw new Exception($exceptionMessage);
            return;
          }
       }
   } 
  }</code></pre>
</blockquote>
<p>index.php</p>
<blockquote>
<p>&lt;?php</p>
<pre><code>  use Phalcon\Loader;
  use Phalcon\Mvc\Application;
   use Phalcon\Di\FactoryDefault;
  use Phalcon\Mvc\Url as UrlProvider;
   use Custom\CustomVolt;
  use Custom\CustomView;

   if($_SERVER['HTTP_HOST'] == "example.com") {

      define('SITENAME',"example.com" );

  }
   if($_SERVER['HTTP_HOST'] == "example2.com") {

      define('SITENAME',"example2.com" );

   }  

      define('APP_PATH', realpath('..') . '/');</code></pre>
<p>try {</p>
<pre><code>  $loader = new Loader();

$loader-&gt;registerNamespaces(array(
    'Common\Controller' =&gt; '../app/common/controllers',
    'Common\Model' =&gt; '../app/common/models',
    'Custom'  =&gt; 'custom'
))-&gt;register();

$loader-&gt;registerDirs(array(
    '../app/'.SITENAME.'/controllers/',

    '../app/'.SITENAME.'/models/'
))-&gt;register();

$di = new FactoryDefault();

$di-&gt;set(
    'voltService',
    function ($view, $di) {
        $volt = new CustomVolt($view, $di);
        $volt-&gt;setOptions(
            array(
                "compiledPath"      =&gt; "../cache/volt/".SITENAME."/",
                "compiledExtension" =&gt; ".compiled",
                'compileAlways' =&gt; true,
                'skinPath' =&gt; '../app/'.SITENAME.'/views/'
            )
        );

        return $volt;
    }
);

$di-&gt;set(
    'view',
    function () {
        $view = new CustomView();
        $view-&gt;addViewsDir(array('../app/common/views/','../app/'.SITENAME.'/views/'));
        $view-&gt;registerEngines(
            array(
                ".volt" =&gt; 'voltService'
            )
        );
        return $view;
    }
);

$application = new Application($di);
$response = $application-&gt;handle();
$response-&gt;send();

  }   catch (\Exception $e) {
      echo "Exception: ", $e-&gt;getMessage();
   }</code></pre>
</blockquote>
<p>To render  Js and css site specific in volt tempaltes</p>
<p>You use can like this </p>
<pre><code>    {% raw %}{{{% endraw %} stylesheet_link(constant('SITENAME') ~'/css/main.css') {% raw %}}}{% endraw %}
    {% raw %}{{{% endraw %} javascript_include(constant('SITENAME') ~'/js/main.js') {% raw %}}}{% endraw %}</code></pre>
<p>skeleton in github <a href="https://github.com/karthikeyan-unimity/phalcon"><a href="https://github.com/karthikeyan-unimity/phalcon">https://github.com/karthikeyan-unimity/phalcon</a></a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="38171" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="38171" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40307" href="#C40307">
                <time itemprop="dateCreated" datetime="2016-09-17T11:19:08-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>something complicated.</p>
<p>Drupal approach:
<a href="https://www.drupal.org/docs/7/multisite-drupal/multi-site-sharing-the-same-code-base">https://www.drupal.org/docs/7/multisite-drupal/multi-site-sharing-the-same-code-base</a></p>
<p>in Phalcon my recomendation:</p>
<pre><code class="language-text">- app
    - default
        - config
            - config.php
            - loader.php
            - services.php
        - lang
    - other_site
    sites.php
- core
- web
    index.php</code></pre>
<p>site.php</p>
<pre><code class="language-php">&lt;?php

$sites['u-w-u.local'] = 'default';</code></pre>
<p>index.php</p>
<pre><code class="language-php">&lt;?php

use Phalcon\Di;
use Phalcon\Mvc\Micro;

error_reporting(E_ALL);

define('APP_PATH', realpath('..'));
define('WEB_PATH', realpath('.'));

/**
 *  Enable multisite
 */
$sites = [];

include '../app/sites.php';

$siteDomain = $_SERVER['SERVER_NAME'];

if (isset($sites[$siteDomain]) &amp;&amp; file_exists(APP_PATH . '/app/' . $sites[$siteDomain] . '/config/config.php')) {
    $sitePath = APP_PATH . '/app/' . $sites[$siteDomain];

    try {
        $di = new Di();

        /**
         * Include Services
         */
        include $sitePath . '/config/services.php';

        require '../autoload.php';

        /**
         * Call the autoloader service.  We don't need to keep the results.
         */
        $di-&gt;getLoader();

        /**
         * Starting the application
         * Assign service locator to the application
         */
        $app = new Micro($di);

        /**
         * Debug
         */
        if ($app-&gt;config-&gt;dev_environment) {
            Kint::$theme = 'solarized';
            $debug = new \Phalcon\Debug();
            $debug-&gt;listen();
        }

        /**
         * Include Application
         */
        foreach ($app-&gt;config-&gt;modules as $module =&gt; $config) {
            if ($config['active'] == true) {
                include APP_PATH . '/core/modules/' . $module . '/' . $module . '.routing.php';
                if ($config['api'] == true) {
                    include APP_PATH . '/core/modules/' . $module . '/' . $module . '.routing.api.php';
                }
            }
        }

        /**
         * Handle the request
         */
        $app-&gt;handle();
    } catch (\Exception $e) {
        echo $e-&gt;getMessage() . '&lt;br&gt;';
        echo '&lt;pre&gt;' . $e-&gt;getTraceAsString() . '&lt;/pre&gt;';
    }

} else {
    // TODO: Mejorar el mensaje de site no encontrado
    echo "Index.php: Acceso no permitido.";
}</code></pre>
<p>hopefully help you.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40307" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40307" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a2658b5645f7a791cd1fbf709c4eb9b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8837/cosmy81" class="user-moderator-N"><span itemprop="name">Cosimo</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C44793" href="#C44793">
                <time itemprop="dateCreated" datetime="2017-01-10T16:53:18-07:00" class="action-date">Jan '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi all.
I've worked around <a href="https://monkpal.com/Multisite-Set-up-with-shared-views-controllers-and-modals-Phalcon">https://monkpal.com/Multisite-Set-up-with-shared-views-controllers-and-modals-Phalcon</a> doing some change.</p>
<p>I have a new directory for templates in the root</p>
<blockquote>
<p>templates<br />
├── frontend<br />
│   ├── common<br />
│   │    ├── layouts<br />
│   │   │   ├── index.volt<br />
│   │   │   ├── cart.volt<br />
|     │     |    └── ... etc etc<br />
│   │   │<br />
│   │    ├── views<br />
│   │   │<br />
│   │   └──    partials<br />
│   │   │<br />
│   │   └──  layouts.volt
│   │<br />
│   ├── sitename1<br />
│   │   ├── layouts<br />
│   │   │   ├── index.volt<br />
│   │   │   ├── cart.volt<br />
|    │    |     └── ... etc etc<br />
│   │   │<br />
│   │   ├── views<br />
│   │   │<br />
│   │   └──    partials
│   │   │<br />
│   │   └──  layouts.volt
│   ├── sitename2<br />
│   │    ├── layouts<br />
│   │   │   ├── index.volt<br />
│   │   │   ├── cart.volt<br />
|     │    |    └── ... etc etc<br />
│   │   │<br />
│   │    ├── views<br />
│   │   │<br />
│   │   └──    partials<br />
│   │   │<br />
│   │   └──  layouts.volt </p>
</blockquote>
<p>there is a <strong>common</strong> directory for default templates and a directory for every site. Sitename files , if exist, override common.
In every dir there is a file layouts.volt for the general template.
In layouts subdir there are the general controller templates.
In views subdir there are the action templates.
In partials subdir there are the partials templates.</p>
<p>The view service init is: </p>
<pre><code class="language-php">&lt;?php

    $di-&gt;setShared(
        'view',
        function () {
              $conf=$this-&gt;get('config');
              $mainView='layout';
              $engines = array(
                  ".volt" =&gt; 'voltService',
                  ".phtml" =&gt; "Phalcon\Mvc\View\Engine\Php"
              );
              $view = new \Extended\ExtendedView();
              $view-&gt;addViewsDir(array(TEMPLATE_PATH.'frontend/common/'.$conf-&gt;application-&gt;viewsDir, TEMPLATE_PATH.'frontend/'.SITENAME.'/'.$conf-&gt;application-&gt;viewsDir));
              $view-&gt;addTemplatesDir(array(TEMPLATE_PATH.'frontend/common/', TEMPLATE_PATH.'frontend/'.SITENAME.'/'));
              // Set the engine
              $view-&gt;registerEngines($engines);
              $view-&gt;setMainView($view-&gt;getRightPath($mainView,$engines).$mainView); //main layout 
            return $view;
        }
    );
</code></pre>
<p>The ExtendedView class modified in order to manage partials and other templates override.</p>
<pre><code class="language-php">&lt;?php
namespace Extended;

use Phalcon\Mvc\View\Exception;
use Phalcon\Mvc\View;
use Phalcon\Cache\BackendInterface;

class ExtendedView extends View
{
    protected $_viewsDirs, $_templatesDirs;
    /**
     * @var
     */
    protected $_eventsManager;
    /**
     * @param $path
     *
     * @return $this
     */
    public function addViewsDir($path)
    {
       $this-&gt;_viewsDirs = $path;
       //$this-&gt;setViewsDir($path);
        return $this;
    }
    public function addTemplatesDir($path)
    {
       $this-&gt;_templatesDirs = $path;
       //$this-&gt;setViewsDir($path);
        return $this;
    }
    public function getRightPath($viewPath, $engines = [])
    {
      $templatesDirs = is_array($this-&gt;_templatesDirs) ? array_reverse($this-&gt;_templatesDirs) : [$this-&gt;_templatesDirs];
      if(empty($engines)) $engines = $this-&gt;_loadTemplateEngines();
      foreach ($engines as $extension =&gt; $engine) {
          foreach ($templatesDirs as $viewsDir) {
              $viewsDirPath   = $this-&gt;_basePath . $viewsDir . $viewPath; //directory completa con nome della vista finale
              $viewEnginePath = $viewsDirPath . $extension; //path completo del file con estensione es .volt .phtml
              if (is_file($viewEnginePath)) {
                  if($viewsDir) return $viewsDir; //imposta la dir della view
              }
          }
      }
      return null;
    }
    /**
     * @param $path
     *
     * @return $this

    public function addPartialsDir($path)
    {
       $this-&gt;_partialsDirs = $path;
       $this-&gt;setPartialsDir($path);
        return $this;
    }
     */
    /**
     * @param $view
     * @param array $vars
     *
     * @return string
     */
    public function getPartial($view, $vars = [])
    {
        ob_start();
        $this-&gt;partial($view, $vars);
        $content = ob_get_contents();
        ob_end_clean();
        return $content;
    }

    protected function _engineRender($engines, $viewPath, $silence, $mustClean, BackendInterface $cache = null){
      //$silence=false;
      //echo "($engines, $viewPath, $silence, $mustClean, BackendInterface $cache = null)";
      /* */
      $viewsDirs = is_array($this-&gt;_viewsDirs) ? array_reverse($this-&gt;_viewsDirs) : [$this-&gt;_viewsDir];
      $notExists = true; //?
      $viewEnginePath = null;
      foreach ($engines as $extension =&gt; $engine) {
          foreach ($viewsDirs as $viewsDir) {
              $viewsDirPath   = $this-&gt;_basePath . $viewsDir . $viewPath; //directory completa con nome della vista finale
              $viewEnginePath = $viewsDirPath . $extension; //path completo del file con estensione es .volt .phtml
              if (is_file($viewEnginePath)) {
                  if($viewsDir) $this-&gt;setViewsDir($viewsDir); //imposta la dir della view
                  return parent::_engineRender($engines, $viewPath, $silence, $mustClean, $cache);
              }
          }
      }
      return parent::_engineRender($engines, $viewPath, $silence, $mustClean, $cache);

    }
    public function render($controllerName, $actionName, $vars = []){
      /**
      * Check if there is a layouts directory set
      */
      $layoutsDir = $this-&gt;_layoutsDir;
      if (!$layoutsDir) {
        $layoutsDir = "layouts/";
      }
      /**
      * Check if the user has defined a custom layout
      */
      $layout = $this-&gt;_layout;
      if ($layout) {
        $layoutName = $layout;
      } else {
        $layoutName = $controllerName;
      }
      $this-&gt;_layoutsDir=$this-&gt;getRightPath($layoutsDir.$layoutName).$layoutsDir;
      return parent::render($controllerName, $actionName, $vars);
    }
    public function partial($partialPath, $vars = [])
      {
      if(!$this-&gt;_partialsDir) $this-&gt;_partialsDir='partials/';
      $this-&gt;_partialsDir=$this-&gt;getRightPath($this-&gt;_partialsDir.$partialPath).$this-&gt;_partialsDir;
      return parent::partial($partialPath, $vars);
    }
}</code></pre>
<p>I think it's more complete and usable by web designers now.
In my project I use modules in order to separate backend and frontend, mantaining the multisite only in the frontend module only.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="44793" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="44793" data-cf-modified-8d3a9e5f03c55dda25fdd20d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="12677" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>