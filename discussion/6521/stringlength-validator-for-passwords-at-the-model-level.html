---
layout: default
title: 'StringLength validator for passwords at the model level - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">StringLength validator for passwords at the model level</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/3666/darknawg63" class="user-moderator-N"><span itemprop="name">Darknawg63</span></a></span>
            <time itemprop="dateCreated" datetime="2015-04-24T06:36:41-07:00">Apr '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-04-24T06:36:41-07:00">Apr '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Apr '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>1007</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/aaf0c9c696e4d632c25559e51d516bfa?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/3666/darknawg63" class="user-moderator-N"><span itemprop="name">Darknawg63</span></a></span>
                <span class="karma">2.6k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C6521" href="#C6521">
        <time class="action-date">Apr '15</time>
    </a>
</div>
<div class="post-content"><div><p>Hi community,</p>
<p>I would like to do StringLength validator in the users model on passwords entered in a view for registration. Minimum of 6 characters Max 60. The received password string is hashed in the users controller before it is saved to the model, so it is always 59 characters in length due hashing. So even if the users picks a password with 2 characters, it will pass stringlength constraints. </p>
<p>What should I do? I wish to use a model validator.</p>
<p>Cheers!</p>
<p>DN</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-255335959264277f8b95f67b-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-255335959264277f8b95f67b-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2b891f8ed6874e0ff0ea1374bcee24ab?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2659/ShadMickelberry" class="user-moderator-N"><span itemprop="name">Shad Mickelberry</span></a>        </span>
        <br>

        <span class="karma">4.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C17608" href="#C17608">
                <time itemprop="dateCreated" datetime="2015-04-24T08:44:15-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I know this probably isn't what you were looking for but why not just verify the length in the controller before hashing along with the length using javascript before submission?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17608" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17608" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/aaf0c9c696e4d632c25559e51d516bfa?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3666/darknawg63" class="user-moderator-N"><span itemprop="name">Darknawg63</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C17608"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/2b891f8ed6874e0ff0ea1374bcee24ab?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Shad Mickelberry                    </a>
                </div><div class="posts-buttons" align="right"><a name="C17610" href="#C17610">
                <time itemprop="dateCreated" datetime="2015-04-24T09:05:01-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for your reply. I may end up trying that, but I'd like the validator because of the ease of appending messages. We usually try to work it out with the given functionality, and if that can't work as expected, we bolt on.</p>
<blockquote>
<p>I know this probably isn't what you were looking for but why not just verify the length in the controller before hashing along with the length using javascript before submission?</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17610" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17610" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fb35f447c5edce740bc88e405d5eb3af?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/742/cspeak" class="user-moderator-N"><span itemprop="name">Steven</span></a>        </span>
        <br>

        <span class="karma">5.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C17611" href="#C17611">
                <time itemprop="dateCreated" datetime="2015-04-24T09:17:10-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You could validate the length in the in the <code>validation()</code> function, then hash the password in the `afterValidation() function.</p>
<p>Just make sure that you check for changes using <code>$this-&gt;keepSnapshots(true);</code> in your <code>initialize()</code> function so that you only validate the password length when it was actually changed. You can check for changes like so:</p>
<pre><code class="language-php">
public function initialize() {

     // Keep a snapshot of the model
    $this-&gt;keepSnapshots(true);
}

public function validation(){

    // Setup the validator
    $this-&gt;validate(new \Phalcon\Mvc\Model\Validator\StringLength(array(
            'field' =&gt; 'password',
            'max' =&gt; 60,
            'min' =&gt; 6,
            'messageMaximum' =&gt; 'Your password is too long.',
            'messageMinimum' =&gt; 'Your password is too short.'
    )));

    return !$this-&gt;validationHasFailed();
}

public function afterValidation(){

    // If there has been a change in the password, re-hash it
    if($this-&gt;hasChanged('password')){
        $this-&gt;password = password_hash($this-&gt;password, PASSWORD_BCRYPT)
    }

}</code></pre>
<p><a href="http://docs.phalcon.io/en/latest/reference/models.html#record-snapshots">More Info on Recording Snapshots</a></p>
<p>I didn't test that code specifically but it should point you in the right direction</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17611" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17611" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/aaf0c9c696e4d632c25559e51d516bfa?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3666/darknawg63" class="user-moderator-N"><span itemprop="name">Darknawg63</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C17611"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/fb35f447c5edce740bc88e405d5eb3af?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Steven                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="17614" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '15</span>
              </span><br/><a name="C17614" href="#C17614">
                <time itemprop="dateCreated" datetime="2015-04-24T09:25:01-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for the reply. I didn't know about the afterValidation function. I thought the last stop was validation, so I should have read a little further. I see also  a beforeValidation as well. I'll quickly check this out.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17614" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17614" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/aaf0c9c696e4d632c25559e51d516bfa?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3666/darknawg63" class="user-moderator-N"><span itemprop="name">Darknawg63</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C17611"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/fb35f447c5edce740bc88e405d5eb3af?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Steven                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="17617" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '15</span>
              </span><br/><a name="C17617" href="#C17617">
                <time itemprop="dateCreated" datetime="2015-04-24T09:49:21-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Well, the validation seems to work, but the model kicks out a message &quot;The record doesn't have a valid data snapshot&quot; when trying to save the user. I have included $this-&gt;keepSnapshots(true) in the initialize. Any idea what causes this. I try to search the forum, but nothing on this.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17617" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17617" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fb35f447c5edce740bc88e405d5eb3af?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/742/cspeak" class="user-moderator-N"><span itemprop="name">Steven</span></a>        </span>
        <br>

        <span class="karma">5.7k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C17619" href="#C17619">
                <time itemprop="dateCreated" datetime="2015-04-24T10:07:51-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Sorry about that. It sounds like you were adding the user, which in that case, there wouldn't be a valid snapshot since there isn't anything to take a snapshot of.</p>
<p>Remov the <code>afterValidation()</code> function and replace it with the following two:</p>
<pre><code class="language-php">public function afterValidationOnCreate(){

    // Always hash the password on update
    $this-&gt;password = password_hash($this-&gt;password, PASSWORD_BCRYPT)
}

public function afterValidationOnUpdate(){

    // If there has been a change in the password, re-hash it
    if($this-&gt;hasChanged('password')){
        $this-&gt;password = password_hash($this-&gt;password, PASSWORD_BCRYPT)
    }

}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17619" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17619" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/aaf0c9c696e4d632c25559e51d516bfa?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3666/darknawg63" class="user-moderator-N"><span itemprop="name">Darknawg63</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C17619"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/fb35f447c5edce740bc88e405d5eb3af?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Steven                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="17621" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '15</span>
              </span><br/><a name="C17621" href="#C17621">
                <time itemprop="dateCreated" datetime="2015-04-24T10:17:09-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I'll credit you for the answer, though I just ended up removing the hasChanged method from afterValidation(). I can't find in the documentation anything like afterValidationOnCreate(). Could you give a link?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17621" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17621" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fb35f447c5edce740bc88e405d5eb3af?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/742/cspeak" class="user-moderator-N"><span itemprop="name">Steven</span></a>        </span>
        <br>

        <span class="karma">5.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C17622" href="#C17622">
                <time itemprop="dateCreated" datetime="2015-04-24T10:24:35-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you for accepting the answer. Here is a link to the docs for the model events: <a href="http://docs.phalcon.io/en/latest/reference/models.html#events-and-events-manager">Model Events And Event Manager</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17622" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17622" data-cf-modified-255335959264277f8b95f67b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="6521" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>