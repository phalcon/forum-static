---
layout: default
title: 'Password Confirmation - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Password Confirmation</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/437/kadinho" class="user-moderator-N"><span itemprop="name">kadinho</span></a></span>
            <time itemprop="dateCreated" datetime="2013-09-07T18:23:17-07:00">Sep '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-09-07T18:23:17-07:00">Sep '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Aug '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>3073</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/9a460e5b055be41989b9cdcaa18851d2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/437/kadinho" class="user-moderator-N"><span itemprop="name">kadinho</span></a></span>
                <span class="karma">11.5k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C869" href="#C869">
        <time class="action-date">Sep '13</time>
    </a>
</div>
<div class="post-content"><div><p>Hello,</p>
<p>I have the following function in users model:</p>
<pre><code class="language-php">
    public function validation()
    {

      $this-&gt;validate(new EmailValidator(array(
        'field' =&gt; 'email',
        'message' =&gt; 'O campo Email não tem um endereço de email válido.'
      )));

       $this-&gt;validate(new Uniqueness(
            array(
                "field"   =&gt; "username",
                "message" =&gt; "O username já existe!"
            ))       
       );

       $this-&gt;validate(new Uniqueness(
            array(
                "field"   =&gt; "numero",
                "message" =&gt; "O numero já existe!"
            ))       
       );

       $this-&gt;validate(new Uniqueness(
            array(
                "field"   =&gt; "email",
                "message" =&gt; "O email já existe!"
            ))       
       );

       return $this-&gt;validationHasFailed() != true;

    }
</code></pre>
<p>I have 2 password fields to validate , password and confirm password, so can i use this function to validate the password / confirm password ?? how ??</p>
<p>thx!</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-c9561cdad279237434cbef2e-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-c9561cdad279237434cbef2e-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3366" href="#C3366">
                <time itemprop="dateCreated" datetime="2013-09-09T07:23:20-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I think that use the models validation would not be useful here since the password confirmation is not a field in the table. You can use the validators in the Validator component or Form component to set up that validation:</p>
<p><a href="https://github.com/phalcon/vokuro/blob/master/app/forms/SignUpForm.php#L64">https://github.com/phalcon/vokuro/blob/master/app/forms/SignUpForm.php#L64</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3366" data-cf-modified-c9561cdad279237434cbef2e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3366" data-cf-modified-c9561cdad279237434cbef2e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fb35f447c5edce740bc88e405d5eb3af?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/742/cspeak" class="user-moderator-N"><span itemprop="name">Steven</span></a>        </span>
        <br>

        <span class="karma">5.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="15225" data-toggle="modal" data-target="#historyModal">
                edited <span>Jan '15</span>
              </span><br/><a name="C15225" href="#C15225">
                <time itemprop="dateCreated" datetime="2015-01-23T08:10:54-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you for a response here Phalcon. Maybe you could help come up with an idea to make the validation a bit more... Model Friendly, if you will.</p>
<p>I've been working on a REST api where there aren't any form components. Yes, we could add them. Pass all API data to the form component and continue that route, but it adds another unnecessary layer of management (form component filtering/validation followed by the database validation).</p>
<p>I do understand that at the ORM level, this would not compare to values in the database, but instead another property in the current object. So as to why it is not part of the Model Validator, I do understand, to a point.</p>
<p>Here is part of the class to show how we envisioned this working.</p>
<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model\Validator\Uniqueness,
    Phalcon\Mvc\Model\Validator\Email,
    Phalcon\Mvc\Model\Validator\StringLength;

class Users extends \Phalcon\Mvc\Model {
    ...
    protected $email_address;
    protected $password;
    protected $confirm_password;
    ...
    public function setEmailAddress($email_address)
    {
        $this-&gt;email_address = $email_address;
        return $this;
    }

    public function setPassword($password)
    {
        $this-&gt;password = $password;

        return $this;
    }
    public function setConfirmPassword($confirm_password)
    {
        $this-&gt;confirm_password = $confirm_password;

        return $this;
    }

    // Getters here
    ...

    // Column Mapping - Does not include confirm_password
    public function columnMap()
    {
        return array(
            'email_address' =&gt; 'email_address',
            'password' =&gt; 'password',
        );
    }

    public function validation(){
        $this-&gt;validate(new \Phalcon\Mvc\Model\Confirmation([
            'field' =&gt; 'password',

            'with' =&gt; 'confirm_password',
            ... or ...
            'with_value' =&gt; $this-&gt;getConfirmPassword(),
            'message' =&gt; 'Password\'s do not match'
        ]));    

        return !$this-&gt;validationHasFailed();
    }

}</code></pre>
<p>The other way we've looked into doing this is to use beforeValidationOnUpdate/beforeValidationOnCreate. This just feels like a hack for something that should be much more simple.</p>
<pre><code class="language-php">    public function beforeValidationOnCreate(){
        $confirm_data = [
            'password' =&gt; $this-&gt;getPassword(),
            'confirm_password' =&gt; $this-&gt;getConfirmPassword()
        ];

        $validator = new Phalcon\Validation();
        $validator-&gt;add('password', new \Phalcon\Validation\Validator\Confirmation(array(
            'message' =&gt; 'Password doesn\'t match confirmation',
            'with' =&gt; 'confirm_password'
        )));

        $messages = $validator-&gt;validate($confirm_data);
        if (count($messages)) {
            foreach ($messages as $message) {
                $model_message = new Phalcon\Mvc\Model\Message(
                    $message-&gt;getMessage(),
                    'password',
                    'ConfirmPassword'
                );
                $this-&gt;appendMessage($model_message);
            }
            return false;
        }
    }
</code></pre>
<p>The above method does work, but again, it doesn't feel right.</p>
<pre><code class="language-php">    public function validation(){
        $this-&gt;validate(new \Phalcon\Mvc\Model\Confirmation([
            'field' =&gt; 'password',

            'with' =&gt; 'confirm_password',
            ... or ...
            'with_value' =&gt; $this-&gt;getConfirmPassword(),
            'message' =&gt; 'Password\'s do not match'
        ]));    

        return !$this-&gt;validationHasFailed();
    }</code></pre>
<p>This method feels much more &quot;natural&quot; if you will, versus the beforeValidationOn[Create/Update] method above.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15225" data-cf-modified-c9561cdad279237434cbef2e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15225" data-cf-modified-c9561cdad279237434cbef2e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/093520928e06f3b83459f14191d4bcd0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4693/belizeno" class="user-moderator-N"><span itemprop="name">belizeno</span></a>        </span>
        <br>

        <span class="karma">616</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C22169" href="#C22169">
                <time itemprop="dateCreated" datetime="2015-08-20T16:52:31-07:00" class="action-date">Aug '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi,</p>
<p>Just wondering if you ever figured this out?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="22169" data-cf-modified-c9561cdad279237434cbef2e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="22169" data-cf-modified-c9561cdad279237434cbef2e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="869" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>