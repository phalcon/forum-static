---
layout: default
title: 'REST API in MVC - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">REST API in MVC</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/125/salarmehr" class="user-moderator-N"><span itemprop="name">Reza</span></a></span>
            <time itemprop="dateCreated" datetime="2014-06-12T22:13:21-07:00">Jun '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-06-12T22:13:21-07:00">Jun '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Apr '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">6</span>
                </td>
                <td>
                    <label>Views</label><br>4826</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/2735edb490f9406bfc891bba909a2b28?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/125/salarmehr" class="user-moderator-N"><span itemprop="name">Reza</span></a></span>
                <span class="karma">22.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2553" href="#C2553">
        <time class="action-date">Jun '14</time>
    </a>
</div>
<div class="post-content"><div><p>I need to use the <code>Phalcon\Mvc\Micro</code> REST features in a non-micro application. I tried the following code:</p>
<pre><code class="language-php">&lt;?php

class ApiController extends Phalcon\Mvc\Controller
{

   public function postAction()
    {

        $app = new Phalcon\Mvc\Micro();
        $app-&gt;setDI($this-&gt;di);

        $app-&gt;get('/api/post', function ($id=null) {
            echo "&lt;h1&gt;GET $id!&lt;/h1&gt;";
        });
        $app-&gt;post('/api/post', function ($id=null) {
            echo "&lt;h1&gt;POST $id!&lt;/h1&gt;";
        });
        $app-&gt;notFound(function () use ($app) {
            $app-&gt;response-&gt;setStatusCode(404, "Not Found")-&gt;sendHeaders();
            echo 'This is crazy, but this page was not found!';
        });
        $app-&gt;handle();
    }
}
</code></pre>
<p>Is the above code the best practice?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-21c2a8dd82892d29188d9d57-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-21c2a8dd82892d29188d9d57-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9cc24f35021ac8897a929a314b209126?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1737/waaghals" class="user-moderator-N"><span itemprop="name">waaghals</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8618" href="#C8618">
                <time itemprop="dateCreated" datetime="2014-06-13T09:16:41-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><code>Phalcon\Mvc\Router</code> allows you to limit request on certain HTTP verbs.
Using <code>addGet()</code> limits the call to GET only, <code>getPost()</code> for POST etc.</p>
<p>You can find more in the <a href="http://docs.phalcon.io/en/latest/reference/routing.html#http-method-restrictions">docs</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8618" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8618" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9cc24f35021ac8897a929a314b209126?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1737/waaghals" class="user-moderator-N"><span itemprop="name">waaghals</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8619" href="#C8619">
                <time itemprop="dateCreated" datetime="2014-06-13T09:16:57-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><code>Phalcon\Mvc\Router</code> allows you to limit request on certain HTTP verbs.
Using <code>addGet()</code> limits the call to GET only, <code>getPost()</code> for POST etc.</p>
<p>You can find more in the <a href="http://docs.phalcon.io/en/latest/reference/routing.html#http-method-restrictions">docs</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8619" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8619" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2735edb490f9406bfc891bba909a2b28?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/125/salarmehr" class="user-moderator-N"><span itemprop="name">Reza</span></a>        </span>
        <br>

        <span class="karma">22.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8625" href="#C8625">
                <time itemprop="dateCreated" datetime="2014-06-13T11:15:28-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks, I need to check the method in the <code>action</code> not in the <code>router</code>. Can you please redefine my code with your suggestion you think there is some pros in it?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8625" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8625" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9cc24f35021ac8897a929a314b209126?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1737/waaghals" class="user-moderator-N"><span itemprop="name">waaghals</span></a>        </span>
        <br>

        <span class="karma">2.6k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8626" href="#C8626">
                <time itemprop="dateCreated" datetime="2014-06-13T11:32:52-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You need two different actions, one which handles a POST and the other which handles the GET.
Both these actions do completely different things thus placing them in seperate actions shouldn't be to difficult.
This way you keep the different logic seperate and clear.</p>
<pre><code class="language-php">//Somewhere in bootstrapping
$router-&gt;addGet("/api/model/{id}", array(
        "controller" =&gt; "ApiController",
        "action"     =&gt; "getEndpoint",
));

$router-&gt;addPost("/api/model", array(
        "controller" =&gt; "ApiController",
        "action"     =&gt; "postEndpoint",
));

//Controller
class ApiController extends Phalcon\Mvc\Controller
{

    public function postEndpointAction()
    {
        $m = new Model();
        $m-&gt;property = $this-&gt;request-&gt;getPost("property");
        $m-&gt;save();
    }

    public function getEndpointAction($id)
    {
        return json_encode(Model::FindFirst($id));
    }
}</code></pre>
<p>The ugly way is to store everything in a complex method which checks <code>$request-&gt;isPost()</code> or <code>$request-&gt;isGet()</code>. But above imho is the more cleaner solution.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8626" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8626" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9cc24f35021ac8897a929a314b209126?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1737/waaghals" class="user-moderator-N"><span itemprop="name">waaghals</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8627" href="#C8627">
                <time itemprop="dateCreated" datetime="2014-06-13T11:32:52-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You need two different actions, one which handles a POST and the other which handles the GET.
Both these actions do completely different things thus placing them in seperate actions shouldn't be to difficult.
This way you keep the different logic seperate and clear.</p>
<pre><code class="language-php">//Somewhere in bootstrapping
$router-&gt;addGet("/api/model/{id}", array(
        "controller" =&gt; "ApiController",
        "action"     =&gt; "getEndpoint",
));

$router-&gt;addPost("/api/model", array(
        "controller" =&gt; "ApiController",
        "action"     =&gt; "postEndpoint",
));

//Controller
class ApiController extends Phalcon\Mvc\Controller
{

    public function postEndpointAction()
    {
        $m = new Model();
        $m-&gt;property = $this-&gt;request-&gt;getPost("property");
        $m-&gt;save();
    }

    public function getEndpointAction($id)
    {
        return json_encode(Model::FindFirst($id));
    }
}</code></pre>
<p>The ugly way is to store everything in a complex method which checks <code>$request-&gt;isPost()</code> or <code>$request-&gt;isGet()</code>. But above imho is the more cleaner solution.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8627" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8627" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/65cc66b2174ca0e8408258408af274c2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1371/david-duncan" class="user-moderator-N"><span itemprop="name">David Duncan</span></a>        </span>
        <br>

        <span class="karma">6.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8651" href="#C8651">
                <time itemprop="dateCreated" datetime="2014-06-14T20:04:58-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Check out how this guy uses collections &amp; controllers <a href="https://github.com/cmoore4/phalcon-rest/blob/develop/routes/collections/example.php">https://github.com/cmoore4/phalcon-rest/blob/develop/routes/collections/example.php</a></p>
<p>relevant code :</p>
<pre><code class="language-php">$exampleCollection = new \Phalcon\Mvc\Micro\Collection();

    $exampleCollection
        // VERSION NUMBER SHOULD BE FIRST URL PARAMETER, ALWAYS
        -&gt;setPrefix('/v1/example')
        // Must be a string in order to support lazy loading
        -&gt;setHandler('\PhalconRest\Controllers\ExampleController')
        -&gt;setLazy(true);

    // Set Access-Control-Allow headers.
    $exampleCollection-&gt;options('/', 'optionsBase');
    $exampleCollection-&gt;options('/{id}', 'optionsOne');

    // First paramter is the route, which with the collection prefix here would be GET /example/
    // Second paramter is the function name of the Controller.
    $exampleCollection-&gt;get('/', 'get');</code></pre>
<p>he also set up base rest controllers, and json &amp; csv responses</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8651" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8651" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2735edb490f9406bfc891bba909a2b28?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/125/salarmehr" class="user-moderator-N"><span itemprop="name">Reza</span></a>        </span>
        <br>

        <span class="karma">22.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14203" href="#C14203">
                <time itemprop="dateCreated" datetime="2014-12-16T07:14:35-07:00" class="action-date">Dec '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/waaghals">@waaghals</a> Thanks a lot. It works like a charm.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14203" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14203" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/47d821d30cc26f5d36220a571aa39f01?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3675/sebozz" class="user-moderator-N"><span itemprop="name">sebozz</span></a>        </span>
        <br>

        <span class="karma">515</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C8626"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/9cc24f35021ac8897a929a314b209126?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        waaghals                    </a>
                </div><div class="posts-buttons" align="right"><a name="C17477" href="#C17477">
                <time itemprop="dateCreated" datetime="2015-04-21T14:33:10-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Trying to implement this but keep on failing.</p>
<p>Little more detailed help needed.</p>
<p>My code is based off of INVO application (one of the phalcon tutorials) so it is a good example of the code that I am trying implement your solution into.</p>
<p>Thanks.</p>
<blockquote>
<p>You need two different actions, one which handles a POST and the other which handles the GET.
Both these actions do completely different things thus placing them in seperate actions shouldn't be to difficult.
This way you keep the different logic seperate and clear.</p>
<pre><code class="language-php">//Somewhere in bootstrapping
$router-&gt;addGet("/api/model/{id}", array(
       "controller" =&gt; "ApiController",
       "action"     =&gt; "getEndpoint",
));

$router-&gt;addPost("/api/model", array(
       "controller" =&gt; "ApiController",
       "action"     =&gt; "postEndpoint",
));

//Controller
class ApiController extends Phalcon\Mvc\Controller
{

   public function postEndpointAction()
   {
      $m = new Model();
      $m-&gt;property = $this-&gt;request-&gt;getPost("property");
      $m-&gt;save();
   }

  public function getEndpointAction($id)
   {
      return json_encode(Model::FindFirst($id));
   }
}</code></pre>
<p>The ugly way is to store everything in a complex method which checks <code>$request-&gt;isPost()</code> or <code>$request-&gt;isGet()</code>. But above imho is the more cleaner solution.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17477" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17477" data-cf-modified-21c2a8dd82892d29188d9d57-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2553" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>