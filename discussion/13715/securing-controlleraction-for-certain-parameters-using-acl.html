---
layout: default
title: 'Securing Controller-Action for certain parameters using ACL - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/17/acl">Acl</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Securing Controller-Action for certain parameters using ACL</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/8181/MSPGraphics" class="user-moderator-N"><span itemprop="name">MSPGraphics</span></a></span>
            <time itemprop="dateCreated" datetime="2016-09-18T09:54:09-07:00">Sep '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-09-18T09:54:09-07:00">Sep '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>717</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/3b2daec5fd64c189e40ec239c7992797?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/8181/MSPGraphics" class="user-moderator-N"><span itemprop="name">MSPGraphics</span></a></span>
                <span class="karma">2.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C13715" href="#C13715">
        <time class="action-date">Sep '16</time>
    </a>
</div>
<div class="post-content"><div><p>Hello everybody,</p>
<p>this is my first post and I am still very new to the Phalcon-Framework, but I already love it.
Now I am facing a problem and I couldn't find a way how to solve it yet. The following is only one example, in fact, I have this problem frequently in my application.</p>
<p>In my application, I have two roles, &quot;users&quot; and &quot;admins&quot;. The profiles-controller has an action called &quot;show&quot; in order to show the profile of a user. The parameter of the show-action is the user-id. Now what I want is that regular users (role: user) are only allowed to use the &quot;show&quot;-action with the parameter of their own user-id stored in the session. Admins should be allowed to use any parameter wich allows them to view all profiles of all users. Is this realizable with the Acl-List and a Security-Plugin or is my whole approach wrong or too complicated?</p>
<p>Thank you and all the best,
MSP</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-82b99914c0ee3805ba5156ff-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-82b99914c0ee3805ba5156ff-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0eb658098a90d286b29e99a38e010df3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/6067/ntesic" class="user-moderator-N"><span itemprop="name">ntesic</span></a>        </span>
        <br>

        <span class="karma">1.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="40369" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C40369" href="#C40369">
                <time itemprop="dateCreated" datetime="2016-09-18T10:05:19-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You don't need ACL for that. Simple code in controller action, for example like: if ($user-&gt;id !== $session['id']) { return false; } would be enought</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40369" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40369" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="40391" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C40391" href="#C40391">
                <time itemprop="dateCreated" datetime="2016-09-19T06:16:54-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Well in 3.1.0 i will add Phalcon\Firewall which can be used to securing actions in controllers using acl or annotations. You will get here some options, thanks for idea for adding dispatcher params to it too.</p>
<p>Basically you need to use beforeExecuteRoute and acl. In phalcon 3.0.0 you can implements custom logic in acl, so for example:</p>
<pre><code class="language-php">// Define allow like this
$acl-&gt;allow('ROLE_XYZ', 'SomeController', 'someAction', function ($dispatcherParameters) {
    $userSession = Di::getDefault()-&gt;get('session')-&gt;get('user');
    return $dispatcherParameters['id'] == $userSession;
});
// In controller or beforeExecuteRoute or wherever you want:
$acl-&gt;isAllowed('ROLE_XYZ', 'SomeController', 'someAction', ['dispatcherParameters' =&gt; $this-&gt;dispatcher-&gt;getParams()]</code></pre>
<p>I just recommend add this isAllowed method call in security plugin and that's it.</p>
<p>Check the docs about ACL and new things in 3.0.0:</p>
<p><a href="https://docs.phalcon.io/pl/latest/reference/acl.html#function-based-access">https://docs.phalcon.io/pl/latest/reference/acl.html#function-based-access</a>
<a href="https://docs.phalcon.io/pl/latest/reference/acl.html#objects-as-role-name-and-resource-name">https://docs.phalcon.io/pl/latest/reference/acl.html#objects-as-role-name-and-resource-name</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40391" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40391" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/3b2daec5fd64c189e40ec239c7992797?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8181/MSPGraphics" class="user-moderator-N"><span itemprop="name">MSPGraphics</span></a>        </span>
        <br>

        <span class="karma">2.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40417" href="#C40417">
                <time itemprop="dateCreated" datetime="2016-09-19T07:13:54-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you very much, both of you.</p>
<p><a href="https://forum.phalcon.io/user/6067/ntesic">@ntesic</a>: I could it implement your way, but I also have to check which role is currently trying to access the controller. I guess the whole point of the Acl and Security-Management is to outsource these kinds of verfications.</p>
<p><a href="https://forum.phalcon.io/user/0/wojciech">@wojciech</a>: Perfect, I was aware of the Acl-functions, but I had no clue how to use it for this problem. Thanks a lot.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40417" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40417" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/3b2daec5fd64c189e40ec239c7992797?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8181/MSPGraphics" class="user-moderator-N"><span itemprop="name">MSPGraphics</span></a>        </span>
        <br>

        <span class="karma">2.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41125" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C41125" href="#C41125">
                <time itemprop="dateCreated" datetime="2016-09-30T11:59:00-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi again,
I tried to implement the function based access, but I get the same error every time I try to use it.
Even this little piece of code, will case the error &quot;Fatal error: Uncaught exception 'Exception' with message 'Serialization of 'Closure' is not allowed'&quot;</p>
<pre><code class="language-php">
$acl-&gt;allow($role, $resource, $action, function($param) {
    return $param;
});

$allowed = $acl-&gt;isAllowed($role, $controller, $action, array("param" =&gt; true));
</code></pre>
<p>Basically, the error always appears when I try to set a function as fourth parameter of the &quot;allow&quot;-function.
Any ideas?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41125" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41125" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41127" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C41127" href="#C41127">
                <time itemprop="dateCreated" datetime="2016-09-30T12:14:47-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You can't cache(serialize) acl object when it has closure obviously by default. Just don't use cache for stroing acl. If you still need this functionality then extend acl class and and implement <code>Serializable</code> interface and serialize closure with <code>https://github.com/jeremeamia/super_closure</code> for example</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41127" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41127" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/3b2daec5fd64c189e40ec239c7992797?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8181/MSPGraphics" class="user-moderator-N"><span itemprop="name">MSPGraphics</span></a>        </span>
        <br>

        <span class="karma">2.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41131" href="#C41131">
                <time itemprop="dateCreated" datetime="2016-09-30T13:21:53-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Aaaaah :):) That's it, thank you! I wasn't aware that I was caching the ACL-List, but now it works. I don't the cache-functionality, but thanks for the link anyway.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41131" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41131" data-cf-modified-82b99914c0ee3805ba5156ff-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="13715" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>