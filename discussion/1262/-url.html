---
layout: default
title: 'Дополнение для Url для реализации обратных ссылок - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Дополнение для Url для реализации обратных ссылок</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a></span>
            <time itemprop="dateCreated" datetime="2013-11-28T23:44:34-07:00">Nov '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-11-28T23:44:34-07:00">Nov '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">8</span>
                </td>
                <td>
                    <label>Views</label><br>1118</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">2</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a></span>
                <span class="karma">10.2k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C1262" href="#C1262">
        <time class="action-date">Nov '13</time>
    </a>
</div>
<div class="post-content"><div><p>Всем привет. Появилось немного времени, сделал первую реализацию обещанных обратных ссылок для phalcon.
Для тех, кто не в курсе: стандартная реализации Route в phalcon 1.* не позволяет использовать опциональные параметры и не правильно генерирует обратные ссылки для роутов. Например:</p>
<pre><code class="language-php">$router
  -&gt;add('/admin(/:controller(/:action(/{id:[0-9]+}(/:params)?)?)?)?', array(
    'module'     =&gt; 'backend',
    'controller' =&gt; 2,
    'action'     =&gt; 4,
    'id'         =&gt; 6,
    'params'     =&gt; 8,
  ))
  -&gt;setName('backend');

...

echo $this-&gt;url-&gt;get(array('for'=&gt;'backend', 'controller'=&gt;'users'));</code></pre>
<p>В результате данного кода получим /adminusers? вместо ожидаемого /admin/users. Для многих - это нормально, они не привыкли к опциональным параметрам. Для других (таких, как я) - это плохо.</p>
<p>Теперь немного затравки, чтобы понимать, что дает данный класс для того-же роута:</p>
<pre><code class="language-php">echo $this-&gt;url-&gt;route('backend'); // /admin
echo $this-&gt;url-&gt;route('backend', array('controller' =&gt; 'users')); // /admin/users
echo $this-&gt;url-&gt;route('backend', array('controller' =&gt; 'users', 'action' =&gt; 'add')); // /admin/users/add
echo $this-&gt;url-&gt;route('backend', array('controller' =&gt; 'users', 'action' =&gt; 'edit', 'id' =&gt; 1)); // /admin/users/edit/1
echo $this-&gt;url-&gt;route('backend', array(
    'controller' =&gt; 'users',
    'action' =&gt; 'info',
    'id' =&gt; 1,
    'params' =&gt; array(
        'page' =&gt; 1,
        'limit' =&gt; 10,
    ),
)); // /admin/users/info/1/page/1/limit/10</code></pre>
<p>Удобно, правда?) Реализация: <a href="https://gist.github.com/aktuba/7702229">https://gist.github.com/aktuba/7702229</a> . Есть вопросы - задавайте.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-4fd499348eac1a37caa4573a-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-4fd499348eac1a37caa4573a-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4484" href="#C4484">
                <time itemprop="dateCreated" datetime="2013-11-29T02:31:20-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Sorry, but I do not understand the magic of indexation </p>
<pre><code class="language-php">'controller' =&gt; 2,
'action'     =&gt; 4,
'params'     =&gt; 6,</code></pre>
<p>What does this index?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4484" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4484" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4485" href="#C4485">
                <time itemprop="dateCreated" datetime="2013-11-29T03:29:47-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/Oleg">@Oleg</a>, ты же вроде по-русски говоришь?) Индексы немного поправил, до этого был старый роут, скопипастил его сюда, изменил, а индексы поменять забыл. Сейчас вроде правильные.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4485" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4485" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4486" href="#C4486">
                <time itemprop="dateCreated" datetime="2013-11-29T04:09:34-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Конечно, говорю.
Мне такая реализация не нравится. Это, конечно же, не значит, что она не имеет права на жизнь.
Если это коиу-то подходит - пусть использует.
Я за абсолютную однозначность в определениях. У вас же индексация идет в разрез с правилами индексации в Phalcon.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4486" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4486" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4488" href="#C4488">
                <time itemprop="dateCreated" datetime="2013-11-29T05:13:10-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Где индексация идет в разрез?) Встроенные классы phalcon вообще не трогаются, индексация стандартная ;)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4488" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4488" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4489" href="#C4489">
                <time itemprop="dateCreated" datetime="2013-11-29T06:41:29-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Почему 2 4 6 8, но не 1 2 3 4?
Ну это ладно...
У вас в корневом примере роутер описан, как такой, что может содержать или не содержать controller, action etc.
В этом я вижу неоднозначность.
При обратном преобразовании невозможно точно определить роут, так как возможны несколько исходов.
Я избегаю такую практику в своей деятельности.
В даном случае вижу &quot;силовое назначение&quot; при обратном преобразовании, и, насколько я увидел, опять происходит возврат к нормальной структуре - module/controller/action/params.
Так что целесообразности не вижу.
Но я за свободу в программировании (пока она не мешает другим, конечно :) ). Так что, если кому-то это принесет пользу - будет хорошо</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4489" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4489" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4490" href="#C4490">
                <time itemprop="dateCreated" datetime="2013-11-29T07:51:24-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Почему 2 4 6 8, но не 1 2 3 4?</p>
</blockquote>
<p>Потому-что в регулярке они под такими параметрами идут. Скобки видишь?</p>
<blockquote>
<p>При обратном преобразовании невозможно точно определить роут, так как возможны несколько исходов.</p>
</blockquote>
<p>Т.е.? Почему нельзя определить роут? о_О</p>
<blockquote>
<p>В даном случае вижу &quot;силовое назначение&quot; при обратном преобразовании, и, насколько я увидел, опять происходит возврат к нормальной структуре - module/controller/action/params.</p>
</blockquote>
<p>Ты о чем? Какой &quot;возврат&quot; в формировании урлов? Почему &quot;module/controller/action/params&quot; - &quot;нормальная структура&quot;, а &quot;module/controller/action/id&quot; - нет?
Можешь чуть подробней рассказать, а то не совсем понятно что ты имеешь в виду.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4490" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4490" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4491" href="#C4491">
                <time itemprop="dateCreated" datetime="2013-11-29T08:00:47-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>По поводу целесообразности - создано для удобства (не только, но в основном). Например, если сделать такой роут</p>
<pre><code class="language-php">$router
  -&gt;add('/admin/:controller/:action', array(
    'module'     =&gt; 'backend',
    'controller' =&gt; 1,
    'action'     =&gt; 2,
  ))
  -&gt;setName('backend');</code></pre>
<p>то в урлах всегда будет /admin/users/index, где /index явно лишний. А в некоторых случаях (имею в виду seo, будь оно не ладно) еще и вредным. Если сделать action в роуте опциональным - все будет отлично. Причем, такой роут (с опциональным action) даже работать будет правильно, и ссылки будут формироваться правильно. Но стоит добавить 3-4-5-... опциональных параметров - phalcon впадает в ступор. Потому и появился данный класс.</p>
<p>Вот еще пример:</p>
<pre><code class="language-php">$this-&gt;url-&gt;get(array('for'=&gt;'backend/default'));
$this-&gt;url-&gt;get(array('for'=&gt;'backend/users'));
$this-&gt;url-&gt;get(array('for'=&gt;'backend/users/new'));
$this-&gt;url-&gt;get(array('for'=&gt;'backend/users/edit', 'id'=&gt;$id));</code></pre>
<p>сравни с </p>
<pre><code class="language-php">$this-&gt;url-&gt;get(array('for'=&gt;'backend'));
$this-&gt;url-&gt;get(array('for'=&gt;'backend', 'controller'=&gt;'users'));
$this-&gt;url-&gt;get(array('for'=&gt;'backend', 'controller'=&gt;'users', 'action'=&gt;'new'));
$this-&gt;url-&gt;get(array('for'=&gt;'backend', 'controller'=&gt;'users', 'action'=&gt;'edit', 'id'=&gt;$id));</code></pre>
<p>Лично мне второе намного проще воспринимать и поддерживать: я сразу вижу модуль, контроллер, действие и параметры. А в первом случае ничего, кроме названия роута, не видно. Ни в какой модуль пойдет запрос, ни в какой контроллер, ни в какой action...</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4491" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4491" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4493" href="#C4493">
                <time itemprop="dateCreated" datetime="2013-11-29T08:39:55-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Давайте возьмем ваш образец роута и протестируем во фреймворке :</p>
<pre><code class="language-php">&lt;?php

$url = new Phalcon\Mvc\Url();

$url-&gt;setBaseUri('/');

$router = new Phalcon\Mvc\Router();

$router
  -&gt;add('/admin(/:controller(/:action(/{id:[0-9]+}(/:params)?)?)?)?', [
    'module'     =&gt; 'backend',
    'controller' =&gt; 2,
    'action'     =&gt; 4,
    'params'     =&gt; 6,
  ])
  -&gt;setName('backend');

$testRoutes = [
'/admin',
'/admin/users',
'/admin/users/edit/123',
'/admin/config/edit',
'/admin/pages/new',
'/admin',
'/admin/users',
'/admin/users/1',
'/admin/users/1/edit',
'/admin/pages',
'/admin/pages/contacts',
'/admin/pages/contacts/edit',
'/admin/users/info/1/page/1/limit/10',
];

foreach ($testRoutes as $testRoute) {

    $router-&gt;handle($testRoute);
    echo 'Test route : ', $testRoute, '&lt;br&gt;', PHP_EOL;

    if ($router-&gt;wasMatched()) {
        echo 'Controller : ', $router-&gt;getControllerName(), '&lt;br&gt;', PHP_EOL;
        echo 'Action : ', $router-&gt;getActionName(), '&lt;br&gt;', PHP_EOL;
    } else {
        echo "The route was't matched...&lt;br&gt;", PHP_EOL;
    }
    echo '&lt;br&gt;', PHP_EOL;
} </code></pre>
<p>Имеем результат :</p>
<pre><code class="language-html">Test route : /admin
Controller : 
Action : 

Test route : /admin/users
Controller : users
Action : 

Test route : /admin/users/edit/123
Controller : admin
Action : users

Test route : /admin/config/edit
Controller : config
Action : edit

Test route : /admin/pages/new
Controller : pages
Action : new

Test route : /admin
Controller : pages
Action : new

Test route : /admin/users
Controller : users
Action : new

Test route : /admin/users/1
Controller : users
Action : new

Test route : /admin/users/1/edit
Controller : admin
Action : users

Test route : /admin/pages
Controller : pages
Action : users

Test route : /admin/pages/contacts
Controller : pages
Action : contacts

Test route : /admin/pages/contacts/edit
Controller : admin
Action : pages

Test route : /admin/users/info/1/page/1/limit/10
Controller : admin
Action : users</code></pre>
<p>Возьмем первый же роут - вопрос - куда идем после /admin?
Вот это я и не понимаю. Я взял ваши выкладки для тестирования.
Поэтому и говорю, что использовать такое не буду.
К тому же у меня уже давненько таких проблем с роутерами и не возникает.
Понравилось использовать роуты в аннотациях.
И, соответственно, с обратными ссылками неурядиц не наблюдается.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4493" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4493" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4494" href="#C4494">
                <time itemprop="dateCreated" datetime="2013-11-29T10:14:44-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Вон вы о чем))). Уважаемый, вы будете удивлены, но... Это стандартная работа роутера phalcon. Повторюсь: это работа phalcon, а не моего класса. Не верите?) Удалите мой класс и сравните результаты). Ну а если проставите дефолтные значения - все встанет на свои места ;).</p>
<p>Мой класс дополняет (даже не изменяет, а только дополняет!!!) класс \Phalcon\Mvc\Url, который не имеет вообще никакого отношения к обработке входящих урлов ;). Видимо, сам роут ввел вас в некоторое заблуждение, давайте объясню. Возьмем роут попроще, например:</p>
<pre><code class="language-php">$router
  -&gt;add('/:controller/:action', array(
    'controller' =&gt; 1,
    'action'     =&gt; 2,
  ))
  -&gt;setName('default');</code></pre>
<p>Проще можно, но смысла нет). Теперь представим, что есть сайт с этим роутом и 30-40 вьюх. Во вьюхах есть какие-то ссылки. Судя по тому, что вы писали выше, скорее всего они выглядят так:</p>
<pre><code class="language-php">&lt;a href="/main/index"&gt;Ссылка 1&lt;/a&gt;
&lt;a href="/post/title"&gt;Пост&lt;/a&gt;
&lt;a href="/comment/view"&gt;Комментарий&lt;/a&gt;
...</code></pre>
<p>или так:</p>
<pre><code class="language-php">&lt;a href="&lt;?= $this-&gt;url-&gt;get('main/index') ?&gt;"&gt;Ссылка 1&lt;/a&gt;
&lt;a href="&lt;?= $this-&gt;url-&gt;get('post/title') ?&gt;"&gt;Пост&lt;/a&gt;
&lt;a href="&lt;?= $this-&gt;url-&gt;get('comment/view') ?&gt;"&gt;Комментарий&lt;/a&gt;
...</code></pre>
<p>Есть еще вариант, когда на каждую ссылку (ну или почти) создается свой роут, но его в расчет не берем, т.к. сути это не меняет. Т.е., фактически, урлы прописаны руками. Что будете делать, когда понадобится, например, добавить к каждой ссылке окончание .html? А если в начале поставить action, а после contoller? Помимо изменения роута придется и пролопатить все 30-40 вьюх (а возможно еще и кучу других файлов), чтобы ручками поменять все ссылки. Верно?</p>
<p>А вот мой вариант. Меняем чуть-чуть роут:</p>
<pre><code class="language-php">$router
  -&gt;add('(/:controller(/:action)?)?', array(
    'controller' =&gt; 2,
    'action'     =&gt; 4,
  ))
  -&gt;setName('default');</code></pre>
<p>И ссылки ставим вот так:</p>
<pre><code class="language-php">&lt;a href="&lt;?= $this-&gt;url-&gt;route('default', array('controller'=&gt;'main')) ?&gt;"&gt;Ссылка 1&lt;/a&gt;
&lt;a href="&lt;?= $this-&gt;url-&gt;route('default', array('controller'=&gt;'post', 'action'=&gt;'title')) ?&gt;"&gt;Пост&lt;/a&gt;
&lt;a href="&lt;?= $this-&gt;url-&gt;route('default', array('controller'=&gt;'comment', 'action'=&gt;'view')) ?&gt;"&gt;Комментарий&lt;/a&gt;</code></pre>
<p>Что надо сделать, чтобы поменять все эти ссылки на сайте? Всего-лишь поменять роут. Все. Надеюсь я понятно объяснил, но если есть вопросы - задавайте.</p>
<p>P.S.: аннотации воспринимаю очень плохо, поэтому вряд-ли буду дорабатывать класс для них (</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4494" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4494" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4495" href="#C4495">
                <time itemprop="dateCreated" datetime="2013-11-29T12:11:50-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Да, я увидел вашу идею, но не соглашусь в ее пользе. Такое мое мнение.
Есть масса способов произвести рефакторинг ссылок, и не только, в проекте.
По крайней мере у меня никогда не возникало такого затруднения.
Пока есть linux, vim &amp; sed :)
Ну и, к тому же, я придерживаюсь строгости (однозначности) в формировании ссылок.
Динамике это не мешает.
Happy weekend :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4495" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4495" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4496" href="#C4496">
                <time itemprop="dateCreated" datetime="2013-11-29T12:24:54-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ну соглашаться я никого не заставляю, как и использовать).
Но вообще, довольно странно, когда рефакторинг предпочитают изначально правильному проектированию o_O.
И вопрос: можете подробнее рассказать про &quot;строгость (однозначность) в формировании ссылок&quot;? Я считаю, что у меня все строго и однозначно, но похоже в чем-то ошибаюсь. Хотелось-бы понять в чем...</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4496" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4496" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4497" href="#C4497">
                <time itemprop="dateCreated" datetime="2013-11-29T14:41:58-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>К счастью, мне еще не приходилось заниматься переделыванием ссылок.
Тем более переименование модулей и контроллеров.
И index контроллер, впрочем, как и index action, у меня, как правило, отсутствуют.
Как-то все решается на начальной стадии проектирования.
Так что потом только добавление при необходимости.
Может, везет</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4497" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4497" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4498" href="#C4498">
                <time itemprop="dateCreated" datetime="2013-11-29T14:51:47-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ок, это я понял. У каждого свой путь, это нормально.
Но я не увидел ответ на &quot;строгость (однозначность) в формировании ссылок&quot;. Что под этим подразумевалось? Отсутствие дефолтных контроллеров/действий? Тогда это странный критерий. И если отсутствие дефолтного контроллера я еще как-то могу понять (хоть и с большим трудом), то отсутствие дефолтного action не воспринимаю. Причина: неоднозначность ссылок ;). Получается, что ссылка выглядит (например) как /posts, но дефолтного действия нет, а значит в роутере жестко прописывается action, который может быть чем угодно... В случае наличия дефолтных параметров, они подставляются если отсутствуют в ссылке, т.е. видя /posts понимаешь сразу, что это контроллер Posts и действие index... Как-то так.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4498" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4498" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4499" href="#C4499">
                <time itemprop="dateCreated" datetime="2013-11-29T15:40:33-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Я даже не знаю, как вам точно объяснить этот мой принцип.
Однозначное трактование...
Наверное, это когда каждому модулю/контроллеру/действию соответствует один, и только один маршрут.
Маршрут может передавать любые параметры, но эти параметры должны быть строго типизированы.
Наверное, как-то так.
Дефолтные контроллеры и действия, конечно же есть. Просто я их называю всегда более осмысленно.
В URI их всегда можно скрыть.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4499" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4499" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4501" href="#C4501">
                <time itemprop="dateCreated" datetime="2013-11-30T01:59:51-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ясно. Мне данный путь не подходит, я привык автоматизировать свою работу.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4501" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4501" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/23f127b8afebc5e0cedb57e4eb524af7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/33/xboston" class="user-moderator-Y"><span itemprop="name">Nikolay Kirsh</span></a>        </span>
        <br>

        <span class="karma">5.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4536" href="#C4536">
                <time itemprop="dateCreated" datetime="2013-12-03T09:24:51-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Хорошее и правильное решение проблемы и реализация поставленной задачи. Сможешь разместить код в Инкубаторе  ( <a href="https://github.com/phalcon/incubator">https://github.com/phalcon/incubator</a> ) ? В пространстве \Phalcon\Mvc\Url , как вариант расширения стандартного роутера ;)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4536" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4536" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4537" href="#C4537">
                <time itemprop="dateCreated" datetime="2013-12-03T09:32:44-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Рано, нашел пару багов, все времени нет поправить. Как протестирую в боевом окружении - потом постараюсь добавить в инкубатор.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4537" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4537" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4562" href="#C4562">
                <time itemprop="dateCreated" datetime="2013-12-06T00:02:27-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Поправил класс, багов пока не нашел: <a href="https://github.com/aktuba/phalcon-url">https://github.com/aktuba/phalcon-url</a>
В Инкубатор не стал добавлять. Если не сложно,<a href="https://forum.phalcon.io/user/0/boston"> @boston</a>, сделай сам plz.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4562" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4562" data-cf-modified-4fd499348eac1a37caa4573a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="1262" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>