---
layout: default
title: 'On duplicate key update - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">On duplicate key update</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/203/dimhoLt" class="user-moderator-N"><span itemprop="name">dimhoLt</span></a></span>
            <time itemprop="dateCreated" datetime="2014-05-09T10:30:04-07:00">May '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-05-09T10:30:04-07:00">May '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>2588</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/c17126b287f7a68ffaf35acc558391d5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/203/dimhoLt" class="user-moderator-N"><span itemprop="name">dimhoLt</span></a></span>
                <span class="karma">22.6k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2266" href="#C2266">
        <time class="action-date">May '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hello!</p>
<p>I've been looking through the documentation (and Google) for how to set <code>on duplicate key update</code> in the models. All I've seen is basically writing custom queries to do this, but I feel that there must be some behavior that can be set in the model initialization or similar. In my table, I have a <code>unique index (col1, col2)</code>, and basically, it only contains two values. If it does not exist, create it. If it exists, update <code>col2</code>.</p>
<p>Can someone point me in the right direction?</p>
<p>Thanks.</p>
<p>// dimhoLt</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-a7f717805797c9d4d6837bc2-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-a7f717805797c9d4d6837bc2-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c17126b287f7a68ffaf35acc558391d5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/203/dimhoLt" class="user-moderator-N"><span itemprop="name">dimhoLt</span></a>        </span>
        <br>

        <span class="karma">22.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7802" href="#C7802">
                <time itemprop="dateCreated" datetime="2014-05-12T06:59:15-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Bump.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7802" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7802" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1baf5073b80f8a6e4a7bb5024f24939d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/833/alexconrad" class="user-moderator-N"><span itemprop="name">alexconrad</span></a>        </span>
        <br>

        <span class="karma">2.7k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7821" href="#C7821">
                <time itemprop="dateCreated" datetime="2014-05-12T17:53:03-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>on duplicate key update is not a sql standard. It's pretty much specific to MySQL. If you want your scripts to actually execute the mysql query with on duplicate key update, with Phalcon, you will have no choice but to have custom queries. If you just want the logic of the &quot;on duplicate key update&quot; (i doubt it), you can use beforeValidationOnCreate, check with select if the primary and/or unique key exist  and if found, run update and fail validation so the insert wont be done.
If you are running slave/master mysql servers, make sure to check if the keys exist using the master connection, not on the slave connection.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7821" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7821" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c17126b287f7a68ffaf35acc558391d5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/203/dimhoLt" class="user-moderator-N"><span itemprop="name">dimhoLt</span></a>        </span>
        <br>

        <span class="karma">22.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7827" href="#C7827">
                <time itemprop="dateCreated" datetime="2014-05-13T01:51:09-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you for your answer. I'm not sure, however, why there would be any doubt that I would want this logic. Is there perhaps some best practices you're referring to that I may have missed?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7827" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7827" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1baf5073b80f8a6e4a7bb5024f24939d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/833/alexconrad" class="user-moderator-N"><span itemprop="name">alexconrad</span></a>        </span>
        <br>

        <span class="karma">2.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7837" href="#C7837">
                <time itemprop="dateCreated" datetime="2014-05-13T05:10:41-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>i said &quot;i doubt it&quot; just because from your question i was 99% sure that you want to run a single mysql query INSERT ... ON DUPLICATE KEY instead of 2 queries.It was not because of some &quot;best practices&quot; thing :) From my unpopular point of view, MySql's LIMIT,and ON DUPLICATE KEY should become sql standard.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7837" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7837" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c17126b287f7a68ffaf35acc558391d5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/203/dimhoLt" class="user-moderator-N"><span itemprop="name">dimhoLt</span></a>        </span>
        <br>

        <span class="karma">22.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7840" href="#C7840">
                <time itemprop="dateCreated" datetime="2014-05-13T06:26:01-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I see. Thank you for your extended explanation =) Yes, I was looking to do that. However, in this case, I'm going to solve this particular issue in a Service using this particular model instead to retain a consistent model behaviour / interface.</p>
<p>I agree, those things are wonderful and should exist everywhere. Recently switched to MariaDB which I so far like very well (MySQL fork ofc).</p>
<p>Thank you again!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7840" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7840" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0cf517c6defc0a91e2256508e3302e70?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/5697/cgaugel" class="user-moderator-N"><span itemprop="name">Christian Gaugel</span></a>        </span>
        <br>

        <span class="karma">621</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50889" href="#C50889">
                <time itemprop="dateCreated" datetime="2017-09-08T05:17:15-07:00" class="action-date">Sep '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Anything new here?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50889" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50889" data-cf-modified-a7f717805797c9d4d6837bc2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2266" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>