---
layout: default
title: 'Many to Many expected behaviour - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Many to Many expected behaviour</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/282/firstactivemedia" class="user-moderator-N"><span itemprop="name">firstactivemedia</span></a></span>
            <time itemprop="dateCreated" datetime="2014-04-28T07:14:01-07:00">Apr '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-04-28T07:14:01-07:00">Apr '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">18</span>
                </td>
                <td>
                    <label>Views</label><br>1933</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">2</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/4b7ae197d55ed486ec4c37d6a1aeaae0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/282/firstactivemedia" class="user-moderator-N"><span itemprop="name">firstactivemedia</span></a></span>
                <span class="karma">4.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2190" href="#C2190">
        <time class="action-date">Apr '14</time>
    </a>
</div>
<div class="post-content"><div><p>I have seen a few posts similar to this over the months, and just wanted to clarify the current state of things.</p>
<p>So say I have a blog with Post and Tag in a many to many, with a joining table, and I run this code</p>
<pre><code class="language-php">$tag1 = \Tag::findFirst('id=1');
$tag2 = \Tag::findFirst('id=2');
$tag3 = \Tag::findFirst('id=3');

// create a post
$post = new \Post();
$post-&gt;tags = array($tag1, $tag2);
$post-&gt;save();

// edit a post
$post = \Post::findFirst('id=1'); // the same post that was created earlier
$post-&gt;tags = array($tag1, $tag3);
$post-&gt;save();</code></pre>
<p>What is the expected behaviour assuming I have everything set up correctly? I see there being 3 possiblities</p>
<ol>
<li>The post has tags 1, 2 &amp; 3</li>
<li>the post has tags 1 &amp; 3</li>
<li>the post has 2 of tag1 and 1 each of 2 &amp; 3</li>
</ol>
<p>Is one of these &quot;right&quot; or is it a config issue?  If what is the syntax for choosing which one happens?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5fb005a5415b06c9a771953d9551f76e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1539/fverry" class="user-moderator-N"><span itemprop="name">François Verry</span></a>        </span>
        <br>

        <span class="karma">858</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7534" href="#C7534">
                <time itemprop="dateCreated" datetime="2014-04-29T14:08:57-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Bump as well,</p>
<p><a href="https://stackoverflow.com/questions/23374858/update-a-records-n-n-relationships">https://stackoverflow.com/questions/23374858/update-a-records-n-n-relationships</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7534" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7534" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5fb005a5415b06c9a771953d9551f76e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1539/fverry" class="user-moderator-N"><span itemprop="name">François Verry</span></a>        </span>
        <br>

        <span class="karma">858</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7536" href="#C7536">
                <time itemprop="dateCreated" datetime="2014-04-29T15:04:09-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Note that a ResultSet\Simple cannot be assigned directly to $post-&gt;tags</p>
<pre><code class="language-php">$post-&gt;tags = Tag::find("id IN (1,2)"); // Wrong</code></pre>
<p>Neither can a full array() export</p>
<pre><code class="language-php">$post-&gt;tags = Tag::find("id IN (1,2)")-&gt;toArray(); // Wrong</code></pre>
<p>Only an array of Models can be assigned :</p>
<pre><code class="language-php">$post-&gt;tags = Tag::find("id IN (1,2)")-&gt;filter(function($t) {
    return $t;
}); // Right</code></pre>
<p>Workaround #1 : overloading the default ResultSet\Simple class</p>
<pre><code class="language-php">class MyResultSet extends \Phalcon\Mvc\Model\ResultSet\Simple
{
    public function getAll()
    {
        return $this-&gt;filter(function($t) {
            return $t;
        });
    }
}

// ...

$post-&gt;tags = Tag::find("id IN (1,2)")-&gt;getAll();</code></pre>
<p>Workaround #2 : overloading the default \Phalcon\Mvc\Model::__set() method</p>
<pre><code class="language-php">abstract class AbstractModel extends \Phalcon\Mvc\Model
{
    public function __set($property, $value)
    {
        if ($value instanceof \Phalcon\Mvc\Model\ResultSetInterface)
        {
            $value = $value-&gt;filter(function($r) {
                return $r;
            });
        }
        parent::__set($property, $value);
    }
}

// ...

$post-&gt;tags = Tag::find("id IN (1,2)");</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7536" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7536" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4b7ae197d55ed486ec4c37d6a1aeaae0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/282/firstactivemedia" class="user-moderator-N"><span itemprop="name">firstactivemedia</span></a>        </span>
        <br>

        <span class="karma">4.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7557" href="#C7557">
                <time itemprop="dateCreated" datetime="2014-05-01T01:50:55-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for your reply, but you have lost me a bit. you say </p>
<blockquote>
<p>Only an array of Models can be assigned :</p>
</blockquote>
<p>but findFirst returns an instance of the model, not a result set so</p>
<pre><code>$tag1 = \Tag::findFirst('id=1');
$tag2 = \Tag::findFirst('id=2');

$post-&gt;tags = array($tag1, $tag2);</code></pre>
<p>is an array of models, I don't see what the difference in end result is between my code and yours.</p>
<p>But even that is a bit OT,  using your code copy and pasted what should happen? </p>
<pre><code>$post-&gt;tags = Tag::find("id IN (1,2)")-&gt;getAll();
$post-&gt;save();

$post-&gt;tags = Tag::find("id IN (1,3)")-&gt;getAll();
$post-&gt;save();</code></pre>
<ol>
<li>The post has tags 1, 2 &amp; 3</li>
<li>the post has tags 1 &amp; 3</li>
<li>the post has 2 of tag1 and 1 each of 2 &amp; 3</li>
</ol>
<p>thanks :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7557" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7557" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/82dd10cce237ef1c09ab0e8cb78182be?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1274/slechtic" class="user-moderator-N"><span itemprop="name">slechtic</span></a>        </span>
        <br>

        <span class="karma">7.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8156" href="#C8156">
                <time itemprop="dateCreated" datetime="2014-05-27T13:00:14-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Did you solve it? I have the same problem.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8156" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8156" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4b7ae197d55ed486ec4c37d6a1aeaae0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/282/firstactivemedia" class="user-moderator-N"><span itemprop="name">firstactivemedia</span></a>        </span>
        <br>

        <span class="karma">4.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8233" href="#C8233">
                <time itemprop="dateCreated" datetime="2014-05-29T01:01:21-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Not yet... I am still not sure if there even is a problem... I don't know if the way it is behaving is the way the programmers intended it to behave!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8233" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8233" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/cd8904251f4fbd3e355bdc3dda584f70?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1544/Vastly" class="user-moderator-N"><span itemprop="name">Vastly</span></a>        </span>
        <br>

        <span class="karma">2.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="8434" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '14</span>
              </span><br/><a name="C8434" href="#C8434">
                <time itemprop="dateCreated" datetime="2014-06-07T11:34:56-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I have worked a lot with other PHP ORMs like Doctrine 2 and so on. The buggy behaviour described here is obviously just a bug/issue in Phalcon ORM, and it needs to be resolved. It hurts a lot, because this problem means that even fundamentals of the ORM (update records correctly) is broken nowadays in Phalcon.</p>
<p>is there an official bug report registered?</p>
<p>i finally came up with the following crutch</p>
<pre><code class="language-php">    public function setTags($tags) {

        // crutch for Phalcon ORM bug https://forum.phalcon.io/discussion/2190/many-to-many-expected-behaviour#C8434
        \Phalcon\DI::getDefault()-&gt;get('modelsManager')-&gt;executeQuery('delete from PostsTags where postref = ' . $this-&gt;getId());

        $this-&gt;Tags = $tags;
    }</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8434" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8434" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/90c8736a63045f6e8117032ef3ee90d2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1066/jiff88" class="user-moderator-N"><span itemprop="name">Josef Svoboda</span></a>        </span>
        <br>

        <span class="karma">7.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="10946" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '14</span>
              </span><br/><a name="C10946" href="#C10946">
                <time itemprop="dateCreated" datetime="2014-09-03T01:25:50-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>PLEASE make someone from Phalcon dev-team make clear about this.</p>
<p>Saving many to many is really painful right now. There is no official statement, we are lost..</p>
<p>Please answer the very first question in this thread..</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="10946" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="10946" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/84a42812162b29bda9e0d7e408d6ab1f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2169/prodigga" class="user-moderator-N"><span itemprop="name">prodigga</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11783" href="#C11783">
                <time itemprop="dateCreated" datetime="2014-10-01T05:18:28-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Bumping this.. As above, could a dev please answer the first question for us?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11783" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11783" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/84a42812162b29bda9e0d7e408d6ab1f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2169/prodigga" class="user-moderator-N"><span itemprop="name">prodigga</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11939" href="#C11939">
                <time itemprop="dateCreated" datetime="2014-10-06T16:02:39-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Bump</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11939" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11939" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4b7ae197d55ed486ec4c37d6a1aeaae0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/282/firstactivemedia" class="user-moderator-N"><span itemprop="name">firstactivemedia</span></a>        </span>
        <br>

        <span class="karma">4.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11942" href="#C11942">
                <time itemprop="dateCreated" datetime="2014-10-07T03:14:08-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>issue reported 6 days ago...
<a href="https://github.com/phalcon/cphalcon/issues/2871">https://github.com/phalcon/cphalcon/issues/2871</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11942" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11942" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/84a42812162b29bda9e0d7e408d6ab1f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2169/prodigga" class="user-moderator-N"><span itemprop="name">prodigga</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12125" href="#C12125">
                <time itemprop="dateCreated" datetime="2014-10-12T02:53:39-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Bump</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12125" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12125" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9af73076014e295c1337e33e51b52518?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2598/rianorie" class="user-moderator-N"><span itemprop="name">Rian Orie</span></a>        </span>
        <br>

        <span class="karma">6.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12817" href="#C12817">
                <time itemprop="dateCreated" datetime="2014-11-05T07:33:36-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I think I have the fix ready to be added to the Phalcon codebase but I want to be absolutely sure I get this right:</p>
<p>1) There's a table &quot;tag&quot; and a table &quot;post&quot; and they have a many to many relation
2) When adding relation elements (tags) to the entity (post), the old relations (tags) get overwritten</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12817" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12817" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/84a42812162b29bda9e0d7e408d6ab1f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2169/prodigga" class="user-moderator-N"><span itemprop="name">prodigga</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12838" href="#C12838">
                <time itemprop="dateCreated" datetime="2014-11-05T16:05:21-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>There is also no way to 'remove' all of the 'tags'. If you set the 'tag'
array in your 'post' to an empty array, it will just leave the relation as
it is in the database, as if you didn't do anything. (instead of removing
the relations).</p>
<p>$post-&gt;tag = $tags;
$post-&gt;save(); //ok
$post-&gt;tag = array();
$post-&gt;save(); //retains tags</p>
<p>On Thu, Nov 6, 2014 at 1:32 AM, Rian Orie <a href="/cdn-cgi/l/email-protection#592931362a2931362b2c3419293138353a3637773036"><span class="__cf_email__" data-cfemail="36465e5945465e5944435b76465e575a555958185f59">[email&#160;protected]</span></a> wrote:</p>
<blockquote>
<p>I think I have the fix ready to be added to the Phalcon codebase but I
want to be absolutely sure I get this right:</p>
<p>1) There's a table &quot;tag&quot; and a table &quot;post&quot; and they have a many to many
relation 2) When adding relation elements (tags) to the entity (post), the
old relations (tags) get overwritten</p>
<p>—
Reply to this email directly or view the complete thread on Phosphorum
<a href="https://forum.phalcon.io/discussion/2190/many-to-many-expected-behaviour#C12817">https://forum.phalcon.io/discussion/2190/many-to-many-expected-behaviour#C12817</a>.
Change your e-mail preferences here <a href="https://forum.phalcon.io/settings">https://forum.phalcon.io/settings</a></p>
</blockquote>
<p>-- </p>
<ul>
<li>Tim</li>
</ul></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12838" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12838" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9af73076014e295c1337e33e51b52518?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2598/rianorie" class="user-moderator-N"><span itemprop="name">Rian Orie</span></a>        </span>
        <br>

        <span class="karma">6.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12839" href="#C12839">
                <time itemprop="dateCreated" datetime="2014-11-05T16:07:11-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>that shouldn't prove too troublesome to take along. Can you confirm my use case though?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12839" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12839" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/84a42812162b29bda9e0d7e408d6ab1f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2169/prodigga" class="user-moderator-N"><span itemprop="name">prodigga</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="12840" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '14</span>
              </span><br/><a name="C12840" href="#C12840">
                <time itemprop="dateCreated" datetime="2014-11-05T16:20:43-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>No, I can't. Maybe first firstactivemedia can. I am following this thread for a different reason. I think things got a little confusing along the way. :( I am here because this just straight up doesn't work:</p>
<pre><code class="language-php">$tag1 = \Tag::findFirst('id=1');
$tag2 = \Tag::findFirst('id=2');

$post-&gt;tags = array($tag1, $tag2);</code></pre>
<p>but this does, because it returns a 'result set'.</p>
<pre><code class="language-php">$post-&gt;tags = Tag::find("id IN (1,2)")-&gt;filter(function($t) {
    return $t;
});</code></pre>
<p>This just seems buggy and broken. This is what I thought we were discussing. More on the topic of what you were asking, I would <em>expect</em> the old relations to get overriden if I do this:</p>
<pre><code class="language-php">$post-&gt;tags = Tag::find("id IN (1,2)")-&gt;filter(function($t) {
    return $t;
});

$post-&gt;save(); //post has tags 1 and 2

$post-&gt;tags = Tag::find("id IN (3)")-&gt;filter(function($t) {
    return $t;
});

$post-&gt;save(); //post only has tag 3. Makes sense that 1 and 2 were 'removed'.</code></pre>
<p>I would expect to have to do an array push of some kind to retain 1 and 2 while adding 3. That is, load up the post, array_push tag with id 3 into the posts tag array and save the post.</p>
<p>The code would be so much easier to work with if the first snippit worked properly. To add tag with 'id' 3 to a post, i would just do this:</p>
<pre><code class="language-php">$tag1 = \Tag::findFirst('id=1');
$tag2 = \Tag::findFirst('id=2');

$post-&gt;tags = array($tag1, $tag2);
$post-&gt;save(); //post has tags 1 and 2

...

array_push($post-&gt;tags, \Tag::findFirst('id=3'));
$post-&gt;save(); //post has tags 1 2 and 3
//or if you wanted to remove all othe relations:
$post-&gt;tags = array(\Tag::findFirst('id=3'));
$post-&gt;save(); //post has only tag 3
</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12840" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12840" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/84a42812162b29bda9e0d7e408d6ab1f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2169/prodigga" class="user-moderator-N"><span itemprop="name">prodigga</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12841" href="#C12841">
                <time itemprop="dateCreated" datetime="2014-11-05T16:25:06-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Rian, incase you are replying via email, I have edited my post with some extra stuff. I'll just leave this comment to notify you.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12841" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12841" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9ab87270227212b876cf4d06dd19cf93?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2782/lfbittencourt" class="user-moderator-N"><span itemprop="name">LF Bittencourt</span></a>        </span>
        <br>

        <span class="karma">2.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C13948" href="#C13948">
                <time itemprop="dateCreated" datetime="2014-12-05T14:23:16-07:00" class="action-date">Dec '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>My two cents: I like Laravel's <code>sync</code> method.</p>
<p><a href="https://github.com/phalcon/cphalcon/issues/2871#issuecomment-65855976">https://github.com/phalcon/cphalcon/issues/2871#issuecomment-65855976</a>.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13948" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13948" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/70479a3f6e443d9bd7c9e75e10555bd2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3894/marhub" class="user-moderator-N"><span itemprop="name">marhub</span></a>        </span>
        <br>

        <span class="karma">615</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C21751" href="#C21751">
                <time itemprop="dateCreated" datetime="2015-08-11T08:09:23-07:00" class="action-date">Aug '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/1539/fverry">@fverry</a> </p>
<blockquote>
<p>Workaround #1 : overloading the default ResultSet\Simple class</p>
</blockquote>
<p>How would you do that ?
Resultset is returned by db adapter.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="21751" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="21751" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b0d8ef7ce641f01d88213edf22f01185?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8247/Appnostic" class="user-moderator-N"><span itemprop="name">Appnostic</span></a>        </span>
        <br>

        <span class="karma">62</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40893" href="#C40893">
                <time itemprop="dateCreated" datetime="2016-09-26T01:49:19-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Bump</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40893" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40893" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a>        </span>
        <br>

        <span class="karma">47.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C49079" href="#C49079">
                <time itemprop="dateCreated" datetime="2017-06-23T08:25:06-07:00" class="action-date">Jun '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Bump</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="49079" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="49079" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d4e6a9e73a474bfde8907ef976517dc0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/6955/dibmartins" class="user-moderator-N"><span itemprop="name">Diego Botelho</span></a>        </span>
        <br>

        <span class="karma">795</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C57303" href="#C57303">
                <time itemprop="dateCreated" datetime="2018-09-12T10:10:32-07:00" class="action-date">Sep '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Bump</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="57303" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="57303" data-cf-modified-6a1bf1deb3fe5b5381f994af-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2190" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>