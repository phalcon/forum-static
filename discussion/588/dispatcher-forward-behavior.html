---
layout: default
title: 'Dispatcher::forward() behavior - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Dispatcher::forward() behavior</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/281/lazycommit" class="user-moderator-N"><span itemprop="name">Matey Goyce</span></a></span>
            <time itemprop="dateCreated" datetime="2013-07-15T07:36:49-07:00">Jul '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-07-15T07:36:49-07:00">Jul '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jul '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>1493</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/ae97c58ab751f240dd8eabe91cf5f7a7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/281/lazycommit" class="user-moderator-N"><span itemprop="name">Matey Goyce</span></a></span>
                <span class="karma">4.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C588" href="#C588">
        <time class="action-date">Jul '13</time>
    </a>
</div>
<div class="post-content"><div><p>Why Dispatcher::forward() does not invoke dispatcher loop or part of it?
And what exactley happens when forward() invoked?
Thanks.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bf2876998907a5932aa609a948720862?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/241/gsouf" class="user-moderator-N"><span itemprop="name">Soufiane Ghzal</span></a>        </span>
        <br>

        <span class="karma">21.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2442" href="#C2442">
                <time itemprop="dateCreated" datetime="2013-07-15T10:34:28-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>As far as i understood how the dispatcher works,  Dispatcher::forward() wont invoke the loop, it just will forward to another controller if the dispatcher is already looping.</p>
<p>Its Behaviour is to forward the current http request from on controller, to another controller.</p>
<p>Can you give a code snippet of what you are doing ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2442" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2442" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ae97c58ab751f240dd8eabe91cf5f7a7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/281/lazycommit" class="user-moderator-N"><span itemprop="name">Matey Goyce</span></a>        </span>
        <br>

        <span class="karma">4.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2453" href="#C2453">
                <time itemprop="dateCreated" datetime="2013-07-15T13:08:13-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><ol>
<li>what happens with views that exists in controller/action what was forwarded to?</li>
<li>what happens with params that was argued forward() for dispatcher?</li>
<li>does beforeExecuteRoute and afterExecuteRoute of controllers invoked in particular forwarded controller/action object instance?</li>
<li>does events of Manager fired? what ones?</li>
</ol>
<p>On all of them i can give an answer by myself (after day of tests%)) not fully, but can. And just for clear and googles I wish to see some internal behavior explanations.
That would be better than mine. Cause I can't answer WHY it's works exactly that way. No time to read C :(</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2453" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2453" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2454" href="#C2454">
                <time itemprop="dateCreated" datetime="2013-07-15T15:03:38-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Everything starts in the router:</p>
<p>The router parses the URI according to the one passed to it, ($_GET['_url'], $_SERVER['REQUEST_URI'], others)
After this handling the router pass the processed module/namespace/controller/action to the dispatcher:</p>
<pre><code class="language-php">$dispatcher-&gt;setControllerName($router-&gt;getControllerName());
$dispatcher-&gt;setActionName($router-&gt;getActionName());
$dispatcher-&gt;setParams($router-&gt;getParams());</code></pre>
<p>When $dispatcher-&gt;dispatch() is executed, this starts a dispatch loop which basically uses a flag variable ($finished) in the dispatcher to know if there are remaining actions to dispatch:</p>
<pre><code class="language-php">$this-&gt;_finished = false;
while (!$this-&gt;_finished) {

   //execute actions

   $this-&gt;_finished = true;
}</code></pre>
<p>The dispatch loop allows the developer to perform additional forwards, this means that $this-&gt;_finished is reset to false making the dispatcher loop again and execute the forwarded action.</p>
<pre><code class="language-php">$eventsManager-&gt;fire('dispatch:beforeDispatchLoop');

$this-&gt;_finished = false;
while (!$this-&gt;_finished) {

    $eventsManager-&gt;fire('dispatch:beforeDispatch');
    if ($this-&gt;_finished==false) {
        continue;
    }   

    $controllerName = $this-&gt;_controllerName;
    $actionName = $this-&gt;_actionName;
    $params = $this-&gt;_params;

    /**
     * Controllers are instantiated via the DI
     * This ensures that only one instance will be created
     * in the application;
     */
    $controller = $di-&gt;getShared($controllerName . 'Controller');

    if (!method_exists($controller, $action . 'Action')) {
        throw new Exception('404 not found');
    }

    $eventsManager-&gt;fire('dispatch:beforeExecuteAction');   
    if ($this-&gt;_finished==false) {
        continue;
    }   

    $controller-&gt;$action($params);

    $eventsManager-&gt;fire('dispatch:afterExecuteAction');
    if ($this-&gt;_finished==false) {
        continue;
    }   

    $eventsManager-&gt;fire('dispatch:afterDispatchLoop');
    if ($this-&gt;_finished==false) {
        continue;
    }   

    $this-&gt;_finished = true;
}</code></pre>
<p>When you make a forward the internal $this-&gt;_finished is changed to false, this is detected and the dispatch loop iterates again: </p>
<pre><code class="language-php">public function forward($forward)
{
    if (isset($forward['controller']))  {
        $this-&gt;_controllerName = $forward['controller'];
    }
    if (isset($forward['action']))  {
        $this-&gt;_actionName = $forward['action'];
    }
    $this-&gt;_finished = false;
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2454" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2454" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bf2876998907a5932aa609a948720862?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/241/gsouf" class="user-moderator-N"><span itemprop="name">Soufiane Ghzal</span></a>        </span>
        <br>

        <span class="karma">21.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2457" href="#C2457">
                <time itemprop="dateCreated" datetime="2013-07-15T23:06:09-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Very usefull informations. Thanks phalcon.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2457" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2457" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ae97c58ab751f240dd8eabe91cf5f7a7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/281/lazycommit" class="user-moderator-N"><span itemprop="name">Matey Goyce</span></a>        </span>
        <br>

        <span class="karma">4.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2462" href="#C2462">
                <time itemprop="dateCreated" datetime="2013-07-16T00:55:59-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks, realy usefull.
One more question.
Why params as arguments of action can be changed only in beforeDispatchLoop?
What is real behavior of params flow and structure after Application set it from Route?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2462" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2462" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ae97c58ab751f240dd8eabe91cf5f7a7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/281/lazycommit" class="user-moderator-N"><span itemprop="name">Matey Goyce</span></a>        </span>
        <br>

        <span class="karma">4.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2464" href="#C2464">
                <time itemprop="dateCreated" datetime="2013-07-16T03:52:30-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>i see. in 1.2.1 already done some stuff about this %)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2464" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2464" data-cf-modified-ea3628b50ff3893fec76b4a9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="588" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>