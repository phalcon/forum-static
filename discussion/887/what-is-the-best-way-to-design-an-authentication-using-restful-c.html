---
layout: default
title: 'What is the best way to design an authentication  using  RESTful concepts? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/22/micro">Micro</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">What is the best way to design an authentication  using  RESTful concepts?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/539/luisfdeandrade" class="user-moderator-N"><span itemprop="name">luisfdeandrade</span></a></span>
            <time itemprop="dateCreated" datetime="2013-09-12T12:03:53-07:00">Sep '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-09-12T12:03:53-07:00">Sep '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">8</span>
                </td>
                <td>
                    <label>Views</label><br>10344</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">4</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/861be9f3308ad2b3d8456f168c90aa43?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/539/luisfdeandrade" class="user-moderator-N"><span itemprop="name">luisfdeandrade</span></a></span>
                <span class="karma">10.2k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C887" href="#C887">
        <time class="action-date">Sep '13</time>
    </a>
</div>
<div class="post-content"><div><p>Hello Guys,</p>
<p>Firstly,  i want say that i am migrating from CI to Phalcon, and until now this framework is showing very, very good!</p>
<p>Well, my doubt is about designing a RESTful.</p>
<p>Until now i had no problem  defening the routes, controllers and everything. (Except that i`m getting a very big index.php with all those routes). </p>
<p>What is the best way to make a authentication in Phalcon ? A lot of articles say that is using Tokens, but how in Phalcon? Maybe sessions?</p>
<p>Thanks</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-5863662a5804286e96b263ef-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-5863662a5804286e96b263ef-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">4</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3432" href="#C3432">
                <time itemprop="dateCreated" datetime="2013-09-13T09:43:46-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>hi, tokens is the best option because it's a good practice avoid stateless data (sessions) in RESTful APIs</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3432" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3432" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/861be9f3308ad2b3d8456f168c90aa43?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/539/luisfdeandrade" class="user-moderator-N"><span itemprop="name">luisfdeandrade</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3434" href="#C3434">
                <time itemprop="dateCreated" datetime="2013-09-13T11:49:54-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Nice, thanks Phalcon, how could i achieve this in Phalcon/Micro ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3434" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3434" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3436" href="#C3436">
                <time itemprop="dateCreated" datetime="2013-09-13T14:56:56-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You can add a middleware that implements authorization before every request to your API: <a href="https://docs.phalcon.io/en/latest/reference/micro.html#middleware-events">https://docs.phalcon.io/en/latest/reference/micro.html#middleware-events</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3436" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3436" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/861be9f3308ad2b3d8456f168c90aa43?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/539/luisfdeandrade" class="user-moderator-N"><span itemprop="name">luisfdeandrade</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3456" href="#C3456">
                <time itemprop="dateCreated" datetime="2013-09-16T07:45:56-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Nice, i accomplished this using the (&quot;beforeExecuteRoute&quot;).</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3456" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3456" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/be847bbd581c7c1861e14fc4b79bd245?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/476/jeteokeeffe" class="user-moderator-N"><span itemprop="name">Jete</span></a>        </span>
        <br>

        <span class="karma">6.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3463" href="#C3463">
                <time itemprop="dateCreated" datetime="2013-09-16T22:51:04-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Oauth2 and HMAC are the 2 main ways. I already designed a phalcon hmac restful api (<a href="https://github.com/jeteokeeffe/php-hmac-rest-api">https://github.com/jeteokeeffe/php-hmac-rest-api</a>). To read more about about HMAC, i recommend this link, <a href="https://www.thebuzzmedia.com/designing-a-secure-rest-api-without-oauth-authentication/">https://www.thebuzzmedia.com/designing-a-secure-rest-api-without-oauth-authentication/</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3463" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3463" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C28373" href="#C28373">
                <time itemprop="dateCreated" datetime="2015-12-28T07:06:14-07:00" class="action-date">Dec '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>HMAC is the way to go.
I implemented it with an events manager, on 'beforeExecuteRoute'. All of this using micro app, which is really the best way for serving RESTful API interface.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="28373" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="28373" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/efda40aff61c44f3f0e40ce43b1152fe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3952/mpparent" class="user-moderator-N"><span itemprop="name">mpparent</span></a>        </span>
        <br>

        <span class="karma">2.5k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C3436"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Phalcon                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="35865" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '16</span>
              </span><br/><a name="C35865" href="#C35865">
                <time itemprop="dateCreated" datetime="2016-06-21T18:16:53-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>You can add a middleware that implements authorization before every request to your API: <a href="https://docs.phalcon.io/en/latest/reference/micro.html#middleware-events">https://docs.phalcon.io/en/latest/reference/micro.html#middleware-events</a></p>
</blockquote>
<p>It finally works. But because I search a lot after that, i add here more details</p>
<p>use Phalcon\Loader;
use Phalcon\Mvc\Micro;
use Phalcon\DI\FactoryDefault;
use Phalcon\Db\Adapter\Pdo\Mysql as PdoMysql;
use Phalcon\Http\Response;
use Phalcon\Events\Manager as EventsManager;
use Phalcon\Session\Adapter\Files as Session;</p>
<p>try{
// you need to start the session
// Start the session the first time when some component request the session service</p>
<p>$di-&gt;setShared('session', function () {
$session = new Session();
$session-&gt;start();
return $session;
});
And to make an authentication</p>
<p>// Create a events manager</p>
<p>$eventsManager = new EventsManager();</p>
<p>// Listen all the application events</p>
<p>$eventsManager-&gt;attach('micro', function ($event, $app) {</p>
<pre><code>if ($event-&gt;getType() == 'beforeExecuteRoute') {
    if ($app-&gt;session-&gt;get('auth') == false) {
    try{
        $connexion = $app-&gt;request-&gt;getJsonRawBody();

            // Get the data from the user

            $nomUsager    = $connexion-&gt;nomUsager;
            $motDePasse = $connexion-&gt;motDePasse;

            // Find the user in the database - depends on your table

            $utilisateur = membre::findFirst(
            array(
                "NomUsager = :nomUsager: AND MotDePasseMembre = :motDePasse:",
                'bind' =&gt; array(
                    'nomUsager'    =&gt; $nomUsager,
                    'motDePasse' =&gt; md5($motDePasse) //simplier

                )
               )
        );

            if ($utilisateur != false) {

              $app-&gt;session-&gt;set(
             'auth',
              array(
                  'id'   =&gt; $utilisateur-&gt;id,
                 'NomMembre' =&gt; $utilisateur-&gt;NomMembre,
          'PrenomMembre' =&gt; $utilisateur-&gt;PrenomMembre
                  )
           );

              $app-&gt;flash-&gt;success('Bienvenue ' . $utilisateur-&gt;PrenomMembre);
       return true;

           }else{
            $app-&gt;flash-&gt;error('Mauvais usager/mot de passe');
        return false;
       }
         }
         catch (Exception $e) {
     //Create a response</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35865" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35865" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="35889" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '16</span>
              </span><br/><a name="C35889" href="#C35889">
                <time itemprop="dateCreated" datetime="2016-06-22T04:47:51-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Well,
after a couple of Micro APIs, I found it most convenient to implement autorization inside <code>before</code> Micro event.</p>
<pre><code class="language-php">//HMAC digest check
$app-&gt;before(function () use ($app) {
    // Executed before every route is executed
//Before executing the handler. It can be used to control the access to the application
}
</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35889" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35889" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/59c1b3e26360dd821aa6758b97bd5fbb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4599/aderbas" class="user-moderator-N"><span itemprop="name">Aderbal Nunes</span></a>        </span>
        <br>

        <span class="karma">3.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="40805" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C40805" href="#C40805">
                <time itemprop="dateCreated" datetime="2016-09-24T07:12:35-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ok, I do exactly this way checking for token, decode and valid date. But, how I report to the Controller class the user's request from the decoded token? Any tips?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40805" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40805" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="40831" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C40831" href="#C40831">
                <time itemprop="dateCreated" datetime="2016-09-24T19:39:42-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You don't need to report anything to the controllers. This before Micro app bound event does all the job. The thing is, if your auth check failed, you only need to return <code>false</code> from <code>before()</code> closure, and execution flow will stop w/o calling any handler (Controller).
Controllers are then called only after <code>before()</code> (middleware) events finished with success.</p>
<p>That's simple and efficient implementation of validating access to the application.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40831" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40831" data-cf-modified-5863662a5804286e96b263ef-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="887" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>