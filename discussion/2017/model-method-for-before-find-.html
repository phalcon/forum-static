---
layout: default
title: 'Model Method for before find* - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Model Method for before find*</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/629/nokios" class="user-moderator-N"><span itemprop="name">Trenton Craig</span></a></span>
            <time itemprop="dateCreated" datetime="2014-04-07T15:17:59-07:00">Apr '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-04-07T15:17:59-07:00">Apr '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Apr '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>1370</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/9c2169cbdc0bddfbdd6bcd2258500bf6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/629/nokios" class="user-moderator-N"><span itemprop="name">Trenton Craig</span></a></span>
                <span class="karma">5.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2017" href="#C2017">
        <time class="action-date">Apr '14</time>
    </a>
</div>
<div class="post-content"><div><p>Is there a method I can hook into that allows me to perform actions on the model before it is returned by the likes of the find commands, much like there is a beforeSave() command?</p>
<p>Not beforeCreate or beforeUpdate, but when retrieveing these objects from the store, I want to perform an action.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-d22ef8fa65e9b276067070fe-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-d22ef8fa65e9b276067070fe-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d41d8cd98f00b204e9800998ecf8427e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1302/Barbery" class="user-moderator-N"><span itemprop="name">Barbery</span></a>        </span>
        <br>

        <span class="karma">9.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="6966" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '14</span>
              </span><br/><a name="C6966" href="#C6966">
                <time itemprop="dateCreated" datetime="2014-04-08T02:42:01-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>you can extends phalcon\mvc\model, and overwrite the method such like that</p>
<pre><code class="language-php">    pubilic static function findFirst($parameters=null)
    {
        $this-&gt;beforeFindFirst($parameters);
        return parent::findFirst($parameters);
    }

    public function beforeFindFirst($parameters)
    {
        // your code
    }</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="6966" data-cf-modified-d22ef8fa65e9b276067070fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="6966" data-cf-modified-d22ef8fa65e9b276067070fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9c2169cbdc0bddfbdd6bcd2258500bf6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/629/nokios" class="user-moderator-N"><span itemprop="name">Trenton Craig</span></a>        </span>
        <br>

        <span class="karma">5.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="6975" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '14</span>
              </span><br/><a name="C6975" href="#C6975">
                <time itemprop="dateCreated" datetime="2014-04-08T05:23:36-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for that information, Barbery.  I took a look a stab at it this morning and came up with the below.</p>
<p>I did neglect to mention that I was using  Mongodb backend, and thus using <code>\Phalcon\Mvc\Collection</code>.  After playing around this morning, I found that I can leverage <code>writeAttribute</code>.</p>
<p>I am doing this so as to make it much simipler to have related models in the system.  See below for what I am doing.  Feel free to comment if you have a better solution.</p>
<p><strong>Base Model</strong></p>
<pre><code class="language-php">    public function beforeSave()
    {
        foreach ($this as $key =&gt; $value) {
            if (substr($key, 0, 1) == "_") {
                continue;
            }

            if (is_subclass_of($value, __CLASS__)) {
                $value-&gt;save();
                $ref = array(
                    'referencedClass' =&gt; $value-&gt;getSource(),
                    'id' =&gt; $value-&gt;getId()
                );
                $this-&gt;$key = $ref;
            }
        }
    }

    public function writeAttribute($name, $value)
    {
        if (is_array($value) &amp;&amp; array_key_exists('referencedClass', $value) &amp;&amp; array_key_exists('id', $value) &amp;&amp;
            $value['id'] instanceof \MongoId) {

            $className = preg_replace("/_/", '\\', $value['referencedClass']);

            $oldValue = $value;

            $value = call_user_func_array(
                $className . '::findFirst',
                array(array(
                    '_id' =&gt; $value['id']
                ))
            );
        }

        return parent::writeAttribute($name, $value);
    }</code></pre>
<p><strong>Example usage:</strong></p>
<pre><code class="language-php">        $user = new \Netadmin\Main\Model\User();
        $user-&gt;fName = "First";
        $user-&gt;lName = "Last";

        $role = new \Netadmin\Main\Model\Role();
        $role-&gt;role = "Admin";
        $user-&gt;role = $role;
        $user-&gt;save();</code></pre>
<p>So, the Role object will be saved into its own collection, and when the user is pulled from the db, thie base model will automatically load that model into the value, reducing duplication.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="6975" data-cf-modified-d22ef8fa65e9b276067070fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="6975" data-cf-modified-d22ef8fa65e9b276067070fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f6fe2ad73d81ddea5f7214dda4b8ea6a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1268/jhtan1" class="user-moderator-N"><span itemprop="name">jhtan1</span></a>        </span>
        <br>

        <span class="karma">7.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7014" href="#C7014">
                <time itemprop="dateCreated" datetime="2014-04-08T19:21:26-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Do you mean afterFetch?</p>
<pre><code class="language-php">class Robots extends Phalcon\Mvc\Model
{

    public $id;

    public $name;

    public $status;

    public function afterFetch()
    {
        //Convert the string to an array
        $this-&gt;status = explode(',', $this-&gt;status);
    }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7014" data-cf-modified-d22ef8fa65e9b276067070fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7014" data-cf-modified-d22ef8fa65e9b276067070fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9c2169cbdc0bddfbdd6bcd2258500bf6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/629/nokios" class="user-moderator-N"><span itemprop="name">Trenton Craig</span></a>        </span>
        <br>

        <span class="karma">5.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7027" href="#C7027">
                <time itemprop="dateCreated" datetime="2014-04-09T05:20:56-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>jhtan1 - Is there a distinct advantage of one over the other?  <code>writeAttribute()</code> is called whenever an object is populated after/during fetching.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7027" data-cf-modified-d22ef8fa65e9b276067070fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7027" data-cf-modified-d22ef8fa65e9b276067070fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f6fe2ad73d81ddea5f7214dda4b8ea6a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1268/jhtan1" class="user-moderator-N"><span itemprop="name">jhtan1</span></a>        </span>
        <br>

        <span class="karma">7.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7067" href="#C7067">
                <time itemprop="dateCreated" datetime="2014-04-09T18:40:55-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Trenton Craig, I'm not sure for the writeAttribute().
Kindly go through <a href="http://docs.phalcon.io/en/latest/reference/models.html#initializing-preparing-fetched-records">Initializing/Preparing fetched records</a> for afterFetch()</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7067" data-cf-modified-d22ef8fa65e9b276067070fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7067" data-cf-modified-d22ef8fa65e9b276067070fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2017" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>