---
layout: default
title: 'View variables are surprising, (bug or feature?) - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">View variables are surprising, (bug or feature?)</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/6153/udarkness" class="user-moderator-N"><span itemprop="name">udarkness</span></a></span>
            <time itemprop="dateCreated" datetime="2016-10-18T02:12:24-07:00">Oct '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-10-18T02:12:24-07:00">Oct '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">7</span>
                </td>
                <td>
                    <label>Views</label><br>690</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/85757999d6beb0c9af6d94c9f8f2c077?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/6153/udarkness" class="user-moderator-N"><span itemprop="name">udarkness</span></a></span>
                <span class="karma">2.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C14497" href="#C14497">
        <time class="action-date">Oct '16</time>
    </a>
</div>
<div class="post-content"><div><pre><code>&lt;?php $a = 2; ?&gt;
&lt;?= $this-&gt;partial("path/view", ["a" =&gt; 1]) ?&gt;
&lt;?= $a ?&gt;</code></pre>
<p>Surprisingly that prints 1, instead of 2, is this a <strong>feature? or a bug?</strong></p>
<p>The <strong>local</strong> variables in the views behaves like <strong>globals</strong></p>
<p>This in php7.0 and phalcon 3.x</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-f0d885966d8f05d674e54ca9-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-f0d885966d8f05d674e54ca9-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41791" href="#C41791">
                <time itemprop="dateCreated" datetime="2016-10-18T04:33:04-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I think this is happening only in php 7 due to changes to symbol table.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41791" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41791" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/85757999d6beb0c9af6d94c9f8f2c077?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/6153/udarkness" class="user-moderator-N"><span itemprop="name">udarkness</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C42061" href="#C42061">
                <time itemprop="dateCreated" datetime="2016-10-21T02:29:28-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Any solution other than preffixing the variables with the view name?</p>
<p>It adds a lot of work to name variables like <code>$path_view_a</code>.</p>
<p>Why zephir is not executing the require as php does? (in the context of the method)</p>
<p><a href="https://github.com/phalcon/cphalcon/blob/master/phalcon/mvc/view/engine/php.zep#L56">https://github.com/phalcon/cphalcon/blob/master/phalcon/mvc/view/engine/php.zep#L56</a></p>
<p>I am not sure if this is a bug in zephir or a &quot;new feature&quot;</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="42061" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="42061" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C42067" href="#C42067">
                <time itemprop="dateCreated" datetime="2016-10-21T03:08:30-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This is not about require. This is about render:</p>
<p><a href="https://github.com/phalcon/cphalcon/blob/master/phalcon/mvc/view.zep#L845">https://github.com/phalcon/cphalcon/blob/master/phalcon/mvc/view.zep#L845</a></p>
<p>As i told you, symbol tables where changed on php 7. There must be changes done to zephir in order to support what you want to achieve in php 7. On php 5.6 your code will work correctly. If you want you can create issue on zephir about this.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="42067" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="42067" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/85757999d6beb0c9af6d94c9f8f2c077?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/6153/udarkness" class="user-moderator-N"><span itemprop="name">udarkness</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C42089" href="#C42089">
                <time itemprop="dateCreated" datetime="2016-10-21T06:03:08-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>As I told you, it is a problem in the scopes (or the stack)</p>
<p>See this page: <a href="https://docs.zephir-lang.com/en/latest/language.html#variable-scope">https://docs.zephir-lang.com/en/latest/language.html#variable-scope</a></p>
<p>But <a href="https://github.com/phalcon/cphalcon/blob/master/phalcon/mvc/view/engine/php.zep#L49">https://github.com/phalcon/cphalcon/blob/master/phalcon/mvc/view/engine/php.zep#L49</a> is not setting them to the local scope.</p>
<p>2 possibles explanations: Zephir is setting locals as static locals or globals (because it is still referencing to the same value in memory, even if it is in a different function call.</p>
<p>Said this, this is a new not documented feature or a bug.</p>
<p>All of this, or <code>require</code> doesn't execute in the function scope and execute in a global scope.</p>
<p>So, if a team member can confirm that indeed this is a bug, and not a feature, the bug can be created</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="42089" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="42089" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="42091" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '16</span>
              </span><br/><a name="C42091" href="#C42091">
                <time itemprop="dateCreated" datetime="2016-10-21T06:44:33-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>As i already told you. This is because of PHP 7 and zephir. On PHP 5 it works fine. Just this <a href="https://github.com/phalcon/cphalcon/blob/master/phalcon/mvc/view.zep#L1073">https://github.com/phalcon/cphalcon/blob/master/phalcon/mvc/view.zep#L1073</a> is broken for php 7 and is not working correctly. Anyway, i will check it to be sure in home. But latest i was talking with some team member this symbol tables changes and not yet changed properly zephir is creating issue like yours.</p>
<p>Well btw anyway variables names like <code>$a</code> is really bad :D</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="42091" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="42091" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/85757999d6beb0c9af6d94c9f8f2c077?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/6153/udarkness" class="user-moderator-N"><span itemprop="name">udarkness</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C42141" href="#C42141">
                <time itemprop="dateCreated" datetime="2016-10-24T03:17:15-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes, you are partially right. Like <code>path</code> and <code>view</code> are bad names for a directory name and view name. But in the example context , those names are excellent ;)  (Anyway, this is bikeshedding, I guess you were trolling) </p>
<p>Yes, I get the idea, it is creating the table. But in the zephir documentation is written this should happen anyway</p>
<blockquote>
<p>All variables declared are locally scoped to the method where they were declared</p>
</blockquote>
<p><a href="https://docs.zephir-lang.com/en/latest/language.html#variable-scope">https://docs.zephir-lang.com/en/latest/language.html#variable-scope</a></p>
<p>or
(the title refers to the local scope, but &quot;current PHP symbol table&quot;, so aren't they the same?)
<a href="https://docs.zephir-lang.com/en/latest/language.html#local-symbol-table">https://docs.zephir-lang.com/en/latest/language.html#local-symbol-table</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="42141" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="42141" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C42159" href="#C42159">
                <time itemprop="dateCreated" datetime="2016-10-24T05:49:39-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes - and it's working fine for php 5. But as i told you there were some changes in symbol table for php 7. Zephir is not updated for it yet, it needs some changes to work properly with this example of your - this is why it's not working. Check your code on php 5. It should be fine.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="42159" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="42159" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2fbd91e08ec1ea7f351c6044e6bd52fe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3443/Feloot" class="user-moderator-N"><span itemprop="name">Jonathan Gaudé</span></a>        </span>
        <br>

        <span class="karma">3.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C53851" href="#C53851">
                <time itemprop="dateCreated" datetime="2018-02-06T13:32:41-07:00" class="action-date">Feb '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi there,</p>
<p>Has this been fixed yet ? It's quite an important problem...</p>
<p>Thank you</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="53851" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="53851" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2fbd91e08ec1ea7f351c6044e6bd52fe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3443/Feloot" class="user-moderator-N"><span itemprop="name">Jonathan Gaudé</span></a>        </span>
        <br>

        <span class="karma">3.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C57313" href="#C57313">
                <time itemprop="dateCreated" datetime="2018-09-14T08:33:58-07:00" class="action-date">Sep '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>In the meantime, have a look at this temporary fix : <a href="https://github.com/phalcon/cphalcon/issues/12176#issuecomment-405168661">https://github.com/phalcon/cphalcon/issues/12176#issuecomment-405168661</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="57313" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="57313" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C57319" href="#C57319">
                <time itemprop="dateCreated" datetime="2018-09-14T14:09:33-07:00" class="action-date">Sep '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I agree, we should hire some c programmer with knowledge of php and zend engine to fix those issues.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="57319" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="57319" data-cf-modified-f0d885966d8f05d674e54ca9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="14497" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>