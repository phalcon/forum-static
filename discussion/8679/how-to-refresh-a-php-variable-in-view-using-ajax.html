---
layout: default
title: 'How to refresh a php variable in view using Ajax? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/21/beginners">Beginners</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">How to refresh a php variable in view using Ajax?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/4149/Blkc" class="user-moderator-N"><span itemprop="name">Bryan Leung</span></a></span>
            <time itemprop="dateCreated" datetime="2015-09-24T10:22:14-07:00">Sep '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-09-24T10:22:14-07:00">Sep '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>1922</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/4322914daa72a9b402c4b9d46b42bac0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/4149/Blkc" class="user-moderator-N"><span itemprop="name">Bryan Leung</span></a></span>
                <span class="karma">16.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C8679" href="#C8679">
        <time class="action-date">Sep '15</time>
    </a>
</div>
<div class="post-content"><div><p>I have this <code>$unreadMessageCount</code> variable in my view:</p>
<pre><code>&lt;a href="javascript:void(0)" id="myAccount" class="site-nav-sub"&gt;&lt;i class="fa fa-angle-down site-nav-arrow"&gt;  &lt;/i&gt;Hi, {% raw %}{{{% endraw %} firstname {% raw %}}}{% endraw %} {% raw %}{%{% endraw %} if unreadMessageCount &gt; 0 {% raw %}%}{% endraw %} &lt;span class="badge pull-down" style="background: rgb(36, 232, 0); padding: 5px 1px;"&gt; &lt;/span&gt;{% raw %}{%{% endraw %} endif {% raw %}%}{% endraw %}&lt;/a&gt;</code></pre>
<p>In my ajax:</p>
<pre><code>       window.setInterval(function(){
            $.ajax({ 
                url: '/index/retrieveUnreadCount',
                success: function(data){
                    console.log(data);
                }
            });
        }, 30000);</code></pre>
<p>In my controller:</p>
<pre><code>public function retrieveUnreadCount()
{
    if ($this-&gt;component-&gt;user-&gt;hasSession()) {
        $this-&gt;user = $this-&gt;component-&gt;user-&gt;getSessionUser();
        $this-&gt;view-&gt;setVar('user', $this-&gt;user);
        $this-&gt;view-&gt;setVar('unreadMessageCount', Messages::getTotalUnreadCount($this-&gt;user-&gt;id));

        $unreadMessageCount = Messages::getTotalUnreadCount($this-&gt;user-&gt;id);
        return json_encode($unreadMessageCount);
    }

} </code></pre>
<p>I want to refresh <code>$unreadMessageCount</code> every 30 seconds using Ajax as seen above but I am not sure if this code works. </p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4769/Izopi4a" class="user-moderator-Y"><span itemprop="name">Izo</span></a>        </span>
        <br>

        <span class="karma">85.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C23743" href="#C23743">
                <time itemprop="dateCreated" datetime="2015-09-24T10:49:58-07:00" class="action-date">Sep '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi,
i dont understand you complatly.</p>
<p>do you mean that </p>
<pre><code class="language-php">Messages::getTotalUnreadCount($this-&gt;user-&gt;id)</code></pre>
<p>doesn't return the new value ?</p>
<p>or maybe you want to use the &quot;new message count&quot; in the page ?</p>
<p>sorry if i am stupid</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="23743" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="23743" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4322914daa72a9b402c4b9d46b42bac0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4149/Blkc" class="user-moderator-N"><span itemprop="name">Bryan Leung</span></a>        </span>
        <br>

        <span class="karma">16.1k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C23743"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Izo                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="23745" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '15</span>
              </span><br/><a name="C23745" href="#C23745">
                <time itemprop="dateCreated" datetime="2015-09-24T11:04:32-07:00" class="action-date">Sep '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Sorry, may be I didn't explain myself clearly. I got the value from the model and everything so it is fine. But then I want this variable to be refreshed in the html as shown in the first snippet every 30 seconds in view without refreshing the whole page</p>
<blockquote>
<p>Hi,
i dont understand you complatly.</p>
<p>do you mean that </p>
<pre><code class="language-php">Messages::getTotalUnreadCount($this-&gt;user-&gt;id)</code></pre>
<p>doesn't return the new value ?</p>
<p>or maybe you want to use the &quot;new message count&quot; in the page ?</p>
<p>sorry if i am stupid</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="23745" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="23745" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4769/Izopi4a" class="user-moderator-Y"><span itemprop="name">Izo</span></a>        </span>
        <br>

        <span class="karma">85.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="23747" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '15</span>
              </span><br/><a name="C23747" href="#C23747">
                <time itemprop="dateCreated" datetime="2015-09-24T11:06:07-07:00" class="action-date">Sep '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>so in ... </p>
<pre><code class="language-php">public function retrieveUnreadCount()
....
return json_encode(['newMessages' =&gt; $unreadMessageCount]);</code></pre>
<p>change html to :</p>
<pre><code>&lt;a href="javascript:void(0)" id="myAccount" class="site-nav-sub"&gt;&lt;i class="fa fa-angle-down site-nav-arrow"&gt;  &lt;/i&gt;Hi, {% raw %}{{{% endraw %} firstname {% raw %}}}{% endraw %} &lt;span id="user_messages_count"&gt;{% raw %}{%{% endraw %} if unreadMessageCount &gt; 0 {% raw %}%}{% endraw %} &lt;span class="badge pull-down" style="background: rgb(36, 232, 0); padding: 5px 1px;"&gt; &lt;/span&gt;{% raw %}{%{% endraw %} endif {% raw %}%}{% endraw %}&lt;/span&gt;&lt;/a&gt;</code></pre>
<p>and then the JS</p>
<pre><code>window.setInterval(function(){
            $.ajax({ 
                url: '/index/retrieveUnreadCount',
                success: function(data){
                    if (data.newMessages &gt; 0)  {
                        var $cont = $('#user_messages_count');

                        $cont.html( data.newMessages + '&lt;span class="badge pull-down" style="background: rgb(36, 232, 0); padding: 5px 1px;"&gt; &lt;/span&gt;');
                    }
                }
            });
        }, 30000);
</code></pre>
<p>and it should work... however for those stuff i would suggest you to remove this mesasge count from being generated in the html at the start, so if you have to change something it will be only inside the javascript</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="23747" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="23747" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4322914daa72a9b402c4b9d46b42bac0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4149/Blkc" class="user-moderator-N"><span itemprop="name">Bryan Leung</span></a>        </span>
        <br>

        <span class="karma">16.1k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C23747"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Izo                    </a>
                </div><div class="posts-buttons" align="right"><a name="C23751" href="#C23751">
                <time itemprop="dateCreated" datetime="2015-09-24T11:32:29-07:00" class="action-date">Sep '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I see. Thanks alot. By the way do I need to disable view in controller?</p>
<blockquote>
<p>so in ... </p>
<pre><code class="language-php">public function retrieveUnreadCount()
....
return json_encode(['newMessages' =&gt; $unreadMessageCount]);</code></pre>
<p>change html to :</p>
<pre><code>&lt;a href="javascript:void(0)" id="myAccount" class="site-nav-sub"&gt;&lt;i class="fa fa-angle-down site-nav-arrow"&gt;  &lt;/i&gt;Hi, {% raw %}{{{% endraw %} firstname {% raw %}}}{% endraw %} &lt;span id="user_messages_count"&gt;{% raw %}{%{% endraw %} if unreadMessageCount &gt; 0 {% raw %}%}{% endraw %} &lt;span class="badge pull-down" style="background: rgb(36, 232, 0); padding: 5px 1px;"&gt; &lt;/span&gt;{% raw %}{%{% endraw %} endif {% raw %}%}{% endraw %}&lt;/span&gt;&lt;/a&gt;</code></pre>
<p>and then the JS</p>
<pre><code>window.setInterval(function(){
           $.ajax({ 
               url: '/index/retrieveUnreadCount',
               success: function(data){
                   if (data.newMessages &gt; 0)  {
                      var $cont = $('#user_messages_count');

                      $cont.html( data.newMessages + '&lt;span class="badge pull-down" style="background: rgb(36, 232, 0); padding: 5px 1px;"&gt; &lt;/span&gt;');
                  }
               }
           });
       }, 30000);
</code></pre>
<p>and it should work... however for those stuff i would suggest you to remove this mesasge count from being generated in the html at the start, so if you have to change something it will be only inside the javascript</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="23751" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="23751" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4769/Izopi4a" class="user-moderator-Y"><span itemprop="name">Izo</span></a>        </span>
        <br>

        <span class="karma">85.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C23753" href="#C23753">
                <time itemprop="dateCreated" datetime="2015-09-24T11:37:12-07:00" class="action-date">Sep '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>try </p>
<pre><code>echo json_encode(['newMessages' =&gt; $unreadMessageCount]);
exit;</code></pre>
<p>if you are using phalcon 2.1 -&gt; </p>
<pre><code>echo json.encode...
return false;</code></pre>
<p>if you are ising 2.0</p>
<p>check this one here:</p>
<p><a href="https://github.com/ovr/phalcon-module-skeleton/tree/master/application/modules/api">https://github.com/ovr/phalcon-module-skeleton/tree/master/application/modules/api</a></p>
<p>otherwise i dont know :D</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="23753" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="23753" data-cf-modified-fb6224d40d283a23dba5ad3e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="8679" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>