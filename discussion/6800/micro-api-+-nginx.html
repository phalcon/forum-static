---
layout: default
title: 'Micro api + nginx - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/22/micro">Micro</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Micro api + nginx</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/3854/robsonflorentino" class="user-moderator-N"><span itemprop="name">Robson Florentino</span></a></span>
            <time itemprop="dateCreated" datetime="2015-05-18T06:25:54-07:00">May '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-05-18T06:25:54-07:00">May '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>May '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">7</span>
                </td>
                <td>
                    <label>Views</label><br>2738</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/ec5b5e1a044527ba886a8daf09edba63?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/3854/robsonflorentino" class="user-moderator-N"><span itemprop="name">Robson Florentino</span></a></span>
                <span class="karma">2.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C6800" href="#C6800">
        <time class="action-date">May '15</time>
    </a>
</div>
<div class="post-content"><div><p>Hi guys!!!</p>
<p>Once again I'm sorry for my english.</p>
<p>I need to build an application to provide a rest api to communicate with AngularJs. I've been following the post <a href="http://forum.phalcon.io/discussion/1753/micro-api-versioning"><a href="http://forum.phalcon.io/discussion/1753/micro-api-versioning">http://forum.phalcon.io/discussion/1753/micro-api-versioning</a></a>, but in my case, I need build it in nginx server</p>
<p>I've been trying some configurations to do it, but most often I get an error saying 'The cycling rewrite or a simple 404 Error'.</p>
<p>Someone help me?</p>
<p>Tks!</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-1da8c947dd96dbc3512586cf-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-1da8c947dd96dbc3512586cf-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/97cfdb3586f82c3e1e4fe562bda688b8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/571/duythien" class="user-moderator-Y"><span itemprop="name">Thien Tran</span></a>        </span>
        <br>

        <span class="karma">58.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C18495" href="#C18495">
                <time itemprop="dateCreated" datetime="2015-05-18T07:31:00-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi
Could you upload configuration file nginx ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18495" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18495" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ec5b5e1a044527ba886a8daf09edba63?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3854/robsonflorentino" class="user-moderator-N"><span itemprop="name">Robson Florentino</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C18504" href="#C18504">
                <time itemprop="dateCreated" datetime="2015-05-18T10:53:31-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Thien, follow my server configuration. Remember that I tried some differents configurations, and I don't know if this is near of be a good configuration.</p>
<p>I'm new with Phalcon and nginx.</p>
<p>tks for you reply.</p>
<pre><code>server {
    listen 80;
    server_name dev.crs.callink.com.br;
    access_log E:/Desenv/Servers/nginx-1.9.0/logs/dev.crs.callink.com.br-access.log;
    error_log E:/Desenv/Servers/nginx-1.9.0/logs/dev.crs.callink.com.br-error.log;
    root E:/Desenv/Projetos/php/svn/crs-admin-branch/public;

    client_max_body_size 100m;

    location @rewrite {
        rewrite ^/(.*)$ /index.php?_url=/$1;
    }

    location / {
        sendfile on;
        client_max_body_size 200m;
        try_files $uri $uri/ /index.php$is_args$args;
        index  index.html index.htm index.php;
    }

    location /api/v1  {
        alias E:/Desenv/Projetos/php/svn/crs-admin-branch/api/v1/public;

        try_files $uri $uri/ @rewrite;

        location ~ \.php {
            fastcgi_pass unix:/run/php-fpm/php-fpm.sock;
            fastcgi_index /index.php;

            include /etc/nginx/fastcgi_params;

            fastcgi_split_path_info       ^(.+\.php)(/.+)$;
            fastcgi_param PATH_INFO       $fastcgi_path_info;
            fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        }

        location ~* ^/(css|img|js|flv|swf|download)/(.+)$ {
            root $root_path;
        }

        location ~ /\.ht {
            deny all;
        }

    }

    location /api/v2  {
        alias E:/Desenv/Projetos/php/svn/crs-admin-branch/api/v2/public;

    }

    location ~ \.php$ {
        try_files $uri /index.php =404;
        fastcgi_index index.php;
        fastcgi_pass  127.0.0.1:9000;
        fastcgi_param  SCRIPT_FILENAME E:/Desenv/Projetos/php/svn/crs-admin-branch/public$fastcgi_script_name;
        fastcgi_param debug true;
        include        fastcgi_params;
    }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18504" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18504" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/97cfdb3586f82c3e1e4fe562bda688b8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/571/duythien" class="user-moderator-Y"><span itemprop="name">Thien Tran</span></a>        </span>
        <br>

        <span class="karma">58.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C18512" href="#C18512">
                <time itemprop="dateCreated" datetime="2015-05-18T17:55:08-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You can refer to configuration file nginx here</p>
<pre><code>server {

    listen   80;
    server_name api.zphalcon.com;

    index index.php index.html index.htm;
    set $root_path '/usr/share/nginx/html/master/apps/api';
    root $root_path;
    #auth_basic "Admin Login";
        #auth_basic_user_file /etc/nginx/pma_pass;
    try_files $uri $uri/ @rewrite;

    location @rewrite {
        #auth_basic "Admin Login";
        #auth_basic_user_file /etc/nginx/pma_pass;
        rewrite ^/(.*)$ /index.php?_url=/$1;
    }
    location ~ \.php$ {
            try_files $uri =404;
            fastcgi_split_path_info ^(.+\.php)(/.+)$;
            fastcgi_pass unix:/var/run/php-fpm.sock;
            fastcgi_index index.php;
            fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
            include fastcgi_params;
    }

    location ~* ^/(css|img|js|flv|swf|download)/(.+)$ {
        root $root_path;
    }

    location ~ /\.ht {
        deny all;
    }
}</code></pre>
<p>It working me <a href="http://api.zphalcon.com//v1/test">http://api.zphalcon.com//v1/test</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18512" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18512" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ec5b5e1a044527ba886a8daf09edba63?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3854/robsonflorentino" class="user-moderator-N"><span itemprop="name">Robson Florentino</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C18542" href="#C18542">
                <time itemprop="dateCreated" datetime="2015-05-19T05:24:27-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Thien!</p>
<p>Sorry for my inexperience.</p>
<p>I've this folder tree:</p>
<pre><code>- application
    - public # my angularJs application
        -index.html
    - api
        - v1 # my Phalcon application in a first version
        - v2</code></pre>
<p>How to adjusts my nginx configuration to serve the two requests?
I had try a similar configuration with your configuration, but only can listen the phalcon request, even so I can't rewrite the parametrs of request.</p>
<p>Follow my current config:</p>
<pre><code>server {

    listen   80;
    server_name dev.rest.callink.com.br;

    index index.php index.html index.htm;
    set $root_path 'E:/Desenv/Projetos/php/local/locadora-web';
    root $root_path;

    try_files $uri $uri/ @rewrite;

    location @rewrite {
        rewrite ^/(.*)$ /index.php?_url=/$1;
    }

    location ~ \.php$ {
        fastcgi_pass  127.0.0.1:9000;
        fastcgi_index index.php;
        fastcgi_split_path_info       ^(.+\.php)(/.+)$;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include        fastcgi_params;
    }

    location ~* ^/(css|img|js|flv|swf|download)/(.+)$ {
        root $root_path;
    }

    location ~ /\.ht {
        deny all;
    }
}</code></pre>
<p>Tks for your reply!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18542" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18542" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/dd3fffd03ae5ee21b4c8df91f54b3bf0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3392/eva-thien" class="user-moderator-N"><span itemprop="name">Thien</span></a>        </span>
        <br>

        <span class="karma">473</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C18572" href="#C18572">
                <time itemprop="dateCreated" datetime="2015-05-19T19:39:12-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi</p>
<p>I see folder the above and file config nginx  does not correspond</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18572" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18572" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ec5b5e1a044527ba886a8daf09edba63?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3854/robsonflorentino" class="user-moderator-N"><span itemprop="name">Robson Florentino</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C18575" href="#C18575">
                <time itemprop="dateCreated" datetime="2015-05-19T21:32:00-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Sorry Thien!</p>
<p>My config doesn't look good!</p>
<p>I just wanted to show you the infrastructure that I want build, and how my final structure should look like this.</p>
<p>How to configure my server for that both applications can work?</p>
<pre><code>- application
    - public # my angularJs application
        -index.html
    - api
        - v1 # my Phalcon application in a first version
        - v2</code></pre>
<p>Once again sorry for my English.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18575" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18575" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/dd3fffd03ae5ee21b4c8df91f54b3bf0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3392/eva-thien" class="user-moderator-N"><span itemprop="name">Thien</span></a>        </span>
        <br>

        <span class="karma">473</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="18576" data-toggle="modal" data-target="#historyModal">
                edited <span>May '15</span>
              </span><br/><a name="C18576" href="#C18576">
                <time itemprop="dateCreated" datetime="2015-05-19T22:27:02-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hey</p>
<p>In v1 you need file index.php, that mean index.php loading all app of you such as dependenci , bootstrap file... . When you need config like exmaple </p>
<pre><code class="language-php">set $root_path '/usr/share/nginx/html/application//api/v1';</code></pre>
<p>When you release v2 then create configuration vhost for it</p>
<pre><code class="language-php">set $root_path '/usr/share/nginx/html/application//api/v2';</code></pre>
<p>By the way to understand Vhost Nginx see here <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-virtual-hosts-server-blocks-on-ubuntu-12-04-lts--3">https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-virtual-hosts-server-blocks-on-ubuntu-12-04-lts--3</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18576" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18576" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ec5b5e1a044527ba886a8daf09edba63?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3854/robsonflorentino" class="user-moderator-N"><span itemprop="name">Robson Florentino</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C18615" href="#C18615">
                <time itemprop="dateCreated" datetime="2015-05-20T06:11:44-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Thien!</p>
<p>I'm new with nginx, and I never got understand the apache config very well.</p>
<p>This was my last try:</p>
<pre><code>server {

    # SERVER
    listen   80;
    server_name dev.rest.application.build;

    # PATHS
    set $root_path 'E:/Desenv/Projetos/php/local/application/public';

    # ALIASES
    set $v1_path 'E:/Desenv/Projetos/php/local/application/api/v1/public';
    set $v2_path 'E:/Desenv/Projetos/php/local/application/api/v2/public';

    # COMMONS
    #gzip  on;
    root $root_path;
    index index.php index.html index.htm;

    #LOCATIONS 

    location /api/v1 {
        alias $v1_path;
        if (!-e $request_filename) {
            rewrite ^(.+)$ /api/v1/index.php?_url=$1 last;
            break;
        }
    }

    location /api/v2 {
        alias $v2_path;
        if (!-e $request_filename) {
            rewrite ^(.+)$ /api/v2/index.php?_url=$1 last;
            break;
        }
    }

    location ~ \.php {
        try_files $uri /index.php =404;
        fastcgi_index index.php;
        fastcgi_pass  127.0.0.1:9000;
        fastcgi_param  SCRIPT_FILENAME $root_path$fastcgi_script_name;
        fastcgi_param debug true;
        include        fastcgi_params;
    }

    location ~* ^/(css|img|js|flv|swf|download)/(.+)$ {
        root $root_path;
    }

    #LOGGING
    rewrite_log on;
    access_log E:/Desenv/Servers/nginx-1.9.0/logs/dev.rest.application.build-access.log;
    error_log E:/Desenv/Servers/nginx-1.9.0/logs/dev.rest.application.build-error.log debug;
}</code></pre>
<p>I think this config is close to what should be. Reading your suggestion, I found some config that I was not understand before, but yet not can run it as wanted to do.</p>
<p>I wanted to thank you for your support in this issue.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18615" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18615" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/97cfdb3586f82c3e1e4fe562bda688b8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/571/duythien" class="user-moderator-Y"><span itemprop="name">Thien Tran</span></a>        </span>
        <br>

        <span class="karma">58.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C18639" href="#C18639">
                <time itemprop="dateCreated" datetime="2015-05-20T17:16:52-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Robson </p>
<p>I am very glad to hear you say so. Any way if you want learming Phalcon tip or trick checkout <a href="http://phalcontip.com">http://phalcontip.com</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18639" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18639" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/15f2ece9163dfec99672e5195a116fb2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3442/cullsin" class="user-moderator-N"><span itemprop="name">cullsin</span></a>        </span>
        <br>

        <span class="karma">13.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C34833" href="#C34833">
                <time itemprop="dateCreated" datetime="2016-05-29T11:47:13-07:00" class="action-date">May '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi, </p>
<p>Can you please suggest me which is the proper working configuration file ? I am getting 404  error as response for <a href="http://api.localhost.com/test/user">http://api.localhost.com/test/user</a>,
whereas my Root URL <a href="http://api.localhost.com">http://api.localhost.com</a>  is responding with Json data. </p>
<p>Please suggest me on the same.</p>
<p>Thanks,
Raja K</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="34833" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="34833" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2f5c6fdb3106d86a5c36c17a265735ec?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/6355/gouy-elliot" class="user-moderator-N"><span itemprop="name">Gouy Elliot</span></a>        </span>
        <br>

        <span class="karma">155</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="34873" data-toggle="modal" data-target="#historyModal">
                edited <span>May '16</span>
              </span><br/><a name="C34873" href="#C34873">
                <time itemprop="dateCreated" datetime="2016-05-30T10:02:29-07:00" class="action-date">May '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I achieve to make multiples version of micro phalcon APIs on nginx :</p>
<p>Here my projects on file system :</p>
<pre><code>- /var/www/myapp
        - /1.0
            phalcon project
        - /1.1
            phalcon project
        - /404.html</code></pre>
<p>And my nginx configuration file :</p>
<pre><code>server {

    listen 80;

    server_name api.my-domain.com;

    error_log /var/log/myapp/api/error.log;

    index index.php index.html index.htm;

    try_files $uri $uri/ @rewrite;

    root /var/www/myapp/;

    ## 404 PAGE FOR FACTCGI ERRORS
    error_page 404 /404.html;

    ## OTHER RULES (GZIP...)

    location @rewrite {
        rewrite ^(/1.0|/1.1|)/(.*)$ $1/public/index.php?_url=/$2;
    }

    ## EXAMPLE OF REWRITE :
    ##
    ## URL INPUT 
    ## http://api.my-domain.com/1.1/test
    ##
    ## URL OUTPUT
    ## http://api.my-domain.com/1.1/public/index.php?_url=/test

    location ~/1.0.*\.php$ {

        root /var/www/myapp/;

        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_index /index.php;
        fastcgi_intercept_errors on;
        include /etc/nginx/fastcgi_params;
        fastcgi_split_path_info       ^(.+\.php)(/.+)$;
        fastcgi_param PATH_INFO       $fastcgi_path_info;
        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    location ~/1.1.*\.php$ {

        root /var/www/myapp/;

        fastcgi_intercept_errors on;
        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_index /index.php;
        include /etc/nginx/fastcgi_params;
        fastcgi_split_path_info       ^(.+\.php)(/.+)$;
        fastcgi_param PATH_INFO       $fastcgi_path_info;
        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    ##CATCH URLs WITHOUT VERSIONS -- SET VERSION 1.1 BY DEFAULT
    location ~ \.php$ {

        root /var/www/myapp/1.1/;

        fastcgi_pass unix:/var/run/php5-fpm.sock;
        fastcgi_index /index.php;
        fastcgi_intercept_errors on;
        include /etc/nginx/fastcgi_params;
        fastcgi_split_path_info       ^(.+\.php)(/.+)$;
        fastcgi_param PATH_INFO       $fastcgi_path_info;
        fastcgi_param PATH_TRANSLATED $document_root$fastcgi_path_info;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    }

    ## WARN : MAKE SUR TO HAVE SAME FILES IN 1.0 &amp; 1.1 PUBLIC FOLDERS (NOT A PROBLEM FOR APIs)

    location ~* ^/(css|img|js|flv|swf|download)/(.+)$ {
        root /var/www/myapp/1.1/public;
    }

    location ~ /\.ht {
        deny all;
    }
}</code></pre>
<p>Now you juste have to call <a href="http://api.my-domain.com/{version}/{yourlocation">http://api.my-domain.com/{version}/{yourlocation</a>} and nginx will redirect to the {version}/public/index.php.</p>
<p>Hope it may help someone.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="34873" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="34873" data-cf-modified-1da8c947dd96dbc3512586cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="6800" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>