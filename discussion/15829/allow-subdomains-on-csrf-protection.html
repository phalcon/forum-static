---
layout: default
title: 'Allow Subdomains on CSRF Protection - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/16/security">Security</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Allow Subdomains on CSRF Protection</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/6503/afbora" class="user-moderator-N"><span itemprop="name">Ahmet Bora</span></a></span>
            <time itemprop="dateCreated" datetime="2017-03-28T11:33:24-07:00">Mar '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-03-28T11:33:24-07:00">Mar '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Mar '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>907</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/7512241adf8b7fb3e19c19c06f775ee3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/6503/afbora" class="user-moderator-N"><span itemprop="name">Ahmet Bora</span></a></span>
                <span class="karma">58.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C15829" href="#C15829">
        <time class="action-date">Mar '17</time>
    </a>
</div>
<div class="post-content"><div><p>My application is: <strong>app.example.com</strong> (Phalcon MVC)</p>
<p>My website is: <strong>www.example.com</strong> (PHP Native)</p>
<p>I want to app login from website with CSRF but i couldnt solve.</p>
<p>I'm getting CSRF token from application api like that:</p>
<pre><code>public function getCsrfTokenAction()
{        
    return $this-&gt;response-&gt;setJsonContent(array(
            'key' =&gt; $this-&gt;security-&gt;getTokenKey(), 
            'value' =&gt; $this-&gt;security-&gt;getToken()
        ));
}</code></pre>
<p>And application response service like that:</p>
<pre><code>$di-&gt;setShared('response', function () {
    $response = new Response();                      
    $response-&gt;setHeader('Access-Control-Allow-Origin', 'example.com');   
    $response-&gt;setHeader('Access-Control-Allow-Credentials', true);   
    $response-&gt;sendHeaders();

    return $response;
});</code></pre>
<p>But this is not working. What missing?</p>
<p>Thanks</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-5fdcbc642c674d97024a27cf-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-5fdcbc642c674d97024a27cf-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c0ce8f5e133750a4dfea4712e533a178?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/15/le51" class="user-moderator-N"><span itemprop="name">le51</span></a>        </span>
        <br>

        <span class="karma">43.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="47023" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '17</span>
              </span><br/><a name="C47023" href="#C47023">
                <time itemprop="dateCreated" datetime="2017-03-28T12:01:36-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi,</p>
<p>I think you have to deal with CORS: <a href="https://enable-cors.org/">https://enable-cors.org/</a> </p>
<p>or <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS</a></p>
<p>But, I imagine you already know that</p>
<p>And regarding how is your website build (single page javascript frontend app, or a kind of classical php website -like a phalcon mvc one- ) solution may be different ...</p>
<p>Is</p>
<blockquote>
<p>$di-&gt;setShared('response', function () { ....</p>
</blockquote>
<p>set in your api app or in your website app ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47023" data-cf-modified-5fdcbc642c674d97024a27cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47023" data-cf-modified-5fdcbc642c674d97024a27cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/7512241adf8b7fb3e19c19c06f775ee3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/6503/afbora" class="user-moderator-N"><span itemprop="name">Ahmet Bora</span></a>        </span>
        <br>

        <span class="karma">58.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="47027" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '17</span>
              </span><br/><a name="C47027" href="#C47027">
                <time itemprop="dateCreated" datetime="2017-03-28T12:09:46-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hmm, I'm trying PHP website via POST to Phalcon MVC application. Not javascript.</p>
<p>I have tried <code>Access-Control-Allow-Origin</code> on htaccess, php header and phalcon response but didnt work.</p>
<p>Dou you have an idea?</p>
<p>Website is PHP, Application is Phalcon MVC</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47027" data-cf-modified-5fdcbc642c674d97024a27cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47027" data-cf-modified-5fdcbc642c674d97024a27cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c0ce8f5e133750a4dfea4712e533a178?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/15/le51" class="user-moderator-N"><span itemprop="name">le51</span></a>        </span>
        <br>

        <span class="karma">43.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="47035" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '17</span>
              </span><br/><a name="C47035" href="#C47035">
                <time itemprop="dateCreated" datetime="2017-03-28T12:52:21-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Dou you have an idea? </p>
</blockquote>
<p>unfortunately not ! But for a future project I will have to dig in this kind of scenario ... So I will try to help</p>
<p>Just for clarification: you said that api.example.com is a phalcon mvc app. Does that mean that the sended responses from that host are full html pages ?</p>
<p>How do the www.example.com pages request api.example.com Because usually this situation happend (and maybe is only supported) through XML httpRequest objects.</p>
<p>And for &quot;debuging&quot; purpose, does a cross origin request work if you disable all the csrf token chek ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47035" data-cf-modified-5fdcbc642c674d97024a27cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47035" data-cf-modified-5fdcbc642c674d97024a27cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47079" href="#C47079">
                <time itemprop="dateCreated" datetime="2017-03-30T02:22:19-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Most likely it's about session - you need to set subdomain session.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47079" data-cf-modified-5fdcbc642c674d97024a27cf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47079" data-cf-modified-5fdcbc642c674d97024a27cf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="15829" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>