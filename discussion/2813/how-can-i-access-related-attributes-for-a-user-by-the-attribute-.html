---
layout: default
title: 'How can I access related attributes for a user by the attribute name? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">How can I access related attributes for a user by the attribute name?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/1942/andrefigueira" class="user-moderator-N"><span itemprop="name">André Figueira</span></a></span>
            <time itemprop="dateCreated" datetime="2014-07-12T07:42:21-07:00">Jul '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-07-12T07:42:21-07:00">Jul '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jul '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>593</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/a93871fc7077b69587626ca90e738ece?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/1942/andrefigueira" class="user-moderator-N"><span itemprop="name">André Figueira</span></a></span>
                <span class="karma">12.6k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2813" href="#C2813">
        <time class="action-date">Jul '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hi guys I'm new to phalcon, loving it so far, but just having an issue getting information I need in volt.</p>
<p>If you could help out that would be great, I've posted a question in detail on Stackoverflow.</p>
<p><a href="http://stackoverflow.com/questions/24713954/getting-related-user-attributes-in-phalcon">http://stackoverflow.com/questions/24713954/getting-related-user-attributes-in-phalcon</a></p>
<p>Thanks in advance</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-d013455a352a5b55c338fac1-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-d013455a352a5b55c338fac1-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="9416" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '14</span>
              </span><br/><a name="C9416" href="#C9416">
                <time itemprop="dateCreated" datetime="2014-07-12T08:56:13-07:00" class="action-date">Jul '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The relationship is called UsersAttributes so instead of:</p>
<pre><code class="language-html">{% raw %}{{{% endraw %} user.userAttributes.profileImage {% raw %}}}{% endraw %}</code></pre>
<p>you have to use:</p>
<pre><code class="language-html">{% raw %}{{{% endraw %} user.usersAttributes.profileImage {% raw %}}}{% endraw %}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9416" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9416" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a93871fc7077b69587626ca90e738ece?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1942/andrefigueira" class="user-moderator-N"><span itemprop="name">André Figueira</span></a>        </span>
        <br>

        <span class="karma">12.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C9417" href="#C9417">
                <time itemprop="dateCreated" datetime="2014-07-12T09:46:47-07:00" class="action-date">Jul '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/Phalcon">@Phalcon</a> still getting  an undefined property error...</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9417" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9417" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a93871fc7077b69587626ca90e738ece?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1942/andrefigueira" class="user-moderator-N"><span itemprop="name">André Figueira</span></a>        </span>
        <br>

        <span class="karma">12.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C9418" href="#C9418">
                <time itemprop="dateCreated" datetime="2014-07-12T10:11:02-07:00" class="action-date">Jul '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>In my controller for example if I dump the following:</p>
<pre><code>    var_dump($user-&gt;usersAttributes-&gt;toArray());</code></pre>
<p>I get:</p>
<pre><code>array (size=3)
    0 =&gt; 
        array (size=4)
        'id' =&gt; string '1' (length=1)
        'userId' =&gt; string '1' (length=1)
        'attributeId' =&gt; string '1' (length=1)
        'attributeValue' =&gt; string '/profile/83/jocelyn.jpg' (length=23)</code></pre>
<p>If I do </p>
<pre><code>var_dump($user-&gt;attributes-&gt;toArray());</code></pre>
<p>If get:</p>
<pre><code>    array (size=3)
        0 =&gt; 
         array (size=3)
            'id' =&gt; string '1' (length=1)
            'name' =&gt; string 'profileImage' (length=12)
            'defaultValue' =&gt; string '/profile/placeholder.jpg' (length=24)</code></pre>
<p>So  I can do {% raw %}{{{% endraw %} user.attributes.profileImage {% raw %}}}{% endraw %} but I get undefined property exception but If i do say {% raw %}{{{% endraw %} user.attributes.name {% raw %}}}{% endraw %} I get &quot;profileImage&quot; returned which isn't exactly what I want, question is I guess, am i missing something and shoudl the attribute anem get mapped to the value in the usersAttributes or do I have to get the value another way by say manually mapping them and setting a view property?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9418" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9418" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ec4efcef34b5522b1d791b67ced4db9?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1816/marek1989" class="user-moderator-N"><span itemprop="name">marek1989</span></a>        </span>
        <br>

        <span class="karma">6.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="9422" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '14</span>
              </span><br/><a name="C9422" href="#C9422">
                <time itemprop="dateCreated" datetime="2014-07-12T16:40:32-07:00" class="action-date">Jul '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/andrefigueira">@andrefigueira</a></p>
<p>What I can see is that in Users model in method initialize you have got</p>
<pre><code class="language-php">$this-&gt;hasMany('id', 'UsersAttributes', 'userId');
$this-&gt;hasManyToMany(
        'id',
        'UsersAttributes',
        'userId', 'attributeId',
        'Attributes',
        'id'
);</code></pre>
<p>so you actually defining relation for UsersAttributes twice. Firstly think which relation you want to use, if you want to have One To Many you should got just hasMany(), if you want to have Many To Many you should got hasManyToMany()...not both together on the same table and field.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9422" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9422" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a93871fc7077b69587626ca90e738ece?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1942/andrefigueira" class="user-moderator-N"><span itemprop="name">André Figueira</span></a>        </span>
        <br>

        <span class="karma">12.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C9431" href="#C9431">
                <time itemprop="dateCreated" datetime="2014-07-13T10:52:30-07:00" class="action-date">Jul '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I've tried removing the first one but still doesn't map the key of the attribute to the related value.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9431" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9431" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C9448" href="#C9448">
                <time itemprop="dateCreated" datetime="2014-07-13T21:22:50-07:00" class="action-date">Jul '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>When you use $this-&gt;hasMany('id', 'UsersAttributes', 'userId'); you're defining a 1-n relationship, it means by accessing user.usersAttributes you're accessing one or more user's attributes, so you can't directly access &quot;profileImage&quot; there:</p>
<pre><code class="language-html">{% raw %}{{{% endraw %} for attribute in user.usersAttributes {% raw %}}}{% endraw %}
 {% raw %}{{{% endraw %} attribute.profileImage {% raw %}}}{% endraw %}
{% raw %}{{{% endraw %} endfor {% raw %}}}{% endraw %}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9448" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9448" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a93871fc7077b69587626ca90e738ece?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1942/andrefigueira" class="user-moderator-N"><span itemprop="name">André Figueira</span></a>        </span>
        <br>

        <span class="karma">12.6k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C9511" href="#C9511">
                <time itemprop="dateCreated" datetime="2014-07-16T07:11:19-07:00" class="action-date">Jul '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Understood, thanks very much for the clarification, what I've ended up doing is within the Users model is create a specific mapper method and do an afterFetch to append the attributes to the user result, would this be ok? It does work, just wondering if not a cleaner way to do it.</p>
<pre><code>public static function fetchUserAttributes($userId)
{

    $modelsManager = Phalcon\DI::getDefault()-&gt;getModelsManager();

    $phql = '
    SELECT name, attributeValue
    FROM Attributes
    LEFT JOIN UsersAttributes
    ON UsersAttributes.userId = :userId:
    AND Attributes.id = UsersAttributes.attributeId
    ';

    $rows = $modelsManager-&gt;executeQuery($phql, array('userId' =&gt; $userId));

    $attributesObj = new \stdClass();

    foreach($rows as $row)
    {

        $attributesObj-&gt;{$row['name']} = $row['attributeValue'];

    }

    return $attributesObj;

}

public function afterFetch()
{

    //Attach user attributes
    $this-&gt;attributes = Users::fetchUserAttributes($this-&gt;id);

}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9511" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9511" data-cf-modified-d013455a352a5b55c338fac1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2813" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>