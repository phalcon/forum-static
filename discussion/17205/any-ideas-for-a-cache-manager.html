---
layout: default
title: 'Any ideas for a cache manager? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/8/cache">Cache</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Any ideas for a cache manager?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/8837/cosmy81" class="user-moderator-N"><span itemprop="name">Cosimo</span></a></span>
            <time itemprop="dateCreated" datetime="2017-10-31T05:51:33-07:00">Oct '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-10-31T05:51:33-07:00">Oct '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>423</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/a2658b5645f7a791cd1fbf709c4eb9b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/8837/cosmy81" class="user-moderator-N"><span itemprop="name">Cosimo</span></a></span>
                <span class="karma">12.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C17205" href="#C17205">
        <time class="action-date">Oct '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hi all. I'm sure that many of you have already managed a structured cache system in your projects.
What I think it's very important is the possibility to use or disable cache without modifying the code, managing indexes and deleting cache  when inserting or updating something in the backend.
I immagine to manage cache refreshing with events to fire on model saving in the backend, so if the cache is disabled you don't receive any error.
What about using the cache inside the frontend? I think there should be the possibility to disable it by config file (cache enabled or disabled) and in debug mode, but putting an if everytime i call the cache is not a good way to perform it. How have you managed a structured caching system?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-317f030d29d976a6c432796d-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-317f030d29d976a6c432796d-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b59fecbff6d1afabf8da316028330df4?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2619/emiliodeg" class="user-moderator-N"><span itemprop="name">Emilio Degiovanni</span></a>        </span>
        <br>

        <span class="karma">32.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C51957" href="#C51957">
                <time itemprop="dateCreated" datetime="2017-10-31T11:48:42-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi<a href="https://forum.phalcon.io/user/0/Cosimo"> @Cosimo</a> you can overwrite the get method in your own cache adapter for example</p>
<pre><code class="language-php">class myCacheAdapter implement Phalcon\Cache\BackendInterface {
    public function get($id) {
        if ($cacheServiceIsAvailable === true) { // cache service is active?
            return parent::get($id);
        }

        return false;
    }

    // the rest of adapter
}</code></pre>
<p>In this way you can enable the service whenever you want without having to modify all the code of your application</p>
<p>Good luck</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51957" data-cf-modified-317f030d29d976a6c432796d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51957" data-cf-modified-317f030d29d976a6c432796d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a2658b5645f7a791cd1fbf709c4eb9b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/8837/cosmy81" class="user-moderator-N"><span itemprop="name">Cosimo</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C51969" href="#C51969">
                <time itemprop="dateCreated" datetime="2017-11-01T02:42:36-07:00" class="action-date">Nov '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Very nice, thank you<a href="https://forum.phalcon.io/user/0/emiliodeg"> @emiliodeg</a>.
In terms of performance, returning false is neutral or a little bit slower than not using cache at all?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51969" data-cf-modified-317f030d29d976a6c432796d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51969" data-cf-modified-317f030d29d976a6c432796d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b59fecbff6d1afabf8da316028330df4?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2619/emiliodeg" class="user-moderator-N"><span itemprop="name">Emilio Degiovanni</span></a>        </span>
        <br>

        <span class="karma">32.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52005" href="#C52005">
                <time itemprop="dateCreated" datetime="2017-11-01T15:31:21-07:00" class="action-date">Nov '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>returning false you can continue using the adapter without changes</p>
<pre><code class="language-php">$element = $this-&gt;persistent-&gt;get('myElement'); // posible element cached

if (!$element) { // no cached
    $element = $this-&gt;elementManager-&gt;get('myElement'); // get fresh element

    $this-&gt;persistent-&gt;set('myElement', $element); // here you have to overwrite set method to cache is the service is active, similar on get
}

echo $element;</code></pre>
<p>I hope it's help you</p>
<p>Good luck</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52005" data-cf-modified-317f030d29d976a6c432796d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52005" data-cf-modified-317f030d29d976a6c432796d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a2658b5645f7a791cd1fbf709c4eb9b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/8837/cosmy81" class="user-moderator-N"><span itemprop="name">Cosimo</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="54025" data-toggle="modal" data-target="#historyModal">
                edited <span>Feb '18</span>
              </span><br/><a name="C54025" href="#C54025">
                <time itemprop="dateCreated" datetime="2018-02-18T04:43:32-07:00" class="action-date">Feb '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I've used your suggestion for the Adapter, so I've extended the File adpter (i need it, no more) using that flag to return false.
Than I've created a cache manager in order to manage the cache logic inside a class and not inside the controllers or the methods.</p>
<pre><code class="language-php">class CacheManager extends Component
{
    /**
     * Get cache data. If data not exists, generate data and save to cache
     */
    public function get($key, $closure, $lifetime = 3000, $prefix = null)
    {
        //if array, serialize it and get unique key, altough use the string $key
        if (is_array($key)) {
            $key = $this-&gt;key($key);
        }
        //the prefix is useful to group several serialized keys
        if ($prefix) {
            $key = $prefix . "-" . $key;
        }
        if ($lifetime == 0) {
            return $closure();
        }
        $data = $this-&gt;cache-&gt;get($key, $lifetime);
        if (!$data) {
            $data = $closure();
            // if cache is disabled skip this step
            if ($this-&gt;getDi()-&gt;get('config')-&gt;cache-&gt;active) {
                $this-&gt;cache-&gt;save($key, $data, $lifetime);
            }
        }
        return $data;
    }

    public function save($key, $data, $lifetime)
    {
        if (is_array($key)) {
            $key = $this-&gt;key($key);
        }
        $this-&gt;cache-&gt;save($key, $data, $lifetime);
    }

    public function delete($key)
    {
        if (is_array($key)) {
            $key = $this-&gt;key($key);
        }
        $this-&gt;cache-&gt;delete($key);
    }

    public function key(array $params = [])
    {
        return md5(json_encode($params));
    }
}</code></pre>
<p>inside config.ini I have a cache section, of course.</p>
<p>So to use cache for a peace of code, or a method, you have just to put it inside the closure. I think that way to manage cache is usefull for large resultsets and their manipulation. I've not considered the possibility to use ORM persistent cache, but you can achieve it in this way</p>
<pre><code class="language-php">    public static function find($parameters = null)
    {
        // Convert the parameters to an array
        if (!is_array($parameters)) {
            $parameters = [$parameters];
        }
        return \Phalcon\DI::getDefault()-&gt;get('cacheManager')-&gt;get(
            $parameters,
            function () use ($parameters) {
                return parent::find($parameters);
            }
        );
    }</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="54025" data-cf-modified-317f030d29d976a6c432796d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="54025" data-cf-modified-317f030d29d976a6c432796d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="17205" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>