---
layout: default
title: 'Model::find(); out of memory - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Model::find(); out of memory</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/2510/rudiservo" class="user-moderator-N"><span itemprop="name">Rudi Servo</span></a></span>
            <time itemprop="dateCreated" datetime="2016-08-23T14:33:22-07:00">Aug '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-08-23T14:33:22-07:00">Aug '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Aug '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">10</span>
                </td>
                <td>
                    <label>Views</label><br>974</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/82ebe53ee6a59e3ad556f575b15daf88?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/2510/rudiservo" class="user-moderator-N"><span itemprop="name">Rudi Servo</span></a></span>
                <span class="karma">3.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C13197" href="#C13197">
        <time class="action-date">Aug '16</time>
    </a>
</div>
<div class="post-content"><div><p>Hey, I am doing a simple find ona table with about 180K results.</p>
<p>$res = SomeModel::find();</p>
<p>and I get</p>
<p>Fatal error:  Allowed memory size of 536870912 bytes exhausted</p>
<p>it's just doing one find, nothing else on a cli task.
All properties are declared.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-c08605bf1d2718068d432def-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-c08605bf1d2718068d432def-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e00a6fdd3e722135512e013b7f1e9693?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3916/zhegwood" class="user-moderator-N"><span itemprop="name">Zach</span></a>        </span>
        <br>

        <span class="karma">17.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C38967" href="#C38967">
                <time itemprop="dateCreated" datetime="2016-08-23T15:00:51-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Are you really going to display all 180k results (bad UX)?  Looks like the collection is eating up the PHP allowed memory.  You can up this via php.ini, but the real fix is to only select the results you'll be showing.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="38967" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="38967" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/82ebe53ee6a59e3ad556f575b15daf88?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2510/rudiservo" class="user-moderator-N"><span itemprop="name">Rudi Servo</span></a>        </span>
        <br>

        <span class="karma">3.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C38969" href="#C38969">
                <time itemprop="dateCreated" datetime="2016-08-23T15:07:36-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/Zach">@Zach</a> its a CLI task not HTTP. I have to iterate over 180K records in background.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="38969" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="38969" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C38971" href="#C38971">
                <time itemprop="dateCreated" datetime="2016-08-23T15:10:47-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What php version ? Why you need to iteraite over 180k records ?! If using php7 then try latest phalcon 3.0.x(you need zephir to compile it)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="38971" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="38971" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e00a6fdd3e722135512e013b7f1e9693?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3916/zhegwood" class="user-moderator-N"><span itemprop="name">Zach</span></a>        </span>
        <br>

        <span class="karma">17.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="38977" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C38977" href="#C38977">
                <time itemprop="dateCreated" datetime="2016-08-23T15:36:30-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>find() will still return a collection of 180k records whether it's cli or http.  Maybe try using a raw query/resultset instead of the collection:</p>
<p><a href="https://docs.phalcon.io/en/latest/reference/phql.html#using-raw-sql">https://docs.phalcon.io/en/latest/reference/phql.html#using-raw-sql</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="38977" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="38977" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/82ebe53ee6a59e3ad556f575b15daf88?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2510/rudiservo" class="user-moderator-N"><span itemprop="name">Rudi Servo</span></a>        </span>
        <br>

        <span class="karma">3.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C38983" href="#C38983">
                <time itemprop="dateCreated" datetime="2016-08-23T16:12:15-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/jurigag">@jurigag</a>, phalcon 3 and PHP7.0.10 and phalcon3</p>
<p>need 180K cause old things that need to be fixed, dont ask...</p>
<p>Also am having the same issue even with limit on query builder with limit 10</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="38983" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="38983" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="38997" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C38997" href="#C38997">
                <time itemprop="dateCreated" datetime="2016-08-23T23:47:31-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Actually 3.0.1 was just released, can you check it? It's fixing many problems with php7 and memory stuff. Also is it happening exactly onf this <code>find</code> call ? Not on some code after it ? Also what is your memory limit for cli and table size ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="38997" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="38997" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39007" href="#C39007">
                <time itemprop="dateCreated" datetime="2016-08-24T03:16:40-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The thing is, if you need to put 180k records in memory, with memory limit set to only 512MB, while each row being average in size of 3KB (2982 bytes), that would nearly fit (you need to take into account other components such as Phalcon, PDO layer, etc.). That's in theory.
In practise, you can have much larger data sets etc.</p>
<p>Since you run a nightly cron task, I would suggest you to use LIMIT with OFFSET, to fetch portions of data in multiple steps. So you start from primary key ID = 1 from let's say 10000. On each iterations you take 10k of rows. That would work.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39007" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39007" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/82ebe53ee6a59e3ad556f575b15daf88?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2510/rudiservo" class="user-moderator-N"><span itemprop="name">Rudi Servo</span></a>        </span>
        <br>

        <span class="karma">3.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39015" href="#C39015">
                <time itemprop="dateCreated" datetime="2016-08-24T03:56:34-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/jurigag">@jurigag</a>, will you put it in the PPA? Meanwhile I will try and compile it.</p>
<p>Yes it's happening on just a simple find() call, on any table that has large data sets, it should not hapen since I am not doing any toArray() or anything that pulls those large tables into memory.</p>
<p><a href="https://forum.phalcon.io/user/4525/stamster">@stamster</a> not a bad idea, but this is a issue still hapens with query builder on limit = 10</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39015" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39015" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/82ebe53ee6a59e3ad556f575b15daf88?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2510/rudiservo" class="user-moderator-N"><span itemprop="name">Rudi Servo</span></a>        </span>
        <br>

        <span class="karma">3.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39017" href="#C39017">
                <time itemprop="dateCreated" datetime="2016-08-24T04:16:41-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>table is 205MB!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39017" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39017" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/82ebe53ee6a59e3ad556f575b15daf88?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2510/rudiservo" class="user-moderator-N"><span itemprop="name">Rudi Servo</span></a>        </span>
        <br>

        <span class="karma">3.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39019" href="#C39019">
                <time itemprop="dateCreated" datetime="2016-08-24T04:20:32-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/jurigag">@jurigag</a> tested it on Phalcon3.0.1 and PHP 7.0.10-1+deb.sury.org~xenial+1
still have the issue</p>
<p>how can I do a memory profile on PHP7, I can try and dig for issue?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39019" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39019" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39023" href="#C39023">
                <time itemprop="dateCreated" datetime="2016-08-24T05:49:21-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>How you tested it ? Post script to reproduce with database please. Or create issue on github with SCRIPT TO REPRODUCE(not just some part of your code, whole script - ctrl+c ctrl+v and i can check it) and database. Eventually you can use <code>phalcon_test</code> database from tests to reproduce it if you can. I don't have your issue, im doing <code>Model::find()</code> or using query builder without any problem.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39023" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39023" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/82ebe53ee6a59e3ad556f575b15daf88?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2510/rudiservo" class="user-moderator-N"><span itemprop="name">Rudi Servo</span></a>        </span>
        <br>

        <span class="karma">3.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39081" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C39081" href="#C39081">
                <time itemprop="dateCreated" datetime="2016-08-24T11:35:16-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/jurigag">@jurigag</a></p>
<p>I created a small project and create a rather large table to test, and still the same issue.</p>
<p>going to try and trace the problem but here is the project you can test</p>
<p><code>https://github.com/rudiservo/phalcon_single</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39081" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39081" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39097" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C39097" href="#C39097">
                <time itemprop="dateCreated" datetime="2016-08-24T13:04:50-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This whole table has 1.3gb - so obviously it can be whole be loaded :D If you don't have enough memory. I don't have problem with loading 300000 records at once. You just need to use limit and offset, you can't just load whole table at once.</p>
<p>From your original table - you had only 512MB <code>memory_limit</code>, you tried to load whole 207MB table, obviously php add memory itself like arrays, objects, other variables, stuff etc. For example:</p>
<pre><code class="language-php">$array = [];
class Test
{
    public $test;
    public $test2;
}
echo memory_get_usage()."&lt;br&gt;";
for($i=0; $i&lt;300000; $i++) {
    $test = new Test();
    $test-&gt;test = "asdasdasdasdasdasd";
    $test-&gt;test2 = ["asdasdasdasdasdasd"];
    $array[] = $test;
}
echo memory_get_usage()."&lt;br&gt;";</code></pre>
<p>Memory usage here will be more than 128MB :) So it's not phalcon problem as you see :)</p>
<p>Using opcache AFTER first page load will reduce memory usage but first it's need to be loaded.</p>
<p>And this sample:</p>
<pre><code class="language-php">echo memory_get_usage()."&lt;br&gt;";
for($i = 0; $i &lt; 100000; $i++) {
    $a = "var$i";
    $$a = "asdasdasdasdasdasd";
}
echo memory_get_usage()."&lt;br&gt;";
$array = [];
for ($i = 0; $i &lt;100000; $i++) {
    $array[] ="asdasdasdasdasdasd";
}
echo memory_get_usage()."&lt;br&gt;";
class Test
{
    public $test;

    public $test2;
}

for ($i = 0; $i &lt;100000; $i++) {
    $a = "var$i";
    $$a = new Test();
    $$a-&gt;test = "asdasdasdasdasdasd";
    $$a-&gt;test2 = ["asdasdasdasdasdasd"];
}
echo memory_get_usage()."&lt;br&gt;";</code></pre>
<p>Your safe bet is something like 10000 records loaded at once - but it depends of course how big is record. Sometimes even 500 can be way too much.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39097" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39097" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/82ebe53ee6a59e3ad556f575b15daf88?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2510/rudiservo" class="user-moderator-N"><span itemprop="name">Rudi Servo</span></a>        </span>
        <br>

        <span class="karma">3.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39107" href="#C39107">
                <time itemprop="dateCreated" datetime="2016-08-24T13:45:27-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/jurigag">@jurigag</a>
You are right not a Phalcon Issue, it's php buffered queries on PDO.</p>
<p>turning off bufffering only lets you work one query at a time.</p>
<p>Have to apply the limit workaround.</p>
<p>thanks guys sorry about the mess.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39107" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39107" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39097"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Wojciech Åšlawski                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39141" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C39141" href="#C39141">
                <time itemprop="dateCreated" datetime="2016-08-25T04:00:48-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Using opcache AFTER first page load will reduce memory usage but first it's need to be loaded.</p>
</blockquote>
<p>OPcache will not reduce memory usage but CPU cycles usage as it will cache OP code and serve prepared php code directly from RAM.</p>
<p>As a matter of fact it takes away RAM from you, but for a good reason.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39141" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39141" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39155" href="#C39155">
                <time itemprop="dateCreated" datetime="2016-08-25T04:54:58-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I just checked same code with <code>memory_get_usage</code> and with opcache enabled it cost less after next refreshes :x</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39155" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39155" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39159" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C39159" href="#C39159">
                <time itemprop="dateCreated" datetime="2016-08-25T04:58:47-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Well, that's kinda expected. On first run, your <code>memory_get_usage</code> profile will be higher since it needs to execute PHP script into OP code (byte code). On each next run, you avoid this step since the majority of the code is being served from RAM, in a OP code ready form, thus only other data streams will be included in memory profile. That's how it seems the memory usage dropped, while actually <code>memory_get_usage</code> does not take into account OP code, but only data streams, network stuff etc. </p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39159" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39159" data-cf-modified-c08605bf1d2718068d432def-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="13197" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>