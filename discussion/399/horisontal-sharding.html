---
layout: default
title: 'Horisontal sharding - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Horisontal sharding</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/23/aavolkoff" class="user-moderator-N"><span itemprop="name">aavolkoff</span></a></span>
            <time itemprop="dateCreated" datetime="2013-06-03T13:54:30-07:00">Jun '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-06-03T13:54:30-07:00">Jun '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>784</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/48537ea6460838b67043b973f132cabd?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/23/aavolkoff" class="user-moderator-N"><span itemprop="name">aavolkoff</span></a></span>
                <span class="karma">36.0k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C399" href="#C399">
        <time class="action-date">Jun '13</time>
    </a>
</div>
<div class="post-content"><div><p>Hello!</p>
<p>Another question about splitting data over multiple databases. Now about &quot;Horisontal Sharding&quot; <a href="http://docs.phalcon.io/en/latest/reference/models.html#setting-multiple-databases">http://docs.phalcon.io/en/latest/reference/models.html#setting-multiple-databases</a></p>
<p>I know that using function <code>selectReadConnection</code> I can choose right connection according to the current query conditions when I want retrieve data from the database. </p>
<p>But, how to choose right connection when I want put (INSERT, UPDATE) data in the database?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-b39fb85f984b62754e5ad39b-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-b39fb85f984b62754e5ad39b-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1659" href="#C1659">
                <time itemprop="dateCreated" datetime="2013-06-03T14:37:43-07:00" class="action-date">Jun '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The idea of 'selectReadConnection' is reduce the read load by splitting queries over several databases servers, write operations are performed in a single master database server which replicates the data to the slaves in async mode.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1659" data-cf-modified-b39fb85f984b62754e5ad39b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1659" data-cf-modified-b39fb85f984b62754e5ad39b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/48537ea6460838b67043b973f132cabd?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/23/aavolkoff" class="user-moderator-N"><span itemprop="name">aavolkoff</span></a>        </span>
        <br>

        <span class="karma">36.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1661" href="#C1661">
                <time itemprop="dateCreated" datetime="2013-06-03T15:00:47-07:00" class="action-date">Jun '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you for the reply!
I thought that it works exactly how you explained... Do you plan to add feature such as &quot;selectWriteConnection&quot;?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1661" data-cf-modified-b39fb85f984b62754e5ad39b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1661" data-cf-modified-b39fb85f984b62754e5ad39b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1667" href="#C1667">
                <time itemprop="dateCreated" datetime="2013-06-03T15:52:30-07:00" class="action-date">Jun '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>By simply override the getWriteConnection in a model you can dynamically change the connection used to write data:</p>
<pre><code class="language-php">&lt;?php

class Robots extends Phalcon\Mvc\Model
{
    public static function getWriteConnection()
    {
        if ($this-&gt;shardKey == 'abcd') {
            return $this-&gt;getDI()-&gt;get('dbMysql1');
        }
        if ($this-&gt;shardKey == 'efgh') {
            return $this-&gt;getDI()-&gt;get('dbMysql2');
        }
        return $this-&gt;getDI()-&gt;get('dbMysql3');
    }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1667" data-cf-modified-b39fb85f984b62754e5ad39b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1667" data-cf-modified-b39fb85f984b62754e5ad39b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/48537ea6460838b67043b973f132cabd?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/23/aavolkoff" class="user-moderator-N"><span itemprop="name">aavolkoff</span></a>        </span>
        <br>

        <span class="karma">36.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1675" href="#C1675">
                <time itemprop="dateCreated" datetime="2013-06-03T21:27:09-07:00" class="action-date">Jun '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you!
So, when I save object I just need check its properties and choose the right connection in the overrided function getWriteConnection. Sure there is still present problem with the null ID (INSERT case), but it's looks okay!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1675" data-cf-modified-b39fb85f984b62754e5ad39b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1675" data-cf-modified-b39fb85f984b62754e5ad39b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="399" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>