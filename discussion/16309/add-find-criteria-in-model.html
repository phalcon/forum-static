---
layout: default
title: 'add find criteria in model - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">add find criteria in model</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/9611/phil67000" class="user-moderator-N"><span itemprop="name">phil67000</span></a></span>
            <time itemprop="dateCreated" datetime="2017-06-12T01:04:56-07:00">Jun '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-06-12T01:04:56-07:00">Jun '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>701</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/4bc65c6eab5e6a2344066da4598654cb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/9611/phil67000" class="user-moderator-N"><span itemprop="name">phil67000</span></a></span>
                <span class="karma">5.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C16309" href="#C16309">
        <time class="action-date">Jun '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hello </p>
<p>For my application my users can only see clients of their agency.</p>
<ul>
<li>the logged user is attached to an agency</li>
<li>An agency has, several customers</li>
</ul>
<p>i can do it in each actions in controller but if possible
I would like to do it once  in the model</p>
<p>What is the best way dto to this ?</p>
<p>thanks</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-0fc6861d9ceb913e4567067f-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-0fc6861d9ceb913e4567067f-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C48699" href="#C48699">
                <time itemprop="dateCreated" datetime="2017-06-12T02:53:02-07:00" class="action-date">Jun '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>By overriding find/findFirst methods i guess. But keep in mind that using query builder you would still need to make proper conditions.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="48699" data-cf-modified-0fc6861d9ceb913e4567067f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="48699" data-cf-modified-0fc6861d9ceb913e4567067f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4bc65c6eab5e6a2344066da4598654cb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/9611/phil67000" class="user-moderator-N"><span itemprop="name">phil67000</span></a>        </span>
        <br>

        <span class="karma">5.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="48715" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '17</span>
              </span><br/><a name="C48715" href="#C48715">
                <time itemprop="dateCreated" datetime="2017-06-12T05:33:38-07:00" class="action-date">Jun '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>thanks
can i call the native find / findFirst methods after add criterias ?</p>
<p>also i see <a href="https://docs.phalcon.io/en/latest/reference/db.html#database-events">event beforeQuery</a> it's possible to modify SQLStatement ?</p>
<p>Edit :</p>
<p>I found <a href="https://forum.phalcon.io/discussion/936/phalcon-mvc-model-find-together-with-phalcon-mvc-model-query-bui#C3576">this tread</a> </p>
<p>I think I can adapt it for my needs</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="48715" data-cf-modified-0fc6861d9ceb913e4567067f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="48715" data-cf-modified-0fc6861d9ceb913e4567067f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="48929" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '17</span>
              </span><br/><a name="C48929" href="#C48929">
                <time itemprop="dateCreated" datetime="2017-06-20T09:59:21-07:00" class="action-date">Jun '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Something like this should work:</p>
<pre><code class="language-php">&lt;?php
$AgencyCustomers = Customers::find();
?&gt;</code></pre>
<pre><code class="language-php">&lt;?php
class Customers{

    function find($criteria = ['conditions'=&gt;'']){
        $loggedInUserAgencyID = $_SESSION['agency_id'];
        if(isset($criteria['conditions'])){
            $criteria['conditions'] .= ' AND agency = :agency:';
        else{
            $criteria['conditions'] = 'agency = :agency:';
        }

        if(isset($criteria['bind'])){
            $criteria['bind']['agency'] =&gt; $loggedInUserAgencyID;
        }
        else{
            $criteria['bind'] = ['agency'=&gt;$loggedInUserAgencyID];
        }

        return parent::find($criteria);
    }
}</code></pre>
<p>This assumes you're storing the user's agency id in $_SESSION.  I'd recommend this because otherwise you'll have to do a query to find the user's agency id, each time you query for Customers.  The agency ID doesn't change, so you might as well just look it up once and store it.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="48929" data-cf-modified-0fc6861d9ceb913e4567067f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="48929" data-cf-modified-0fc6861d9ceb913e4567067f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4bc65c6eab5e6a2344066da4598654cb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/9611/phil67000" class="user-moderator-N"><span itemprop="name">phil67000</span></a>        </span>
        <br>

        <span class="karma">5.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C48945" href="#C48945">
                <time itemprop="dateCreated" datetime="2017-06-21T00:53:44-07:00" class="action-date">Jun '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks Dylan </p>
<p>Yes i store the user agency in $di-&gt;session  and some others trifles as the user language, the user function ....</p>
<p>I try to realize a whole CRUD system of authorization  according to the functions of the user and his agency</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="48945" data-cf-modified-0fc6861d9ceb913e4567067f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="48945" data-cf-modified-0fc6861d9ceb913e4567067f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="48957" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '17</span>
              </span><br/><a name="C48957" href="#C48957">
                <time itemprop="dateCreated" datetime="2017-06-21T03:45:10-07:00" class="action-date">Jun '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Well dont access <code>$_SESSION</code> use <code>$di-&gt;get("session")</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="48957" data-cf-modified-0fc6861d9ceb913e4567067f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="48957" data-cf-modified-0fc6861d9ceb913e4567067f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="16309" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>