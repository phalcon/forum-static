---
layout: default
title: 'Micro app router map-&gt;via with Collection? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/22/micro">Micro</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Micro app router map-&gt;via with Collection?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/10387/amnuts" class="user-moderator-N"><span itemprop="name">Andrew Collington</span></a></span>
            <time itemprop="dateCreated" datetime="2017-12-04T04:22:25-07:00">Dec '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-12-04T04:22:25-07:00">Dec '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">6</span>
                </td>
                <td>
                    <label>Views</label><br>862</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/100d558fcc9ef6d5a660745740739160?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/10387/amnuts" class="user-moderator-N"><span itemprop="name">Andrew Collington</span></a></span>
                <span class="karma">2.5k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C17393" href="#C17393">
        <time class="action-date">Dec '17</time>
    </a>
</div>
<div class="post-content"><div><p>I'm setting up a Phalcon app using the Micro class. I'm setting up my router to use the <code>Collection</code> class so that I can use a controller to split up the functionality and keep it fairly contained.</p>
<p>Now, what I'd like to do is have a route that handles both GET and POST. With the normal micro app setup it looks pretty easy with <code>$app-&gt;add(…)-&gt;via(['GET', 'POST']);</code>. However, the collections class offers a map method but nothing like a via.</p>
<p>Does anyone know the best way to achieve what I'm trying to do while still using Collection? Code in the router looks simply like:</p>
<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Micro\Collection;

$login = new Collection();
$login-&gt;setHandler('Service\Controllers\LoginController', true);
$login-&gt;setPrefix('/login');
$login-&gt;post('/basic', 'usernameAction');
$login-&gt;map('/social/{oauthProvider}', 'socialAction')-&gt;via(['GET', 'POST']);

$app-&gt;mount($login);</code></pre>
<p>(Note: this is just an included file, so auto-loading, defining $app and so on is fine, just in another file. It also includes the map/via combination that doesn't work just to highlight what I'm trying to do.)</p>
<p>Thanks!</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52651" href="#C52651">
                <time itemprop="dateCreated" datetime="2017-12-04T05:21:40-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Well it's actually new feature request, we can't add it as via method beacause there is no operation on objects, everything is done on plain array elements. Calling this via method would change just last added element, in some cases it would change what we don't want. What i propose is to add new method mapVia, which will accept methods parameter. In phalcon 4.0.0 just add new argument to map with methods.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52651" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52651" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="52703" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '17</span>
              </span><br/><a name="C52703" href="#C52703">
                <time itemprop="dateCreated" datetime="2017-12-05T01:30:40-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I have done this for a project.</p>
<pre><code class="language-php">namespace Myns;
use \Phalcon\Mvc\Micro\Collection;

//Overrides collection methods in order to inject namespace and baseUri
class MicroCollection extends Collection
{
    private $_config;

    /**
     * Inject current namespace and normally proceed further treatment of request to a parent method
     * @param null $handler
     * @param bool $lazy
     * @return mixed
     * Default zephir signature:
     * public function setHandler(var handler, boolean lazy = false) -&gt; &lt;Collection&gt;
     */
    function setHandler($handler = null, $lazy = true)
    {
        return parent::{__FUNCTION__}(__NAMESPACE__ . '\\' . $handler, $lazy);
    }

    /**
     * @param null $prefix
     * @return mixed
     * Default zephir signature:
     * public function setPrefix(string! prefix) -&gt; &lt;Collection&gt;
     */
    function setPrefix($prefix = null){
        //inject baseUri to every route prefix
        return parent::{__FUNCTION__}($this-&gt;_config-&gt;application-&gt;baseUri . $prefix);
    }

    /**
     * @param null $routePattern
     * @param null $handler
     * @param null $name
     * @return mixed
     *
     * Default zephir signature:
     * public function get(string! routePattern, handler, var name = null) -&gt; &lt;Collection&gt;
     */
    function get($routePattern = null, $handler = null, $name = null){
        //auto prepend baseUri if route prefix is not set
        !self::getPrefix() &amp;&amp; $routePattern = $this-&gt;_config-&gt;application-&gt;baseUri . $routePattern;
        return parent::{__FUNCTION__}($routePattern, $handler, $name);
    }

    /**
     * @param null $routePattern
     * @param null $handler
     * @param null $name
     * @return mixed
     *
     * Default zephir signature:
     * public function post(string! routePattern, handler, var name = null) -&gt; &lt;Collection&gt;
     */
    function post($routePattern = null, $handler = null, $name = null){
        //auto prepend baseUri if route prefix is not set
        !self::getPrefix() &amp;&amp; $routePattern = $this-&gt;_config-&gt;application-&gt;baseUri . $routePattern;
        return parent::{__FUNCTION__}($routePattern, $handler, $name);
    }

    /**
     * MicroCollection constructor.
     *
     * @param \Phalcon\DiInterface|null $di
     */
    final function __construct(\Phalcon\DiInterface $di = null){
        //resolve config object into local scope
        $this-&gt;_config = $di-&gt;getShared('config');
    }

    /**
     * @param string|null $routePattern
     * @param string|null $handler
     * @param string|null $name
     * @return bool
     * This method creates both GET and POST routes automatically
     */
    final function via(string $routePattern = null, string $handler = null, string $name = null){
        self::get($routePattern, $handler, $name);
        self::post($routePattern, $handler, $name);
        return true;
    }</code></pre>
<p>You basically only need the very last method (<code>via</code>).</p>
<p>Only change self to parent:</p>
<pre><code class="language-php"> parent::get($routePattern, $handler, $name);
 parent::post($routePattern, $handler, $name);</code></pre>
<p>Usage:</p>
<pre><code class="language-php">        $authModule = new MicroCollection(self::getDI()); //I need DI for config object etc, you might not need it...
        $authModule-&gt;setHandler('AuthModule');
        $authModule-&gt;via('/login', 'customerLogin', 'customer_login_module'); //This method creates both GET and POST routes automatically
</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52703" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52703" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1664cd00255dfa6e438b0b5560fa1738?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5729/Ultimater" class="user-moderator-N"><span itemprop="name">Kevin Yarmak</span></a>        </span>
        <br>

        <span class="karma">4.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52705" href="#C52705">
                <time itemprop="dateCreated" datetime="2017-12-05T01:37:39-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Micro currently doesn't support &quot;via&quot;. It carries on treating the method as <code>NULL</code>. Internally Phalcon will use NULL as a signal meaning this applies to ALL request methods. If it sees the URL, it won't even check the request method used. In otherwords if you're using <code>map</code>, there's no reason to write <code>via(['GET', 'POST'])</code> because it will apply to all request methods.  From the callback there ,you can check the request method used if you want to deny anything that wasn't GET or POST.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52705" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52705" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52719" href="#C52719">
                <time itemprop="dateCreated" datetime="2017-12-05T05:02:40-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I added method mapVia anyway. I guess in phalcon 4 we cant add argument to map method so it will accept method. Sometimes Kevin you want to map specifcally to GET and POST, without DELETE, PUT and other methods.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52719" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52719" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1664cd00255dfa6e438b0b5560fa1738?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5729/Ultimater" class="user-moderator-N"><span itemprop="name">Kevin Yarmak</span></a>        </span>
        <br>

        <span class="karma">4.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="52733" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '17</span>
              </span><br/><a name="C52733" href="#C52733">
                <time itemprop="dateCreated" datetime="2017-12-05T13:14:03-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>True, although we could add this as early as Phalcon 3 since it wouldn't break the current Micro functionality.</p>
<p>In the past I've used:  </p>
<pre><code class="language-php">    class MicroCollection extends \Phalcon\Mvc\Micro\Collection
    {
        public function setName($name)
        {
            $this-&gt;_handlers[count($this-&gt;_handlers)-1][3] = $name;
            return $this;
        }
        public function via($methods)
        {
            $this-&gt;_handlers[count($this-&gt;_handlers)-1][0] = $methods;
            return $this;
        }
    }</code></pre>
<p>The idea being it would just grab the last handler referenced and update its request method array. Same idea with adding setName so we can name routes.
This allows two new methods to be added without changing anything else in the zephir.  </p>
<p>I see you added a <code>mapVia</code> to 3.3.x. While that would probably be faster speed wise than my approach, I think we should add a <code>via</code> anyways as people would expect one to exist.</p>
<p>As you're already working on Micro, you mind adding these two for me?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52733" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52733" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52735" href="#C52735">
                <time itemprop="dateCreated" datetime="2017-12-05T13:42:09-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Not sure if this is good idea this thing operating on array, but i guess it won't break anything or don't do anything unexpected, yea i guess i could add those two, though you can set already a name of added route by setting third parameter so it's not needed really, better to avoid unncessary method calls.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52735" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52735" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/100d558fcc9ef6d5a660745740739160?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/10387/amnuts" class="user-moderator-N"><span itemprop="name">Andrew Collington</span></a>        </span>
        <br>

        <span class="karma">2.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52785" href="#C52785">
                <time itemprop="dateCreated" datetime="2017-12-07T07:27:36-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for the feedback to the problem, adding mapVia into 3.3.3, and giving me possibly ways I could do what I want to now.  Much appreciated!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52785" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52785" data-cf-modified-ffb2f6bffbe11a9bff17151f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="17393" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>