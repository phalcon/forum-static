---
layout: default
title: 'Row/Object Level Security - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/17/acl">Acl</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Row/Object Level Security</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/2994/WorkingWarrior" class="user-moderator-N"><span itemprop="name">Sölve Svartskogen</span></a></span>
            <time itemprop="dateCreated" datetime="2015-12-18T06:08:44-07:00">Dec '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-12-18T06:08:44-07:00">Dec '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">5</span>
                </td>
                <td>
                    <label>Views</label><br>535</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/79a1c90178d766844ad7aa54806e2a62?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/2994/WorkingWarrior" class="user-moderator-N"><span itemprop="name">Sölve Svartskogen</span></a></span>
                <span class="karma">1.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C9911" href="#C9911">
        <time class="action-date">Dec '15</time>
    </a>
</div>
<div class="post-content"><div><p>Hello!</p>
<p>I'm writing an ERP application now and I'm trying to figure out how to implement Row Level Security.
In my application access list is based on users and roles. I know I can block single users from doing actions in controllers, but how can I block them from getting all records (they'll get only records they can see) or related records (same here)?</p>
<p>I hope you can help me.
Best regards!</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e984ca5d22935b577e77fcbb53edb3e2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1653/stefanchiriac" class="user-moderator-N"><span itemprop="name">Stefan Chiriac</span></a>        </span>
        <br>

        <span class="karma">16.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C27943" href="#C27943">
                <time itemprop="dateCreated" datetime="2015-12-18T06:40:12-07:00" class="action-date">Dec '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>For this I recommend to create some groups permissions. Each group can contain one or more roles.</p>
<p>On your records add a new column for group_id. When you need to get your records, check first on which group your user belogs to, and query after group_id too.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="27943" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="27943" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="27945" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '15</span>
              </span><br/><a name="C27945" href="#C27945">
                <time itemprop="dateCreated" datetime="2015-12-18T06:58:56-07:00" class="action-date">Dec '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Just put in the condition when you select records proper condition you want. I dont think so it has anything to do with ACL. Its more about proper query imho.</p>
<p>Also i did a pull request to phalcon with adding function as 4th parameter in allow/deny method and option to check isAllowed method on objects. In this way we can add some custom logic for acl for example checking edit/remove object. There is pull request if you want comment it and add some idea:</p>
<p><a href="https://github.com/phalcon/cphalcon/pull/11237">https://github.com/phalcon/cphalcon/pull/11237</a></p>
<p>And there is repo with this thing implemented:</p>
<p><a href="https://github.com/Jurigag/cphalcon/tree/2.0.x">https://github.com/Jurigag/cphalcon/tree/2.0.x</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="27945" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="27945" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/79a1c90178d766844ad7aa54806e2a62?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2994/WorkingWarrior" class="user-moderator-N"><span itemprop="name">Sölve Svartskogen</span></a>        </span>
        <br>

        <span class="karma">1.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C27947" href="#C27947">
                <time itemprop="dateCreated" datetime="2015-12-18T07:35:04-07:00" class="action-date">Dec '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for your answers!</p>
<p>Sorry, I probably didn't state it clearly, but I'm trying to implement single user permissions for single records. I have groups, but I need an option to exclude single user from, for example, editing single record. This permissions are higher in hierarchy than ACL based on roles, so if I disable user from editing a record with id=3, user still can edit other records. I know how to do it, but I don't know how to simply and efficiently block user from fetching records in which he is disabled from viewing it.  I'm trying to do it without PHQL, but I didn't find a way to do it.
Thanks for your help.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="27947" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="27947" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="27949" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '15</span>
              </span><br/><a name="C27949" href="#C27949">
                <time itemprop="dateCreated" datetime="2015-12-18T07:48:55-07:00" class="action-date">Dec '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>First:</p>
<p>Why cant user edit this record ? I guess beacause its not added by him/ not added by his shop(for example) or whatever other reason. He cant just edit it beacause not.
Then you need some information about this record, how you gonna get it if you dont wanna do query ?</p>
<p>You can use my branch of phalcon, after compile phalcon its adding two new interfaces: Roleable and Resourceable. Then your model must implement Resourceable, and your user class(model) Roleable. Then you can do something like this:</p>
<pre><code class="language-php">$acl-&gt;allow('SomeRole','SomeResource','update',function(UserClass $user, ModelClass $model){
    return $user-&gt;getId() == $model-&gt;getUser();
});</code></pre>
<p>If getUser() ofc will return id of user.</p>
<p>And then somewhere in code you can do this:</p>
<pre><code class="language-php">$acl-&gt;isAllowed($user,$model,'update');</code></pre>
<p>Second:</p>
<p>If you just want to hardcoded it that some role just cant edit id=3 noe matter what is this then you have something wrong. There must be some reason.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="27949" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="27949" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/79a1c90178d766844ad7aa54806e2a62?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2994/WorkingWarrior" class="user-moderator-N"><span itemprop="name">Sölve Svartskogen</span></a>        </span>
        <br>

        <span class="karma">1.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C28055" href="#C28055">
                <time itemprop="dateCreated" datetime="2015-12-21T01:24:17-07:00" class="action-date">Dec '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for your reply!</p>
<p>Well, I don't want to hardcode it, it was just an example. I don't want to build a query, because I wan't to keep things simple, but as far as I can see, I'll be unable to implement that kind of ACL without queries. Your implementation is very useful for me, I'll try it.
Thanks for your replies!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="28055" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="28055" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e984ca5d22935b577e77fcbb53edb3e2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1653/stefanchiriac" class="user-moderator-N"><span itemprop="name">Stefan Chiriac</span></a>        </span>
        <br>

        <span class="karma">16.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="28059" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '15</span>
              </span><br/><a name="C28059" href="#C28059">
                <time itemprop="dateCreated" datetime="2015-12-21T02:35:47-07:00" class="action-date">Dec '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><ol>
<li>
<p>maybe Jurigag's solution will work for now, but if his changes doesn't get included in the official phalcon release,  you won't be able to update to new phalcon releases to take advantage of new features and fixes.</p>
</li>
<li>since the ACL data rarely changes in production, use models and cache the result</li>
</ol></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="28059" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="28059" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="28061" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '15</span>
              </span><br/><a name="C28061" href="#C28061">
                <time itemprop="dateCreated" datetime="2015-12-21T02:42:35-07:00" class="action-date">Dec '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Well you should wait for 2.1.x phalcon. I hope it will be included when they release it. Cuz currently PR is for 2.1.x cuz i added some more functionallity. But i guess you can still use 2.0.x PR which i did. Just check my repo for 2.0.x branch. It should as i provided after compiling phalcon.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="28061" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="28061" data-cf-modified-d92f29be3c5a3d3987c37f64-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="9911" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>