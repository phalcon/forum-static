---
layout: default
title: 'Output in browser doesn&#039;t change after redirection? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Output in browser doesn&#039;t change after redirection?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/1409/gazley" class="user-moderator-N"><span itemprop="name">G Wynne</span></a></span>
            <time itemprop="dateCreated" datetime="2014-05-11T13:06:46-07:00">May '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-05-11T13:06:46-07:00">May '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>May '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>868</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/b7087a5cdbd5a4365582e4a26a26a9a2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/1409/gazley" class="user-moderator-N"><span itemprop="name">G Wynne</span></a></span>
                <span class="karma">38.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2284" href="#C2284">
        <time class="action-date">May '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hi there,</p>
<pre><code class="language-php">  public function chargeCardAction()
  {
    return $this-&gt;response-&gt;redirect('booking/booked');
  }</code></pre>
<p>The above action is called from a page. There is other code inthe chargeCardAction but it's commented out and removed here for the sake of brevity. The bottom line is that after the code executes, it finally redirects to 'booking/booked'. The bookedAction is called (I set a breakpoint in there) and I watch it execute and output the volt template associated with the action.</p>
<p>However, despite executing the getContent() method and my debug environment and seeing the correct output, the brower's URL doesn't change and neither does the content of the page. It stays the same as when it called the chargeCardAction() ???</p>
<p>I've spent hours trying to work out why but it just doesn't seem to work and I don't know why :( Any ideas?</p>
<p>Thanks.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-6c941a790333b0aa3d335f75-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-6c941a790333b0aa3d335f75-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7787" href="#C7787">
                <time itemprop="dateCreated" datetime="2014-05-11T15:20:54-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Just try</p>
<pre><code class="language-php">public function chargeCardAction()
  {
    $this-&gt;response-&gt;redirect('booking/booked');
  }</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7787" data-cf-modified-6c941a790333b0aa3d335f75-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7787" data-cf-modified-6c941a790333b0aa3d335f75-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b7087a5cdbd5a4365582e4a26a26a9a2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1409/gazley" class="user-moderator-N"><span itemprop="name">G Wynne</span></a>        </span>
        <br>

        <span class="karma">38.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7788" href="#C7788">
                <time itemprop="dateCreated" datetime="2014-05-11T15:33:17-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Tried and no difference. The browser still stays on the <a href="https://localhost:8888/booking/payment">https://localhost:8888/booking/payment</a> payment. </p>
<p>I checked my PHP error file and there are the following errors: </p>
<pre><code>[12-May-2014 00:23:13 Europe/Berlin] PHP Stack trace:
[12-May-2014 00:23:13 Europe/Berlin] PHP   1. {main}() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   2. Phalcon\Mvc\Application-&gt;handle() /Applications/MAMP/htdocs/escglam/public/index.php:149
[12-May-2014 00:23:13 Europe/Berlin] PHP   3. Phalcon\Mvc\View-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:149
[12-May-2014 00:23:13 Europe/Berlin] PHP   4. Phalcon\Mvc\View-&gt;_engineRender() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   5. Phalcon\Mvc\View\Engine\Volt-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   6. Phalcon\Mvc\View\Engine\Volt-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP Notice:  Undefined variable: max_calendar_date in /Applications/MAMP/htdocs/escglam/public/cache/volt/%%applications%%mamp%%htdocs%%escglam%%app%%views%%layouts%%booking.volt.php on line 23
[12-May-2014 00:23:13 Europe/Berlin] PHP Stack trace:
[12-May-2014 00:23:13 Europe/Berlin] PHP   1. {main}() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   2. Phalcon\Mvc\Application-&gt;handle() /Applications/MAMP/htdocs/escglam/public/index.php:149
[12-May-2014 00:23:13 Europe/Berlin] PHP   3. Phalcon\Mvc\View-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:149
[12-May-2014 00:23:13 Europe/Berlin] PHP   4. Phalcon\Mvc\View-&gt;_engineRender() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   5. Phalcon\Mvc\View\Engine\Volt-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   6. Phalcon\Mvc\View\Engine\Volt-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP Notice:  Undefined variable: payment_type in /Applications/MAMP/htdocs/escglam/public/cache/volt/%%applications%%mamp%%htdocs%%escglam%%app%%views%%layouts%%booking.volt.php on line 14
[12-May-2014 00:23:13 Europe/Berlin] PHP Stack trace:
[12-May-2014 00:23:13 Europe/Berlin] PHP   1. {main}() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   2. Phalcon\Mvc\Application-&gt;handle() /Applications/MAMP/htdocs/escglam/public/index.php:149
[12-May-2014 00:23:13 Europe/Berlin] PHP   3. Phalcon\Mvc\View-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:149
[12-May-2014 00:23:13 Europe/Berlin] PHP   4. Phalcon\Mvc\View-&gt;_engineRender() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   5. Phalcon\Mvc\View\Engine\Volt-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   6. Phalcon\Mvc\View\Engine\Volt-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP Notice:  Undefined variable: max_calendar_date in /Applications/MAMP/htdocs/escglam/public/cache/volt/%%applications%%mamp%%htdocs%%escglam%%app%%views%%layouts%%booking.volt.php on line 23
[12-May-2014 00:23:13 Europe/Berlin] PHP Stack trace:
[12-May-2014 00:23:13 Europe/Berlin] PHP   1. {main}() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   2. Phalcon\Mvc\Application-&gt;handle() /Applications/MAMP/htdocs/escglam/public/index.php:149
[12-May-2014 00:23:13 Europe/Berlin] PHP   3. Phalcon\Mvc\View-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:149
[12-May-2014 00:23:13 Europe/Berlin] PHP   4. Phalcon\Mvc\View-&gt;_engineRender() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   5. Phalcon\Mvc\View\Engine\Volt-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:0
[12-May-2014 00:23:13 Europe/Berlin] PHP   6. Phalcon\Mvc\View\Engine\Volt-&gt;render() /Applications/MAMP/htdocs/escglam/public/index.php:0</code></pre>
<p>They come from:</p>
<pre><code class="language-php">{% raw %}{%{% endraw %} extends 'layouts/main.volt' {% raw %}%}{% endraw %}

{% raw %}{%{% endraw %} block js {% raw %}%}{% endraw %}
  {% raw %}{{{% endraw %} super() {% raw %}}}{% endraw %}
  {% raw %}{{{% endraw %} stylesheet_link('datetimepicker/jquery.datetimepicker.css') {% raw %}}}{% endraw %}
  {% raw %}{{{% endraw %} javascript_include('datetimepicker/jquery.datetimepicker.js') {% raw %}}}{% endraw %}

  {% raw %}{%{% endraw %} if payment_type {% raw %}%}{% endraw %}
    {% raw %}{{{% endraw %} partial('booking/payment_handler') {% raw %}}}{% endraw %}
  {% raw %}{%{% endraw %} endif {% raw %}%}{% endraw %}

  &lt;script&gt;
    $( document ).ready(function() {
      $('#booking_date').datetimepicker({
        timepicker:false,
        minDate: 0,
        maxDate:'{% raw %}{{{% endraw %} max_calendar_date {% raw %}}}{% endraw %}',
        closeOnDateSelect:true,
        validateOnBlur:true,
        format:'d/m/Y',
        onChangeDateTime:function(){
          $('.row.slots').hide();
          $('.row.no-slots').hide();
        }
      });
      $('#package_id').change(function() {
        var page_id = $(this).val();
        $('.row.pricing').hide();
        $('.row.slots').hide();
        $('.row.no-slots').hide();
        $('.page_' + page_id).fadeIn();
      })
    });
  &lt;/script&gt;
{% raw %}{%{% endraw %} endblock {% raw %}%}{% endraw %}</code></pre>
<p>Could these notices intefere with the output? I stepped through the process and the target action is definately hit and I see the bookedAction template markup in the getContent() output?</p>
<p>Thanks.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7788" data-cf-modified-6c941a790333b0aa3d335f75-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7788" data-cf-modified-6c941a790333b0aa3d335f75-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b7087a5cdbd5a4365582e4a26a26a9a2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1409/gazley" class="user-moderator-N"><span itemprop="name">G Wynne</span></a>        </span>
        <br>

        <span class="karma">38.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7811" href="#C7811">
                <time itemprop="dateCreated" datetime="2014-05-12T11:33:48-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>OK, so I got to the bottom of this but I'm not sure whether the behaviour I'm seeing is correct. In my 'booking/payment_handler' partial (see above), I had the following:</p>
<pre><code class="language-php">  var handler = StripeCheckout.configure({
    key: '{% raw %}{{{% endraw %} constant("PaymentProcessing::STRIPE_PUBLISHABLE_KEY") {% raw %}}}{% endraw %}',
    image: '/square-image.png',
    token: function (token, args) {
      //$.post('{% raw %}{{{% endraw %} url("booking/chargeCard") {% raw %}}}{% endraw %}', { stripe_token: JSON.stringify(token) } );
      $("form:first" ).submit() // added in place of previous line
    }
  });</code></pre>
<p>As you can see, I've commented out the $.post(...) line and added the form submit line.</p>
<p>Originally, the $.post(...) line correctly called the appropriate action in my controller and from there, I redirected to the target handler (that wasn't being displayed). I can only assume that this redirect was being negated because the $.post(...) was still in effect?</p>
<p>When I actually submit the form, the redirection works as expected.</p>
<p>So, I guess the real question is, in my scenario, does the client-side $.post(...) trump the redirection that occurs in the action called by the $.post(...).</p>
<p>Thanks :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7811" data-cf-modified-6c941a790333b0aa3d335f75-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7811" data-cf-modified-6c941a790333b0aa3d335f75-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c393137504e3c8e04fec99f187fcc33e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1057/maxgalbu" class="user-moderator-N"><span itemprop="name">Max Galbusera</span></a>        </span>
        <br>

        <span class="karma">3.2k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="7883" data-toggle="modal" data-target="#historyModal">
                edited <span>May '14</span>
              </span><br/><a name="C7883" href="#C7883">
                <time itemprop="dateCreated" datetime="2014-05-14T11:04:37-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You are redirecting the ajax request, not the actual browser page. The ajax request headers (where the <code>Location</code> header is) are not handled by the browser but from javascript. I usually do this to redirect after an ajax call:</p>
<pre><code class="language-js">$.post('{% raw %}{{{% endraw %} url("booking/chargeCard") {% raw %}}}{% endraw %}', params, function(json){
    if (json.redirect)
        location.href = json.redirect;
}, "json");</code></pre>
<p>and in the controller </p>
<pre><code class="language-php">public function chargeCardAction()
{
    return $this-&gt;response-&gt;setJsonContent(array(
        'redirect'  =&gt; $this-&gt;url-&gt;get('booking/booked')
    ));
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7883" data-cf-modified-6c941a790333b0aa3d335f75-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7883" data-cf-modified-6c941a790333b0aa3d335f75-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b7087a5cdbd5a4365582e4a26a26a9a2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1409/gazley" class="user-moderator-N"><span itemprop="name">G Wynne</span></a>        </span>
        <br>

        <span class="karma">38.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7884" href="#C7884">
                <time itemprop="dateCreated" datetime="2014-05-14T11:09:55-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Awesome! Thanks for providing this solution - I really appreciate it :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7884" data-cf-modified-6c941a790333b0aa3d335f75-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7884" data-cf-modified-6c941a790333b0aa3d335f75-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2284" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>