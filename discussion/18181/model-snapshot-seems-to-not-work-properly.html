---
layout: default
title: 'Model snapshot seems to not work properly - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Model snapshot seems to not work properly</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/1320/tztztztz" class="user-moderator-N"><span itemprop="name">Tomasz Zadora</span></a></span>
            <time itemprop="dateCreated" datetime="2018-05-03T17:14:06-07:00">May '18</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2018-05-03T17:14:06-07:00">May '18</time>
                </td>
                <td>
                    <label>Last Reply</label><br>May '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">1</span>
                </td>
                <td>
                    <label>Views</label><br>328</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/07dedd51671291aca4f3f84a115c534e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/1320/tztztztz" class="user-moderator-N"><span itemprop="name">Tomasz Zadora</span></a></span>
                <span class="karma">10.4k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C18181" href="#C18181">
        <time class="action-date">May '18</time>
    </a>
</div>
<div class="post-content"><div><p>Hello,</p>
<p>im doing update setting  exactly the same values to the model, yet Phalcon ORM showing me that some fields has changed. I've already found way around comparing new values before setting with entity/model values, and do setting only if they really change, but still... this is a bug...</p>
<p>Below is listing: first you have final values for setting, then snapshot data (before setting) and finally list of changed fields.</p>
<p>New values and snapshot data is exactly the same.</p>
<p>The problem is with: primary key (id), one of foreign keys (payer_country_id), and boolean fields. PostgreSQL database. There is other foreign key: ship_country_id, but there is no problem, maybe because it is NULL / empty.</p>
<pre><code>setting id to [2]
setting creation_time to [2018-05-03 15:49:39.64878+02]
setting is_company to [0]
setting payer_name to [kolorofon 2]
setting payer_country_id to [116]
setting payer_address to [abc 12]
setting payer_city to [bb]
setting payer_zip_code to [43300]
setting payer_nip to []
setting email to [<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e1aaaeada4aacfb2aeb2afaeb6b8a1808382cc8c8092958493cf918d">[email&#160;protected]</a>]
setting telephone to []
setting login_pass to [$2y$10$U6lBCSh8MDjLCejYdVMcc.P9PM.Hwq/NKarweKpUmWegz15RGM0pq]
setting ship_name to []
setting ship_country_id to []
setting ship_address to []
setting ship_city to []
setting ship_zip_code to []
setting admin_notes to []
setting remind_pass_time to []
setting subscribe_newsletter to [1]
setting active to [1]
setting facebook_id to []
setting force_pass_change to [0]

SNAPSHOT DATA:

Array
(
    [id] =&gt; 2
    [creation_time] =&gt; 2018-05-03 15:49:39.64878+02
    [is_company] =&gt; 
    [payer_name] =&gt; kolorofon 2
    [payer_country_id] =&gt; 116
    [payer_address] =&gt; abc 12
    [payer_city] =&gt; bb
    [payer_zip_code] =&gt; 43300
    [payer_nip] =&gt; 
    [email] =&gt; <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6f2420232a24413c203c212038362f0e0d0c42020e1c1b0a1d411f03">[email&#160;protected]</a>
    [telephone] =&gt; 
    [login_pass] =&gt; $2y$10$U6lBCSh8MDjLCejYdVMcc.P9PM.Hwq/NKarweKpUmWegz15RGM0pq
    [ship_name] =&gt; 
    [ship_country_id] =&gt; 
    [ship_address] =&gt; 
    [ship_city] =&gt; 
    [ship_zip_code] =&gt; 
    [admin_notes] =&gt; 
    [remind_pass_time] =&gt; 
    [subscribe_newsletter] =&gt; 1
    [active] =&gt; 1
    [facebook_id] =&gt; 
    [force_pass_change] =&gt; 
)

CHANGED FIELDS (WTF?):Array
(
    [0] =&gt; id
    [1] =&gt; is_company
    [2] =&gt; payer_country_id
    [3] =&gt; subscribe_newsletter
    [4] =&gt; active
    [5] =&gt; force_pass_change
)</code></pre>
<p>When I'll find time i'll try to report issue, and fix it by pulling request, but it will be not soon and im not fluent with Zphir / Github so maybe someone can do it faster and better,</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-cb93bab69a80091f6a4fe53f-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-cb93bab69a80091f6a4fe53f-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4d1384d668711e6153ed4c6f05e29216?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/286/trentramseyer" class="user-moderator-N"><span itemprop="name">Trent Ramseyer</span></a>        </span>
        <br>

        <span class="karma">22.6k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C55211" href="#C55211">
                <time itemprop="dateCreated" datetime="2018-05-04T12:18:02-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Looks like your INTs are the one being triggered.. are you passing a &quot;string&quot; of &quot;1&quot; ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55211" data-cf-modified-cb93bab69a80091f6a4fe53f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55211" data-cf-modified-cb93bab69a80091f6a4fe53f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/07dedd51671291aca4f3f84a115c534e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1320/tztztztz" class="user-moderator-N"><span itemprop="name">Tomasz Zadora</span></a>        </span>
        <br>

        <span class="karma">10.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C55213" href="#C55213">
                <time itemprop="dateCreated" datetime="2018-05-04T15:27:48-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes casting values to appropriate data types like boolean or integer  before settings them to the Model has improved results. </p>
<p>But still there is some strange behaviors for some of the string columns when value of the field is pure number. Thats why on update I prefer to check if value changed compared to snapshot data using == operator before setting it, to be sure that changed fields detection is working properly.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55213" data-cf-modified-cb93bab69a80091f6a4fe53f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55213" data-cf-modified-cb93bab69a80091f6a4fe53f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="18181" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>