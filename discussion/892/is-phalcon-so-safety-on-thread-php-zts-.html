---
layout: default
title: 'Is phalcon.so safety on thread (php-zts) ? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/6/installation">Installation</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Is phalcon.so safety on thread (php-zts) ?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/544/COBAY" class="user-moderator-N"><span itemprop="name">COBAY</span></a></span>
            <time itemprop="dateCreated" datetime="2013-09-13T06:00:56-07:00">Sep '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-09-13T06:00:56-07:00">Sep '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>2912</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">5</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/8e658cf6d1b5a82ce6819b2392b42581?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/544/COBAY" class="user-moderator-N"><span itemprop="name">COBAY</span></a></span>
                <span class="karma">4.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C892" href="#C892">
        <time class="action-date">Sep '13</time>
    </a>
</div>
<div class="post-content"><div><p>my linux box is................
CentOS 5.8
httpd (worker MPM - thread model)
php 5.4 (mysqlnd.so + zend thread safety mode)  : <a href="http://www.webtatic.com/news/2013/07/latest-updates-php-5-5-1-5-4-17/">http://www.webtatic.com/news/2013/07/latest-updates-php-5-5-1-5-4-17/</a>
mysql 5.1</p>
<p>I've just complied &amp; install cphalcon.
the result is ............
/etc/php.d/phalcon.ini
/usr/lib64/php/modules/phalcon.so</p>
<p>and my phalcon site is displayed the error below
Fatal error: Class 'Phalcon\Mvc\Application' not found in /var/www/MYSITE/app/bootstrap.php on line 20
It doesn't work.......
also,
&lt;?php
var_dump( get_loaded_extensions() );
?&gt;
there is no phalcon extension in the result.</p>
<p>phalcon.so is thread safety?
where is thread safety version of phalcon.so (for example, phalcon_ts.so) ?</p>
<p>I'm using php 5.4 (in thread safety) of webtatic.com
webtatic.com mechanism is.....to change an appropriate php directory automatically (based on apache running mode(worker or prefork))
if apache is running the worker mode, it will find extension conf in /etc/php-zts.d/ directory.
else if apache is running the perfork mode, it will find extension in /etc/php.d/ directory.</p>
<p>In my case, it should be installed in the directory(php-zts directory) below.
/etc/php-zts/phalcon.ini (extension=/usr/lib64/php-zts/modules/phalcon_ts.so)
/usr/lib64/php-zts/modules/phalcon_ts.so</p>
<p>/usr/lib64/php/modules/phalcon.so is thread safety?
if so, copy &amp; paste to php-zts directory?</p>
<p>###########################################################</p>
<p>I tried to change apache perfork mode + php non-thread-safe mode
It works. phalcon.so is loaded.
whereas i tried to change apache worker mode + php thread-safe mode
It's NOT works. phalcon.so is NOT loaded.</p>
<p>Is NOT supported apache worker mode + php thread-safe mode ?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-3431c3c68384d2dd36662288-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-3431c3c68384d2dd36662288-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">5</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3429" href="#C3429">
                <time itemprop="dateCreated" datetime="2013-09-13T09:41:31-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Phalcon is thread safe: <a href="https://github.com/phalcon/cphalcon/search?q=TSRMLS_CC&amp;ref=cmdform">https://github.com/phalcon/cphalcon/search?q=TSRMLS_CC&amp;ref=cmdform</a></p>
<p>Maybe there are two php-config that produce different flags for thread-safe and non-thread-safe.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3429" data-cf-modified-3431c3c68384d2dd36662288-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3429" data-cf-modified-3431c3c68384d2dd36662288-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8e658cf6d1b5a82ce6819b2392b42581?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/544/COBAY" class="user-moderator-N"><span itemprop="name">COBAY</span></a>        </span>
        <br>

        <span class="karma">4.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3438" href="#C3438">
                <time itemprop="dateCreated" datetime="2013-09-13T21:16:18-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Okay, I found...../usr/bin/zts-*
/usr/bin/zts-php
/usr/bin/zts-phpize
/usr/bin/zts-php-config</p>
<p>I modified &quot;install&quot; script of phalcon source. (absolute path of phpize and php-config)
Line 69 of /usr/local/src/cphalcon/build/install</p>
<p>FROM </p>
<h1>perform the complication</h1>
<p>phpize &amp;&amp; aclocal &amp;&amp; $LIBTOOLIZE_BIN --force &amp;&amp; autoheader &amp;&amp; autoconf &amp;&amp; ./configure --enable-phalcon &amp;&amp; make &amp;&amp; make install &amp;&amp; echo -e &quot;\nThanks for compiling Phalcon!\nBuild succeed: Please restart your web server to complete the installation&quot;</p>
<p>TO
/usr/bin/zts-phpize &amp;&amp; aclocal &amp;&amp; $LIBTOOLIZE_BIN --force &amp;&amp; autoheader &amp;&amp; autoconf &amp;&amp; ./configure --enable-phalcon --with-php-config=/usr/bin/zts-php-config &amp;&amp; make &amp;&amp; make install &amp;&amp; echo -e &quot;\nThanks for compiling Phalcon!\nBuild succeed: Please restart your web server to complete the installation&quot;</p>
<p>and save &amp; run &quot;install&quot; script.</p>
<p>The Result
/usr/lib64/php-zts/modues/phalcon.so</p>
<p>and then, create file below
/etc/php-zts.d/phalcon.ini
with extension=phalcon.so</p>
<p>Restart httpd.(service httpd restart)</p>
<p>It works.( httpd worker mode + php 5.4 zend thread safe mode )</p>
<h2>References</h2>
<p><a href="http://blog.famillecollet.com/post/2011/10/15/PHP-and-PECL-extensions-for-ZTS">http://blog.famillecollet.com/post/2011/10/15/PHP-and-PECL-extensions-for-ZTS</a>
<a href="http://forums.famillecollet.com/viewtopic.php?id=1724">http://forums.famillecollet.com/viewtopic.php?id=1724</a>
<a href="http://stackoverflow.com/questions/6471434/how-to-compile-php-extension-for-php-5-3-6-with-debug-ts">http://stackoverflow.com/questions/6471434/how-to-compile-php-extension-for-php-5-3-6-with-debug-ts</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3438" data-cf-modified-3431c3c68384d2dd36662288-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3438" data-cf-modified-3431c3c68384d2dd36662288-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5cfc1eb34e142b9035b986311e0e8468?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/306/sjinks" class="user-moderator-Y"><span itemprop="name">Volodymyr Kolesnykov</span></a>        </span>
        <br>

        <span class="karma">1.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3444" href="#C3444">
                <time itemprop="dateCreated" datetime="2013-09-15T19:08:40-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What is the reason to use ZTS on Linux? ZTS binaries are a bit slower than non-ZTS ones.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3444" data-cf-modified-3431c3c68384d2dd36662288-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3444" data-cf-modified-3431c3c68384d2dd36662288-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8e658cf6d1b5a82ce6819b2392b42581?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/544/COBAY" class="user-moderator-N"><span itemprop="name">COBAY</span></a>        </span>
        <br>

        <span class="karma">4.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3445" href="#C3445">
                <time itemprop="dateCreated" datetime="2013-09-15T19:51:26-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I'm going to use pthread extension + phalcon extension + apache worker mode (the main reason is because apache perfork mode is memory killer. memory is increased continually and not decreased)
by the way pthread requires php-zts.</p>
<p>Is it really slow than general php mode ?
what is non-ZTS solution ?
apache worker mode + php fast cgi mode ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3445" data-cf-modified-3431c3c68384d2dd36662288-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3445" data-cf-modified-3431c3c68384d2dd36662288-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5cfc1eb34e142b9035b986311e0e8468?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/306/sjinks" class="user-moderator-Y"><span itemprop="name">Volodymyr Kolesnykov</span></a>        </span>
        <br>

        <span class="karma">1.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3447" href="#C3447">
                <time itemprop="dateCreated" datetime="2013-09-15T20:29:29-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Slower, not slow :-) In my tests php-zts is up to 5% slower than non-ZTS binary (thread safety comes at a price), however, your mileage may vary. But if you have to use pthreads, then ZTS is your only option.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3447" data-cf-modified-3431c3c68384d2dd36662288-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3447" data-cf-modified-3431c3c68384d2dd36662288-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="892" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>