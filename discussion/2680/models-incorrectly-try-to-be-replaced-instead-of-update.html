---
layout: default
title: 'Models incorrectly try to be replaced instead of update - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Models incorrectly try to be replaced instead of update</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/125/salarmehr" class="user-moderator-N"><span itemprop="name">Reza</span></a></span>
            <time itemprop="dateCreated" datetime="2014-06-27T23:24:09-07:00">Jun '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-06-27T23:24:09-07:00">Jun '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>1135</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/2735edb490f9406bfc891bba909a2b28?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/125/salarmehr" class="user-moderator-N"><span itemprop="name">Reza</span></a></span>
                <span class="karma">22.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2680" href="#C2680">
        <time class="action-date">Jun '14</time>
    </a>
</div>
<div class="post-content"><div><p>I am trying to update the name of a user <code>id=1</code>. I tried the following code (v 1.3). But instead of updating, it t replaces the user and <code>var_dump($n-&gt;getMessages());</code> outputs errors relating to <code>not null</code> attributes.</p>
<pre><code> class UserApi extends Phalcon\DI\Injectable{}

 $n=new User;
$n-&gt;id=1;
 $n-&gt;name='Tom';
 $n-&gt;save(); //or even $n-&gt;update()</code></pre>
<p><code>User::findFirst(1)-&gt;save();</code> works. But I prefer to use a single code for both  create and update operations.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C9001" href="#C9001">
                <time itemprop="dateCreated" datetime="2014-06-29T11:29:24-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Every object in the ORM has 3 states: </p>
<ul>
<li>DIRTY STATE PERSISTENT: The object is attached to a row persisted in the database</li>
<li>DIRTY STATE TRANSIENT: The object is created in the application userland by is not attached to a row persisted in the database</li>
<li>DIRTY STATE DETACHED: The object exists in the application and it was recently detached from a row persisted in the database</li>
</ul>
<p>When you create an object it's in TRANSIENT state, you can only update objects when they're in PERSISTENT state. findFirst() and find() returns objects in PERSISTENT state which are capable of being updated to the persistance.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9001" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9001" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2735edb490f9406bfc891bba909a2b28?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/125/salarmehr" class="user-moderator-N"><span itemprop="name">Reza</span></a>        </span>
        <br>

        <span class="karma">22.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C9006" href="#C9006">
                <time itemprop="dateCreated" datetime="2014-06-29T11:53:58-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks. But I didn't get it. In documentation:</p>
<blockquote>
<p>The save method is called internally by the create and update methods of Phalcon\Mvc\Model. For this to work as expected it is necessary to have properly defined a primary key in the entity to determine whether a record should be updated or created.</p>
</blockquote>
<p>I want to create/update data rows with single code block. How can I do that?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9006" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9006" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="9008" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '14</span>
              </span><br/><a name="C9008" href="#C9008">
                <time itemprop="dateCreated" datetime="2014-06-29T11:59:16-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What the documentation says is that a record is checked (not retrieved) if it does exist in the persistance to trigger the proper events/hooks before save it.</p>
<p>You can do this:</p>
<pre><code class="language-php">$user = User::findFirst(1);
if (!$user) {
    $user = new User;
    $user-&gt;id = 1;  
}
$user-&gt;name = "Tom";
$user-&gt;save();</code></pre>
<p>Or add a method like this to your model:</p>
<pre><code class="language-php">class User extends Phalcon\Mvc\Model
{
    public static function createOrGet($id)
    {
        $user = User::findFirst($id);
        if (!$user) {
            $user = new User;
            $user-&gt;id = $id;    
        }       
        return $user;   
    }
}</code></pre>
<p>Usage:</p>
<pre><code class="language-php">$user = User::createOrGet(1);
$user-&gt;name = "Tom";
$user-&gt;save();</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9008" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9008" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2735edb490f9406bfc891bba909a2b28?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/125/salarmehr" class="user-moderator-N"><span itemprop="name">Reza</span></a>        </span>
        <br>

        <span class="karma">22.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C9430" href="#C9430">
                <time itemprop="dateCreated" datetime="2014-07-13T05:16:05-07:00" class="action-date">Jul '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Is there any resource to read more about ORM 3 states? The current implementaion does not seems natural for me.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="9430" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="9430" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2735edb490f9406bfc891bba909a2b28?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/125/salarmehr" class="user-moderator-N"><span itemprop="name">Reza</span></a>        </span>
        <br>

        <span class="karma">22.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="16203" data-toggle="modal" data-target="#historyModal">
                edited <span>Feb '15</span>
              </span><br/><a name="C16203" href="#C16203">
                <time itemprop="dateCreated" datetime="2015-02-26T08:54:19-07:00" class="action-date">Feb '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Larval has some similar methods:</p>
<pre><code>  // Create a new user in the database...
  $user = User::create(['name' =&gt; 'John']);

  // Retrieve the user by the attributes, or create it if it doesn't exist...
  $user = User::firstOrCreate(['name' =&gt; 'John']);

  // Retrieve the user by the attributes, or instantiate a new instance...
  $user = User::firstOrNew(['name' =&gt; 'John']);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="16203" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="16203" data-cf-modified-c1a632f4d03908ca6e76efbb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2680" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>