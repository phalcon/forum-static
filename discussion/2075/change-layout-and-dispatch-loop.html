---
layout: default
title: 'Change layout and dispatch loop - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/21/beginners">Beginners</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Change layout and dispatch loop</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/1471/vmanchev" class="user-moderator-N"><span itemprop="name">Venelin Manchev</span></a></span>
            <time itemprop="dateCreated" datetime="2014-04-14T03:15:59-07:00">Apr '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-04-14T03:15:59-07:00">Apr '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Apr '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">1</span>
                </td>
                <td>
                    <label>Views</label><br>696</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/4bc9a9e867454a5b46f2ee76beb53922?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/1471/vmanchev" class="user-moderator-N"><span itemprop="name">Venelin Manchev</span></a></span>
                <span class="karma">3.0k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2075" href="#C2075">
        <time class="action-date">Apr '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hello,
I'm not sure about the category, please change it if necessary.</p>
<p>For one of my actions, (IndexController::loginAction), I would like to change the layout script to more basic one than the standard admin layout and it works great with:</p>
<pre><code>public function loginAction()
{
    $this-&gt;view-&gt;setRenderLevel(View::LEVEL_LAYOUT)-&gt;setLayout('login');
}</code></pre>
<p>Well, now I have the Security plugin, which needs to redirect the user to the login page if not logged in and works perfect with this code:</p>
<pre><code>$di['dispatcher'] = function() {
    //.......
    $eventsManager-&gt;attach('dispatch', $adminSecurity);
    //.......
    return $dispatcher;
};</code></pre>
<p>But the problem is - it still use the main layout and not my login layout. It seems the setRenderLevel call have no effect anymore. In the Security plugin, I'm using beforeExecuteRoute method and I've tried to change to other dispatch events. I also tried to change the event to which it is attached to dispatch:beforeDispatch with no effect. </p>
<p>Any help is welcome!</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-ca5420a41b18c4e23275a506-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-ca5420a41b18c4e23275a506-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4bc9a9e867454a5b46f2ee76beb53922?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1471/vmanchev" class="user-moderator-N"><span itemprop="name">Venelin Manchev</span></a>        </span>
        <br>

        <span class="karma">3.0k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7181" href="#C7181">
                <time itemprop="dateCreated" datetime="2014-04-14T05:39:44-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Solved: </p>
<pre><code>$eventsManager-&gt;attach('dispatch:afterDispatch', $adminSecurity);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7181" data-cf-modified-ca5420a41b18c4e23275a506-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7181" data-cf-modified-ca5420a41b18c4e23275a506-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/758de2db098b8bbb31a3b1bd37e2b028?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/185/nazwa" class="user-moderator-N"><span itemprop="name">nazwa</span></a>        </span>
        <br>

        <span class="karma">15.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="7225" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '14</span>
              </span><br/><a name="C7225" href="#C7225">
                <time itemprop="dateCreated" datetime="2014-04-15T07:46:50-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I think you should do your security checks before dispatch, not after.
<a href="http://docs.phalcon.io/en/latest/reference/dispatching.html">http://docs.phalcon.io/en/latest/reference/dispatching.html</a></p>
<p>In your current situation, I can still post any malicious data to your admin, which will successfuly process it and only then check if I'm logged in or not.</p>
<p>Remember that you can use 'View picking' from your controllers to change the view / layout.</p>
<pre><code class="language-php">        // Pick "views-dir/products/search" as view to render
        $this-&gt;view-&gt;pick("products/search");</code></pre>
<p><a href="http://docs.phalcon.io/en/latest/reference/views.html#picking-views">http://docs.phalcon.io/en/latest/reference/views.html#picking-views</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7225" data-cf-modified-ca5420a41b18c4e23275a506-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7225" data-cf-modified-ca5420a41b18c4e23275a506-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2075" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>