---
layout: default
title: 'struggling with $response-&gt;setHeader - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/5/general">General</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">struggling with $response-&gt;setHeader</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/15/le51" class="user-moderator-N"><span itemprop="name">le51</span></a></span>
            <time itemprop="dateCreated" datetime="2013-12-08T13:35:43-07:00">Dec '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-12-08T13:35:43-07:00">Dec '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Feb '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>2643</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/c0ce8f5e133750a4dfea4712e533a178?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/15/le51" class="user-moderator-N"><span itemprop="name">le51</span></a></span>
                <span class="karma">43.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C1306" href="#C1306">
        <time class="action-date">Dec '13</time>
    </a>
</div>
<div class="post-content"><div><p>Hi all,</p>
<p>in my app, I have to retrieve images that are located outside the public directory. Each image is also referenced in a db table (with mime-type, size, access rights and so on)</p>
<p>I want to dispaly them with {% raw %}{{{% endraw %} image(&quot;media/image/13&quot; {% raw %}}}{% endraw %} </p>
<p>media controller, image action below:</p>
<pre><code class="language-php">
public function image($id)
{
// some stuff to build absolute path to image: $imagePath
// ....

        $this-&gt;response-&gt;setHeader("Content-Type",$image-&gt;mime);
        $this-&gt;response-&gt;setHeader("Content-Length",$image-&gt;size);
        $this-&gt;response-&gt;setFileToSend($imagePath);
// also tried with: 

        $response-&gt;setHeader("X-Sendfile", $imagePath);
        $this-&gt;response-&gt;send();
}
</code></pre>
<p>No image is displayed. Content-Length is not the right one ... What am I doing wrong ?
Any help really appreciated !</p>
<p>response headers with setFileToSend:</p>
<p>Connection:Keep-Alive
Content-Description:File Transfer
Content-Disposition:attachment; filename=22.jpg
Content-Length:465
Content-Transfer-Encoding:binary
Content-Type:image/jpeg</p>
<p>response headers with X-Sendfile:</p>
<p>Connection:Keep-Alive
Content-Length:45
Content-Type:image/jpeg
Date:Sun, 08 Dec 2013 20:34:06 GMT
Keep-Alive:timeout=5, max=98
Server:Apache/2.2.22 (Debian)
X-Powered-By:PHP/5.4.4-14+deb7u5
X-Sendfile:/var/www/phalcon/medias/app/files/2013-12-08/22.jpg</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-02d7238cd56ae6fe548bce94-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-02d7238cd56ae6fe548bce94-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/6a884ce84688397f7a98996064831bb0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/820/tom-it" class="user-moderator-N"><span itemprop="name">Thomas Lang</span></a>        </span>
        <br>

        <span class="karma">10</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4637" href="#C4637">
                <time itemprop="dateCreated" datetime="2013-12-11T02:50:31-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>are you sure the $imagePath has the complete path to the image including the image name?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4637" data-cf-modified-02d7238cd56ae6fe548bce94-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4637" data-cf-modified-02d7238cd56ae6fe548bce94-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b7fe1bb3abb8cdf11c75f383bd53fc63?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/626/birkof" class="user-moderator-N"><span itemprop="name">Daniel Stancu</span></a>        </span>
        <br>

        <span class="karma">741</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4638" href="#C4638">
                <time itemprop="dateCreated" datetime="2013-12-11T07:05:07-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What are you get at? <code>php var_dump(file_exists($imagePath));</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4638" data-cf-modified-02d7238cd56ae6fe548bce94-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4638" data-cf-modified-02d7238cd56ae6fe548bce94-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c0ce8f5e133750a4dfea4712e533a178?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/15/le51" class="user-moderator-N"><span itemprop="name">le51</span></a>        </span>
        <br>

        <span class="karma">43.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="4651" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '16</span>
              </span><br/><a name="C4651" href="#C4651">
                <time itemprop="dateCreated" datetime="2013-12-12T03:37:46-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi, thank you for help.
$imagePath is OK, I'm now dealing this problem with</p>
<pre><code class="language-php">
$response = new Phalcon\Http\Response();
        $response-&gt;setContentType($image-&gt;mime);
        $response-&gt;setContent(file_get_contents($imagePath));
        return $response;
</code></pre>
<p>It's not really satisying me, but I will use that as a primary workaround before I investigate (and learn more about response headers) this problem further ...</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4651" data-cf-modified-02d7238cd56ae6fe548bce94-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4651" data-cf-modified-02d7238cd56ae6fe548bce94-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b0f63bbe7e2f1a89feedbde170e8e896?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2954/nini" class="user-moderator-N"><span itemprop="name">nini</span></a>        </span>
        <br>

        <span class="karma">507</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C29699" href="#C29699">
                <time itemprop="dateCreated" datetime="2016-02-08T07:43:48-07:00" class="action-date">Feb '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>It looks like it is non-documented feature. send() method on response is not gonna be called at all. But this is the method which reads the file content.
So try following (note send() call at the end):</p>
<pre><code class="language-php">    public function downloadAction()
    {
        $this-&gt;view-&gt;disable();
        $this-&gt;response-&gt;setFileToSend('/path/to/my/file', 'file-name.png')-&gt;send();
    }</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="29699" data-cf-modified-02d7238cd56ae6fe548bce94-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="29699" data-cf-modified-02d7238cd56ae6fe548bce94-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="1306" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>