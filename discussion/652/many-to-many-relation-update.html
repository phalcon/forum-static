---
layout: default
title: 'Many-to-Many relation update - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Many-to-Many relation update</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/355/charnad" class="user-moderator-N"><span itemprop="name">Viktoras</span></a></span>
            <time itemprop="dateCreated" datetime="2013-07-26T00:41:12-07:00">Jul '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-07-26T00:41:12-07:00">Jul '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>2774</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">4</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/98d169ed95725f8310bb4150708a4f20?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/355/charnad" class="user-moderator-N"><span itemprop="name">Viktoras</span></a></span>
                <span class="karma">12.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C652" href="#C652">
        <time class="action-date">Jul '13</time>
    </a>
</div>
<div class="post-content"><div><p>What should happen when m-n relation is updated? For example</p>
<pre><code class="language-php">// $a-&gt;hasManyToMany(..."B"...);
$a = new A();
$b = new B();
$a-&gt;bs = array($b);
$a-&gt;save();
// Ok, lets say we have a connection in the DB
// However I have to save b manually, otherwise it doesn't work
// Now, what if I do this
$b2 = new B();
$a-&gt;bs = array($b2);
$a-&gt;save();</code></pre>
<p>What I expect to happen: remove a-b connection, b itself remains in the DB, b2 is created in DB with the new link a-b2.
What really happens: a now has 2 connections, to b and b2</p>
<p>Is this a bug, or do I need to remove it myself?
What is the best way to &quot;disconnect&quot; A and B entries?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-4177270fdce7a40821586a1c-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-4177270fdce7a40821586a1c-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">4</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2661" href="#C2661">
                <time itemprop="dateCreated" datetime="2013-07-26T07:39:59-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Connections are get as shared from the di, so every model use the same connection no matter how many saves you do.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2661" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span><span itemprop="downvoteCount">1</span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2661" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/98d169ed95725f8310bb4150708a4f20?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/355/charnad" class="user-moderator-N"><span itemprop="name">Viktoras</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2670" href="#C2670">
                <time itemprop="dateCreated" datetime="2013-07-26T08:49:31-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Either you didn't quite understand my question, or I didn't understand the answer.
What I'm talking about is: list of related objects is not updated, new objects are added, old are not removed.
E.g. I want to update posts' tags in a blog.</p>
<pre><code class="language-php">$post-&gt;tags = $oldTags;
$post-&gt;save();
$post-&gt;tags = $newTags;
$post-&gt;save();</code></pre>
<p>What I receive at the and is both, old and new tags, when I would like to only have new! Am I wrong with such expectations?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2670" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2670" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/687c56e2a0eb522b061c8bf3a57790d9?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/551/darda" class="user-moderator-N"><span itemprop="name">darda</span></a>        </span>
        <br>

        <span class="karma">1.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4723" href="#C4723">
                <time itemprop="dateCreated" datetime="2013-12-19T00:34:21-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Some case here.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4723" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4723" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/98d169ed95725f8310bb4150708a4f20?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/355/charnad" class="user-moderator-N"><span itemprop="name">Viktoras</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4724" href="#C4724">
                <time itemprop="dateCreated" datetime="2013-12-19T01:32:06-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Well, I ended up using this:</p>
<pre><code class="language-php">$a-&gt;hasManyToMany("..B..");
$a-&gt;hasMany("..AtoB..");

$this-&gt;db-&gt;begin(); // for transaction
$a-&gt;AtoB-&gt;delete(); // remove connection
$a-&gt;B = array(new B(), new B());
$this-&gt;db-&gt;commit();</code></pre>
<p>So, I define relation to middle-model and remove all of them prior to saving new ones. Don't forget to use transaction, so that if saving related entities fails you can rollback to your old a-to-b connections.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4724" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4724" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5fb005a5415b06c9a771953d9551f76e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1539/fverry" class="user-moderator-N"><span itemprop="name">François Verry</span></a>        </span>
        <br>

        <span class="karma">859</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7532" href="#C7532">
                <time itemprop="dateCreated" datetime="2014-04-29T13:46:47-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Bump,</p>
<p><a href="http://stackoverflow.com/questions/23374858/update-a-records-n-n-relationships">http://stackoverflow.com/questions/23374858/update-a-records-n-n-relationships</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7532" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7532" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/37d37fbd703f926fdae1feb0d8ba7709?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5601/imansa" class="user-moderator-N"><span itemprop="name">imansa</span></a>        </span>
        <br>

        <span class="karma">55</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="27231" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '15</span>
              </span><br/><a name="C27231" href="#C27231">
                <time itemprop="dateCreated" datetime="2015-12-02T06:08:21-07:00" class="action-date">Dec '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>hi. when phalcon automaticaly add data to middle-model on adding data why did not correct them on update?
is this a bug?
i have this problem.
i think all solutions for this case are not very clean. all of them are solving a case temporary.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="27231" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="27231" data-cf-modified-4177270fdce7a40821586a1c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="652" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>