---
layout: default
title: 'Phalcon + Pattern State - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/21/beginners">Beginners</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Phalcon + Pattern State</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/5003/munozdaniel" class="user-moderator-N"><span itemprop="name">Muñoz Daniel</span></a></span>
            <time itemprop="dateCreated" datetime="2017-04-19T03:26:51-07:00">Apr '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-04-19T03:26:51-07:00">Apr '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Apr '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>464</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img  src="https://secure.gravatar.com/avatar/cf4afc70d576de6954ded1bbf6e81702?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/5003/munozdaniel" class="user-moderator-N"><span itemprop="name">Muñoz Daniel</span></a></span>
                <span class="karma">7.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C15983" href="#C15983">
        <time class="action-date">Apr '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hi, i need implement the pattern state with phalcon and mysql. The implementation of pattern is not a problem. I not understand how save data in mysql. Use this example <a href="https://sourcemaking.com/design_patterns/state/php">https://sourcemaking.com/design_patterns/state/php</a></p>
<p>Help :)
Thanks</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-bb2fb3925cc529e40d6086ad-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-bb2fb3925cc529e40d6086ad-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/e05a71a3c55b7800771353f025c8fd03?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4529/tkroll" class="user-moderator-N"><span itemprop="name">Ty Kroll</span></a>        </span>
        <br>

        <span class="karma">8.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47657" href="#C47657">
                <time itemprop="dateCreated" datetime="2017-04-19T03:41:07-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Correct link: <a href="https://bit.ly/2omcEug">state pattern php example</a></p>
<p>Why don't your show us what you've got so far.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47657" data-cf-modified-bb2fb3925cc529e40d6086ad-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47657" data-cf-modified-bb2fb3925cc529e40d6086ad-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/cf4afc70d576de6954ded1bbf6e81702?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/5003/munozdaniel" class="user-moderator-N"><span itemprop="name">Muñoz Daniel</span></a>        </span>
        <br>

        <span class="karma">7.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47659" href="#C47659">
                <time itemprop="dateCreated" datetime="2017-04-19T04:42:25-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><strong>Model Door</strong></p>
<pre><code>class **Door** extends \Phalcon\Mvc\Model
{

/**
 *
 * @var integer
 */
protected $door_id;

/**
 *
 * @var integer
 */
protected $door_stateId;

/**
 *
 * @var string
 */
protected $door_description;

/**
 * Method to set the value of field door_id
 *
 * @param integer $door_id
 * @return $this
 */
public function setDoorId($door_id)
{
    $this-&gt;door_id = $door_id;

    return $this;
}

/**
 * Method to set the value of field door_stateId
 *
 * @param integer $door_stateId
 * @return $this
 */
public function setDoorStateid($door_stateId)
{
    $this-&gt;door_stateId = $door_stateId;

    return $this;
}

/**
 * Method to set the value of field door_description
 *
 * @param string $door_description
 * @return $this
 */
public function setDoorDescription($door_description)
{
    $this-&gt;door_description = $door_description;

    return $this;
}

/**
 * Returns the value of field door_id
 *
 * @return integer
 */
public function getDoorId()
{
    return $this-&gt;door_id;
}

/**
 * Returns the value of field door_stateId
 *
 * @return integer
 */
public function getDoorStateid()
{
    return $this-&gt;door_stateId;
}

/**
 * Returns the value of field door_description
 *
 * @return string
 */
public function getDoorDescription()
{
    return $this-&gt;door_description;
}

/**
 * Returns table name mapped in the model.
 *
 * @return string
 */
public function getSource()
{
    return 'door';
}

/**
 * Allows to query a set of records that match the specified conditions
 *
 * @param mixed $parameters
 * @return Door[]
 */
public static function find($parameters = null)
{
    return parent::find($parameters);
}

/**
 * Allows to query the first record that match the specified conditions
 *
 * @param mixed $parameters
 * @return Door
 */
public static function findFirst($parameters = null)
{
    return parent::findFirst($parameters);
}

/**
 * @var DoorState
 */
private $state;
public function initialize(DoorState $state)
{
    $this-&gt;setState($state);
}
/**
 * @throws IllegalStateTransitionException
 */
public function open()
{
    $this-&gt;setState($this-&gt;state-&gt;open());
}
/**
 * @throws IllegalStateTransitionException
 */
public function close()
{
    $this-&gt;setState($this-&gt;state-&gt;close());
}
/**
 * @throws IllegalStateTransitionException
 */
public function lock()
{
    $this-&gt;setState($this-&gt;state-&gt;lock());
}
/**
 * @throws IllegalStateTransitionException
 */
public function unlock()
{
    $this-&gt;setState($this-&gt;state-&gt;unlock());
}
/**
 * @return bool
 */
public function isOpen()
{
    echo "es INSTANCIA DE OpenDoorState";
    return $this-&gt;state instanceof Dooropen;
}
/**
 * @return bool
 */
public function isClosed()
{
    echo "es INSTANCIA DE ClosedDoorState";
    return $this-&gt;state instanceof Doorclose;
}
/**
 * @return bool
 */
public function isLocked()
{
    echo "es INSTANCIA DE LockedDoorState";
    return $this-&gt;state instanceof Doorlocked;
}
private function setState(DoorState $state)
{
    $this-&gt;state = $state;
}</code></pre>
<p><strong>Model Interface DoorState</strong></p>
<pre><code>interface **DoorState** {
    public function open();
    public function close();
    public function lock();
    public function unlock();
}</code></pre>
<p><strong>Model DoorOpen implements DoorState</strong></p>
<pre><code>class **Dooropen** extends \Phalcon\Mvc\Model implements DoorState
{

  /**
   *
   * @var integer
   */
  protected $doorOpen_id;

  /**
   *
   * @var string
   */
  protected $doorOpen_description;

  /**
   * Method to set the value of field doorOpen_id
   *
   * @param integer $doorOpen_id
   * @return $this
   */
  public function setDooropenId($doorOpen_id)
  {
      $this-&gt;doorOpen_id = $doorOpen_id;

      return $this;
  }

  /**
   * Method to set the value of field doorOpen_description
   *
   * @param string $doorOpen_description
   * @return $this
   */
  public function setDooropenDescription($doorOpen_description)
  {
      $this-&gt;doorOpen_description = $doorOpen_description;

      return $this;
  }

  /**
   * Returns the value of field doorOpen_id
   *
   * @return integer
   */
  public function getDooropenId()
  {
      return $this-&gt;doorOpen_id;
  }

  /**
   * Returns the value of field doorOpen_description
   *
   * @return string
   */
  public function getDooropenDescription()
  {
      return $this-&gt;doorOpen_description;
  }

  /**
   * Returns table name mapped in the model.
   *
   * @return string
   */
  public function getSource()
  {
      return 'dooropen';
  }

  /**
   * Allows to query a set of records that match the specified conditions
   *
   * @param mixed $parameters
   * @return Dooropen[]
   */
  public static function find($parameters = null)
  {
      return parent::find($parameters);
  }

  /**
   * Allows to query the first record that match the specified conditions
   *
   * @param mixed $parameters
   * @return Dooropen
   */
  public static function findFirst($parameters = null)
  {
      return parent::findFirst($parameters);
  }
  public function initialize()
  {
      $this-&gt;setDooropenDescription("PUERTA ABIERTA");
      $this-&gt;setDooropenId(1);
  }

  public function close()
  {
      return new Doorclose();
  }

  public function open()
  {
      throw new IllegalStateTransitionException;
  }

  public function lock()
  {
      throw new IllegalStateTransitionException;
  }

  public function unlock()
  {
      throw new IllegalStateTransitionException;
  }
}</code></pre>
<p>I do not understand how they are reflected in the database. The Door class has a $ state (DoorState interface) attribute, this field as it is stored in the database?
The State classes are new tables in the database that relate to the state attribute of the Door class?
I hope you understand</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47659" data-cf-modified-bb2fb3925cc529e40d6086ad-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47659" data-cf-modified-bb2fb3925cc529e40d6086ad-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47677" href="#C47677">
                <time itemprop="dateCreated" datetime="2017-04-20T02:14:02-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>In your code, only two classes will be reflected in the database (those which extend <code>Phalcon\Mvc\Model</code>):</p>
<p><strong>Door</strong> and <strong>Dooropen</strong>.</p>
<p>The properties of these classes will be mapped to DB columns, which you can fine-tune with:</p>
<pre><code class="language-php">class Door extends \Phalcon\Mvc\Model {
    public function columnMap() {
        return [
            '&lt;db_column_name&gt;' =&gt; '&lt;model_property_name&gt;'
        ];
    }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47677" data-cf-modified-bb2fb3925cc529e40d6086ad-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47677" data-cf-modified-bb2fb3925cc529e40d6086ad-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/cf4afc70d576de6954ded1bbf6e81702?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/5003/munozdaniel" class="user-moderator-N"><span itemprop="name">Muñoz Daniel</span></a>        </span>
        <br>

        <span class="karma">7.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47723" href="#C47723">
                <time itemprop="dateCreated" datetime="2017-04-21T06:18:31-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>In case I want to add a new state, for example DoorClosed, it should be reflected in the database.
I am right?
How should I change the relationship in colummap?</p>
<pre><code>    class Door extends \Phalcon\Mvc\Model {
        public function columnMap() {
            return [
                '&lt;db_column_name&gt;' =&gt; '&lt;model_property_name&gt;',
                '&lt;db_column_name2&gt;' =&gt; '&lt;model_property_name2&gt;'
            ];
        }
    }</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47723" data-cf-modified-bb2fb3925cc529e40d6086ad-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47723" data-cf-modified-bb2fb3925cc529e40d6086ad-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="15983" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>