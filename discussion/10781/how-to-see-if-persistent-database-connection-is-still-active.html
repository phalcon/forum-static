---
layout: default
title: 'How to see if persistent database connection is still active? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">How to see if persistent database connection is still active?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/4413/Firzenizer" class="user-moderator-N"><span itemprop="name">Tomi Ruusala</span></a></span>
            <time itemprop="dateCreated" datetime="2016-03-15T01:51:49-07:00">Mar '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-03-15T01:51:49-07:00">Mar '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Mar '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>2824</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img  src="https://secure.gravatar.com/avatar/84525ce8ab37cc06caab1ea6d9f8b492?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/4413/Firzenizer" class="user-moderator-N"><span itemprop="name">Tomi Ruusala</span></a></span>
                <span class="karma">7.4k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C10781" href="#C10781">
        <time class="action-date">Mar '16</time>
    </a>
</div>
<div class="post-content"><div><p>When I go through this documentation:
<a href="https://docs.phalcon.io/en/latest/api/Phalcon_Db_Adapter_Pdo_Mysql.html">https://docs.phalcon.io/en/latest/api/Phalcon_Db_Adapter_Pdo_Mysql.html</a></p>
<p>I find only getConnectionId() which seems to return 0 always for me. I'd like to find out if my connection is open or not.</p>
<p>I have a CLI task running in an eternal loop. Sometime its running lots of queries, but during the night it usually has nothing to run and may timeout. What I'd like to do is check if my connection is still open, before throwing any queries at it. I wanna avoid getting mysql has gone away error.</p>
<p>Is there anyway I could test if this is still active?
$db = \Phalcon\Di::getDefault()-&gt;getShared('db');</p>
<p>I could do $db-&gt;connect()  everytime before running queries, but it's not a persistent connection anymore then. It opens a new connection every time.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-7818114310be87354811419d-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-7818114310be87354811419d-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/1f92c8832155ca96cb3147af3cad27b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/6311/davihu" class="user-moderator-N"><span itemprop="name">David Hübner</span></a>        </span>
        <br>

        <span class="karma">9.3k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C30967" href="#C30967">
                <time itemprop="dateCreated" datetime="2016-03-15T02:50:50-07:00" class="action-date">Mar '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The timeout will appear on MySQL site, even if method getConnectionId() returns an ID, Phalcon will not know that connection is timeouted. Your best way is to wrap your query to try-catch and on exception reconnect and retry.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="30967" data-cf-modified-7818114310be87354811419d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="30967" data-cf-modified-7818114310be87354811419d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="30973" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '16</span>
              </span><br/><a name="C30973" href="#C30973">
                <time itemprop="dateCreated" datetime="2016-03-15T03:06:13-07:00" class="action-date">Mar '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I had exactly same issue with persistent CLI task.
There are couple of ways to solve it.
First, you want to make sure that you're actually using PDO persistent connections.</p>
<p>In your DB service, make sure you have an array with key 'options' as in my example:</p>
<pre><code class="language-php">    $dbConfig['options'] = [
        PDO::ATTR_DEFAULT_FETCH_MODE =&gt; PDO::FETCH_ASSOC,
        PDO::ATTR_PERSISTENT =&gt; 1,
        //Many web applications will benefit from making persistent connections to database servers. Persistent connections are not closed at the end of the script, but are cached and re-used when another script requests a connection using the same credentials.
        // The persistent connection cache allows you to avoid the overhead of establishing a new connection every time a script needs to talk to a database, resulting in a faster web application.
        PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION
    ];</code></pre>
<p>But, it might be safer and easier to just recconect each time from your CLI APP.</p>
<pre><code class="language-php">$this-&gt;db-&gt;connect(); //This will reconnect even active connection pipe</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="30973" data-cf-modified-7818114310be87354811419d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="30973" data-cf-modified-7818114310be87354811419d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/1f92c8832155ca96cb3147af3cad27b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/6311/davihu" class="user-moderator-N"><span itemprop="name">David Hübner</span></a>        </span>
        <br>

        <span class="karma">9.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C30981" href="#C30981">
                <time itemprop="dateCreated" datetime="2016-03-15T04:16:08-07:00" class="action-date">Mar '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://stackoverflow.com/questions/3332074/what-are-the-disadvantages-of-using-persistent-connection-in-pdo">https://stackoverflow.com/questions/3332074/what-are-the-disadvantages-of-using-persistent-connection-in-pdo</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="30981" data-cf-modified-7818114310be87354811419d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="30981" data-cf-modified-7818114310be87354811419d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="10781" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>