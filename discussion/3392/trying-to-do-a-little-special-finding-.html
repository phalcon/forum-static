---
layout: default
title: 'Trying to do a little special finding... - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Trying to do a little special finding...</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a></span>
            <time itemprop="dateCreated" datetime="2014-09-07T16:35:20-07:00">Sep '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-09-07T16:35:20-07:00">Sep '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>574</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a></span>
                <span class="karma">33.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C3392" href="#C3392">
        <time class="action-date">Sep '14</time>
    </a>
</div>
<div class="post-content"><div><p>My <code>User</code> model is conected to <code>Group</code> model, which is connected to <code>Grade</code> model. I'm trying to find a condition (the <code>WHERE</code> clause) or criteria (<a href="https://docs.phalcon.io/es/latest/api/Phalcon_Mvc_Model_Criteria.html">https://docs.phalcon.io/es/latest/api/Phalcon_Mvc_Model_Criteria.html</a> ) to get a string that is like <code>Grade.name Group.name - User.fullName</code>, and the search starts from the <code>User</code> model.</p>
<p>The problem is that, with the condition, I cannot do anything, 'cause I can't find if it is possible to do something like a <code>JOIN</code> there (I don't think so); and with the criteria, I don't find how to set the query.</p>
<p>Can anybody illuminate me?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-1f2cd71e1d590c76510dc503-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-1f2cd71e1d590c76510dc503-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/210803d2bf1f658b0d4ca1c7a4877196?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2172/dsabella84" class="user-moderator-N"><span itemprop="name">Dom</span></a>        </span>
        <br>

        <span class="karma">2.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11157" href="#C11157">
                <time itemprop="dateCreated" datetime="2014-09-08T07:01:46-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>How do you have your models written up? You can also do the query using PHQL as well.  </p>
<pre><code class="language-php">$query = new Phalcon\Mvc\Model\Query("SELECT * FROM User
INNER JOIN Group on User.GroupId = Group.Id
INNER JOIN Grade on User.Id = Grade.UserId
WHERE CONCAT(Grade.name, ' ', Group.name, ' - ', User.fullName) =  :name:", $this-&gt;getDI());

$value = $query-&gt;execute(array(
'name' =&gt; 'A Group - John Smith'
));</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11157" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11157" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11161" href="#C11161">
                <time itemprop="dateCreated" datetime="2014-09-08T07:37:38-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The problem isn't how they are written; the problem is that I need to do a <code>WHERE</code> that is that <code>CONCAT</code> of the three tables.</p>
<p>BTW thanks, but I already did it with Criteria (I successed using the <code>join()</code>, didn't realize that the table name has to be the same that the model file name xD). Also your code fails 'cause of the second param of <code>$query</code> and something more I don't remember right now.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11161" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11161" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/210803d2bf1f658b0d4ca1c7a4877196?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2172/dsabella84" class="user-moderator-N"><span itemprop="name">Dom</span></a>        </span>
        <br>

        <span class="karma">2.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11163" href="#C11163">
                <time itemprop="dateCreated" datetime="2014-09-08T07:40:13-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Can you post your model definitions, I'd like to play around with them locally.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11163" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11163" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11164" href="#C11164">
                <time itemprop="dateCreated" datetime="2014-09-08T07:55:08-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Student.php</p>
<pre><code>&lt;?php

use Phalcon\Mvc\Model,
    Phalcon\Db\Column;

class Student extends Model
{
    public function initialize()
    {
        $this-&gt;belongsTo("group_id", "Group", "id");
    }
    public static function searchStudents($search = "")
    {
        $where = "CONCAT(Grade.name, " ", Group.name, " - ", Student.lastname1, " ", Student.lastName2, ", ", Student.name) LIKE CONCAT("%", :chain:,"%")";
        $params = array(
            "chain" =&gt; $search
            );
        $types = array(
            Column::BIND_PARAM_STR
            );
        $students = Student::query()
            -&gt;join("Group", "Student.group_id = Group.id")
            -&gt;join("Grade", "Group.grade_id = Grade.id")
            -&gt;where($where)
            -&gt;bind($params)
            -&gt;bindTypes($types)
            -&gt;execute();
        $results = array();

        foreach ($students as $student)
        {
            $results[] = array(
                "id" =&gt; $student-&gt;id,
                "chain" =&gt; ($student-&gt;group-&gt;grade-&gt;name . " " .
                    $student-&gt;group-&gt;descripcion . " - " .
                    $student-&gt;lastName1 . " " .
                    $alumno-&gt;lastName2 . ", " .
                    $student-&gt;name)
                );
        }

        return $results;
    }
}</code></pre>
<p>Group.php</p>
<pre><code>&lt;?php

use Phalcon\Mvc\Model;

class Group extends Model
{
    public function initialize()
    {
        $this-&gt;belongsTo('grade_id', 'Grade', 'id');
        $this-&gt;hasMany('id', 'Student', 'group_id');
    }
}</code></pre>
<p>Grade.php</p>
<pre><code>&lt;?php

use Phalcon\Mvc\Model;

class Grade extends Model
{
    public function initialize()
    {
        $this-&gt;hasMany('id', 'Group', 'grade_id');
    }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11164" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11164" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/210803d2bf1f658b0d4ca1c7a4877196?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2172/dsabella84" class="user-moderator-N"><span itemprop="name">Dom</span></a>        </span>
        <br>

        <span class="karma">2.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11171" href="#C11171">
                <time itemprop="dateCreated" datetime="2014-09-08T09:45:16-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Have you tried changing your model name of Group to StudentGroup, I was able to get the models to work like that.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11171" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11171" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11173" href="#C11173">
                <time itemprop="dateCreated" datetime="2014-09-08T09:46:33-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>If you can post the code here, I will see it later, now I have to go (BTW, renaming? I don't have a table for that model)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11173" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11173" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/210803d2bf1f658b0d4ca1c7a4877196?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2172/dsabella84" class="user-moderator-N"><span itemprop="name">Dom</span></a>        </span>
        <br>

        <span class="karma">2.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11174" href="#C11174">
                <time itemprop="dateCreated" datetime="2014-09-08T09:52:20-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Here is the updated models:</p>
<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model,
    Phalcon\Db\Column;

class Student extends Model
{
    public function initialize()
    {
        $this-&gt;belongsTo("group_id", "StudentGroup", "id");
    }
    public static function searchStudents($search = "")
    {
        $where = "CONCAT(Grade.name, ' ', StudentGroup.name, ' - ', Student.lastname1, ' ', Student.lastName2, ', ', Student.name) LIKE CONCAT('%', :chain:,'%')";
        $params = array(
            "chain" =&gt; $search
            );
        $types = array(
            Column::BIND_PARAM_STR
            );
        $students = Student::query()
            -&gt;join("StudentGroup", "Student.group_id = StudentGroup.id")
            -&gt;join("Grade", "StudentGroup.grade_id = Grade.id")
            -&gt;where($where)
            -&gt;bind($params)
            -&gt;bindTypes($types)
            -&gt;execute();
        $results = array();

        foreach ($students as $student)
        {
            $results[] = array(
                "id" =&gt; $student-&gt;id,
                "chain" =&gt; ($student-&gt;group-&gt;grade-&gt;name . " " .
                    $student-&gt;group-&gt;description . " - " .
                    $student-&gt;lastName1 . " " .
                    $alumno-&gt;lastName2 . ", " .
                    $student-&gt;name)
                );
        }

        return $results;
    }

}</code></pre>
<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model;

class StudentGroup extends Model
{
    public function initialize()
    {
        $this-&gt;belongsTo('grade_id', 'Grade', 'id');
        $this-&gt;hasMany('id', 'Student', 'group_id');
    }
}</code></pre>
<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model;

class Grade extends Model
{
    public function initialize()
    {
        $this-&gt;hasMany('id', 'StudentGroup', 'grade_id');
    }
}</code></pre>
<p>Also be careful when any of those columns are null a CONCAT willl return null.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11174" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11174" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11180" href="#C11180">
                <time itemprop="dateCreated" datetime="2014-09-08T12:53:01-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Updated? We did the same, only that my <code>Group</code> model isn't renamed xDD</p>
<p>I thinked you find a way to do the <code>find()</code> for this case, that's why I asked you to post your code hehe. Thanks anyway.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11180" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11180" data-cf-modified-1f2cd71e1d590c76510dc503-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="3392" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>