---
layout: default
title: 'Phalcon and prepared sql statements - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Phalcon and prepared sql statements</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/3520/SevaJmurov" class="user-moderator-N"><span itemprop="name">Seva Jmurov</span></a></span>
            <time itemprop="dateCreated" datetime="2018-04-12T03:57:55-07:00">Apr '18</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2018-04-12T03:57:55-07:00">Apr '18</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Apr '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>740</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/f5c6ce717e91b110b115c9353611c070?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/3520/SevaJmurov" class="user-moderator-N"><span itemprop="name">Seva Jmurov</span></a></span>
                <span class="karma">15.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C18077" href="#C18077">
        <time class="action-date">Apr '18</time>
    </a>
</div>
<div class="post-content"><div><p>Hello,
I was looking for ways to improve my work with dynamic mysql database/table names.
And I found prepare method in <a href="https://docs.phalcon.io/ru/3.2/Phalcon_Db_Adapter_Pdo_Mysql">Phalcon\Db\Adapter\Pdo</a>.
Also I've read somewhere on forum that phalcon prepares sql statements implicitly.</p>
<p>So my first question: Why and when do we need to explicitely use prepare method?</p>
<p>And my second question: Is there a way to utilize phalcon prepared statements to achieve something like this:</p>
<pre><code>SET @id := '47';
SET @table := concat(@id,'_2013_2014_voucher');
set @qry1:= concat('select * from ',@table);
prepare stmt from @qry1 ;
execute stmt ;</code></pre>
<p>?
(this is mysql implementation of dynamic table names usage from <a href="https://stackoverflow.com/questions/27542617/dynamic-table-name-at-sql-statement?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa">the stackoverflow post</a>).</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-0fd1219432e642ebf2a5c9fe-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-0fd1219432e642ebf2a5c9fe-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b59fecbff6d1afabf8da316028330df4?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2619/emiliodeg" class="user-moderator-N"><span itemprop="name">Emilio Degiovanni</span></a>        </span>
        <br>

        <span class="karma">32.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C54793" href="#C54793">
                <time itemprop="dateCreated" datetime="2018-04-12T10:31:02-07:00" class="action-date">Apr '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Q1: always, it's the best wait prevent SQL injection</p>
<p>Q2: <a href="https://stackoverflow.com/questions/24958367/php-pdo-using-mysql-variables">check this</a> and then use the <a href="https://docs.phalcon.io/en/3.3/db-layer">DB Layer</a> to execute it</p>
<p>Good luck</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="54793" data-cf-modified-0fd1219432e642ebf2a5c9fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="54793" data-cf-modified-0fd1219432e642ebf2a5c9fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C54851" href="#C54851">
                <time itemprop="dateCreated" datetime="2018-04-16T09:12:21-07:00" class="action-date">Apr '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You should use prepared statements whenever the statement could potentially include text from a user.  This includes usernames, email addresses... basically anything that wasn't 100% internally generated.</p>
<p>This is to prevent SQL injection.  SQL injection happens when a query string is being interpreted by the database engine.  It's literal, so it doesn't know that <code>;delete from users;</code> was intended to be a username and not a new query.  With prepared queries, the database engine parses the query ahead of time without any actual values, so it can't get confused.  Then, when you have a malicious string of user text , such as <code>;delete from users;</code>, the engine doesn't try to parse that string and just treats it as a string to match on.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="54851" data-cf-modified-0fd1219432e642ebf2a5c9fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="54851" data-cf-modified-0fd1219432e642ebf2a5c9fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f5c6ce717e91b110b115c9353611c070?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3520/SevaJmurov" class="user-moderator-N"><span itemprop="name">Seva Jmurov</span></a>        </span>
        <br>

        <span class="karma">15.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="54879" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '18</span>
              </span><br/><a name="C54879" href="#C54879">
                <time itemprop="dateCreated" datetime="2018-04-18T07:59:51-07:00" class="action-date">Apr '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi, Emilio, Dylan.
Thanks for your answers first of all.</p>
<p>I prety much got that prepared statements is a security requirement nowadays, however Q1 was more about why do i need to explicitely write this:</p>
<pre><code class="language-php">$statement = $db-&gt;prepare($some_sql_statement);</code></pre>
<p>If phalcon prepares sql statements anyway. Or it doesn't do so on DB Layer? (hadn't a minute to find out in mysql logs yet)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="54879" data-cf-modified-0fd1219432e642ebf2a5c9fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="54879" data-cf-modified-0fd1219432e642ebf2a5c9fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C54881" href="#C54881">
                <time itemprop="dateCreated" datetime="2018-04-18T08:04:29-07:00" class="action-date">Apr '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You only need to do that if you're using the DB layer directly.  That DB layer is what Phalcon uses to talk to the database.  Code like that essentially bypasses Phalcon and the work it would do.</p>
<p>If you're using the Phalcon ORM, you can do a statement like:</p>
<pre><code class="language-php">$Records = $Model::find(['conditions'=&gt;'country=:country:','bind'=&gt;['country'=&gt;'Canada']);</code></pre>
<p>That will translate to (roughly speaking - I don't know the functions exactly</p>
<pre><code>$statement = $db-&gt;prepare('SELECT * FROM model_table where country = ?')
$db-&gt;executePrepared($statement,['Canada']);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="54881" data-cf-modified-0fd1219432e642ebf2a5c9fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="54881" data-cf-modified-0fd1219432e642ebf2a5c9fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="18077" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>