---
layout: default
title: 'Session Destroy - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/28/session">Session</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Session Destroy</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/2437/haithanh" class="user-moderator-N"><span itemprop="name">haithanh</span></a></span>
            <time itemprop="dateCreated" datetime="2014-10-26T19:43:58-07:00">Oct '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-10-26T19:43:58-07:00">Oct '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>1218</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/1e76774ee664ff41f540ee7ddd51be0e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/2437/haithanh" class="user-moderator-N"><span itemprop="name">haithanh</span></a></span>
                <span class="karma">3.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C3791" href="#C3791">
        <time class="action-date">Oct '14</time>
    </a>
</div>
<div class="post-content"><div><p>I have this case : </p>
<p>I have user logged in two browsers. When this user changes his password, I want that the user logouts in the two browser. How can I setup the function that it destroys all sessions of this user??? without setup session save in MySQL, I want to use memcache because it optimizes speed for my website.</p>
<p>Thanks everyone,</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-c60b0ca754e64cf131079969-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-c60b0ca754e64cf131079969-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9eafe1dbabc0c116138b0aff7e8f3670?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2335/skollro" class="user-moderator-N"><span itemprop="name">skollro</span></a>        </span>
        <br>

        <span class="karma">6.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12595" href="#C12595">
                <time itemprop="dateCreated" datetime="2014-10-27T05:35:11-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Store the database object of the current user in <code>$_SESSION</code>.
Validate the password from <code>$_SESSION</code> against the one from the database on every request and destroy the session if they're not matching.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12595" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12595" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12604" href="#C12604">
                <time itemprop="dateCreated" datetime="2014-10-27T10:32:26-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>When a password is changed, simply find every session for the current user, that doesn't have the same session ID as the password-changing session, and remove it.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12604" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12604" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1e76774ee664ff41f540ee7ddd51be0e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2437/haithanh" class="user-moderator-N"><span itemprop="name">haithanh</span></a>        </span>
        <br>

        <span class="karma">3.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12615" href="#C12615">
                <time itemprop="dateCreated" datetime="2014-10-27T19:22:59-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/quasipickle">@quasipickle</a> :
Now i use files adpater , when i call &quot;this-&gt;session-&gt;destroy({sesId})&quot; , it dont destroy the session with &quot;sesId&quot; i give, it just destroy the current session @@</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12615" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12615" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/075703e80faff2a7790144aaa5ed209d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/60/ajmckee" class="user-moderator-N"><span itemprop="name">AJ McKee</span></a>        </span>
        <br>

        <span class="karma">15.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12617" href="#C12617">
                <time itemprop="dateCreated" datetime="2014-10-27T22:44:07-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/haithanh">@haithanh</a> You could store a value in memcache with say your users internal id and a password reset boolean. If it returns on a request as true you know to remove the session for the affected browser irrespective of the users session. </p>
<p>It should also have the benifit of being rather quick.  Its a tiny hit on performance, no where as bad as storing on mysql and looking up each request the db.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12617" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12617" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9af73076014e295c1337e33e51b52518?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2598/rianorie" class="user-moderator-N"><span itemprop="name">Rian Orie</span></a>        </span>
        <br>

        <span class="karma">6.9k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="12950" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '14</span>
              </span><br/><a name="C12950" href="#C12950">
                <time itemprop="dateCreated" datetime="2014-11-09T05:25:07-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>While the proposed solution of validating the password on every load is possible and quick to implement I wouldn't do it. Since md5 and sha have been found to be insecure we're using proper hashing systems now, see <a href="http://docs.phalcon.io/en/latest/reference/security.html">Phalcon\Security</a>, this becomes quite expensive in cpu cycles. That is deliberate, the more expensive it is to generate a password the longer it will take to be able to break them.</p>
<p>For logins and the occasional password change that's no problem, but if you start hashing passwords on every load, for every user.. maybe it's not so good an idea.</p>
<p>What you want to do is create a token when a user logs in. Add a table <code>token</code> to your database, the structure could be something like: <code>id</code>, <code>user_id</code>, <code>token</code>, <code>created_on</code>, <code>used_on</code>. Whenever a user logs in you create a new token and store the id of the token in the session. When the token stops being available, you redirect back to the login page. At this point I'm sure you've figured out how this works.. whenever a user changes their password you can remove the tokens associated with the <code>user_id</code> and voila, they'll be logged out everywhere.</p>
<p>There's an added bonus, you can use the <code>token</code> field, which has a random string (md5 or sha are fine here) and store it in a cookie. If they reach the login page and you detect a cookie named <code>login_token</code> or whatever you test the string against the database, make sure the token isn't too old to use (that's what <code>used_on</code> is for, you update that every login or even every page load, it'll still be cheaper than validating the password every load) and log them in.</p>
<p>Bonus points for using a redis or other key/value store for your token storage, it'll be even faster.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12950" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12950" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1e76774ee664ff41f540ee7ddd51be0e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2437/haithanh" class="user-moderator-N"><span itemprop="name">haithanh</span></a>        </span>
        <br>

        <span class="karma">3.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12959" href="#C12959">
                <time itemprop="dateCreated" datetime="2014-11-09T08:41:05-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>i use memcached server instead of file cached, and i can delete the other session_id. thanks for your help</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12959" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12959" data-cf-modified-c60b0ca754e64cf131079969-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="3791" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>