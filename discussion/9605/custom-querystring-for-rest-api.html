---
layout: default
title: 'Custom querystring for Rest API - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/22/micro">Micro</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Custom querystring for Rest API</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/5537/jojuarva" class="user-moderator-N"><span itemprop="name">JJ</span></a></span>
            <time itemprop="dateCreated" datetime="2015-11-25T09:37:53-07:00">Nov '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-11-25T09:37:53-07:00">Nov '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>920</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/666f0650627500c28db433056745954d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/5537/jojuarva" class="user-moderator-N"><span itemprop="name">JJ</span></a></span>
                <span class="karma">1.0k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C9605" href="#C9605">
        <time class="action-date">Nov '15</time>
    </a>
</div>
<div class="post-content"><div><p>Hi people, </p>
<p>I'm creating a rest api and I need configure a route with optional parameters on querystring.</p>
<p>The url should be looks like:
<a href="http://192.168.1.133/base/generic/lista/">http://192.168.1.133/base/generic/lista/</a> OR
<a href="http://192.168.1.133/base/generic/lista?q=criteria">http://192.168.1.133/base/generic/lista?q=criteria</a> OR
<a href="http://192.168.1.133/base/generic/lista?q=some+criteria&amp;sort=-priority">http://192.168.1.133/base/generic/lista?q=some+criteria&amp;sort=-priority</a> OR
<a href="http://192.168.1.133/base/generic/lista?q=some+criteria&amp;sort=priority">http://192.168.1.133/base/generic/lista?q=some+criteria&amp;sort=priority</a> OR
<a href="http://192.168.1.133/base/generic/lista?sort=-priority">http://192.168.1.133/base/generic/lista?sort=-priority</a> </p>
<p>I want to use a unique get route for this, is:</p>
<pre><code>    $app-&gt;get('/generic/lista/[I DONT KNOW WHAt PUT HERE]', function([AND HERE]) {
        $controller-&gt;listar($q,$sort);
    });</code></pre>
<p>$app is my MicroApp instance
$controller is my Controller instance</p>
<p>And in my controller I want to validate if $q or $sort have value. I was trying with:</p>
<pre><code>$app-&gt;get('/generic/lista/?{q:[a-z]*}&amp;{sort:-?[a-z0-9]*}', function($q=null, $sort=null) {
    $controller-&gt;listar($q,$sort);
});</code></pre>
<p>But I don't receive %q or $sort in controller</p>
<p>Any clue?</p>
<p>Thanks</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="26955" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '15</span>
              </span><br/><a name="C26955" href="#C26955">
                <time itemprop="dateCreated" datetime="2015-11-25T10:56:13-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Actually to rerievie variables from question mark you have to use getQuery() from $app-&gt;request like this:</p>
<p>$app-&gt;request-&gt;getQuery('q') or $app-&gt;request-&gt;getQuery('sort').</p>
<p>If you have to use this in function you have to add use ($app) after function. Im not sure if it is bound to function closure like in di(so you can just use $this, well this behaviour of di is actually only in 2.1 beta phalcon).</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="26955" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="26955" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/666f0650627500c28db433056745954d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5537/jojuarva" class="user-moderator-N"><span itemprop="name">JJ</span></a>        </span>
        <br>

        <span class="karma">1.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C26955"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Wojciech Ślawski                    </a>
                </div><div class="posts-buttons" align="right"><a name="C26997" href="#C26997">
                <time itemprop="dateCreated" datetime="2015-11-26T14:17:09-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Jurigag</p>
<p>About use &quot;use ($app)&quot;, I don't need pass it because my controller has $app injected.</p>
<p>I have a doubt, my route are ok:</p>
<pre><code>$app-&gt;get('/generic/lista/?{q:[a-z]*}&amp;{sort:-?[a-z0-9]*}', function($q=null, $sort=null) {
    $controller-&gt;listar($q,$sort);
});</code></pre>
<p>Or should be looks like:</p>
<pre><code>$app-&gt;get('/generic/lista/?{q:[a-z]*}&amp;{sort:-?[a-z0-9]*}', function() {
    $controller-&gt;listar();
});</code></pre>
<p>Then in my controller can I use your suggestion:</p>
<pre><code>$app-&gt;request-&gt;getQuery('q') or $app-&gt;request-&gt;getQuery('sort').</code></pre>
<p>Thanks in advance</p>
<blockquote>
<p>Actually to rerievie variables from question mark you have to use getQuery() from $app-&gt;request like this:</p>
<p>$app-&gt;request-&gt;getQuery('q') or $app-&gt;request-&gt;getQuery('sort').</p>
<p>If you have to use this in function you have to add use ($app) after function. Im not sure if it is bound to function closure like in di(so you can just use $this, well this behaviour of di is actually only in 2.1 beta phalcon).</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="26997" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="26997" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C27023" href="#C27023">
                <time itemprop="dateCreated" datetime="2015-11-26T23:50:07-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>It Doesn't even have to be in route definition</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="27023" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="27023" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/666f0650627500c28db433056745954d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5537/jojuarva" class="user-moderator-N"><span itemprop="name">JJ</span></a>        </span>
        <br>

        <span class="karma">1.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C27023"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Wojciech Ślawski                    </a>
                </div><div class="posts-buttons" align="right"><a name="C27097" href="#C27097">
                <time itemprop="dateCreated" datetime="2015-11-28T06:52:05-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks, works perfect</p>
<p>Another question about these routes, I have defined:</p>
<pre><code>    $this-&gt;app-&gt;get('/generics/', function() {
        $this-&gt;controller-&gt;listar();
    });

    $this-&gt;app-&gt;get("/generics/{id:[0-9a-z]+}",  function($id) {
        $this-&gt;controller-&gt;get($id);
    });

    $this-&gt;app-&gt;post('/generics/', function()  {
        $this-&gt;controller-&gt;nuevo();
    });

    $this-&gt;app-&gt;put('/generics/{id:[0-9a-z]+}', function($id) {
        $this-&gt;controller-&gt;modificar($id);
    });

    $this-&gt;app-&gt;delete('/generics/{id:[0-9a-z]+}', function($id) {
        $this-&gt;controller-&gt;eliminar($id);
    });</code></pre>
<p>But no all of them works:</p>
<p>$this-&gt;app-&gt;get('/generics/', function() {   // doesn't work, always is executed $this-&gt;app-&gt;get(&quot;/generics/{id:[0-9a-z]+}</p>
<p>$this-&gt;app-&gt;post('/generics/', function()  {  // doesn't work, the route is not found</p>
<p>put and delete works perfect</p>
<p>Before that, I was using specific names for each resource like app-&gt;get('/generics/lista/ or app-&gt;get('/generics/get/ or app-&gt;get('/generics/new/</p>
<p>But for client guidelines we need to use / with each different http method</p>
<p>Any suggestion?</p>
<blockquote>
<p>It Doesn't even have to be in route definition</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="27097" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="27097" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="27101" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '15</span>
              </span><br/><a name="C27101" href="#C27101">
                <time itemprop="dateCreated" datetime="2015-11-28T10:44:43-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>It should work. You are sure you are access /generics/ not /generics ? So if this second route with $id is executed what value of $id is then ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="27101" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="27101" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/666f0650627500c28db433056745954d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5537/jojuarva" class="user-moderator-N"><span itemprop="name">JJ</span></a>        </span>
        <br>

        <span class="karma">1.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C27101"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Wojciech Ślawski                    </a>
                </div><div class="posts-buttons" align="right"><a name="C27103" href="#C27103">
                <time itemprop="dateCreated" datetime="2015-11-28T13:27:36-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes, I'm sure about the access. I tryed with:</p>
<p><a href="http://192.168.1.131/base/generics/">http://192.168.1.131/base/generics/</a>
<a href="http://192.168.1.131/base/generics">http://192.168.1.131/base/generics</a></p>
<p>(&quot;base&quot; is my context path on apache)</p>
<p>But the route isn't found... is executed:</p>
<pre><code>$app-&gt;notFound(function () {
            $this-&gt;app-&gt;response-&gt;setStatusCode(ICommons::HTTP_404, ICommons::HTTP_404_MSG);
            $this-&gt;app-&gt;response-&gt;setHeader(ICommons::HEADER_CONTENT_TYPE, ICommons::HEADER_CONTENT_JSON);
            $this-&gt;app-&gt;response-&gt;setJsonContent(array(ICommons::RESPONSE_RESULTADO =&gt; ICommons::HTTP_404_MSG, ICommons::RESPONSE_MENSAJE =&gt; ICommons::RESPONSE_RUTA_INEXISTENTE));
            $this-&gt;app-&gt;response-&gt;send();
        });</code></pre>
<p>The second route works like:</p>
<p><a href="http://192.168.1.131/base/generics/67890">http://192.168.1.131/base/generics/67890</a>
With response like:
{
resultado: &quot;OK&quot;,
mensaje: {
id: &quot;67890&quot;,
nombre: &quot;generico de prueba 2&quot;,
fecha: &quot;2015-11-17 14:19:32.275854&quot;,
tipo: 1,
marca: &quot;marca 2&quot;
}
}</p>
<p>I don't see the error.... </p>
<blockquote>
<p>It should work. You are sure you are access /generics/ not /generics ? So if this second route with $id is executed what value of $id is then ?</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="27103" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="27103" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/666f0650627500c28db433056745954d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5537/jojuarva" class="user-moderator-N"><span itemprop="name">JJ</span></a>        </span>
        <br>

        <span class="karma">1.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C27105" href="#C27105">
                <time itemprop="dateCreated" datetime="2015-11-28T15:21:08-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Solved!! Using Micro/Collection</p>
<pre><code>use Phalcon\Mvc\Micro\Collection as MicroCollection;
.....

$mc = new MicroCollection();

    $mc-&gt;setHandler($this-&gt;controller);
    $mc-&gt;setPrefix('/generics');

    $mc-&gt;get('/', "listar");

    $mc-&gt;get('/{id:[0-9a-z]+}', "get");

    $mc-&gt;post('/', "nuevo");

    $mc-&gt;put('/{id:[0-9a-z]+}', "modificar");

    $mc-&gt;delete('/{id:[0-9a-z]+}', "eliminar");

    $this-&gt;app-&gt;mount($mc);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="27105" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="27105" data-cf-modified-9b9f5272cbf495de1c3b1cbc-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="9605" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>