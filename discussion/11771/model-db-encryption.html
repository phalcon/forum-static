---
layout: default
title: 'Model &amp; db encryption - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Model &amp; db encryption</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/3151/sboudoux" class="user-moderator-N"><span itemprop="name">stephane</span></a></span>
            <time itemprop="dateCreated" datetime="2016-06-09T09:45:03-07:00">Jun '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-06-09T09:45:03-07:00">Jun '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>705</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">2</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/076d8254b3d82407f201a00995d41c96?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/3151/sboudoux" class="user-moderator-N"><span itemprop="name">stephane</span></a></span>
                <span class="karma">24.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C11771" href="#C11771">
        <time class="action-date">Jun '16</time>
    </a>
</div>
<div class="post-content"><div><p>Hi all,</p>
<p>I want to encrypt a few columns containing personal information is my database (mysql).
I want that to be internal to mysql and not in php,  so I can still query it if needed (even if decrypting on the fly  makes it slower), so I was planning to use AES_ENCRYPT and AES_DECRYPT. </p>
<p>Nothing crazy so far, taht's fairly standard, my question is how to make my models manage that ?
I'd like the models to  automatically  build queries (select + insert + update) managing the encryption for me.</p>
<p>For example: instead of executing:</p>
<pre><code class="language-php">SELECT myEncryptedColumn FROM myTable;
--&gt;   SELECT AES_DECRYPT(myEncryptedColumn, "myKey")  FROM myTable ;

INSERT INTO myTable (myEncryptedColumn)  VALUES  (value);
--&gt;   INSERT INTO myTable (myEncryptedColumn)  VALUES  (AES_ENCRYPT(value, "myKey"));</code></pre>
<p>Is there anything in phalcon for that, or do I have to overwrite all the models methods myself ?
Cheers</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C35253" href="#C35253">
                <time itemprop="dateCreated" datetime="2016-06-09T15:31:36-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I doubt this can be done via ORM/Models, since that function is rather specific to a certain RDBMS engine, in this case MySQL.
IMHO, your best shot would be to extend DB dialect and try to handle it there.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35253" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35253" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/076d8254b3d82407f201a00995d41c96?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3151/sboudoux" class="user-moderator-N"><span itemprop="name">stephane</span></a>        </span>
        <br>

        <span class="karma">24.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C35255" href="#C35255">
                <time itemprop="dateCreated" datetime="2016-06-09T16:28:10-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks.</p>
<p>I was kinda expecting something like that, your answer totally make sense...
Since there are some partials solutions in other frameworks/ORMs, I wanted to ask anyway.  I was hoping someone had the same issue in the past, had alreay worked on it, and had some reusable code to share :)</p>
<p>Since I'm planning to encrypt columns from only 1 table, I probably won't go for a generic &amp; extendable solution, I'll just create custom methods &amp; queries in this specif model.   (Unless someone shares some code here by then ;)   )</p>
<p>Cheers</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35255" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35255" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/97cfdb3586f82c3e1e4fe562bda688b8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/571/duythien" class="user-moderator-Y"><span itemprop="name">Thien Tran</span></a>        </span>
        <br>

        <span class="karma">58.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C35257" href="#C35257">
                <time itemprop="dateCreated" datetime="2016-06-09T18:18:49-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hello</p>
<p>Why you not use <a href="https://docs.phalcon.io/en/latest/reference/crypt.html">https://docs.phalcon.io/en/latest/reference/crypt.html</a> to encrypt I think it good for solution</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35257" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35257" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/076d8254b3d82407f201a00995d41c96?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3151/sboudoux" class="user-moderator-N"><span itemprop="name">stephane</span></a>        </span>
        <br>

        <span class="karma">24.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C35261" href="#C35261">
                <time itemprop="dateCreated" datetime="2016-06-10T01:47:41-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I don't have anything against Phalcon crypt, or PHP encryption in general,  but doing it on the app side creates other difficulties.
I'd rather have that fully manage by the db engine if possible.</p>
<p>For instance, since I want to be able to decrypt on the fly while making queries (not talking about password here, it's just encryption-at-rest for some personal data), I would need to choose and maintain an encryption format that mysql support and can decrypt.</p>
<p>That's a scary move because the day I change either PHP or mysql version, the supported encryption formats  may change...
I know chances are low, but if that ever happens, I can expect a tricky maintenance in which I'll have to update the app encryption mechanism and decrypt and re-encrypt all my records in the db...</p>
<p>Doable, but I'd be happier with less risky solution.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35261" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35261" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="35265" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '16</span>
              </span><br/><a name="C35265" href="#C35265">
                <time itemprop="dateCreated" datetime="2016-06-10T02:03:23-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I agree with you. This task should be handled on RDBMS level.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35265" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35265" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/076d8254b3d82407f201a00995d41c96?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3151/sboudoux" class="user-moderator-N"><span itemprop="name">stephane</span></a>        </span>
        <br>

        <span class="karma">24.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C35285" href="#C35285">
                <time itemprop="dateCreated" datetime="2016-06-10T07:44:32-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Does anyone know if there's any plan for Phalcon team to bring that feature at some point ?</p>
<p>Because it would be a shame performance &amp; complexity wise to extend in php  all the class required to make the encryption transparent so it works with model relations and joined tables...  (I guess dialect, querybuilder, pdo/mysql, model maybe ... )</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35285" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35285" data-cf-modified-a2c65ae95d37c1dfaaa5cba1-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="11771" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>