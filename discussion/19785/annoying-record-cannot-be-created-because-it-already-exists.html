---
layout: default
title: 'Annoying &quot;Record cannot be created because it already exists&quot; - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Annoying &quot;Record cannot be created because it already exists&quot;</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/1320/tztztztz" class="user-moderator-N"><span itemprop="name">Tomasz Zadora</span></a></span>
            <time itemprop="dateCreated" datetime="2019-06-23T19:45:23-07:00">Jun '19</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2019-06-23T19:45:23-07:00">Jun '19</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '19</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>274</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/07dedd51671291aca4f3f84a115c534e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/1320/tztztztz" class="user-moderator-N"><span itemprop="name">Tomasz Zadora</span></a></span>
                <span class="karma">10.4k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C19785" href="#C19785">
        <time class="action-date">Jun '19</time>
    </a>
</div>
<div class="post-content"><div><p>Hello,</p>
<p>I want to do quick import between databases, i've created service in DI for database im reading from. Before executing code below im doing TRUNCATE on local SQL table.</p>
<pre><code>$entity-&gt;setReadConnectionService( 'service_for_reading' );
$cursor = $entity-&gt;find();
foreach ($cursor as $row) {
    $row-&gt;create();
}</code></pre>
<p>And im getting &quot;Record cannot be created because it already exists&quot;.</p>
<p>Doing this doesn't help either:</p>
<pre><code>foreach ($cursor as $row) {
    $newEntity = new \EntityClass();
    $newEntity-&gt;create( $row-&gt;toArray() );
}</code></pre>
<p>ORM should recognise that read and write connections are diffrent before checking if record already exists, or there should be way to switch this checking off.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="60153" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '19</span>
              </span><br/><a name="C60153" href="#C60153">
                <time itemprop="dateCreated" datetime="2019-06-24T01:15:08-07:00" class="action-date">Jun '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>ORM should recognise that read and write connections are diffrent before checking if record already exists</p>
</blockquote>
<p>From the looks of it, you are trying to implement a DB replication logic from scratch, which the ORM was never designed to handle.</p>
<p>The reason we can specify read/write connection is because of DB replication like Galera</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="60153" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="60153" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/07dedd51671291aca4f3f84a115c534e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1320/tztztztz" class="user-moderator-N"><span itemprop="name">Tomasz Zadora</span></a>        </span>
        <br>

        <span class="karma">10.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C60161" href="#C60161">
                <time itemprop="dateCreated" datetime="2019-06-24T12:41:48-07:00" class="action-date">Jun '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I just need to disable that checking if record already exists, is that possible trough Model configuration?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="60161" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="60161" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="60167" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '19</span>
              </span><br/><a name="C60167" href="#C60167">
                <time itemprop="dateCreated" datetime="2019-06-25T04:30:45-07:00" class="action-date">Jun '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://github.com/phalcon/cphalcon/blob/master/phalcon/Mvc/Model.zep#L951">https://github.com/phalcon/cphalcon/blob/master/phalcon/Mvc/Model.zep#L951</a></p>
<p>You could override the <code>create</code> method:</p>
<pre><code class="language-php">class MyBaseModel extends \Phalcon\Mvc\Model
{
    public function create()
    {
        if($this-&gt;_exists($this-&gt;getModelsMetaData(), $this-&gt;getWriteConnection())) {
            // generate error
            return false;
        }
        return $this-&gt;save();
    }
}</code></pre>
<p>But it's an antipattern, since you could have a protocol write-only connection from which you cannot read at all.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="60167" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="60167" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/07dedd51671291aca4f3f84a115c534e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1320/tztztztz" class="user-moderator-N"><span itemprop="name">Tomasz Zadora</span></a>        </span>
        <br>

        <span class="karma">10.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C60169" href="#C60169">
                <time itemprop="dateCreated" datetime="2019-06-25T06:13:33-07:00" class="action-date">Jun '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks, i'll try. </p>
<p>I need just find a proper way to distinguish between normal operations and import.</p>
<p>Or I'll just do it like that:</p>
<pre><code>class MyBaseModelForImport extends MyBaseModel</code></pre>
<p>In MyBaseModelForImport I'll just overrid the create() method and that model will be used for import only.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="60169" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="60169" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/07dedd51671291aca4f3f84a115c534e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1320/tztztztz" class="user-moderator-N"><span itemprop="name">Tomasz Zadora</span></a>        </span>
        <br>

        <span class="karma">10.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="60171" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '19</span>
              </span><br/><a name="C60171" href="#C60171">
                <time itemprop="dateCreated" datetime="2019-06-25T08:14:57-07:00" class="action-date">Jun '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Regarding <a href="https://github.com/phalcon/cphalcon/blob/master/phalcon/Mvc/Model.zep#L951">https://github.com/phalcon/cphalcon/blob/master/phalcon/Mvc/Model.zep#L951</a> </p>
<p>there is still problem here in save method:</p>
<pre><code>let exists = this-&gt;_exists(metaData, readConnection, table);

        if exists {
            let this-&gt;operationMade = self::OP_UPDATE;
        } else {
            let this-&gt;operationMade = self::OP_CREATE;
        }</code></pre>
<p>so I rather need to override _exists method than create, anyway thanks for pointing me way to do it.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="60171" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="60171" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C60173" href="#C60173">
                <time itemprop="dateCreated" datetime="2019-06-25T13:01:11-07:00" class="action-date">Jun '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I know this is already marked as solved, but from what you've explained, writing code for this seems unnecessary.</p>
<p>Is the table structure the same between databasese?  Why not just do an export from 1 database, then import into the other?  Or a simple plain SQL statement:</p>
<pre><code class="language-sql">INSERT INTO newdatabase.newtable SELECT * FROM olddatabase.oldtable</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="60173" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="60173" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/07dedd51671291aca4f3f84a115c534e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1320/tztztztz" class="user-moderator-N"><span itemprop="name">Tomasz Zadora</span></a>        </span>
        <br>

        <span class="karma">10.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="60177" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '19</span>
              </span><br/><a name="C60177" href="#C60177">
                <time itemprop="dateCreated" datetime="2019-06-25T14:26:37-07:00" class="action-date">Jun '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes it's the same structure, but databases are on different machines. There is probably some way to do it by one SQL command, but I just needed quick solution for few tables, to use from time-to-time, not some complex system. But it must be done from www page by clicking link not by executing command at server console. Anyway it's working (I did it in even other way bu it doesnt matter) so I will not change it now.</p>
<p>Another thing is: doing it in plain SQL forbids any processing rows in PHP before importing, </p>
<p>BTW That checking if record already exists was problematic for me in few other cases. Framework creators should seriously consider option for switching it off (default on of course). That option could just change behavior of _exist method so it would return always false</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="60177" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="60177" data-cf-modified-e88ae2abe5d75853455fc8e0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="19785" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>