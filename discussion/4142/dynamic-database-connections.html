---
layout: default
title: 'Dynamic database connections - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Dynamic database connections</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/2458/armonb" class="user-moderator-N"><span itemprop="name">armonb</span></a></span>
            <time itemprop="dateCreated" datetime="2014-11-30T13:41:30-07:00">Nov '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-11-30T13:41:30-07:00">Nov '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '19</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>1155</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img  src="https://secure.gravatar.com/avatar/dbee4872e49b9331f0a2634e30e4f66a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/2458/armonb" class="user-moderator-N"><span itemprop="name">armonb</span></a></span>
                <span class="karma">4.6k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C4142" href="#C4142">
        <time class="action-date">Nov '14</time>
    </a>
</div>
<div class="post-content"><div><p>Is it possible with Phalcon to register a database connection based on the logged in user.</p>
<p>E.g. System will host multiple accounts, each account will have its own database. </p>
<p>All users credentials are saved in the main database, user logs in via main database, once logged in, their account specific database credentials should be loaded for the secondary connection.</p>
<p>So in essence, I guess I am looking for a way to register the database service from a controller?</p>
<p>I hope this is clear. Any help would be appreciated, thanks.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-51bcaff675958bfda38d07bb-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-51bcaff675958bfda38d07bb-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/ef35769757b23a982de5d30846530d40?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/768/iamtartan" class="user-moderator-N"><span itemprop="name">Aboozar Ghaffari</span></a>        </span>
        <br>

        <span class="karma">10.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C13791" href="#C13791">
                <time itemprop="dateCreated" datetime="2014-11-30T14:22:13-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You could use multiple db functionality. One db as your main db and the second one based on logged user.
the only thing that you should handle is initializing the second DB connection after user successful login and assigne it to your app DI.
I thinks it's the best solution for your case</p>
<p>for more information see <a href="https://docs.phalcon.io/en/latest/reference/models.html#setting-multiple-databases">official documentation</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13791" data-cf-modified-51bcaff675958bfda38d07bb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13791" data-cf-modified-51bcaff675958bfda38d07bb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/dbee4872e49b9331f0a2634e30e4f66a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2458/armonb" class="user-moderator-N"><span itemprop="name">armonb</span></a>        </span>
        <br>

        <span class="karma">4.6k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C13791"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img  src="https://secure.gravatar.com/avatar/ef35769757b23a982de5d30846530d40?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Aboozar Ghaffari                    </a>
                </div><div class="posts-buttons" align="right"><a name="C13825" href="#C13825">
                <time itemprop="dateCreated" datetime="2014-12-01T09:22:24-07:00" class="action-date">Dec '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>You could use multiple db functionality. One db as your main db and the second one based on logged user.
the only thing that you should handle is initializing the second DB connection after user successful login and assigne it to your app DI.
I thinks it's the best solution for your case</p>
<p>for more information see <a href="https://docs.phalcon.io/en/latest/reference/models.html#setting-multiple-databases">official documentation</a></p>
</blockquote>
<p>Hi Aboozar,
Thanks for your comment, I have previously read that documentation but cannot work out how to implement it in my scenario. Once the user has logged in, their account id is saved to the session, how can I add a new connection to the di after the services have already been registered in the module? As the module cannot read the session until it has fully loaded?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13825" data-cf-modified-51bcaff675958bfda38d07bb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13825" data-cf-modified-51bcaff675958bfda38d07bb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C13843" href="#C13843">
                <time itemprop="dateCreated" datetime="2014-12-02T13:49:25-07:00" class="action-date">Dec '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You can access the DI using:</p>
<pre><code class="language-php">Phalcon\DI::getDefault();</code></pre>
<p>So once the user has logged in, you might be able to do:</p>
<pre><code class="language-php">// assuming $db_username, $db_password, $db_db are all set:
Phalcon\DI::getDefault-&gt;setShared('user_db',function() use($db_username,$db_password,$db_db){
    // run whatever code you need to create the connection

    return $DatabaseConnection;
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13843" data-cf-modified-51bcaff675958bfda38d07bb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13843" data-cf-modified-51bcaff675958bfda38d07bb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/c7081054bb349024b4d0ed00e83ca6ff?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/13057/MarkMidrashim" class="user-moderator-N"><span itemprop="name">MarkMidrashim</span></a>        </span>
        <br>

        <span class="karma">180</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C61343" href="#C61343">
                <time itemprop="dateCreated" datetime="2019-11-15T12:45:53-07:00" class="action-date">Nov '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>i would like to know the same thing... I have the same problem
When i set the connection into DI, not applied in global context</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="61343" data-cf-modified-51bcaff675958bfda38d07bb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="61343" data-cf-modified-51bcaff675958bfda38d07bb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="4142" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>