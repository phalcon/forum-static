---
layout: default
title: 'Many to many - one record exists - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Many to many - one record exists</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/7573/garyrutland" class="user-moderator-N"><span itemprop="name">Gary Rutland</span></a></span>
            <time itemprop="dateCreated" datetime="2016-06-22T14:04:28-07:00">Jun '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-06-22T14:04:28-07:00">Jun '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>530</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/8ce8f55d2f81ac1f73df55eabacd3d9a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/7573/garyrutland" class="user-moderator-N"><span itemprop="name">Gary Rutland</span></a></span>
                <span class="karma">6.5k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C11907" href="#C11907">
        <time class="action-date">Jun '16</time>
    </a>
</div>
<div class="post-content"><div><p>Hi,</p>
<p>I haven't been able to find a nicer way to do this yet and don't think i'm trying to do anything rediculous.
My situation is that I have many users and many users can be linked to many objects and when viewing an object I would like to display certain objects if the link between them exists.</p>
<p>At the moment I have only been able to do it via the <code>__get</code> magic method like so:</p>
<pre><code>&lt;?php
$object-&gt;getUsers([
    'user_id = :user_id:'
    'bind' =&gt; [
        'user_id' =&gt; 1, //as an example
    ]
]);
$exists = $object-&gt;count() === 1;</code></pre>
<p>Is there a nicer way to do this?
Or at least get one record back instead of a record set?</p>
<p>Thanks,
Gary</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/3a303b625f8d3aa02e7b69d28a13870e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3945/christianallred" class="user-moderator-N"><span itemprop="name">Christian Allred</span></a>        </span>
        <br>

        <span class="karma">18.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C35907" href="#C35907">
                <time itemprop="dateCreated" datetime="2016-06-22T16:51:54-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You shouldn't have to pass in those paramets to the magic method if your models are defined right.</p>
<p><code>$object-&gt;getUsers();</code> shoudl be plently. Or even better yet you coudl alias the relationshit then its not a method you just access them via the alias. <code>$object-&gt;aliasUsers</code></p>
<p>that being said you are simply trying to determine if there exists a non 0 value? </p>
<p><code>count($object-&gt;aliasUsers) &gt; 0</code> or i suppose <code>$object-&gt;aliasUsers-&gt;count()</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35907" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35907" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/3a303b625f8d3aa02e7b69d28a13870e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3945/christianallred" class="user-moderator-N"><span itemprop="name">Christian Allred</span></a>        </span>
        <br>

        <span class="karma">18.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C35909" href="#C35909">
                <time itemprop="dateCreated" datetime="2016-06-22T16:53:29-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>quick follow up.. </p>
<p>you say you have a many to many relationship, but code</p>
<pre><code class="language-php">$object-&gt;getUsers([
    'user_id = :user_id:'
    'bind' =&gt; [
        'user_id' =&gt; 1, //as an example
    ]
]);</code></pre>
<p>would by definition only ever return 1 record...</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35909" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35909" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ce8f55d2f81ac1f73df55eabacd3d9a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7573/garyrutland" class="user-moderator-N"><span itemprop="name">Gary Rutland</span></a>        </span>
        <br>

        <span class="karma">6.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C35911" href="#C35911">
                <time itemprop="dateCreated" datetime="2016-06-22T23:36:43-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>It is a many-to-many relationship with the following setup:</p>
<pre><code>&lt;?php
// User model
$this-&gt;hasManyToMany('id', 'ObjectUser', 'user_id', 'object_id', 'Object', 'id', [
    'alias' =&gt; 'objects',
]);

// Object model
$this-&gt;hasManyToMany('id', 'ObjectUser', 'object_id', 'user_id', 'User', 'id', [
    'alias' =&gt; 'users',
]);

// ObjectUser model
$this-&gt;belongsTo('object_id', 'Object', 'id', [
    'alias' =&gt; 'object',
]);
$this-&gt;belongsTo('user_id', 'User', 'id', [
    'alias' =&gt; 'user',
]);</code></pre>
<p>So with that I can call:</p>
<pre><code>&lt;?php
$object-&gt;getUsers();</code></pre>
<p>But that returns me all users as <code>Phalcon\Mvc\Model\Resultset\Simple</code> and <code>count()</code> can be greater than one.
According to <a href="https://docs.phalcon.io/en/latest/reference/models.html#taking-advantage-of-relationships">https://docs.phalcon.io/en/latest/reference/models.html#taking-advantage-of-relationships</a> I can match on conditions:</p>
<pre><code>&lt;?php
// Or using bound parameters
$robotsParts = $robot-&gt;getRobotsParts(
  array(
    "created_at = :date:",
    "bind" =&gt; array(
        "date" =&gt; "2015-03-15"
    )
  )
);</code></pre>
<p>But that still returns a result set and I am left with using <code>count()</code>.</p>
<p>Gary</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35911" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35911" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ce8f55d2f81ac1f73df55eabacd3d9a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7573/garyrutland" class="user-moderator-N"><span itemprop="name">Gary Rutland</span></a>        </span>
        <br>

        <span class="karma">6.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C35923" href="#C35923">
                <time itemprop="dateCreated" datetime="2016-06-23T04:13:00-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The other option I can think of is using an ACL, but not sure how to make it object specific.
I guess I need to register the ACL as a shared service so I can make use of <code>isAllowed()</code> as at the moment it's within my security plugin.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35923" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35923" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/3a303b625f8d3aa02e7b69d28a13870e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3945/christianallred" class="user-moderator-N"><span itemprop="name">Christian Allred</span></a>        </span>
        <br>

        <span class="karma">18.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="35961" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '16</span>
              </span><br/><a name="C35961" href="#C35961">
                <time itemprop="dateCreated" datetime="2016-06-23T15:44:07-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I mean your implemenation works, but i would put it in the model method instead so you can call it form anywhere. Instantiating and ACL for this is super overkill.. and esentiall does the same exact thing but adds another play of unnecesarry complexity. </p>
<pre><code class="language-php">    public function canAccess($id){
        $ct = $this-&gt;getUsers([
        'conditions' =&gt; 'user_id = :user_id:',
        'bind' =&gt; [
            'user_id' =&gt; $id ]]);
        return ( count($ct) &gt; 0) ? true : false; // any non 0 value woudl mean your user has access in case your usersobjects table gets messy for whatever reason. 
    }</code></pre>
<p>Then wherever you are calling it from controller, helpers etc its available and consistant. </p>
<pre><code class="language-php">$object = Object::findFirstById( 10 );

$object-&gt;canAccess( 24 ); // user ID we are checking has access.</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35961" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35961" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ce8f55d2f81ac1f73df55eabacd3d9a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7573/garyrutland" class="user-moderator-N"><span itemprop="name">Gary Rutland</span></a>        </span>
        <br>

        <span class="karma">6.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C35995" href="#C35995">
                <time itemprop="dateCreated" datetime="2016-06-24T07:12:26-07:00" class="action-date">Jun '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yeah, this was something I was thinking of implementing but was just hoping there was a slightly nicer way of doing it.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="35995" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="35995" data-cf-modified-0b5a7375f2336a57ad41eb88-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="11907" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>