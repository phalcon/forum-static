---
layout: default
title: 'PDO connections non persistent &amp; not close - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">PDO connections non persistent &amp; not close</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a></span>
            <time itemprop="dateCreated" datetime="2016-09-07T03:22:31-07:00">Sep '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-09-07T03:22:31-07:00">Sep '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">16</span>
                </td>
                <td>
                    <label>Views</label><br>3394</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a></span>
                <span class="karma">5.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C13381" href="#C13381">
        <time class="action-date">Sep '16</time>
    </a>
</div>
<div class="post-content"><div><p>I think i have a problem with Phalcon framework </p>
<p>I have this class : </p>
<pre><code class="language-php">&lt;?php

class Testmysql extends \Phalcon\Db\Adapter\Pdo\Mysql {

    static $id = null;
    /**
    * Creates the Adapter
    */
  public function __construct(array $descriptor = NULL)
  {
      self::$id = uniqid(true);

      error_log(self::$id."\tMySQL::__construct()\n", 3, '/usr/share/nginx/html/test.log'); 

      return parent::__construct($descriptor);
  }

  /**
   * Connect
   */
  public function connect(array $descriptor = NULL)
  {
      error_log("MySQL::connect()\n", 3, '/usr/share/nginx/html/test.log');
      return parent::connect($descriptor);
  }

  /**
   * Close
   */
  public function close()
  {
      error_log(self::$id."\tMySQL::close()\n", 3, '/usr/share/nginx/html/test.log');
      return parent::close();
  }

}</code></pre>
<p>and this test script :</p>
<pre><code class="language-php">&lt;?php
require '../../public/_bootStrap.php';

$mysql_host = "localhost";
$mysql_user = "root";
$mysql_pass = "";

while(true) {

   $db = new Testmysql(["host"       =&gt; $mysql_host,
                        "username"   =&gt; $mysql_user,
                        "password"   =&gt; $mysql_pass,
                        "dbname"     =&gt; "db_test",
                        "persistent" =&gt; true,
                        "options"    =&gt; [],
    ]);
   echo ".";

   if($i++ &gt;= 100) {
    break;
   }
}</code></pre>
<p>In my log i have 200 lines :</p>
<pre><code>157cfe92d7447e  MySQL::__construct()
MySQL::connect()
157cfe92d744e6  MySQL::__construct()
MySQL::connect()</code></pre>
<p>So first problem : i don't have any close connection
Secondly : I set persistent connection but i have different connection each time ! </p>
<p>So ? What do you think ? </p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39851" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39851" href="#C39851">
                <time itemprop="dateCreated" datetime="2016-09-07T03:25:54-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You don't have to call <code>close()</code> explicitly as it is being called by the framework implicitly. <code>Phalcon automatically closes and destroys active connections when the request ends</code></p>
<p>If you want to take advantage of persistent DB connections, for MySQL you need to set this option in <code>options</code> flag:
<code>PDO::ATTR_PERSISTENT =&gt; 1</code></p>
<pre><code class="language-php"> $db = new Testmysql(["host"       =&gt; $mysql_host,
                        "username"   =&gt; $mysql_user,
                        "password"   =&gt; $mysql_pass,
                        "dbname"     =&gt; "db_test",
                        "persistent" =&gt; true,
                        "options"    =&gt; [\PDO::ATTR_PERSISTENT =&gt; 1],
    ]);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39851" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39851" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39851"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39853" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39853" href="#C39853">
                <time itemprop="dateCreated" datetime="2016-09-07T03:28:49-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>In syslog in production i have many (many many many : </p>
<pre><code>Sep  7 12:10:45 sd- mysqld: 2016-09-07 12:10:45 140069590919936 [Warning] Aborted connection 969 to db: 'db_test' user: 'root' host: 'localhost' (Unknown error)
Sep  7 12:10:45 sd- mysqld: 2016-09-07 12:10:45 140069658635008 [Warning] Aborted connection 899 to db: 'db_test' user: 'root' host: 'localhost' (Unknown error)</code></pre>
<p>50 time per seconds... and i think it's a problem with phalcon which don't close connection... </p>
<blockquote>
<p>You don't have to call <code>close()</code> explicitly as it is being called by the framework implicitly. <code>Phalcon automatically closes and destroys active connections when the request ends</code></p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39853" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39853" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39851"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><a name="C39855" href="#C39855">
                <time itemprop="dateCreated" datetime="2016-09-07T03:31:38-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>How can i be sure that's the same connection ?</p>
<blockquote>
<p>You don't have to call <code>close()</code> explicitly as it is being called by the framework implicitly. <code>Phalcon automatically closes and destroys active connections when the request ends</code></p>
<p>If you want to take advantage of persistent DB connections, for MySQL you need to set this option in <code>options</code> flag:
<code>PDO::ATTR_PERSISTENT =&gt; 1</code></p>
<pre><code class="language-php">$db = new Testmysql(["host"       =&gt; $mysql_host,
                       "username"   =&gt; $mysql_user,
                       "password"   =&gt; $mysql_pass,
                       "dbname"     =&gt; "db_test",
                       "persistent" =&gt; true,
                       "options"    =&gt; [\PDO::ATTR_PERSISTENT =&gt; 1],
   ]);</code></pre>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39855" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39855" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39857" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39857" href="#C39857">
                <time itemprop="dateCreated" datetime="2016-09-07T03:36:08-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You need to take into account following:</p>
<ul>
<li>set your DB as shared service <code>$di-&gt;setShared("db", function () use ($config)....</code></li>
<li>set <code>PDO::ATTR_PERSISTENT</code> to true</li>
</ul>
<p>Then in your app:</p>
<ul>
<li>put some <code>sleep()</code> on your app so you can catch the result more easily</li>
<li>on your remote DB server watch for TCP connections, you'll see that one bound port to MySQL server is kept open (ESTABLISHED state)</li>
</ul>
<p>repeat - run your app again, ESTABLISHED connection on a remote DB server will be the same.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39857" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39857" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39857"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39865" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39865" href="#C39865">
                <time itemprop="dateCreated" datetime="2016-09-07T05:33:25-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>actually i have :</p>
<pre><code class="language-php">$di = new FactoryDefault();

$di-&gt;set('db', function() {

        $mysql_host = "localhost";
        $mysql_user = "root";
        $mysql_pass = "";

    $db = new PdoMysql(["host"       =&gt; $mysql_host,
                        "username"   =&gt; $mysql_user,
                        "password"   =&gt; $mysql_pass,
                        "dbname"     =&gt; "db_test",
                        "persistent" =&gt; true,
                        "options"    =&gt; [
                            \PDO::ATTR_PERSISTENT =&gt; 1
                        ],
    ]);

    return $db;
});</code></pre>
<p>is it ok ? </p>
<p>Actually i have ~1000 lines like this :</p>
<pre><code>unix  2      [ ACC ]     STREAM     LISTENING     1045901395 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107952948 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107612012 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107471100 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107436320 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107411964 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107978977 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107876398 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107872218 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107786653 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107544531 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107528842 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107734772 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107899936 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107709578 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107697844 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107460006 16007/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1107501505 16007/mysqld        /var/run/mysqld/mysqld.sock
...</code></pre>
<blockquote>
<p>You need to take into account following:</p>
<ul>
<li>set your DB as shared service <code>$di-&gt;setShared("db", function () use ($config)....</code></li>
<li>set <code>PDO::ATTR_PERSISTENT</code> to true</li>
</ul>
<p>Then in your app:</p>
<ul>
<li>put some <code>sleep()</code> on your app so you can catch the result more easily</li>
<li>on your remote DB server watch for TCP connections, you'll see that one bound port to MySQL server is kept open (ESTABLISHED state)</li>
</ul>
<p>repeat - run your app again, ESTABLISHED connection on a remote DB server will be the same.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39865" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39865" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39867" href="#C39867">
                <time itemprop="dateCreated" datetime="2016-09-07T05:51:04-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Your both DB server and APP server reside on the same machine. So in case of using localhost as your PDO hostname / constructor param, you'll connect always through local UNIX domain socket, i.e. <code>/var/run/mysqld/mysqld.sock</code>.
You should restart your DB, and then check for active connections.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39867" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39867" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39867"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39869" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39869" href="#C39869">
                <time itemprop="dateCreated" datetime="2016-09-07T05:55:08-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>even if i restart my database i have the same problem... (~1000 lines of « unix  3      [ ]         STREAM     CONNECTED     1119175450 19957/mysqld        /var/run/mysqld/mysqld.sock » ) </p>
<p>server version : Server version: 10.1.12-MariaDB-1~trusty mariadb.org binary distribution</p>
<pre><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="64160b0b10241700">[email&#160;protected]</a>:/usr/share/nginx/html/#netstat -anp | grep mysql 
tcp        0      0 0.0.0.0:4567            0.0.0.0:*               LISTEN      19957/mysqld    
tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      19957/mysqld    
tcp        0      0 10.0.0.1:65266      10.0.0.2:4567       ESTABLISHED 19957/mysqld    
unix  2      [ ACC ]     STREAM     LISTENING     1119137947 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1120798773 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1121058760 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1121006534 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1120942686 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1120926831 19957/mysqld        /var/run/mysqld/mysqld.sock
....</code></pre>
<blockquote>
<p>Your both DB server and APP server reside on the same machine. So in case of using localhost as your PDO hostname / constructor param, you'll connect always through local UNIX domain socket, i.e. <code>/var/run/mysqld/mysqld.sock</code>.
You should restart your DB, and then check for active connections.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39869" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39869" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39871" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39871" href="#C39871">
                <time itemprop="dateCreated" datetime="2016-09-07T06:06:59-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>To watch live MySQL opened connections through UNIX socket, run (as root):</p>
<p><code>watch -n1 "netstat -np | grep -i mysqld"</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39871" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39871" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39871"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39873" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39873" href="#C39873">
                <time itemprop="dateCreated" datetime="2016-09-07T06:12:57-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes ok, but i have many many connections ... </p>
<pre><code>tcp        0      0 10.0.0.1:65266      10.0.0.2:4567       ESTABLISHED 19957/mysqld
unix  3      [ ]         STREAM     CONNECTED     1128931262 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1128854224 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1128804375 19957/mysqld        /var/run/mysqld/mysqld.sock
...</code></pre>
<blockquote>
<p>To watch live MySQL opened connections through UNIX socket, run (as root):</p>
<p><code>watch -n1 "netstat -np | grep -i mysqld"</code></p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39873" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39873" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39877" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39877" href="#C39877">
                <time itemprop="dateCreated" datetime="2016-09-07T07:02:19-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You probabbly have many dead/broken connections.</p>
<p>I just compiled this shell one line script to check both TCP and UNIX socket MySQL connections which are in active state:</p>
<p><code>ss -nt4 | grep -i "estab.*:3306"; sudo netstat -np | grep -i "connect.*mysqld"</code></p>
<p>Result:</p>
<pre><code>ESTAB      0      0           192.168.200.200:3306       192.168.200.210:33988 
ESTAB      0      0           192.168.200.200:3306       192.168.200.210:33996 
unix  3      [ ]         STREAM     CONNECTED     1148777  1476/mysqld         /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1148778  1476/mysqld         /var/run/mysqld/mysqld.sock</code></pre>
<p>So I have 2 TCP connections opened, and 2 connections from the same machine through local UNIX domain socket :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39877" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39877" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39879" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39879" href="#C39879">
                <time itemprop="dateCreated" datetime="2016-09-07T07:05:32-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Watch it interactively: </p>
<p><code>watch -n1 @ ss -nt4 | grep -i "estab.*:3306"; sudo netstat -np | grep -i "connect.*mysqld" @</code></p>
<p>NOTE: change <code>@</code> to single quote (')</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39879" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39879" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39877"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39881" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39881" href="#C39881">
                <time itemprop="dateCreated" datetime="2016-09-07T07:07:21-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ok, but i have other result lol :</p>
<pre><code>ESTAB      0      0             xx.xx.xx.xx:443         xx.xx.xx.xx:3306  
unix  3      [ ]         STREAM     CONNECTED     1158082023 -                   /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1158076519 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1157916691 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1157658709 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1157413697 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1157939256 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1157655739 19957/mysqld        /var/run/mysqld/mysqld.sock
unix  3      [ ]         STREAM     CONNECTED     1157643512 19957/mysqld        /var/run/mysqld/mysqld.sock
... ~1000 same lines</code></pre>
<p>each time i call my index.php new connection created. Not reused... </p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39881" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39881" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39883" href="#C39883">
                <time itemprop="dateCreated" datetime="2016-09-07T07:38:33-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>First row from your result is there by coincidence, i.e. it is not MySQL TCP connection from remote host to local machine. </p>
<p>You have many UNIX sockets, that's not good as you must be doing something wrong. Or it might be there are other users of your app who are using same app?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39883" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39883" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39883"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><a name="C39885" href="#C39885">
                <time itemprop="dateCreated" datetime="2016-09-07T07:46:35-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>i have PHP-FPM and index.php</p>
<p>each time one visitor go to index.php i have one mysql query : </p>
<pre><code class="language-php">$mysql_conn   = $app-&gt;getDi()-&gt;getShared('db');
        $query = "select column
                  from table
                  where column = x";

        $var  = $mysql_conn-&gt;fetchColumn($query, ['x' =&gt; $params['x'] ]);</code></pre>
<p>that's all...</p>
<blockquote>
<p>First row from your result is there by coincidence, i.e. it is not MySQL TCP connection from remote host to local machine. </p>
<p>You have many UNIX sockets, that's not good as you must be doing something wrong. Or it might be there are other users of your app who are using same app?</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39885" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39885" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39887" href="#C39887">
                <time itemprop="dateCreated" datetime="2016-09-07T08:11:50-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ok my problem is fixed if i disabled persistent connection ( persistent =&gt; true &amp; PDO::ATTR_PERSISTENT =&gt; 0 )</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39887" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39887" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39889" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39889" href="#C39889">
                <time itemprop="dateCreated" datetime="2016-09-07T08:12:31-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>That's not a fix, since you actually wanted to use persistent DB connections?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39889" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39889" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39889"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39891" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39891" href="#C39891">
                <time itemprop="dateCreated" datetime="2016-09-07T08:22:47-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>yes, cause i have 1000 hits / sec on my index. this index do one simple mysql query. so i thinked that if i used persistent connection i will not have 1000 connections / sec. it's why i have defined persistent =&gt; true in my code. But now, if i disabled persistent connection, when i check connections list with netstat, i have ~4/5 socket unix opened, instead of 1000 before. and in my syslog i have no error about aborted connection... </p>
<p>i don't understand why but my problem it solved if i disabled persistent connection in my app code. </p>
<blockquote>
<p>That's not a fix, since you actually wanted to use persistent DB connections?</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39891" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39891" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39893" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39893" href="#C39893">
                <time itemprop="dateCreated" datetime="2016-09-07T08:24:03-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Option to \Phalcon\Db\Adapter constructor &quot;persistent&quot; =&gt; true have no meaning at all, it's not supported that way.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39893" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39893" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39893"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39895" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39895" href="#C39895">
                <time itemprop="dateCreated" datetime="2016-09-07T08:25:14-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>it's not right... if i defined only persistent =&gt; true in my constructor, i have many errors about aborted connections. if i remove it, i have no error in log, so it inevitably changes something... </p>
<blockquote>
<p>Option to \Phalcon\Db\Adapter constructor &quot;persistent&quot; =&gt; true have no meaning at all, it's not supported that way.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39895" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39895" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39897" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39897" href="#C39897">
                <time itemprop="dateCreated" datetime="2016-09-07T08:27:34-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Correct.
I failed to check all of the classes xD
Here it is: <a href="https://github.com/phalcon/cphalcon/blob/master/phalcon/db/adapter/pdo.zep#L130">https://github.com/phalcon/cphalcon/blob/master/phalcon/db/adapter/pdo.zep#L130</a></p>
<p>So it will set PDO option <code>\Pdo::ATTR_PERSISTENT] = true;</code> for you, great.</p>
<p>In general:</p>
<blockquote>
<p>Many web applications will benefit from making persistent connections to database servers. Persistent connections are not closed at the end of the script, but are cached and re-used when another script requests a connection using the same credentials.
The persistent connection cache allows you to avoid the overhead of establishing a new connection every time a script needs to talk to a database, resulting in a faster web application.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39897" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39897" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39897"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39899" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39899" href="#C39899">
                <time itemprop="dateCreated" datetime="2016-09-07T08:29:44-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>trust me :</p>
<p>if i comment  the line :</p>
<pre><code class="language-php">'persistent' =&gt; true</code></pre>
<p>i have no error, if i uncomment the line i have errors. </p>
<pre><code class="language-bash">aptitude show php5-phalcon 
Package: php5-phalcon                    
State: installed
Automatically installed: no
Version: 3.0.0-build10-ppa1~trusty</code></pre>
<p>I have 1000 hits per seconds on my app code index, so i thinked that persistent connection can help me... </p>
<blockquote>
<p>There's no treatment of such option anywhere in Zephir code.
Which version of PhalconPHP do you say you run? 2.0.x or 3.0.x?</p>
<p>In general:</p>
<blockquote>
<p>Many web applications will benefit from making persistent connections to database servers. Persistent connections are not closed at the end of the script, but are cached and re-used when another script requests a connection using the same credentials.
The persistent connection cache allows you to avoid the overhead of establishing a new connection every time a script needs to talk to a database, resulting in a faster web application.</p>
</blockquote>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39899" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39899" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39903" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39903" href="#C39903">
                <time itemprop="dateCreated" datetime="2016-09-07T08:53:33-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I just set <code>persistent</code> flag on my app.</p>
<p>I have a total of 4 TCP connections established between my app &amp; db server (both residing on a dedicated VMs).</p>
<pre><code>ESTAB      0      0           192.168.200.204:3306       192.168.200.201:42048
ESTAB      0      0           192.168.200.204:3306       192.168.200.201:42046
ESTAB      0      0           192.168.200.204:3306       192.168.200.201:42050
ESTAB      0      0           192.168.200.204:3306       192.168.200.201:42049
unix  3      [ ]         STREAM     CONNECTED     1512417  58594/mysqld        /var/run/mysqld/mysqld.sock</code></pre>
<p>Each time another user hits the app, it will reuse connection from this 'pool'.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39903" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39903" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39903"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><a name="C39905" href="#C39905">
                <time itemprop="dateCreated" datetime="2016-09-07T08:54:57-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>ok, so why only 4 connections ? is it a variable in your configuration ?</p>
<blockquote>
<p>I just set <code>persistent</code> flag on my app.</p>
<p>I have a total of 4 TCP connections established between my app &amp; db server (both residing a dedicated VMs).</p>
<pre><code>ESTAB      0      0           192.168.200.204:3306       192.168.200.201:42048
ESTAB      0      0           192.168.200.204:3306       192.168.200.201:42046
ESTAB      0      0           192.168.200.204:3306       192.168.200.201:42050
ESTAB      0      0           192.168.200.204:3306       192.168.200.201:42049
unix  3      [ ]         STREAM     CONNECTED     1512417  58594/mysqld        /var/run/mysqld/mysqld.sock</code></pre>
<p>Each time another user hits the app, it will reuse connection from this 'pool'.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39905" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39905" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39907" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39907" href="#C39907">
                <time itemprop="dateCreated" datetime="2016-09-07T09:16:30-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I guess because 4 php-fpm processes ? Persistent connection means it will reuse connection, but obviously one php-fpm can connect only once.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39907" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39907" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39909" href="#C39909">
                <time itemprop="dateCreated" datetime="2016-09-07T10:18:36-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Exactly. Worker processes are set to <code>auto</code>, so now there are 3 connections from app to db server.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39909" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39909" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/12939067310c1b9d7ac687d2673ac2fb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/6847/tembem" class="user-moderator-N"><span itemprop="name">Jimmy Chandra</span></a>        </span>
        <br>

        <span class="karma">1.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39921" href="#C39921">
                <time itemprop="dateCreated" datetime="2016-09-07T18:36:08-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Maybe a little bit out of topic. Just curious. Can I use 'persistent' =&gt; true for PostgreSql database as well?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39921" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39921" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39907"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Wojciech Ślawski                    </a>
                </div><div class="posts-buttons" align="right"><a name="C39925" href="#C39925">
                <time itemprop="dateCreated" datetime="2016-09-08T02:23:57-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ok, so now i understood : </p>
<p>In my php fpm configuration i have :</p>
<pre><code class="language-bash">pm.process_idle_timeout=10s
pm.max_requests=50</code></pre>
<p>So when php-fpm process was created, one persistent connection was created too, but after 50 requests, php-fpm process was kill and also connection → aborted connection on persistent connection. </p>
<blockquote>
<p>I guess because 4 php-fpm processes ? Persistent connection means it will reuse connection, but obviously one php-fpm can connect only once.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39925" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39925" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39921"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/12939067310c1b9d7ac687d2673ac2fb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jimmy Chandra                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39927" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C39927" href="#C39927">
                <time itemprop="dateCreated" datetime="2016-09-08T02:35:46-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes you can, as long as the underlying RDBMS supports such feature. I guess PostgreSQL does.
This option is defined on PDO/Adapter level, so it's database type agnostic.</p>
<blockquote>
<p>Maybe a little bit out of topic. Just curious. Can I use 'persistent' =&gt; true for PostgreSql database as well?</p>
</blockquote>
<p><a href="https://forum.phalcon.io/user/0/Ange7">@Ange7</a>: <code>pm.process_idle_timeout</code> is used only when pm is set to 'ondemand', are you sure you have this setting enabled instead of 'dynamic'?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39927" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39927" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1d8807928d11753af2ac21c54c66c005?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/5693/Ange7" class="user-moderator-N"><span itemprop="name">Alexandre</span></a>        </span>
        <br>

        <span class="karma">5.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39927"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><a name="C39929" href="#C39929">
                <time itemprop="dateCreated" datetime="2016-09-08T02:47:43-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes, i'm « ondemand »</p>
<blockquote>
<p>Yes you can, as long as the underlying RDBMS supports such feature. I guess PostgreSQL does.
This option is defined on PDO/Adapter level, so it's database type agnostic.</p>
<blockquote>
<p>Maybe a little bit out of topic. Just curious. Can I use 'persistent' =&gt; true for PostgreSql database as well?</p>
</blockquote>
<p><a href="https://forum.phalcon.io/user/0/Ange7">@Ange7</a>: <code>pm.process_idle_timeout</code> is used only when pm is set to 'ondemand', are you sure you have this setting enabled instead of 'dynamic'?</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39929" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39929" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39939" href="#C39939">
                <time itemprop="dateCreated" datetime="2016-09-08T04:23:05-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>In that scenario / worker mode, it's hard to re-use peristent database connections I'm afraid.
For my setup it's working fine, even through there's only a tiny benefit of doing it if you use localhost i.e. UNIX domain socket for MySQL (both app &amp; db server on the same machine) where overhead is negligible.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39939" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39939" data-cf-modified-22bb74c411eb9bdd22a4c40d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="13381" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>