---
layout: default
title: 'Why properties of Models are lost? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Why properties of Models are lost?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/581/b-viguier" class="user-moderator-N"><span itemprop="name">Benoit</span></a></span>
            <time itemprop="dateCreated" datetime="2013-09-25T08:14:50-07:00">Sep '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-09-25T08:14:50-07:00">Sep '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>1943</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img  src="https://secure.gravatar.com/avatar/914ec0c15efa4b4808a13f124cb5eed7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/581/b-viguier" class="user-moderator-N"><span itemprop="name">Benoit</span></a></span>
                <span class="karma">1.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C945" href="#C945">
        <time class="action-date">Sep '13</time>
    </a>
</div>
<div class="post-content"><div><p>Hi everyone,
I am using Phalcon's ORM quite intensively these days, and I have some problems with my properties.
I create a model class, derivating from \Phalcon\Mvc\Model, all is working fine.</p>
<pre><code class="language-php">class Test extends \Phalcon\Mvc\Model {
  // ...
  private $myProperty;
}</code></pre>
<p>But if I modify $myProperty on a particlar instance of Test, I lose its value in some function (especially during validation). Is there a special reason for this behaviour?</p>
<p>In the same way, if I have a ResultSet, I cannot iterate on it and modify $myProperty, since accessors (iterators-like) perform a copy of the object (no a clone). Is it &quot;by design&quot;?</p>
<p>Thanks! :)</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-8412e07d614b2d04fdf1b201-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-8412e07d614b2d04fdf1b201-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3605" href="#C3605">
                <time itemprop="dateCreated" datetime="2013-09-25T08:30:53-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Can you post the code where you're modifying the property and then is lost?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3605" data-cf-modified-8412e07d614b2d04fdf1b201-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3605" data-cf-modified-8412e07d614b2d04fdf1b201-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/914ec0c15efa4b4808a13f124cb5eed7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/581/b-viguier" class="user-moderator-N"><span itemprop="name">Benoit</span></a>        </span>
        <br>

        <span class="karma">1.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3608" href="#C3608">
                <time itemprop="dateCreated" datetime="2013-09-25T13:23:32-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes, I know, it would be better to post the code in the first message.... ;)</p>
<p>About ResultSet:</p>
<pre><code class="language-php">class MyModel extends \Phalcon\Mvc\Model {
    public $myProperty = 'hello';
}
//...
$all =MyModel::find();
foreach($all as $m){
    $m-&gt;myProperty= 'World'; //A clone is modified
    echo $m-&gt;myProperty, "&lt;BR/&gt;";
}
foreach($all as $m){
    echo $m-&gt;myProperty, "&lt;BR/&gt;"; //Still display the 'hello' value
}</code></pre>
<p>I understand that a clone is done, but it can be annoying since normally objects are passed by reference (by default) in Php5</p>
<p>About property change during validation, it is a mistake... I made some rapid conclusions according to the situation above. So here the real question:</p>
<pre><code class="language-php">$myModel-&gt;appendMessage(new Phalcon\Mvc\Model\Message("Hello World"));;
foreach($myModel-&gt;getMessages() as $msg){
    echo $msg,"&lt;BR/&gt;"; //The message is displayed
}
$myModel-&gt;create(); //This statement seems to empty the current message queue
foreach($myModel-&gt;getMessages() as $msg){
    echo $msg,"&lt;BR/&gt;"; //No message displayed!
}</code></pre>
<p>So, in fact it was not related to properties (sorry), but to the message queue that is cleaned before update/create operation. It's not a bad idea.... ;)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3608" data-cf-modified-8412e07d614b2d04fdf1b201-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3608" data-cf-modified-8412e07d614b2d04fdf1b201-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3615" href="#C3615">
                <time itemprop="dateCreated" datetime="2013-09-26T07:37:07-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Regarding the first part, when a resultset is traversed, only just one record is kept in memory, if you modify a record changes will lost, because the record is freed once it is not used anymore. This scheme is very efficient if you are traversing big resultsets, imagine if you have 10.000 records, keeping them in memory could easily use all available memory. If you still want this, you can add the records to an array, due to the reference counting, the object will not freed and you can re-use the records created.</p>
<pre><code class="language-php">$records = array();
$all = MyModel::find();
foreach ($all as $m) {
    $m-&gt;myProperty= 'World'; //A clone is modified
    echo $m-&gt;myProperty, "&lt;BR/&gt;";
    $records[] = $m;
}

foreach ($records as $m) {
    echo $m-&gt;myProperty, "&lt;BR/&gt;"; //changed value
}</code></pre>
<p>Secondly, the ORM clear all the messages when you call create/update/save, imagine if the ORM does not have this behavior:</p>
<pre><code class="language-php">if (!$myModel-&gt;create()) { //saving some records producing messages

    foreach ($myModel-&gt;getMessages() as $msg) {
        echo $msg, "&lt;BR/&gt;"; //No message displayed!
    }

    //fixing those messages
    $myModel-&gt;xx = "yy";

    $myModel-&gt;create();

    // since create does not clear messages you'll find messages
    // from the past create
    foreach ($myModel-&gt;getMessages() as $msg) {
        echo $msg, "&lt;BR/&gt;"; //No message displayed!
    }

}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3615" data-cf-modified-8412e07d614b2d04fdf1b201-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3615" data-cf-modified-8412e07d614b2d04fdf1b201-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/914ec0c15efa4b4808a13f124cb5eed7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/581/b-viguier" class="user-moderator-N"><span itemprop="name">Benoit</span></a>        </span>
        <br>

        <span class="karma">1.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3617" href="#C3617">
                <time itemprop="dateCreated" datetime="2013-09-26T07:51:12-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>About ResultSet, I forgot this 'detail', that only one record is kept in memory, so it is normal that my properties cannot be kept.
About messages, it is relevant too.</p>
<p>So, no more questions :)
Thank you very much for these explanations, and for your work!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3617" data-cf-modified-8412e07d614b2d04fdf1b201-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3617" data-cf-modified-8412e07d614b2d04fdf1b201-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="945" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>