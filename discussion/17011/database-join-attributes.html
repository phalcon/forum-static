---
layout: default
title: 'Database join attributes - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Database join attributes</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/9887/JABirchall" class="user-moderator-N"><span itemprop="name">Jake Birchall</span></a></span>
            <time itemprop="dateCreated" datetime="2017-09-28T15:49:32-07:00">Sep '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-09-28T15:49:32-07:00">Sep '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '20</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>444</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/dabaee32fe49d05f6aeb6226af284252?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/9887/JABirchall" class="user-moderator-N"><span itemprop="name">Jake Birchall</span></a></span>
                <span class="karma">8.2k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C17011" href="#C17011">
        <time class="action-date">Sep '17</time>
    </a>
</div>
<div class="post-content"><div><p>So, so I understand that phalcon doesnt handle joins like other framewoks. But I would still like to format my data like that for ease of development.</p>
<p>When querying for all the servers of a single user, Phalcon returns multiple of the same user for each server, I would like to format it so when I have 1 that user contains all the servers they have. Like so:</p>
<pre><code class="language-php">Object Users extends Phalcon\Mvc\Model (
  -&gt;id (public) = Numeric string (1) "1"
  -&gt;username (public) = String (5) "admin"
  -&gt;ip_address (public) = String (9) "127.0.0.1"
  -&gt;first_name (public) = String (3) "The"
  -&gt;last_name (public) = String (5) "Admin"
  -&gt;premium (public) = Numeric string (1) "1"
  -&gt;suspended (public) = Numeric string (1) "0"
  -&gt;suspension_expiry (public) = NULL
  -&gt;suspension_reason (public) = NULL
  -&gt;created_at (public) = String (19) "2017-09-26 21:47:20"
  -&gt;updated_at (public) = String (19) "2017-09-26 21:47:20"
  -&gt;servers (public) = Object Phalcon\Mvc\Model\Resultset\Complex extends Phalcon\Mvc\Model\Resultset (
    Object Servers extends Phalcon\Mvc\Model (
      -&gt;id (public) = Numeric string (1) "1"
      -&gt;owned_by (public) = Numeric string (1) "1"
      -&gt;posted_by (public) = Numeric string (1) "2"
      -&gt;type (public) = Numeric string (1) "1"
      -&gt;ip (public) = String (13) "151.80.109.86"
      -&gt;port (public) = Numeric string (4) "9987"
      -&gt;query_port (public) = Numeric string (5) "10011"
      -&gt;players (public) = NULL
      -&gt;max_players (public) = Numeric string (3) "512"
      -&gt;description (public) = NULL
      -&gt;map (public) = NULL
      -&gt;unlisted (public) = Numeric string (1) "0"
      -&gt;created_at (public) = String (19) "2017-09-26 21:47:21"
      -&gt;updated_at (public) = String (19) "2017-09-26 21:47:21"
    )
    Object Servers extends Phalcon\Mvc\Model (
      -&gt;id (public) = Numeric string (1) "2"
      -&gt;owned_by (public) = Numeric string (1) "1"
      -&gt;posted_by (public) = Numeric string (1) "1"
      -&gt;type (public) = Numeric string (1) "2"
      -&gt;ip (public) = String (13) "151.80.109.86"
      -&gt;port (public) = Numeric string (5) "27015"
      -&gt;query_port (public) = Numeric string (5) "27015"
      -&gt;players (public) = NULL
      -&gt;max_players (public) = Numeric string (3) "512"
      -&gt;description (public) = NULL
      -&gt;map (public) = NULL
      -&gt;unlisted (public) = Numeric string (1) "0"
      -&gt;created_at (public) = String (19) "2017-09-26 21:47:21"
      -&gt;updated_at (public) = String (19) "2017-09-26 21:47:21"
  )
)</code></pre>
<p>How can I acheive this with phalcon?</p>
<p>Im trying to acheive somelike how how Doctrine and Eloquent handle joins, Where the joined table is a child container (resultset in phalcons case) instead of multiple of the same user with diffrent joined servers.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-4a303156adbe92045a0b88fd-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-4a303156adbe92045a0b88fd-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/dabaee32fe49d05f6aeb6226af284252?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/9887/JABirchall" class="user-moderator-N"><span itemprop="name">Jake Birchall</span></a>        </span>
        <br>

        <span class="karma">8.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="51273" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '17</span>
              </span><br/><a name="C51273" href="#C51273">
                <time itemprop="dateCreated" datetime="2017-09-28T15:57:47-07:00" class="action-date">Sep '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Update, I have managed to do this</p>
<pre><code class="language-php">foreach ($items-&gt;toArray() as $item) {
    $servers[] = $item-&gt;servers;
}

$return = $items[0]-&gt;users;
$return-&gt;writeAttribute('servers', $servers);
return $return;</code></pre>
<p>But its not something Im pleased about tbh</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51273" data-cf-modified-4a303156adbe92045a0b88fd-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51273" data-cf-modified-4a303156adbe92045a0b88fd-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b0118ac36d373acb24122c8183b087b4?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/578/JREAM" class="user-moderator-N"><span itemprop="name">Jesse Boyer</span></a>        </span>
        <br>

        <span class="karma">58.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="51275" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '17</span>
              </span><br/><a name="C51275" href="#C51275">
                <time itemprop="dateCreated" datetime="2017-09-28T16:33:00-07:00" class="action-date">Sep '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><strong>This should retain your Objects.</strong></p>
<p>Yeah, the <code>toArray</code> is something I prefer to avoid otherwise you get an entire object dump even with a simple result.</p>
<p>Here's something to try, I put this in the overloaded <code>Users::findFirst</code> method, <strong>yet you can put it anywhere</strong>:</p>
<ul>
<li>So I have a model for: <strong>Users</strong>, and <strong>Servers</strong>.</li>
</ul>
<p><strong>models/Servers.php</strong></p>
<pre><code class="language-php">    &lt;?php
    public function initialize()
    {
         $this-&gt;hasMany('owned_by', 'Users', 'id', ['alias' =&gt; 'Users']);
         $this-&gt;belongsTo('owned_by', '\Users', 'id', ['alias' =&gt; 'Users']);
    }</code></pre>
<p><strong>models/Users.php</strong></p>
<pre><code class="language-php">    &lt;?php
    // .... Users model
    /**
     * Allows to query the first record that match the specified conditions
     *
     * @param mixed $parameters
     * @return Users|\Phalcon\Mvc\Model\ResultInterface
     */
    public static function findFirst($parameters = null)
    {
        $result = parent::findFirst($parameters);
        $result-&gt;server_list = \Servers::findFirstByOwnedBy($result-&gt;id);

        return $result;
    }</code></pre>
<p>In the ^^ Above ^^ Example, you could just apply to $result-&gt;ANY_VAR_NAME -- Yet I feel like there is a better way to do this.</p>
<p><strong>IndexController.php</strong> (This is for testing)</p>
<pre><code class="language-php">    &lt;?php

    class IndexController extends ControllerBase
    {

        public function indexAction()
        {
            $user = \Users::findFirstById(1);

            echo '&lt;h1&gt;user_id: ' . $user-&gt;id . '&lt;/h1&gt;&lt;br&gt;';
            foreach ($user-&gt;server_list as $instance) {
                foreach ($instance as $key =&gt; $value) {
                    if ($key == 'id') {
                        $key = 'server_id'; // just so its more readable
                    }
                    echo "$key = $value &lt;br&gt;";
                }
                echo '&lt;hr&gt;';
            }

            die;
        }
    }</code></pre>
<p><strong>My results with some fake data is:</strong></p>
<h2>user_id: 1</h2>
<h2>server_id = 1
owned_by = 1
name = foo </h2>
<h2>server_id = 2
owned_by = 1
name = fizz</h2>
<h2>server_id = 3
owned_by = 1
name = fun </h2></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51275" data-cf-modified-4a303156adbe92045a0b88fd-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51275" data-cf-modified-4a303156adbe92045a0b88fd-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/dabaee32fe49d05f6aeb6226af284252?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/9887/JABirchall" class="user-moderator-N"><span itemprop="name">Jake Birchall</span></a>        </span>
        <br>

        <span class="karma">8.2k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C51275"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/b0118ac36d373acb24122c8183b087b4?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jesse Boyer                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="51277" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '17</span>
              </span><br/><a name="C51277" href="#C51277">
                <time itemprop="dateCreated" datetime="2017-09-28T16:41:03-07:00" class="action-date">Sep '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p><strong>This should retain your Objects.</strong></p>
<p>Yeah, the <code>toArray</code> is something I prefer to avoid otherwise you get an entire object dump even with a simple result.</p>
<p>Here's something to try, I put this in the overloaded <code>Users::findFirst</code> method, <strong>yet you can put it anywhere</strong>:</p>
<ul>
<li>So I have a model for: <strong>Users</strong>, and <strong>Servers</strong>.</li>
</ul>
<p><strong>models/Servers.php</strong></p>
<pre><code class="language-php">   &lt;?php
   public function initialize()
   {
        $this-&gt;hasMany('owned_by', 'Users', 'id', ['alias' =&gt; 'Users']);
        $this-&gt;belongsTo('owned_by', '\Users', 'id', ['alias' =&gt; 'Users']);
   }</code></pre>
<p><strong>models/Users.php</strong></p>
<pre><code class="language-php">   &lt;?php
  // .... Users model
   /**
    * Allows to query the first record that match the specified conditions
    *
    * @param mixed $parameters
    * @return Users|\Phalcon\Mvc\Model\ResultInterface
    */
   public static function findFirst($parameters = null)
   {
       $result = parent::findFirst($parameters);
       $result-&gt;server_list = \Servers::findFirstByOwnedBy($result-&gt;id);

       return $result;
   }</code></pre>
<p>In the ^^ Above ^^ Example, you could just apply to $result-&gt;ANY_VAR_NAME -- Yet I feel like there is a better way to do this.</p>
<p><strong>IndexController.php</strong> (This is for testing)</p>
<pre><code class="language-php">   &lt;?php

   class IndexController extends ControllerBase
   {

       public function indexAction()
       {
           $user = \Users::findFirstById(1);

           echo '&lt;h1&gt;user_id: ' . $user-&gt;id . '&lt;/h1&gt;&lt;br&gt;';
           foreach ($user-&gt;server_list as $instance) {
               foreach ($instance as $key =&gt; $value) {
                   if ($key == 'id') {
                       $key = 'server_id'; // just so its more readable
                   }
                   echo "$key = $value &lt;br&gt;";
               }
               echo '&lt;hr&gt;';
           }

           die;
       }
   }</code></pre>
<p><strong>My results with some fake data is:</strong></p>
<h2>user_id: 1</h2>
<h2>server_id = 1
owned_by = 1
name = foo </h2>
<h2>server_id = 2
owned_by = 1
name = fizz</h2>
<h2>server_id = 3
owned_by = 1
name = fun </h2>
</blockquote>
<p>While that solves the problem for some, I am joining the tabel in a PHQL</p>
<pre><code class="language-php">$items = self::query()-&gt;createBuilder()
            -&gt;columns(["Users.*", "Servers.*"])
            -&gt;where("Users.id = :userid:", ['userid' =&gt; $userid], ['userid' =&gt; Column::TYPE_INTEGER])
            -&gt;innerJoin("Servers", "Users.id = Servers.owned_by", "Servers")
            -&gt;getQuery()-&gt;execute();</code></pre>
<p>Because what i am working will need to keep load oft he database. And there are expected to be more joins on top, for instance each server has a oneToOne type and then then another oneToMany of all the users on the server.</p>
<p>So I would need</p>
<pre><code class="language-php">$user // a single server owner
$user-&gt;servers // a collection of all the servers owned by the user
$user-&gt;servers[0]-&gt;type // a single servers type
$user-&gt;servers[0]-&gt;users // a collection of the all the users on the server.
$user-&gt;servers[0]-&gt;users[0]-&gt;roles // a collection of the specific users role on the server</code></pre>
<p>By the default behavour of the ORM returning 1 user for each joined row, thats alot of duplicate data and spegetti code to achieve the task</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51277" data-cf-modified-4a303156adbe92045a0b88fd-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51277" data-cf-modified-4a303156adbe92045a0b88fd-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fc20aff88dbf74867086ae25e3d18994?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/12247/rogerrharris" class="user-moderator-N"><span itemprop="name">rogerrharris</span></a>        </span>
        <br>

        <span class="karma">65</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C59457" href="#C59457">
                <time itemprop="dateCreated" datetime="2019-04-01T19:11:59-07:00" class="action-date">Apr '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Posting the (relevant) source of your model class could help... Also, which version of PHP + Phalcon are you running?
<a href="https://scdownloader.io">soundcloud downloader</a> apk</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59457" data-cf-modified-4a303156adbe92045a0b88fd-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59457" data-cf-modified-4a303156adbe92045a0b88fd-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8fdeb75c93616a981b4381c796d394d0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/13809/DanienJomm" class="user-moderator-N"><span itemprop="name">DanienJomm</span></a>        </span>
        <br>

        <span class="karma">65</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C63323" href="#C63323">
                <time itemprop="dateCreated" datetime="2020-06-03T21:37:25-07:00" class="action-date">Jun '20</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Nice post, thank you so much.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="63323" data-cf-modified-4a303156adbe92045a0b88fd-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="63323" data-cf-modified-4a303156adbe92045a0b88fd-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="17011" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>