---
layout: default
title: 'Access controller/action name from bootstrap - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/21/beginners">Beginners</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Access controller/action name from bootstrap</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a></span>
            <time itemprop="dateCreated" datetime="2013-07-05T15:53:20-07:00">Jul '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-07-05T15:53:20-07:00">Jul '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jul '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>1883</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">3</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a></span>
                <span class="karma">125.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C538" href="#C538">
        <time class="action-date">Jul '13</time>
    </a>
</div>
<div class="post-content"><div><p>Hi all,</p>
<p>How do I access the controller and action name from the bootstrap file?</p>
<p>I've set up my app with the Security plugin like the Invo app tutorial displays.  My authentication is done by a third-party library, and the Security plugin translates the integer access levels that library provides (ie: 1 = admin, 2 = employee, 3 = student), to role strings (ie: &quot;Admin&quot;, etc).  I would like to have that &quot;role&quot; accessible throughout the application, as well as other user properties provided by the third-party library.  Long-story-short, I don't know the &quot;role&quot; of the user until after the beforeExecuteRoute() function is run.  So, I'm considering reworking the Security class and just invoke it directly from the bootstrap file (since absolutely every controller/action in my app will require authentication).</p>
<p>However, to do that I need the controller and action names.  In the Security-class-as-Plugin code, the beforeExecuteRoute() function gets passed the dispatcher.  However, in my bootstrap, if I call $DI-&gt;get('dispatcher')-&gt;getControllerName(), I always get NULL.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-7c30788b10c2b461ee973a55-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-7c30788b10c2b461ee973a55-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">3</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2229" href="#C2229">
                <time itemprop="dateCreated" datetime="2013-07-06T11:07:55-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi, can you please post some code?, the code in your bootstrap for example?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2229" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2229" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="2246" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '14</span>
              </span><br/><a name="C2246" href="#C2246">
                <time itemprop="dateCreated" datetime="2013-07-08T08:03:31-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Bootloader file</p>
<pre><code class="language-php">&lt;?PHP
try{
    // Load config
    $Config = require '../app/config/config.php';

    // Register an autoloader
    $Loader = new \Phalcon\Loader();
    $Loader-&gt;registerDirs($Config-&gt;phalcon-&gt;loadDirs)-&gt;register();

    // Create a Dependency Injection container
    $DI = new \Phalcon\DI\FactoryDefault();

    // Set up the Dispatcher
    $DI-&gt;set('dispatcher',function() use ($DI){

        // Get the standard eventsManager
        $EM = $DI-&gt;getShared('eventsManager');

        // Instantiate the Security plugin
        $Security = new Security($DI);

        // Listen for events produced by the Dispatcher using the Security plugin
        $EM-&gt;attach('dispatch',$Security);

        // Set the dispatcher to the custom dispatcher with the newly modified Events Manager
        $Dispatcher = new Phalcon\Mvc\Dispatcher();
        $Dispatcher-&gt;setEventsManager($EM);

        return $Dispatcher;
    });

    // Set up the View component
    $DI-&gt;set('view',function() use ($Config){
        $View = new \Phalcon\Mvc\View();
        $View-&gt;setViewsDir($Config-&gt;app-&gt;appDir.'/views/');
        return $View;
    });

    #
    # User object is created in Security
    #

    # Initialize Session
    $Session = new Phalcon\Session\Adapter\Files();
    $Session-&gt;start();
    $Session-&gt;config = $Config;
    $DI-&gt;setShared('session',$Session);

    // Handle the requested URL
    $App = new \Phalcon\Mvc\Application($DI);

    // Echo the output
    echo $App-&gt;handle()-&gt;getContent();
}
catch(\Phalcon\Exception $e){
    echo 'Phalcon Exception: ',$e-&gt;getMessage();
}</code></pre>
<p>Relevant parts of the Security plugin</p>
<pre><code class="language-php">&lt;?PHP
#
#
# Relevant parts of the "Security" plugin
#
#
// "beforeExecuteRoute" is the name of the event for which we want this function to be called
public function beforeExecuteRoute($Event,$Dispatcher){

    $role       = $this-&gt;getRole();
    $controller = $Dispatcher-&gt;getControllerName();
    $action     = $Dispatcher-&gt;getActionName();
    $allowed    = $this-&gt;getAcl()-&gt;isAllowed($role,$controller,$action);

    if($allowed != Phalcon\Acl::ALLOW){
        $this-&gt;flash-&gt;error('You are not allowed to view this page.');
        $Dispatcher-&gt;forward(['controller'=&gt;'index','action'=&gt;'index']);

        // Returning false will tell the Dispatcher to stop the current operation
        return FALSE;
    }
    else
    {
        $User = new User(   [   'level' =&gt;  RemoteAuth::$level,
                        'name'  =&gt;  RemoteAuth::$name,
                        'ccid'  =&gt;  RemoteAuth::$ccid,
                        'role'  =&gt;  $role
                    ]
                );
        $DI = $Dispatcher-&gt;getDI();
        $DI-&gt;setShared('user',$User);
    }
}

###
# Get the role for the logged in user
###

private function getRole(){
    /* RemoteAuth is the library used by all organizational web apps for central authentication.
       Consequently, it doesn't tie in with Phalcon 100%.  Creating a new RemoteAuth object
       with no session, will cause the "You have no session" page to appear, rather than 
       proper routing via Phalcon
    */
    $RemoteAuth = new RemoteAuth('media',999);
    $level = RemoteAuth::$level;

    //need to convert access levels to "roles" for proper ACL integration
    $roles = $this-&gt;session-&gt;config-&gt;roles;
    $role = (isset($roles[$level])) ? $roles[$level] : FALSE;

    $this-&gt;session-&gt;role = $role;

    return $role;
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2246" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2246" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2251" href="#C2251">
                <time itemprop="dateCreated" datetime="2013-07-08T11:34:27-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The code seems to be fine, however the Security plugin (for example in INVO) is intended to provide authorization rather than authentication, check the Auth component in Vokuro, perphaps that is you're needing: <a href="https://github.com/phalcon/vokuro/tree/master/app/library/Auth">https://github.com/phalcon/vokuro/tree/master/app/library/Auth</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2251" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2251" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2254" href="#C2254">
                <time itemprop="dateCreated" datetime="2013-07-08T12:07:34-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Authorization (determining what privileges a logged in user has) is precisely what I want.  Authentication (actually logging in the user) has already happened before this application and code is accessed.  The Auth component you referenced seems pretty focused on logging in - Authentication.</p>
<p>The root of the problem is I don't like my &quot;User&quot; object being created in the Security plugin.  But it seems attaching to the beforeExecuteRoute event is the only way to do authorization checking before page load.  Is there a framework acceptable way to just put this logic in the bootstrap?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2254" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2254" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2255" href="#C2255">
                <time itemprop="dateCreated" datetime="2013-07-08T12:19:47-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>But are you getting the current role service: new RemoteAuth('media',999)?</p>
<p>What I see is:</p>
<p>1) Perform the authentication getting the role and storing it in session (new RemoteAuth('media',999)) then validate it with the roles, also you don't to store the config in session.
2) In authorization, you use the role in session  to check permissions</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2255" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2255" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2256" href="#C2256">
                <time itemprop="dateCreated" datetime="2013-07-08T12:32:13-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>My apologies, I'm having a bit of trouble figuring out what you mean.</p>
<p>By the time this app is accessed, the user has already been authenticated, and their access level for this app has been determined.  The system &quot;RemoteAuth&quot; interacts with assigns access levels (1-3), rather than roles.  I need to convert the &quot;level&quot; into a &quot;role</p>
<p>1) Config is stored in session near the bottom of the Bootstrap file
2) Is this an insight into how I'm currently doing authorization, or a comment on how Phalcon generally deals with authorization?</p>
<p>This discussion is perhaps a bit off track.  Initially I was just wondering if there was any way to get the current controller &amp; action name in the bootstrap file.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2256" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2256" data-cf-modified-7c30788b10c2b461ee973a55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="538" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>