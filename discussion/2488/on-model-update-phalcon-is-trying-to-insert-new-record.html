---
layout: default
title: 'On model-&gt;update() Phalcon is trying to INSERT new record - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/21/beginners">Beginners</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">On model-&gt;update() Phalcon is trying to INSERT new record</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/995/anddrzejb" class="user-moderator-N"><span itemprop="name">anddrzejb</span></a></span>
            <time itemprop="dateCreated" datetime="2014-06-06T04:00:12-07:00">Jun '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-06-06T04:00:12-07:00">Jun '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>1897</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/1930feb0cd023ae0bfa9aa1a59c4bffc?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/995/anddrzejb" class="user-moderator-N"><span itemprop="name">anddrzejb</span></a></span>
                <span class="karma">9.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2488" href="#C2488">
        <time class="action-date">Jun '14</time>
    </a>
</div>
<div class="post-content"><div><p>After a couple of months of break from Phalcon I finally came back to my project. In the meantime I updated to 1.3.1.
I am now having an issue with model update. In short the following is happening:</p>
<pre><code class="language-php">        $country = Country::findFirst(array(
            "conditions"=&gt;"cntID = ?1",
            "bind" =&gt; array(1 =&gt;$this-&gt;persistent-&gt;cntID),
            "for_update" =&gt; true
            )
        ...
        $formFields-&gt;bind($this-&gt;request-&gt;getPost(), $country);
        try
                {
                    if ($country-&gt;update() == false) {
                    ...
                        $this-&gt;flash-&gt;error($message-&gt;getMessage());</code></pre>
<p>Here I get &quot;Duplicate key (...)&quot; MySQL error. While debugging I noticed that Phalcon instead going to Country-&gt;beforeUpdate() it actually goes to Country-&gt;beforeCreate(). And I thought that</p>
<pre><code class="language-php">    $country-&gt;update() </code></pre>
<p>tells it explicitly to go to beforeUpdate... And at the end Phalcon is trying to do INSERT SQL statement.... This situation is happening always after initial insert of a record and later on attempt of updating it. I know this i as short description. If necessary I will gladly elaborate.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-bf325d0afe775ae1aad5d7b7-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-bf325d0afe775ae1aad5d7b7-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e909effb189b69d2363d035ae7b4240d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1610/wandersonwhcr" class="user-moderator-N"><span itemprop="name">Wanderson Camargo</span></a>        </span>
        <br>

        <span class="karma">2.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8419" href="#C8419">
                <time itemprop="dateCreated" datetime="2014-06-06T13:35:25-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>can you show the &quot;getPost&quot; content?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8419" data-cf-modified-bf325d0afe775ae1aad5d7b7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8419" data-cf-modified-bf325d0afe775ae1aad5d7b7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1930feb0cd023ae0bfa9aa1a59c4bffc?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/995/anddrzejb" class="user-moderator-N"><span itemprop="name">anddrzejb</span></a>        </span>
        <br>

        <span class="karma">9.8k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8510" href="#C8510">
                <time itemprop="dateCreated" datetime="2014-06-10T10:29:23-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Sorry for such a delay (long weekend).
Your request gave an idea and I found a solution. My understanding of Phalcon is very limited and maybe that is why I see this as a bug. </p>
<p>The problem I had was that in addAction I have an option to Save or to Apply. Save option was obviously saving and forwarding to indexAction, however Apply was saving and forwarding to editAction. The problem here was that from addAction the content of the POST global was missing the primary key cntID field value (the field was there, but it was empty). That value was obviously missing from $this-&gt;request-&gt;getPost() that was used for binding data to edit form. So when I was trying to save, phalcon probably figured that is needs to create a new record. What I did - just before forwarding to editAction I inserted </p>
<pre><code class="language-php">$_POST['cntID'] = $country-&gt;cntID;</code></pre>
<p>this way forcing the getPost() to get all the data. However it is little confusing to me - I was thinking that creating a model object $country I already had all the necessary data and binding will only be used to validate the fields. And using explicit update() method should not generate INSERT statement in any case...</p>
<p>Anyway, thanks a lot for your help.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8510" data-cf-modified-bf325d0afe775ae1aad5d7b7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8510" data-cf-modified-bf325d0afe775ae1aad5d7b7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e909effb189b69d2363d035ae7b4240d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1610/wandersonwhcr" class="user-moderator-N"><span itemprop="name">Wanderson Camargo</span></a>        </span>
        <br>

        <span class="karma">2.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8521" href="#C8521">
                <time itemprop="dateCreated" datetime="2014-06-10T13:22:13-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>u r welcome :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8521" data-cf-modified-bf325d0afe775ae1aad5d7b7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8521" data-cf-modified-bf325d0afe775ae1aad5d7b7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2488" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>