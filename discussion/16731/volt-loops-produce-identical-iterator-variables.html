---
layout: default
title: 'Volt loops produce identical iterator variables - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/3/volt">Volt</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Volt loops produce identical iterator variables</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/5871/tigrino" class="user-moderator-N"><span itemprop="name">Albert &#039;Tigr&#039; Zenkoff</span></a></span>
            <time itemprop="dateCreated" datetime="2017-08-15T06:38:38-07:00">Aug '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-08-15T06:38:38-07:00">Aug '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>May '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>513</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img  src="https://secure.gravatar.com/avatar/34435331a5991dd4f23c13f71d9cee6d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/5871/tigrino" class="user-moderator-N"><span itemprop="name">Albert &#039;Tigr&#039; Zenkoff</span></a></span>
                <span class="karma">624</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C16731" href="#C16731">
        <time class="action-date">Aug '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hi!</p>
<p>I suddenly ran into a problem with iterators. I have one loop in one file that does this:</p>
<pre><code>{% raw %}{%{% endraw %} for exercise in page.items {% raw %}%}{% endraw %}</code></pre>
<p>And inside that loop I call a partial:</p>
<pre><code>&lt;?php $this-&gt;partial("shared/view-exercise-in-list"); ?&gt;</code></pre>
<p>Inside the partial I have again a loop:</p>
<pre><code>{% raw %}{%{% endraw %} for exercise_name in exercise_names {% raw %}%}{% endraw %}</code></pre>
<p>And now the iterators generated by the two files:</p>
<pre><code>&lt;?php $v174897676652324318951iterated = false; ?&gt;&lt;?php $v174897676652324318951iterator = $page-&gt;items; ...</code></pre>
<p>and</p>
<pre><code>&lt;?php $v174897676652324318951iterator = $exercise_names; </code></pre>
<p>So the iterators are exactly the same. In fact, all iterators generated in one generator run (for the same request) all over the place are exactly the same. Iterators for another request are different but same between themselves. What could be the problem here?</p>
<p>I only noticed the problem when I removed the cache files. Apparently, the old generated files were correct but now the generation does not work properly and generates the same name for all iterators.</p>
<p>Thanks for ideas in advance,</p>
<p>Albert</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-22b2f79244209b308d01e32e-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-22b2f79244209b308d01e32e-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="50273" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '17</span>
              </span><br/><a name="C50273" href="#C50273">
                <time itemprop="dateCreated" datetime="2017-08-15T06:50:03-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Phalcon partials are scope-aware; you would have to pass in the iterated variable to the scope of the partial as arguments.</p>
<pre><code class="language-volt">{% raw %}{%{% endraw %} for item in page.items {% raw %}%}{% endraw %}
    {% raw %}{{{% endraw %} partial('shared/view-exercise-in-list', ['exercise':item]) {% raw %}}}{% endraw %}
{% raw %}{%{% endraw %} endfor {% raw %}%}{% endraw %}</code></pre>
<p>Or, you could include it, that would expose the parent scope to the included template.</p>
<pre><code class="language-volt">{% raw %}{%{% endraw %} for item in page.items {% raw %}%}{% endraw %}
    {% raw %}{%{% endraw %} include 'partials/shared/view-exercise-in-list' {% raw %}%}{% endraw %}
{% raw %}{%{% endraw %} endfor {% raw %}%}{% endraw %}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50273" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50273" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/34435331a5991dd4f23c13f71d9cee6d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/5871/tigrino" class="user-moderator-N"><span itemprop="name">Albert &#039;Tigr&#039; Zenkoff</span></a>        </span>
        <br>

        <span class="karma">624</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50373" href="#C50373">
                <time itemprop="dateCreated" datetime="2017-08-18T06:24:03-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The problem is not that I cannot access the variable inside the Volt partial. The problem is that the loop inside the partial generates the same loop variable, thereby corrupting the loop variable outside the partial. What gives?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50373" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50373" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/34435331a5991dd4f23c13f71d9cee6d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/5871/tigrino" class="user-moderator-N"><span itemprop="name">Albert &#039;Tigr&#039; Zenkoff</span></a>        </span>
        <br>

        <span class="karma">624</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50375" href="#C50375">
                <time itemprop="dateCreated" datetime="2017-08-18T06:35:32-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ah, wait. So if I do not pass the $exercise into the partial it is not set, is that what you mean? That's probably new behavior in the newer versions... This used to work before. Okay, that makes sense because I check for the $exercise and if not set, I perform a DB lookup, getting a different $exercise in the process. That is useful to know. However, it still does not resolve the original question, does it?</p>
<p>Why does Volt generate the same variable name for the two loops? Isn't that a bug?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50375" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50375" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/530e640c502dd38d9a4d3a48c59f54ee?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/11167/hacketo" class="user-moderator-N"><span itemprop="name">Hacketo</span></a>        </span>
        <br>

        <span class="karma">262</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C55367" href="#C55367">
                <time itemprop="dateCreated" datetime="2018-05-11T07:56:46-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Do you have any suggestion about this issue since ? I can't find anything about it.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55367" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55367" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/34435331a5991dd4f23c13f71d9cee6d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/5871/tigrino" class="user-moderator-N"><span itemprop="name">Albert &#039;Tigr&#039; Zenkoff</span></a>        </span>
        <br>

        <span class="karma">624</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="55369" data-toggle="modal" data-target="#historyModal">
                edited <span>May '18</span>
              </span><br/><a name="C55369" href="#C55369">
                <time itemprop="dateCreated" datetime="2018-05-11T09:02:19-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi!</p>
<p>I did solve the problem but it was a while... What I find in my code is this:</p>
<pre><code>{% raw %}{%{% endraw %} for exercise in page.items {% raw %}%}{% endraw %}
...
&lt;?php $this-&gt;partial("shared/view-exercise-in-list"); ?&gt;</code></pre>
<p>and then in the partial:</p>
<pre><code>$exercise_names = $exercise-&gt;getExerciseNames()-&gt;toArray();
{% raw %}{%{% endraw %} for exercise_name in exercise_names {% raw %}%}{% endraw %}</code></pre>
<p>So the code looks unchanged to me, in fact. That's weird. I wonder if something else was wrong... But I frankly ddo not remember. Sorry.</p>
<p>Albert</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55369" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55369" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/530e640c502dd38d9a4d3a48c59f54ee?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/11167/hacketo" class="user-moderator-N"><span itemprop="name">Hacketo</span></a>        </span>
        <br>

        <span class="karma">262</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="55429" data-toggle="modal" data-target="#historyModal">
                edited <span>May '18</span>
              </span><br/><a name="C55429" href="#C55429">
                <time itemprop="dateCreated" datetime="2018-05-13T16:04:45-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>After some zephir debugging, I came across this old issue : <a href="https://github.com/phalcon/cphalcon/issues/12176">Diffrent volt partial() in php 5.6/7.0 #12176</a>
The loop context cannot be used 'atm' .
Thanks.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55429" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55429" data-cf-modified-22b2f79244209b308d01e32e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="16731" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>