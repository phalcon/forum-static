---
layout: default
title: 'why does the cli_task take so long time? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/5/general">General</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">why does the cli_task take so long time?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/3169/zhudonghe" class="user-moderator-N"><span itemprop="name">zhudonghe</span></a></span>
            <time itemprop="dateCreated" datetime="2015-04-30T01:47:50-07:00">Apr '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-04-30T01:47:50-07:00">Apr '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>May '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>480</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/80f4ff181b96d329ef2c5b9e90838a9e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/3169/zhudonghe" class="user-moderator-N"><span itemprop="name">zhudonghe</span></a></span>
                <span class="karma">6.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C6585" href="#C6585">
        <time class="action-date">Apr '15</time>
    </a>
</div>
<div class="post-content"><div><p>I run the same code in &quot;cli task action&quot; and &quot;web controller action&quot;. The code is used to update data in MySQL. But when I use CLI to run the function, it takes about over 30 times as compared with the time calling from web. </p>
<p>I want to create cron jobs to update data automatically. But it's too slow calling from CLI. It happens both in CentOS 7 and OSX 10.10.3.</p>
<p>Phalcon 1.3.3</p>
<p>Thanks!</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/80f4ff181b96d329ef2c5b9e90838a9e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3169/zhudonghe" class="user-moderator-N"><span itemprop="name">zhudonghe</span></a>        </span>
        <br>

        <span class="karma">6.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C17814" href="#C17814">
                <time itemprop="dateCreated" datetime="2015-04-30T01:54:06-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The piece of code has many MySQL select and update operations. I guess it is because of the memory limit.
How to set the memory limit when calling from CLI?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17814" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17814" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/80f4ff181b96d329ef2c5b9e90838a9e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3169/zhudonghe" class="user-moderator-N"><span itemprop="name">zhudonghe</span></a>        </span>
        <br>

        <span class="karma">6.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="17816" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '15</span>
              </span><br/><a name="C17816" href="#C17816">
                <time itemprop="dateCreated" datetime="2015-04-30T02:22:11-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I use memory_get_usage() to get the allocated memory. The function become obviously slow when the memory_get_usage()'s return value is over 100,000,000. The code runs more and more slowly with the memory_get_usage()'s return value increases. </p>
<p>memory_limit=512M in the php.ini.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17816" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17816" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0443edc510c8690c5ebeac47ff491cfe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3402/stibiumz" class="user-moderator-N"><span itemprop="name">Óscar Enríquez</span></a>        </span>
        <br>

        <span class="karma">6.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C17821" href="#C17821">
                <time itemprop="dateCreated" datetime="2015-04-30T04:13:14-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><code>memory_get_usage</code> returns the current memory that your script is using, so if this is increasing it means you're not freeing memory, unset all big variables that are not necessary once used with <code>unset ()</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17821" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17821" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/80f4ff181b96d329ef2c5b9e90838a9e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3169/zhudonghe" class="user-moderator-N"><span itemprop="name">zhudonghe</span></a>        </span>
        <br>

        <span class="karma">6.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C17821"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/0443edc510c8690c5ebeac47ff491cfe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Óscar Enríquez                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="17835" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '15</span>
              </span><br/><a name="C17835" href="#C17835">
                <time itemprop="dateCreated" datetime="2015-04-30T18:53:06-07:00" class="action-date">Apr '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p><code>memory_get_usage</code> returns the current memory that your script is using, so if this is increasing it means you're not freeing memory, unset all big variables that are not necessary once used with <code>unset ()</code></p>
</blockquote>
<p>I have used <code>unset()</code> to free the big variables. But the allocated memory seems to be no effect. Calling from web allocates only about half of the memory allocated by calling by CLI. I don't know why CLI allocates so much memory and is there any other ways to free memory? </p>
<p>After the action running about 2.5 hours, the allocated memory is about 500,000,000. So why does the action run so slowly when the allocated memory is over 100,000,000 while the action could allocate over 500,000,000?</p>
<p>Thanks!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17835" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17835" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0443edc510c8690c5ebeac47ff491cfe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3402/stibiumz" class="user-moderator-N"><span itemprop="name">Óscar Enríquez</span></a>        </span>
        <br>

        <span class="karma">6.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="17843" data-toggle="modal" data-target="#historyModal">
                edited <span>May '15</span>
              </span><br/><a name="C17843" href="#C17843">
                <time itemprop="dateCreated" datetime="2015-05-01T00:35:18-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>There aren't other ways to free memory, you can use <code>unset (...$vars);</code>, <ins>(unset) $var;</ins> (oops, I was wrong <a href="http://php.net/unset#example-5731">http://php.net/unset#example-5731</a>) or <code>$var = NULL;</code>, all have the same effect. I would recommend you this reading <a href="http://blog.ircmaxell.com/2014/12/what-about-garbage.html">http://blog.ircmaxell.com/2014/12/what-about-garbage.html</a></p>
<p>Also note that PHP CLI loads a different  php.ini</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="17843" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="17843" data-cf-modified-6b32b12fdb45ff6762a334ba-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="6585" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>