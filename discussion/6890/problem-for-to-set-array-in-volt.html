---
layout: default
title: 'problem for to set array in volt - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/3/volt">Volt</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">problem for to set array in volt</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/3161/NelsonJPG" class="user-moderator-N"><span itemprop="name">NelsonJPG</span></a></span>
            <time itemprop="dateCreated" datetime="2015-05-25T09:32:29-07:00">May '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-05-25T09:32:29-07:00">May '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>May '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>1321</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/c48fa4623815d79a63b4a6ceb3ed9c31?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/3161/NelsonJPG" class="user-moderator-N"><span itemprop="name">NelsonJPG</span></a></span>
                <span class="karma">17.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C6890" href="#C6890">
        <time class="action-date">May '15</time>
    </a>
</div>
<div class="post-content"><div><p>Hi ...</p>
<p>I'm trying to translate a php function in volts but I have a problem setting the array</p>
<p>this is the function php </p>
<pre><code class="language-php">&lt;?php 
function formatTree($tree, $parent){
        $tree2 = array();
        foreach($tree as $i =&gt; $item){
            if($item['parent_id'] == $parent){
                $tree2[$item['id']] = $item;
                $tree2[$item['id']]['submenu'] = formatTree($tree, $item['id']);
            }
        }

        return $tree2;
    }
</code></pre>
<p>and this in volt</p>
<pre><code class="language-php">{% raw %}{%{% endraw %}- macro formatTree(tree,parent = null) {% raw %}%}{% endraw %}
  {% raw %}{%{% endraw %} set tree2 = [] {% raw %}%}{% endraw %}

    {% raw %}{%{% endraw %} for i,item in tree {% raw %}%}{% endraw %}

      {% raw %}{%{% endraw %} if item["parent_id"] == parent {% raw %}%}{% endraw %}

        {# {% raw %}{%{% endraw %} set tree2 = [item["id"]:item] {% raw %}%}{% endraw %} DON'T WORK #}
        {% raw %}{%{% endraw %} set tree2 = [item["id"],["submenu":formatTree(tree,item["id"])]] {% raw %}%}{% endraw %}      

      {% raw %}{%{% endraw %} endif {% raw %}%}{% endraw %}

    {% raw %}{%{% endraw %} endfor {% raw %}%}{% endraw %}

  {% raw %}{%{% endraw %} return tree2 {% raw %}%}{% endraw %}

{% raw %}{%{% endraw %}- endmacro {% raw %}%}{% endraw %}</code></pre>
<p>the error is </p>
<pre><code>Syntax error, unexpected token COLON</code></pre></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-6d94b6801c03c379f3f11aa5-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-6d94b6801c03c379f3f11aa5-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c48fa4623815d79a63b4a6ceb3ed9c31?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3161/NelsonJPG" class="user-moderator-N"><span itemprop="name">NelsonJPG</span></a>        </span>
        <br>

        <span class="karma">17.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C18793" href="#C18793">
                <time itemprop="dateCreated" datetime="2015-05-25T13:19:11-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This is that doesn't work</p>
<pre><code class="language-php"> {% raw %}{%{% endraw %} set tree2 = [item["id"]:item] {% raw %}%}{% endraw %}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18793" data-cf-modified-6d94b6801c03c379f3f11aa5-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18793" data-cf-modified-6d94b6801c03c379f3f11aa5-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/857b8420e1d5fe37fa3324badf149743?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3921/Skymidt" class="user-moderator-N"><span itemprop="name">Skymidt</span></a>        </span>
        <br>

        <span class="karma">3.9k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C18796" href="#C18796">
                <time itemprop="dateCreated" datetime="2015-05-25T14:29:31-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><pre><code class="language-php">{% raw %}{%{% endraw %} set tree2 = item["id"].["submenu"].formatTree(tree,item["id"]) {% raw %}%}{% endraw %}</code></pre>
<p>This have a syntax error itself independent of Phalcon\Volt.
Volt is a children and has many bugs of construct and interpreter, that developers are doing an extensive job to made it better each day.
The correct way to do that doesen't work at all, because volt doesn't have associative dynamic array. This key must be a string:</p>
<pre><code class="language-php">        {% raw %}{%{% endraw %}- macro formatTree(tree,parent = null) {% raw %}%}{% endraw %}
            {% raw %}{%{% endraw %} set tree2 = [] {% raw %}%}{% endraw %}
            {% raw %}{%{% endraw %} for i,item in tree {% raw %}%}{% endraw %}
                {% raw %}{%{% endraw %} if item['parent_id'] == parent {% raw %}%}{% endraw %}
                    {% raw %}{%{% endraw %} set item_id = item['id'] {% raw %}%}{% endraw %}
                    {% raw %}{%{% endraw %} set tree2 = ['item_id':item] {% raw %}%}{% endraw %}{# key has to be a string that's why doesen't work #}
                    {% raw %}{%{% endraw %} set tree2 = ['item_id']['submenu':formatTree(tree,item['id']]) {% raw %}%}{% endraw %}
                {% raw %}{%{% endraw %} endif {% raw %}%}{% endraw %}
            {% raw %}{%{% endraw %} endfor {% raw %}%}{% endraw %}
            {% raw %}{%{% endraw %} return tree2 {% raw %}%}{% endraw %}
        {% raw %}{%{% endraw %}- endmacro {% raw %}%}{% endraw %}</code></pre>
<p>I use a lot of function in my volt calling they directly from an model, see the exemple bellow:</p>
<p>in Model:</p>
<pre><code class="language-php">public function formatTree($tree, $parent){
    $tree2 = array();
    foreach($tree as $i =&gt; $item){
        if($item['parent_id'] == $parent){
            $tree2[$item['id']] = $item;
            $tree2[$item['id']]['submenu'] = formatTree($tree, $item['id']);
        }
    }
    return $tree2;
}</code></pre>
<p>in Controller:</p>
<pre><code class="language-php">$this-&gt;view-&gt;myModel = new myModel();</code></pre>
<p>in Volt:</p>
<pre><code class="language-php">{% raw %}{%{% endraw %} set item = myModel.formatTree(tree, parent) {% raw %}%}{% endraw %}</code></pre>
<p>This can't be the better way to do this, but works.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18796" data-cf-modified-6d94b6801c03c379f3f11aa5-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18796" data-cf-modified-6d94b6801c03c379f3f11aa5-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/857b8420e1d5fe37fa3324badf149743?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3921/Skymidt" class="user-moderator-N"><span itemprop="name">Skymidt</span></a>        </span>
        <br>

        <span class="karma">3.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="18943" data-toggle="modal" data-target="#historyModal">
                edited <span>May '15</span>
              </span><br/><a name="C18943" href="#C18943">
                <time itemprop="dateCreated" datetime="2015-05-30T14:55:33-07:00" class="action-date">May '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You can use a custom function declared on services for volt too like this:</p>
<p>1 - Create a folder with a friendly name like &quot;Customs&quot; or &quot;Helpers&quot; anything you want</p>
<p>2 - Remeber to declare this on  your applications config:</p>
<pre><code class="language-php">return new \Phalcon\Config(array(
    'database' =&gt; array(
        'adapter'     =&gt; 'Mysql',
        'host'        =&gt; 'localhost',
        'username'    =&gt; 'root',
        'password'    =&gt; 'your_pass',
        'dbname'      =&gt; 'your_base',
        'charset'     =&gt; 'utf8',
    ),
    'application' =&gt; array(
        'controllersDir' =&gt; __DIR__ . '/../../app/controllers/',
        'modelsDir'      =&gt; __DIR__ . '/../../app/models/',
        'migrationsDir'  =&gt; __DIR__ . '/../../app/migrations/',
        'viewsDir'       =&gt; __DIR__ . '/../../app/views/',
        'pluginsDir'     =&gt; __DIR__ . '/../../app/plugins/',
        'libraryDir'     =&gt; __DIR__ . '/../../app/library/',
        'helpersDir'      =&gt; __DIR__ . '/../../app/Helpers/', //here your folder
        'cacheDir'       =&gt; __DIR__ . '/../../app/cache/',
        'vendorDir'     =&gt; __DIR__ . '/../../vendors/',
        'baseUri'        =&gt; '/clinica_vita/',
    )
));</code></pre>
<p>3 - Register this on your loader:</p>
<pre><code class="language-php">$loader-&gt;registerDirs(
    array(
        $config-&gt;application-&gt;controllersDir,
        $config-&gt;application-&gt;modelsDir,
        $config-&gt;application-&gt;helpersDir,
    )
)-&gt;register();</code></pre>
<p>4 - Create a class inside this with the name you pick: (Ex: for me is: Filters.php)</p>
<pre><code class="language-php">class Filters
{
    public static formatTree($tree, $parent){
        $tree2 = array();
        foreach($tree as $i =&gt; $item){
            if($item['parent_id'] == $parent){
                $tree2[$item['id']] = $item;
                $tree2[$item['id']]['submenu'] = formatTree($tree, $item['id']);
            }
        }
        return $tree2;
    }
}</code></pre>
<p>5 - Inside the services.php call this on the volt object:</p>
<pre><code class="language-php">$di-&gt;set('view', function () use ($config) {

    $view = new View();
    $view-&gt;setViewsDir($config-&gt;application-&gt;viewsDir);
    $view-&gt;setRenderLevel(\Phalcon\Mvc\View::LEVEL_ACTION_VIEW);
    $view-&gt;registerEngines(array(
        '.volt' =&gt; function ($view, $di) use ($config) {

            $volt = new VoltEngine($view, $di);
            $volt-&gt;setOptions(array(
                'compiledPath' =&gt; $config-&gt;application-&gt;cacheDir . '/volt/',
                'compiledSeparator' =&gt; '_'
            ));
            $compiler = $volt-&gt;getCompiler();

            //Aply here the name of your  custom function
            $compiler-&gt;addFunction('formatTree', function($resolvedArgs, $exprArgs) {
               return 'Filters::formatTree(' . $resolvedArgs . ')';
            });

            return $volt;
        }
    ));

    return $view;
}, true);</code></pre>
<p>6 - Finally on volt you can call your custom function without model dependencies:</p>
<pre><code class="language-php">{% raw %}{%{% endraw %} set item = formatTree(tree, parent) {% raw %}%}{% endraw %}</code></pre>
<p>Just another method to do that without Model way.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="18943" data-cf-modified-6d94b6801c03c379f3f11aa5-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="18943" data-cf-modified-6d94b6801c03c379f3f11aa5-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="6890" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>