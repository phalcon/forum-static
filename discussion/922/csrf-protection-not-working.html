---
layout: default
title: 'CSRF protection not working - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/16/security">Security</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">CSRF protection not working</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/569/kaioken" class="user-moderator-N"><span itemprop="name">Max Castro</span></a></span>
            <time itemprop="dateCreated" datetime="2013-09-20T15:55:30-07:00">Sep '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-09-20T15:55:30-07:00">Sep '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">21</span>
                </td>
                <td>
                    <label>Views</label><br>5492</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">4</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/83c11918052630e4dda79206c336924d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/569/kaioken" class="user-moderator-N"><span itemprop="name">Max Castro</span></a></span>
                <span class="karma">16.4k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C922" href="#C922">
        <time class="action-date">Sep '13</time>
    </a>
</div>
<div class="post-content"><div><p>Um using version 1.2.3 and 1.2.4 . I'm making a simply invitation form using CSRF just like the tutorial
<a href="https://github.com/phalcon/docs/blob/master/en/reference/security.rst#cross-site-request-forgery-csrf-protection">https://github.com/phalcon/docs/blob/master/en/reference/security.rst#cross-site-request-forgery-csrf-protection</a></p>
<p>But for some reason the validation $this-&gt;security-&gt;checkToken() is always returning false.</p>
<p>I saw this post with a similar case but no reply
<a href="http://forum.phalcon.io/discussion/310/csrf-protection">http://forum.phalcon.io/discussion/310/csrf-protection</a> </p>
<p>Anyone having this issue?</p>
<p>Thanks</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-aed4500f2a7b257877f7fb91-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-aed4500f2a7b257877f7fb91-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">4</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3535" href="#C3535">
                <time itemprop="dateCreated" datetime="2013-09-20T16:27:27-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This happens when the token is regenerated before it's checked, you must generate the token in the form:
<a href="https://github.com/phalcon/vokuro/blob/master/app/views/session/signup.volt#L53">https://github.com/phalcon/vokuro/blob/master/app/views/session/signup.volt#L53</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3535" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3535" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/83c11918052630e4dda79206c336924d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/569/kaioken" class="user-moderator-N"><span itemprop="name">Max Castro</span></a>        </span>
        <br>

        <span class="karma">16.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="3537" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '14</span>
              </span><br/><a name="C3537" href="#C3537">
                <time itemprop="dateCreated" datetime="2013-09-20T16:43:26-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Im already generating the token in the form , and it still not working</p>
<pre><code class="language-html">&lt;!-- login beta --&gt;
&lt;div id="beta_login"&gt;
    &lt;?php echo $this-&gt;tag-&gt;form('') ?&gt;
        &lt;div&gt;
                &lt;?php echo $this-&gt;tag-&gt;textField(["name", "size" =&gt; "30", 'class' =&gt; 'tfield', 'placeholder' =&gt; 'Dirección de correo electrónico...']); ?&gt;

                &lt;input type="hidden" name="&lt;?php echo $this-&gt;security-&gt;getTokenKey() ?&gt;" value="&lt;?php echo $this-&gt;security-&gt;getToken() ?&gt;"/&gt;
            &lt;input type="submit" class="btn g_blue" value="Enviar" /&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;
&lt;!-- END login beta --&gt;</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3537" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3537" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/83c11918052630e4dda79206c336924d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/569/kaioken" class="user-moderator-N"><span itemprop="name">Max Castro</span></a>        </span>
        <br>

        <span class="karma">16.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3548" href="#C3548">
                <time itemprop="dateCreated" datetime="2013-09-21T14:29:29-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Any update?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3548" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3548" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3549" href="#C3549">
                <time itemprop="dateCreated" datetime="2013-09-21T14:31:55-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Could you try using a static name for the input: </p>
<pre><code class="language-html">&lt;input type="hidden" name="csrf" value="&lt;?php echo $this-&gt;security-&gt;getToken() ?&gt;"/&gt;</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3549" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3549" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/83c11918052630e4dda79206c336924d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/569/kaioken" class="user-moderator-N"><span itemprop="name">Max Castro</span></a>        </span>
        <br>

        <span class="karma">16.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="3565" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '14</span>
              </span><br/><a name="C3565" href="#C3565">
                <time itemprop="dateCreated" datetime="2013-09-22T17:45:36-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Nop not working</p>
<p>If i do this on the index.phtml on the main view</p>
<pre><code class="language-html">&lt;!-- login beta --&gt;
&lt;div id="beta_login"&gt;
    &lt;h2 class="innerS"&gt;¡Regístrate para la versión beta!&lt;/h2&gt;
    &lt;?php //echo $this-&gt;tag-&gt;form('') ?&gt;
    &lt;?php echo $this-&gt;tag-&gt;form("invites/create") ?&gt;
        &lt;div&gt;
                &lt;?php echo $this-&gt;tag-&gt;textField(["name", "size" =&gt; "30", 'class' =&gt; 'tfield', 'placeholder' =&gt; 'Dirección de correo electrónico...']); ?&gt;
                 &lt;input type="hidden" name="&lt;?php echo $this-&gt;security-&gt;getTokenKey() ?&gt;" value="&lt;?php echo $this-&gt;security-&gt;getToken() ?&gt;"/&gt;

                &lt;input type="submit" class="btn g_blue" value="Enviar" /&gt;
        &lt;/div&gt;
    &lt;/form&gt;
&lt;/div&gt;
&lt;!-- END login beta --&gt;</code></pre>
<p>It doesnt work but if I use the token on another controller/view that is not the index, it work perfectly :S</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3565" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3565" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/83c11918052630e4dda79206c336924d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/569/kaioken" class="user-moderator-N"><span itemprop="name">Max Castro</span></a>        </span>
        <br>

        <span class="karma">16.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3566" href="#C3566">
                <time itemprop="dateCreated" datetime="2013-09-22T18:05:26-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ok so , this is too weird,</p>
<p>If i have the form running with  token at index.phtml on the IndexController , tokens wont work on any place of the system. But if I dont use the token on that main function, it will work everyplace  else , any one else having this issue?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3566" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3566" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/83c11918052630e4dda79206c336924d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/569/kaioken" class="user-moderator-N"><span itemprop="name">Max Castro</span></a>        </span>
        <br>

        <span class="karma">16.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C3567" href="#C3567">
                <time itemprop="dateCreated" datetime="2013-09-22T18:53:47-07:00" class="action-date">Sep '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ok found a solution, change the index in the route to another function and everything will work currently, please try it yourself<a href="https://forum.phalcon.io/user/1/phalcon"> @Phalcon</a> and let me know if you can reproduce the error</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="3567" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="3567" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ab260c3f2bbba367281db5d9f67964e7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/943/natronite" class="user-moderator-N"><span itemprop="name">Nate</span></a>        </span>
        <br>

        <span class="karma">558</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5127" href="#C5127">
                <time itemprop="dateCreated" datetime="2014-01-16T13:34:32-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hello there,
I've had the same problem. I'd really like to have a sign up and/or login form on my main site. I've tried but always get a csrf validation error.
Is there a possibility to make csrf work on the index page?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5127" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5127" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/83c11918052630e4dda79206c336924d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/569/kaioken" class="user-moderator-N"><span itemprop="name">Max Castro</span></a>        </span>
        <br>

        <span class="karma">16.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5129" href="#C5129">
                <time itemprop="dateCreated" datetime="2014-01-16T13:46:54-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>hey<a href="https://forum.phalcon.io/user/0/Nate"> @Nate</a>, I dont use token on index function if you change the index to lets say home function it will work</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5129" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5129" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ab260c3f2bbba367281db5d9f67964e7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/943/natronite" class="user-moderator-N"><span itemprop="name">Nate</span></a>        </span>
        <br>

        <span class="karma">558</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5133" href="#C5133">
                <time itemprop="dateCreated" datetime="2014-01-16T23:34:07-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hey<a href="https://forum.phalcon.io/user/0/kaioken"> @kaioken</a>, That's what I figured. It just would be nice to have an official answer on that topic and my curiosity would love to know why it's behaving that way :p</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5133" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5133" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="5135" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '14</span>
              </span><br/><a name="C5135" href="#C5135">
                <time itemprop="dateCreated" datetime="2014-01-17T02:13:04-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>CSRF is working.
For example.
Token generated in form with:</p>
<pre><code class="language-php">
  protected function setFields() {
        $attributes = $this-&gt;modelsMetadata-&gt;getAttributes($this-&gt;entity);
        $metadata   = $this-&gt;annotations-&gt;get($this-&gt;entity);
        foreach ($attributes as $attribute) {
            $this-&gt;fields[$attribute] = $metadata
                    -&gt;getPropertiesAnnotations()[$attribute]
                    -&gt;get('FormOptions')
                    -&gt;getArguments();
        }
        foreach ($this-&gt;fields as $field =&gt; $type) {
            $fieldtype  = array_shift($type);
            $fieldclass = $this-&gt;classprefix . $fieldtype;
            $this-&gt;add(new $fieldclass($field, $type));
            if ($fieldtype !== 'hidden') {
                $this-&gt;get($field)-&gt;setLabel($this-&gt;get($field)-&gt;getName());
            }
        }
        $this-&gt;add(new \Phalcon\Forms\Element\Hidden($this-&gt;security-&gt;getTokenKey(), [
            'value' =&gt; $this-&gt;security-&gt;getToken(),
        ]));
        $this-&gt;add(new Submit('submit', [
            'value' =&gt; 'Send',
            'class' =&gt; 'submit-btn',
        ]));
    }

    public function renderform() {
        $this-&gt;html .= $this-&gt;tag-&gt;form([$this-&gt;action,
            'id' =&gt; $this-&gt;prefix . 'form',
        ]);
        //fill form tags
        foreach ($this as $element) {
            $this-&gt;html .= '&lt;div class="row-form"&gt;';
            $this-&gt;html .= '&lt;label for="';
            $this-&gt;html .= $element-&gt;getName() . '"&gt;';
            $this-&gt;html .= $element-&gt;getLabel() . '&lt;/label&gt;';
            $this-&gt;html .= $element;
            $this-&gt;html .= $this-&gt;messageCollect($element);
            $this-&gt;html .= '&lt;/div&gt;';
        }
        $this-&gt;html .= $this-&gt;tag-&gt;endForm();
        return $this-&gt;html;
    }</code></pre>
<p>And we check them in controller :</p>
<pre><code class="language-php"> /**
     * @Route("/new", methods={"GET", "POST"})
     */
    public function newAction() {
        if ($this-&gt;request-&gt;isPost() &amp;&amp; $this-&gt;security-&gt;checkToken()) {
            $discussform            = new DiscussForm();
            if ($discussform-&gt;isValid($this-&gt;request-&gt;getPost())) {
                $this-&gt;view-&gt;disable();
                $discussion = new Discussions();
                $discussform-&gt;bind($this-&gt;request-&gt;getPost(), $discussion, [
                    'users_id',
                    'categories_id',
                    'title',
                    'topic',
                ]);
                $discussion-&gt;save();
                $this-&gt;response-&gt;redirect();
            }
        }
        $this-&gt;assets-&gt;get('styles')-&gt;addCss('assets/css/form.css');
        $discussform             = new DiscussForm();
        $this-&gt;view-&gt;discussform = $discussform;
    }</code></pre>
<p>You must check token in your controller (action) before any operation, wich may generate new token.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5135" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5135" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ab260c3f2bbba367281db5d9f67964e7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/943/natronite" class="user-moderator-N"><span itemprop="name">Nate</span></a>        </span>
        <br>

        <span class="karma">558</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5136" href="#C5136">
                <time itemprop="dateCreated" datetime="2014-01-17T02:49:06-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks<a href="https://forum.phalcon.io/user/0/oleg578"> @oleg578</a>. Maybe I need to do it this way to make it work. I was using the technique used in Vökuró. It works great except on the index controller. But I'll implement it like you suggested and make it work :D</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5136" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5136" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5137" href="#C5137">
                <time itemprop="dateCreated" datetime="2014-01-17T03:03:15-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I do not advise Vokuro regarded as a tutorial. It's my opninion.
It was created when the Phalcon was 0.9.
Just need to detail and slowly read the documentation. And several times, preferably :)
In my experience - helps :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5137" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5137" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ab260c3f2bbba367281db5d9f67964e7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/943/natronite" class="user-moderator-N"><span itemprop="name">Nate</span></a>        </span>
        <br>

        <span class="karma">558</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5138" href="#C5138">
                <time itemprop="dateCreated" datetime="2014-01-17T03:27:19-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hehe. Will do. And build my stuff from scratch according to the docu :D Thanks!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5138" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5138" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d2e0e0f3420dc4138963548fedfb1e39?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/268/jimmycdinata" class="user-moderator-N"><span itemprop="name">Jimmy Chandra</span></a>        </span>
        <br>

        <span class="karma">21.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5403" href="#C5403">
                <time itemprop="dateCreated" datetime="2014-02-03T18:35:35-07:00" class="action-date">Feb '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/oleg578">@oleg578</a>
Do you have idea what php.ini setting related to when my csrf is not working?</p>
<p>I've tried many ways (including yours) but still no luck.</p>
<p>Thanks.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5403" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5403" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5404" href="#C5404">
                <time itemprop="dateCreated" datetime="2014-02-03T20:27:19-07:00" class="action-date">Feb '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>At start check your server and CGI for work with session without Phalcon.
After play with session via Phalcon documentation.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5404" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5404" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d8ff73fe4bdd5a3bf4c6f15ab6503ced?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1055/avra911" class="user-moderator-N"><span itemprop="name">avra911</span></a>        </span>
        <br>

        <span class="karma">785</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="5629" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '14</span>
              </span><br/><a name="C5629" href="#C5629">
                <time itemprop="dateCreated" datetime="2014-02-23T02:00:21-07:00" class="action-date">Feb '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>thanks,<a href="https://forum.phalcon.io/user/0/Max"> @Max</a> Castro
changing &quot;/&quot; route to something different than index/index worked perfectly</p>
<p>however i found an interesting behavior of beforeExecuteRoute($dispatcher), flashing error once will displayed twice in the page
i believe it has something to do with csrf also when in is not working, because is trigerred twice</p>
<p>does somebody has an explication why a single flash in before route is displayed twice?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5629" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5629" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1fcf827b80188a603d1a52b9c8f8c859?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/940/jymboche" class="user-moderator-N"><span itemprop="name">jymboche</span></a>        </span>
        <br>

        <span class="karma">16.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C6144" href="#C6144">
                <time itemprop="dateCreated" datetime="2014-03-12T13:25:01-07:00" class="action-date">Mar '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Wow... this is a super bizarre issue. How many of you with this issue are using Chrome?</p>
<p>Here's what I've discovered. In Safari and Firefox if I clear my cookies/browsing history everything works as expected. Thats reasonable. But heres the weird part:</p>
<p>Im on page /author/dashboard and have a link in which I use getToken to generate a $_GET variable to /session/logout?tok=xxxx...
My default controller is &quot;SiteController&quot; and default action is &quot;main.&quot; If I even HAVE an indexAction my csrf links are wrong... I'm not on the default route, nor do I have the default route set to /site/index... Merely having indexAction in  SiteController messes up my csrf links in Chrome -- even though its a complete separate controller than what I'm on!</p>
<p><a href="https://forum.phalcon.io/user/1/phalcon">@phalcon</a> can you speculate on this?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="6144" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="6144" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-positive">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/61552f6d4e2d8ee1b817092afdf69786?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1357/warmwaterkruik" class="user-moderator-N"><span itemprop="name">Daniel</span></a>        </span>
        <br>

        <span class="karma">278</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="6649" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '14</span>
              </span><br/><a name="C6649" href="#C6649">
                <time itemprop="dateCreated" datetime="2014-03-27T10:05:40-07:00" class="action-date">Mar '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>FINALLY after a long search I found it via the Zend CSRF bug in Chrome. What Chrome does is request the favicon.ico in the background. If it does not find it, it requests the page again and you get a new csrf token. The fix is adding the favicon.ico</p>
<p>ALSO: turn off the Web Inspector Tool. The CSRF check does not work with the toolbar open.</p>
<p>This bug I do not have in Firefox.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="6649" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="6649" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">8</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/693cd29a926f2659ccec45ba126abd71?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/11/doit76" class="user-moderator-N"><span itemprop="name">Karol Marcinkiewicz</span></a>        </span>
        <br>

        <span class="karma">40.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="6651" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '14</span>
              </span><br/><a name="C6651" href="#C6651">
                <time itemprop="dateCreated" datetime="2014-03-27T10:15:53-07:00" class="action-date">Mar '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi,<br />
It is true :) not only favicon.ico, robots.txt, and any other.<br />
At http server you can eliminate this bug too.<br />
Below for nginx</p>
<pre><code class="language-php">server {
    #listen, servername, root etc

    location = /robots.txt { return 204; access_log off; log_not_found off; }
    location = /favicon.ico { return 204; access_log off; log_not_found off; }
    location ~ /\. { access_log off; log_not_found off; allow all; }
    location ~ ~$ { access_log off; log_not_found off; deny all; }

    # other locations, for php, error_page etc
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="6651" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="6651" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d8ff73fe4bdd5a3bf4c6f15ab6503ced?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1055/avra911" class="user-moderator-N"><span itemprop="name">avra911</span></a>        </span>
        <br>

        <span class="karma">785</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="6652" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '14</span>
              </span><br/><a name="C6652" href="#C6652">
                <time itemprop="dateCreated" datetime="2014-03-27T10:21:02-07:00" class="action-date">Mar '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/warmwaterkruik">@warmwaterkruik</a> if you close the firefox browser and open again it will reproduce as in chrome (but only once, next times will work). Thanks for discovering that!</p>
<p>R</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="6652" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="6652" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C6649"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/61552f6d4e2d8ee1b817092afdf69786?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Daniel                    </a>
                </div><div class="posts-buttons" align="right"><a name="C6653" href="#C6653">
                <time itemprop="dateCreated" datetime="2014-03-27T10:22:37-07:00" class="action-date">Mar '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you, this MUST be added to the docs :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="6653" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="6653" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/693cd29a926f2659ccec45ba126abd71?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/11/doit76" class="user-moderator-N"><span itemprop="name">Karol Marcinkiewicz</span></a>        </span>
        <br>

        <span class="karma">40.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C6657" href="#C6657">
                <time itemprop="dateCreated" datetime="2014-03-27T11:15:14-07:00" class="action-date">Mar '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Some times ago I had problem with flashSession the same reason. I though that flashSession didn't work but it was flushed by favicon. Some hours lost :(</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="6657" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="6657" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8021" href="#C8021">
                <time itemprop="dateCreated" datetime="2014-05-20T12:42:43-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>A bit of a necro post, but I thought I'd add my Apache config to mirror the nginx config posted above:</p>
<pre><code>RedirectMatch 204 /robots.txt
RedirectMatch 204 /favicon.ico</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8021" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8021" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5e765e30b2def171a913a5501de37faa?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/506/oh-ren" class="user-moderator-N"><span itemprop="name">ren</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8943" href="#C8943">
                <time itemprop="dateCreated" datetime="2014-06-26T07:23:42-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This also happens in <code>Firefox</code> with <code>Firebug</code> <em>en</em>abled and <code>browser cache</code> <em>dis</em>abled.</p>
<p>The page is requested twice, with the 2nd page request being done after all other requests.</p>
<p>This must mean then that the result of the <em>first</em> request is shown in the browser (with the 2nd one f*ing up the token in the session of course.)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8943" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8943" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/222e4902d9096abe7c851523bf503744?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3380/rex2002xp" class="user-moderator-N"><span itemprop="name">Victor Cornejo</span></a>        </span>
        <br>

        <span class="karma">90</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C6649"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/61552f6d4e2d8ee1b817092afdf69786?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Daniel                    </a>
                </div><div class="posts-buttons" align="right"><a name="C16246" href="#C16246">
                <time itemprop="dateCreated" datetime="2015-03-01T19:15:01-07:00" class="action-date">Mar '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you, only add favicon and all nice .</p>
<blockquote>
<p>FINALLY after a long search I found it via the Zend CSRF bug in Chrome. What Chrome does is request the favicon.ico in the background. If it does not find it, it requests the page again and you get a new csrf token. The fix is adding the favicon.ico</p>
<p>ALSO: turn off the Web Inspector Tool. The CSRF check does not work with the toolbar open.</p>
<p>This bug I do not have in Firefox.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="16246" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="16246" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/96a28ea309921461eb53e6e3f548ebe2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3505/johnlfoleyiii" class="user-moderator-N"><span itemprop="name">John Foley</span></a>        </span>
        <br>

        <span class="karma">110</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="26891" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '15</span>
              </span><br/><a name="C26891" href="#C26891">
                <time itemprop="dateCreated" datetime="2015-11-24T13:07:04-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I have been experiencing this problem. What we are all trying to do here is make sure that a second request isn't made to the same controller and action as is sent when the page loads. What is causing this problem is requests being made for files that are not there. What I found the solution was is logging the controller name and action name everytime a request is made to find out which files are being requested and not found..</p>
<p>For many, this will be the favicon.ico or the robots.txt file.</p>
<p>For me the problem was a little different:</p>
<p>I was hosting a version of jquery on my server at js/jquery.min.js. What I found is that everytime I loaded a page that used this jquery file a request was made looking for js/jquery.min.map and since I didn't have that file in the js directory it went looking for it inside phalcon by looking for the js controller with the jquery.min.map action. When it couldn't find that another request was sent to the same controller and action as before. In my case this could have been index/index or login/index, it could have been any combination. The solution was for me to put in the jquery.min.map file from code.jquery.com/jquery.min.map. Then the same thing happened again where requests were made for jquery.js ( This is the web inspectors looking for these ). So I put in the jquery.js from code.jquery.com/jquery.js. After doing that there were never any unwanted requests made again.</p>
<p>The point here is that you need to make sure that all files that are being requested are found, or you need to change you code so that those files are not requested at all ( you could have just loaded jquery from the jquery domain instead of your own web server ). In order to check out which files are being requested and not found, make sure to log dispatcher information like so:</p>
<pre><code>    $controller = $dispatcher-&gt;getControllerName ();
    $action = $dispatcher-&gt;getActionName ();
    Phalcon\DI::getDefault()-&gt;get('logger')-&gt;debug( $controller .' '. $action );</code></pre>
<p>What my log showed when I was experiencing the issue:</p>
<pre><code>    [Tue, 24 Nov 15 19:32:00 +0000][DEBUG][][] index index
    [Tue, 24 Nov 15 19:32:00 +0000][DEBUG][][] js jquery.min.map
    [Tue, 24 Nov 15 19:32:00 +0000][DEBUG][][] index index</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="26891" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="26891" data-cf-modified-aed4500f2a7b257877f7fb91-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="922" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>