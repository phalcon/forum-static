---
layout: default
title: 'Performance Tips: Starting with Models in controllers... - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/21/beginners">Beginners</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Performance Tips: Starting with Models in controllers...</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a></span>
            <time itemprop="dateCreated" datetime="2017-08-04T09:54:05-07:00">Aug '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-08-04T09:54:05-07:00">Aug '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Aug '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">5</span>
                </td>
                <td>
                    <label>Views</label><br>587</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a></span>
                <span class="karma">47.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C16659" href="#C16659">
        <time class="action-date">Aug '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hi,</p>
<p>Would anyone be willing to share any tips on leverageing performance in phalcon particularly in the way models are called in view and controller?</p>
<p>So for example what would be the most performant code when displaying multiply related models which includes getting firsts and lasts of related models in the view.</p>
<p>(edit: It's working!)</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-c3feae5ebf889927d3a54214-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-c3feae5ebf889927d3a54214-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e551053274114c51c47004223c8e65b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9839/ChangePlaces" class="user-moderator-N"><span itemprop="name">ChangePlaces</span></a>        </span>
        <br>

        <span class="karma">10.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50071" href="#C50071">
                <time itemprop="dateCreated" datetime="2017-08-04T10:29:16-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>??? ??? ???</p>
<p>get it working first. then worry about making it faster if you have to.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50071" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50071" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a4422d89d7bed6763f236da321a1747f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9683/petermoo" class="user-moderator-N"><span itemprop="name">Peter</span></a>        </span>
        <br>

        <span class="karma">9.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50079" href="#C50079">
                <time itemprop="dateCreated" datetime="2017-08-05T00:21:14-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>As mentioned above, make it work first. Then use the database's tools for showing you the SQL plus the database's interpretation of the SQL. You are far more likely to improve speed by working with the database to add indexes or increase a buffer allocation.</p>
<p>When you find the worst performing queries, bring them back to here to discuss how you might change the query through Phalcon.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50079" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50079" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a>        </span>
        <br>

        <span class="karma">47.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="50127" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '17</span>
              </span><br/><a name="C50127" href="#C50127">
                <time itemprop="dateCreated" datetime="2017-08-07T04:27:42-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I ended up installing webgrind to display the xdebug profiler cache.</p>
<p>This has helped me pinpoint problem area's.</p>
<p>git clone <a href="https://github.com/jokkedk/webgrind.git">https://github.com/jokkedk/webgrind.git</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50127" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50127" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a4422d89d7bed6763f236da321a1747f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9683/petermoo" class="user-moderator-N"><span itemprop="name">Peter</span></a>        </span>
        <br>

        <span class="karma">9.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50143" href="#C50143">
                <time itemprop="dateCreated" datetime="2017-08-07T15:50:15-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What were the worst problems?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50143" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50143" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a>        </span>
        <br>

        <span class="karma">47.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50173" href="#C50173">
                <time itemprop="dateCreated" datetime="2017-08-08T08:39:00-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>A bad function to generate a url in a model the needed to get GrandParent details.</p>
<p>The rest I can't pin down because they are all model related and webgrinder can only tell me:</p>
<pre><code>php::Phalcon\Mvc\Model\Query-&gt;_executeSelect
php::Phalcon\Db\Adapter\Pdo\Mysql-&gt;query</code></pre>
<p>Slow query logs in sql reveal nothing.</p>
<p>Does anyone know the most performant way to make calls on the Model?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50173" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50173" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a4422d89d7bed6763f236da321a1747f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9683/petermoo" class="user-moderator-N"><span itemprop="name">Peter</span></a>        </span>
        <br>

        <span class="karma">9.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50181" href="#C50181">
                <time itemprop="dateCreated" datetime="2017-08-08T16:07:24-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Does Webgrind tell you if the delay is Phalcon CPU or if it is MySQL?</p>
<p>For MySQL, you can get the SQL and test the SQL outside of Phalcon. It is a database issue.</p>
<p>If it is Phalcon, it is more likely to be the handling of the request or results. For example, it might bring back a list one row at a time instead of all rows in one database call. The generated SQL might indicate that type of problem. After you know the problem, you can look for model overrides to fix the problem.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50181" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50181" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a>        </span>
        <br>

        <span class="karma">47.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="50245" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '17</span>
              </span><br/><a name="C50245" href="#C50245">
                <time itemprop="dateCreated" datetime="2017-08-14T08:00:42-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I'm generally not using phql or mysql. I'd like to keep to the model.</p>
<p>No it doesn't tell you. </p>
<p>I'm not trying to view this through the lense of phalcon vs mysql.</p>
<p>I'm trying to look at this as the best practise way to leverage phalcon so the best way to call on the model.</p>
<p>Should i generate a model object and find all relations to it? Or is it more performant to write a phql query that does the same job? Or something else? </p>
<p>So more like tips phalcon coding tips on getting related models maybe? The most performant way to leverage phalcon....</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50245" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50245" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a4422d89d7bed6763f236da321a1747f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9683/petermoo" class="user-moderator-N"><span itemprop="name">Peter</span></a>        </span>
        <br>

        <span class="karma">9.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50261" href="#C50261">
                <time itemprop="dateCreated" datetime="2017-08-15T01:49:26-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>For a Phalcon oriented approach, a developer would need to know the code structure, the request, and the way the data is stored.</p>
<p>You can reduce model overheads when you bypass the model and work closer to PDO. It only makes a significant difference for some types of access. Think of a list where you want the first 20 rows. The model might read them one row at a time. A direct SQL request could ask for 20 rows at a time, reducing the internal processing.</p>
<p>When you change the model usage, you can see some of the effect through request logs. If your request translates to SQL, some databases log the SQL request and you can use the log to pick up some perfornace problems. You could then as a specific question here. You could post the generated SQL and ask how to change the model to produce bettwer SQL requests or how to change the model to produce better indexes on the tables.</p>
<p>I contributed performance enhancements to Drupal in the form of SQL and table structure changes. That was achieved by looking at the SQL log.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50261" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50261" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a>        </span>
        <br>

        <span class="karma">47.7k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C50261"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/a4422d89d7bed6763f236da321a1747f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Peter                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="50267" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '17</span>
              </span><br/><a name="C50267" href="#C50267">
                <time itemprop="dateCreated" datetime="2017-08-15T03:41:31-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>That tallies with what i am seeing.</p>
<p>This appears to be quite expensive and I don't think I need to use it so much:</p>
<pre><code class="language-php">php::Phalcon\Mvc\Model\Manager-&gt;getRelationRecords().</code></pre>
<p>That's my angle of attack sorted. I'll give it a shot and report back after a refactor.</p>
<p>Thanks!</p>
<blockquote>
<p>For a Phalcon oriented approach, a developer would need to know the code structure, the request, and the way the data is stored.</p>
<p>You can reduce model overheads when you bypass the model and work closer to PDO. It only makes a significant difference for some types of access. Think of a list where you want the first 20 rows. The model might read them one row at a time. A direct SQL request could ask for 20 rows at a time, reducing the internal processing.</p>
<p>When you change the model usage, you can see some of the effect through request logs. If your request translates to SQL, some databases log the SQL request and you can use the log to pick up some perfornace problems. You could then as a specific question here. You could post the generated SQL and ask how to change the model to produce bettwer SQL requests or how to change the model to produce better indexes on the tables.</p>
<p>I contributed performance enhancements to Drupal in the form of SQL and table structure changes. That was achieved by looking at the SQL log.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50267" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50267" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a>        </span>
        <br>

        <span class="karma">47.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50391" href="#C50391">
                <time itemprop="dateCreated" datetime="2017-08-20T17:24:17-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I wrote a sql query that couldn't be written in phql and called it against the database connection.</p>
<p>My sql query had a join on select statement with joins and a group by. Maybe it can be done in phql.</p>
<p>In any case I shaved off 1sec. Thanks!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50391" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50391" data-cf-modified-c3feae5ebf889927d3a54214-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="16659" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>