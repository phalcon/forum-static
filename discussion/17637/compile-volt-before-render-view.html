---
layout: default
title: 'Compile volt before render view - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/3/volt">Volt</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Compile volt before render view</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/8205/lacsyst" class="user-moderator-N"><span itemprop="name">lacsyst</span></a></span>
            <time itemprop="dateCreated" datetime="2018-01-18T03:21:53-07:00">Jan '18</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2018-01-18T03:21:53-07:00">Jan '18</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jan '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>636</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img  src="https://secure.gravatar.com/avatar/a5acb530bcb763deca419bb20b7b138c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/8205/lacsyst" class="user-moderator-N"><span itemprop="name">lacsyst</span></a></span>
                <span class="karma">3.3k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C17637" href="#C17637">
        <time class="action-date">Jan '18</time>
    </a>
</div>
<div class="post-content"><div><p>Hi</p>
<p>I have items in database and I want to add volt code in the content for exemple : </p>
<pre><code>"blalbla {% raw %}{{{% endraw %}  myfunction('param') {% raw %}}}{% endraw %} blabla".</code></pre>
<p>the problem is that I get </p>
<blockquote>
<p>blalbla {% raw %}{{{% endraw %}  myfunction('param') {% raw %}}}{% endraw %} blabla</p>
</blockquote>
<p>I tried to compile the content in my controller but still not working.</p>
<pre><code class="language-php">$item-&gt;content = (new Volt($this-&gt;view, $this-&gt;getDI()))-&gt;getCompiler()-&gt;compileString($item-&gt;content);</code></pre>
<p>How I can achieve this?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-0197a3888bbcab83772d68ea-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-0197a3888bbcab83772d68ea-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/c0ce8f5e133750a4dfea4712e533a178?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/15/le51" class="user-moderator-N"><span itemprop="name">le51</span></a>        </span>
        <br>

        <span class="karma">43.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C53529" href="#C53529">
                <time itemprop="dateCreated" datetime="2018-01-18T03:29:49-07:00" class="action-date">Jan '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi,</p>
<p>you have to register your function in volt compiler
see here: <a href="https://docs.phalcon.io/en/3.2/volt#extending-functions">https://docs.phalcon.io/en/3.2/volt#extending-functions</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="53529" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="53529" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/a5acb530bcb763deca419bb20b7b138c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8205/lacsyst" class="user-moderator-N"><span itemprop="name">lacsyst</span></a>        </span>
        <br>

        <span class="karma">3.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C53533" href="#C53533">
                <time itemprop="dateCreated" datetime="2018-01-18T04:04:20-07:00" class="action-date">Jan '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>thx le51</p>
<p>I already added my function to the compiler like this</p>
<pre><code class="language-php">$compiler-&gt;addFunction(
                            'myfunction', function ($param) {
                                return '\Namespace::myfunction(' . $param . ')';
                            }
                    );</code></pre>
<p>But I get this</p>
<blockquote>
<p>callMacro('myfunction', ['test']) ?&gt;</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="53533" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="53533" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/6221c81c81cd357c818daec1bb8b17ff?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4153/nikolay-mihaylov" class="user-moderator-N"><span itemprop="name">Nikolay Mihaylov</span></a>        </span>
        <br>

        <span class="karma">93.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C53535" href="#C53535">
                <time itemprop="dateCreated" datetime="2018-01-18T04:09:13-07:00" class="action-date">Jan '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hmm if I understand, you want to achieve something like Worpdress &quot;shortcodes&quot;?</p>
<pre><code>// Example of replacing a string with entire partial template
{% raw %}{{{% endraw %} str_replace(
    '[flight-search-form]',
    view.getPartial("_layouts/parts/flight-search-form", ['searchType': 'simple']),
    obj.content
) {% raw %}}}{% endraw %}

// Simple replacement in your case
{% raw %}{{{% endraw %} str_replace(
    '__PLACEHOLDER_BLABLABLA__',
    someFunction(obj.someVariable),
    obj.content
) {% raw %}}}{% endraw %}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="53535" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="53535" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/a5acb530bcb763deca419bb20b7b138c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8205/lacsyst" class="user-moderator-N"><span itemprop="name">lacsyst</span></a>        </span>
        <br>

        <span class="karma">3.3k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C53535"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img  src="https://secure.gravatar.com/avatar/6221c81c81cd357c818daec1bb8b17ff?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Nikolay Mihaylov                    </a>
                </div><div class="posts-buttons" align="right"><a name="C53537" href="#C53537">
                <time itemprop="dateCreated" datetime="2018-01-18T04:16:22-07:00" class="action-date">Jan '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Hmm if I understand, you want to achieve something like Worpdress &quot;shortcodes&quot;?</p>
<pre><code>// Example of replacing a string with entire partial template
{% raw %}{{{% endraw %} str_replace(
   '[flight-search-form]',
   view.getPartial("_layouts/parts/flight-search-form", ['searchType': 'simple']),
   obj.content
) {% raw %}}}{% endraw %}

// Simple replacement in your case
{% raw %}{{{% endraw %} str_replace(
   '__PLACEHOLDER_BLABLABLA__',
   someFunction(obj.someVariable),
   obj.content
) {% raw %}}}{% endraw %}</code></pre>
</blockquote>
<p>Hi</p>
<p>Yes I want to achieve something like loadposition in Joomla, I have entity named blocks, with block position field, I want to be able to load my block in the content. So I need to convert {% raw %}{{{% endraw %} displayBlock(&quot;position&quot;) {% raw %}}}{% endraw %} to the content of the block.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="53537" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="53537" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/a5acb530bcb763deca419bb20b7b138c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8205/lacsyst" class="user-moderator-N"><span itemprop="name">lacsyst</span></a>        </span>
        <br>

        <span class="karma">3.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C53539" href="#C53539">
                <time itemprop="dateCreated" datetime="2018-01-18T04:48:16-07:00" class="action-date">Jan '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>the problem of your piece of code is that my function parameter can change, the placeholder not fixed text.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="53539" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="53539" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/6221c81c81cd357c818daec1bb8b17ff?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4153/nikolay-mihaylov" class="user-moderator-N"><span itemprop="name">Nikolay Mihaylov</span></a>        </span>
        <br>

        <span class="karma">93.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="53541" data-toggle="modal" data-target="#historyModal">
                edited <span>Jan '18</span>
              </span><br/><a name="C53541" href="#C53541">
                <time itemprop="dateCreated" datetime="2018-01-18T05:29:50-07:00" class="action-date">Jan '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Well not 100% sure what you want to achieve, but judging from your question you want to execute some code inside of a Text block generated from WYSIWYG editor for example? </p>
<p>1) If above is correct, your best option is to use placeholders. It is easier for non programmer users to use and less fragile to break your app. It is easy to pass parameters in shortcodes:</p>
<pre><code>'[flight-search-form blabla=123 test=44 bla2="haha"]'</code></pre>
<p>You just have to replace <code>str_replace</code> with  more advanced function that can parse parameters.</p>
<p>2) If your page is built with &quot;blocks&quot; then you have to use some other logic. In this case i would do something like:</p>
<pre><code>// Lets say your Blocks setup in the CMS looks like:
BLOCK-0 (header navigation)
BLOCK-1 (generic slideshow)
BLOCK-2 (news widget)
BLOCK-3 (products slideshow)
BLOCK-4 (footer navigation)

// Volt code may look something like:
{% raw %}{%{% endraw %} for block in blocks {% raw %}%}{% endraw %}
    {% raw %}{{{% endraw %} block.render() {% raw %}}}{% endraw %} // This is a random function name
{% raw %}{%{% endraw %} endfor {% raw %}%}{% endraw %}</code></pre>
<p>In the example above the <code>block</code> can be a Model object, which will contain all needed DB properties/parameters which can be used in the related block template.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="53541" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="53541" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/a5acb530bcb763deca419bb20b7b138c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8205/lacsyst" class="user-moderator-N"><span itemprop="name">lacsyst</span></a>        </span>
        <br>

        <span class="karma">3.3k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C53543" href="#C53543">
                <time itemprop="dateCreated" datetime="2018-01-18T06:07:12-07:00" class="action-date">Jan '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>thx Nikolay</p>
<p>I find a quick solution, I created a class with the functions for rendering the content and I add this function</p>
<pre><code class="language-php">    public function prepareContent($content) {
        return preg_replace_callback("/{% raw %}{{{% endraw %}2}[^{}]*\}{2}/", function($matches) {
            foreach ($matches as $m) {
                return eval('return \PathToMyClass::' . substr(substr($m, 0, -2), 3, strlen($m)) . ';');
            }
        }, $content);
    }</code></pre>
<p>and in my content controller I do:</p>
<pre><code class="language-php">$content-&gt;description = $this-&gt;elements-&gt;prepareContent($content-&gt;description);</code></pre>
<p>Its' working and I don't need to declare my functions in volt compiler.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="53543" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="53543" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/6221c81c81cd357c818daec1bb8b17ff?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4153/nikolay-mihaylov" class="user-moderator-N"><span itemprop="name">Nikolay Mihaylov</span></a>        </span>
        <br>

        <span class="karma">93.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C53545" href="#C53545">
                <time itemprop="dateCreated" datetime="2018-01-18T06:10:51-07:00" class="action-date">Jan '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>As long as you trust the content source it should do the job. Well done :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="53545" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="53545" data-cf-modified-0197a3888bbcab83772d68ea-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="17637" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>