---
layout: default
title: 'getBestLanguage for Googlebot - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/26/http-environment">HTTP Environment</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">getBestLanguage for Googlebot</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/3786/tihoho" class="user-moderator-N"><span itemprop="name">Alexander V.</span></a></span>
            <time itemprop="dateCreated" datetime="2016-01-04T07:22:37-07:00">Jan '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-01-04T07:22:37-07:00">Jan '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jan '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>513</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/e795ffea55ac8a4f34da1fbb8e409d3d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/3786/tihoho" class="user-moderator-N"><span itemprop="name">Alexander V.</span></a></span>
                <span class="karma">19.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C10067" href="#C10067">
        <time class="action-date">Jan '16</time>
    </a>
</div>
<div class="post-content"><div><p>Hi guys!</p>
<p>getBestLanguage detected user-agent language if not set a header ACCEPT_LANGUAGE ? Example: googlebot, etc.</p>
<p>what this method return if user-agent not found and header accept_language not found? false? null? how it detect?</p>
<p>Thanks and nice day!</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4769/Izopi4a" class="user-moderator-Y"><span itemprop="name">Izo</span></a>        </span>
        <br>

        <span class="karma">85.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="28529" data-toggle="modal" data-target="#historyModal">
                edited <span>Jan '16</span>
              </span><br/><a name="C28529" href="#C28529">
                <time itemprop="dateCreated" datetime="2016-01-04T08:00:43-07:00" class="action-date">Jan '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>as far as I understand ,you can return whatever you want, the thing is what does your application expect from this function ?</p>
<p>me personally after i check the language if it is empty I return a &quot;default one&quot; ( lets say English , en_US) because my app needs a language, and if there is something wrong, i simply dont care i display the default language</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="28529" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="28529" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e795ffea55ac8a4f34da1fbb8e409d3d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3786/tihoho" class="user-moderator-N"><span itemprop="name">Alexander V.</span></a>        </span>
        <br>

        <span class="karma">19.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C28531" href="#C28531">
                <time itemprop="dateCreated" datetime="2016-01-04T08:37:03-07:00" class="action-date">Jan '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Izo, i understand you. But i interest: getBestLanguage use header (accept_language) and useragent, or some one ? or i need add one detect by useragent if GBL retured header langs only?</p>
<pre><code>$lang = substr($request-&gt;getBestLanguage(), 0, 2);
// need it? :
if(empty($lang)) {
   $lang = $defLang;
}</code></pre>
<p>and how detect language searchable bots ? google, yandex etc</p>
<p>Thanks!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="28531" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="28531" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e795ffea55ac8a4f34da1fbb8e409d3d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3786/tihoho" class="user-moderator-N"><span itemprop="name">Alexander V.</span></a>        </span>
        <br>

        <span class="karma">19.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C28533" href="#C28533">
                <time itemprop="dateCreated" datetime="2016-01-04T08:43:04-07:00" class="action-date">Jan '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>im tested via requestmaker[dot]com without accept lang and without useragent. gBL returned false. It means necessary so:</p>
<pre><code>...
if(!$lang) {
    $lang = $defLang;
}
...</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="28533" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="28533" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4769/Izopi4a" class="user-moderator-Y"><span itemprop="name">Izo</span></a>        </span>
        <br>

        <span class="karma">85.5k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="28535" data-toggle="modal" data-target="#historyModal">
                edited <span>Jan '16</span>
              </span><br/><a name="C28535" href="#C28535">
                <time itemprop="dateCreated" datetime="2016-01-04T10:29:40-07:00" class="action-date">Jan '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>well here is source code of phalcon <a href="https://github.com/phalcon/cphalcon/blob/7cd81ef3c04f660f2d901aa285c051ec8f44c0a1/phalcon/http/request.zep#L917">https://github.com/phalcon/cphalcon/blob/7cd81ef3c04f660f2d901aa285c051ec8f44c0a1/phalcon/http/request.zep#L917</a></p>
<p>it uses <code>HTTP_ACCEPT_LANGUAGE</code></p>
<p>and if we check php.net <a href="https://www.php.net/manual/en/reserved.variables.server.php">https://www.php.net/manual/en/reserved.variables.server.php</a>  it says <code>Contents of the Accept-Language: header from the current request, if there is one. Example: 'en'.</code></p>
<p>so my guess would be that it should be null.</p>
<p>regard the checking i am not an <code>empty()</code> user so i dont know you have to check it yourself. </p>
<p>but what i usually do is like : </p>
<pre><code class="language-php">
$langs = [
    'en_US' =&gt; "US",
    'de_DE' =&gt; "DE" // or whatever
];

$lang = $request-&gt;getBestLanguage();

if (false == isset($langs[$lang])){
    return "EN"; // the default one 
}

return $langs[$lang];</code></pre>
<p>so in this case i wont care what $_SERVER headers sends.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="28535" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="28535" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e795ffea55ac8a4f34da1fbb8e409d3d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3786/tihoho" class="user-moderator-N"><span itemprop="name">Alexander V.</span></a>        </span>
        <br>

        <span class="karma">19.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="28557" data-toggle="modal" data-target="#historyModal">
                edited <span>Jan '16</span>
              </span><br/><a name="C28557" href="#C28557">
                <time itemprop="dateCreated" datetime="2016-01-05T01:50:41-07:00" class="action-date">Jan '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>my release as service. maybe someone will need.</p>
<pre><code>$di-&gt;setShared('lang', function() use ($di) {

        $langDefault = 'en';

        $request = $di-&gt;getRequest();
        $cookies = $di-&gt;getCookies();

        // Если есть кука с языком
        if($cookies-&gt;has('lang')) {
            $lang = $cookies-&gt;get('lang');
        }
        // Если нет
        else {
            // Ставим язык из браузера 
            $lang = substr($request-&gt;getBestLanguage(), 0, 2);

            // Если из браузера или заголовков определить не удалось
            if(!$lang) {
                // Ставим по умолчанию
                $lang = $langDefault;
            } 
            else {
                // Устанавливаем куку на 1 год
                $cookies-&gt;set('lang', $lang, time() + 365 * 86400);
            }
        }

        return $lang ?: $langDefault;
    });

    $di-&gt;setShared('translate', function() use ($di) {

        $lang = $di-&gt;getLang();

        // Доступные переводы
        $acceptLanguages = array(
            'en','ru',
        );

        // Языки-замены
        $friendlyLanguages = array(
            'ru' =&gt; ['ru','be','uk','kk'],
            'en' =&gt; ['en'],
        );

        // Если перевод на этот язык не готов - ищем ближайший понятный
        if(!in_array($lang, $acceptLanguages)) {
            foreach($friendlyLanguages as $from =&gt; $to) {
                if(in_array($lang, $to)) {
                    $lang = $from;
                    break;
                }
            }
        }

        // Подключаем перевод
        if (file_exists('../app/langs/'.$lang.'.php')) {
            require '../app/langs/'.$lang.'.php';
        }

        return new \Phalcon\Translate\Adapter\NativeArray(array(
            'content' =&gt; $messages
        ));

    });</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="28557" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="28557" data-cf-modified-b9eec8cf9efb5f99129628e4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="10067" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>