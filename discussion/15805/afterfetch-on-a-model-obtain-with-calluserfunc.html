---
layout: default
title: 'afterFetch on a model obtain with call_user_func - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">afterFetch on a model obtain with call_user_func</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/457/dlusignan" class="user-moderator-N"><span itemprop="name">Daniel</span></a></span>
            <time itemprop="dateCreated" datetime="2017-03-23T11:36:48-07:00">Mar '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-03-23T11:36:48-07:00">Mar '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Mar '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>616</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/e2fc7e2dd9d373126cccff6bb4d7169b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/457/dlusignan" class="user-moderator-N"><span itemprop="name">Daniel</span></a></span>
                <span class="karma">31.3k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C15805" href="#C15805">
        <time class="action-date">Mar '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hi,</p>
<p>I use to call my data in a specific situation like that:</p>
<pre><code>call_user_func(array($tableName, 'find'), array(

    'conditions' =&gt; $parameter,
));</code></pre>
<p>Is it possible that afterFetch is not call in this situation ?</p>
<p>Thank you.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-675d4f4bbebcea861f68bf55-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-675d4f4bbebcea861f68bf55-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46885" href="#C46885">
                <time itemprop="dateCreated" datetime="2017-03-24T01:33:22-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>If you will select not full models then yes. Also don't use <code>call_user_func</code>, just use <code>$tableName::find();</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46885" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46885" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e2fc7e2dd9d373126cccff6bb4d7169b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/457/dlusignan" class="user-moderator-N"><span itemprop="name">Daniel</span></a>        </span>
        <br>

        <span class="karma">31.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46909" href="#C46909">
                <time itemprop="dateCreated" datetime="2017-03-24T10:27:13-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I select the whole models. The function still not firing. I don't get it. I made the change mproposed by Wojciech. But, same problem.</p>
<p>The call :</p>
<pre><code>$data = $tableName::find(array(

    'conditions' =&gt; $parameter,
    'order' =&gt; $tableDefinitionColumn-&gt;ColumnName .  " $direction"
));</code></pre>
<p>The model :</p>
<pre><code>public function initialize() {

    $this-&gt;setSource('city_names');
}

public function columnMap() {

    return [

        "id_city" =&gt; "ID",
        "country_name" =&gt; "CountryName",
        "city_name_ok" =&gt; "CityNameCorrected",
        "to_skip" =&gt; "ToSkip",
        "is_deleted" =&gt; "IsDeleted",
        "province_name" =&gt; "StateName",
        "city_name" =&gt; "CityName",
        "time" =&gt; "Time",
        "is_google_checked" =&gt; "IsGoogleChecked",
    ];
}

public function afterFetch() {

    $this-&gt;Time = date_format('Y-m-d', $this-&gt;Time);
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46909" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46909" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="46911" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '17</span>
              </span><br/><a name="C46911" href="#C46911">
                <time itemprop="dateCreated" datetime="2017-03-24T10:32:55-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Oh i just didnt get your question :C Yes, i thought you are looking way TO NOT FIRE AFTER FETCH. AfterFetch will be fired when you will access any model from resultset. It's not fired on <code>::find</code> alone, model instance is created once you will access any row, toArray method is returning resultset from database raw data + columnMap - this is making resultset really fast.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46911" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46911" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e2fc7e2dd9d373126cccff6bb4d7169b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/457/dlusignan" class="user-moderator-N"><span itemprop="name">Daniel</span></a>        </span>
        <br>

        <span class="karma">31.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46913" href="#C46913">
                <time itemprop="dateCreated" datetime="2017-03-24T10:47:11-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>OK, so if I understand correctly, when I execute </p>
<pre><code>$data-&gt;toArray();</code></pre>
<p>afterFetch should be executed ? Because he is not. The other way I understand it is that when I loop over the dataset like :</p>
<pre><code>foreach($data as $d) {

    echo $d-&gt;CityName;
}</code></pre>
<p>on each iterations, the afterFetch is executed ?</p>
<p>Thank you.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46913" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46913" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e90bb057b38e45709cfd8720cad56587?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/9321/zedorak" class="user-moderator-N"><span itemprop="name">zedorak</span></a>        </span>
        <br>

        <span class="karma">82</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="46923" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '17</span>
              </span><br/><a name="C46923" href="#C46923">
                <time itemprop="dateCreated" datetime="2017-03-24T16:41:32-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/Jurigag">@Jurigag</a> I have read in forum a debate over the ways to query join data from multiple tables, and I choose to use a custom query (QueryBuilder) to fetch the data doing all the joins in a single request. BUT this way i have observed that the result set is a &quot;generic&quot; dataset since I'm not using the raw model (maybe im a dumb programmer and coder, possibly), and as consequence afterFetch will never be executed it seems. </p>
<p>There is another way to format the result of the query?</p>
<p>I'm trying to do the same as Daniel, just format the date. The date is just a read field, since the database timestamps when the data is created/updated. Since is ungratful to change data from the resultset object, I'm thinking about to use a raw sql query, but then whats the point again? lol ^^</p>
<p>Thanks for reading this and any help that could be given, I'm much appreciated!</p>
<pre><code class="language-php">$query = new Phalcon\Mvc\Model\Query\Builder();

$query-&gt;addFrom("Shroubles")
-&gt;columns(array('several.columns')
-&gt;join('Shrent','Shroubles.id = Shrent.id')
-&gt;join('Shrongas','Shroubles.shorongaId = Shorongas.id')
-&gt;where('condition');

$result = $query-&gt;getQuery()-execute();</code></pre>
<p>P.S.: I know it's not good, but it was the best i could do at the moment.
P.P.S.: Sorry for my bad english, non-native speaker here.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46923" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46923" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46935" href="#C46935">
                <time itemprop="dateCreated" datetime="2017-03-25T02:25:47-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You can always format it yourself. Not sure if this new thing from 3.1.0 will work on not full models, you would need to check. If you don't select full models then result will be Phalcon\Mvc\Model\Row, not your Model class causing it to not execut afterFetch, which is good thing, because you don't have full model and all columns and in this afterFetch method you could change some not existing columns for example.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46935" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46935" data-cf-modified-675d4f4bbebcea861f68bf55-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="15805" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>