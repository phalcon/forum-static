---
layout: default
title: 'Problem with hasMany composite key - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Problem with hasMany composite key</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/6967/fabiomarayo" class="user-moderator-N"><span itemprop="name">Fabio Vieira</span></a></span>
            <time itemprop="dateCreated" datetime="2017-06-23T09:46:40-07:00">Jun '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-06-23T09:46:40-07:00">Jun '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">1</span>
                </td>
                <td>
                    <label>Views</label><br>402</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/318a62acad77db66bd432be6742791ed?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/6967/fabiomarayo" class="user-moderator-N"><span itemprop="name">Fabio Vieira</span></a></span>
                <span class="karma">986</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C16399" href="#C16399">
        <time class="action-date">Jun '17</time>
    </a>
</div>
<div class="post-content"><div><p>Good morning people,</p>
<p>I'm trying to make a relationship with <code>hasMany</code> and it is not working properly,
Model: Filial, Related Model: FilialContato</p>
<p>$this-&gt;hasMany(['filial_id','ImobiliariaId'], FilialContato::class, ['filial_id','imobiliaria_id'], ['alias' =&gt; 'FilialContato']);</p>
<p>I need both relationships to connect through &quot;filial_id&quot; and &quot;ImobiliariaId&quot;
In the log, it constructs the query correctly:
<code>SELECT .... FROM .... WHERE filial_contato.filial_id = :APR0 AND filial_contato.imobiliaria_id = :APR1{</code></p>
<p>But the past variables are in trouble, the primary key of FilialContate <code>filial_id</code> works, but ImobiliariaId does not, it returns NULL value, even if it is filled, and this happens with any other column I put there.</p>
<p><code>{"APR0":"10","APR1":null}</code></p>
<p>I've tried everything and I can not fix it, my version of Phalcon is 2.0.8</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-39c4b65c3bd69b227ec3b800-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-39c4b65c3bd69b227ec3b800-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/318a62acad77db66bd432be6742791ed?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/6967/fabiomarayo" class="user-moderator-N"><span itemprop="name">Fabio Vieira</span></a>        </span>
        <br>

        <span class="karma">986</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C49083" href="#C49083">
                <time itemprop="dateCreated" datetime="2017-06-23T10:04:50-07:00" class="action-date">Jun '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>My code for the first post is weird, follow the pictures</p>
<hr />
<p>HasMany
</p>
<hr />
<p>Schema
</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="49083" data-cf-modified-39c4b65c3bd69b227ec3b800-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="49083" data-cf-modified-39c4b65c3bd69b227ec3b800-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Åšlawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="49085" data-toggle="modal" data-target="#historyModal">
                edited <span>Jun '17</span>
              </span><br/><a name="C49085" href="#C49085">
                <time itemprop="dateCreated" datetime="2017-06-23T10:06:52-07:00" class="action-date">Jun '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Okay, now i have weird question, what's the difference between Id and <code>filial_id</code> in filial table?</p>
<p>I feel it should be like:</p>
<pre><code>$this-&gt;hasMany(['Id','ImobiliariaId'], FilialContato::class, ['filialid','imobiliaria_id'], ['alias' =&gt; 'FilialContato']);</code></pre>
<p>Or decide to using underscore or camelCase, dont use both in database.</p>
<p>You sure that in table it's not null?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="49085" data-cf-modified-39c4b65c3bd69b227ec3b800-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="49085" data-cf-modified-39c4b65c3bd69b227ec3b800-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/318a62acad77db66bd432be6742791ed?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/6967/fabiomarayo" class="user-moderator-N"><span itemprop="name">Fabio Vieira</span></a>        </span>
        <br>

        <span class="karma">986</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C49087" href="#C49087">
                <time itemprop="dateCreated" datetime="2017-06-23T10:20:06-07:00" class="action-date">Jun '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This database is very old and has passed through the hands of 15 developers, the new tables normalize to underscore, the old ones are so messed up that it's not worth the effort (there is a legacy application using this database)</p>
<p>This &quot;Id&quot; is a key per client, so there may be several clients with the same ID, but differentiated by &quot;imobiliaria_id&quot;.</p>
<p>I did the manual query in sqlyog and it works correctly, and if I only do the relationship for ImobiliariaId it works too, ie it is not the field that is empty, it seems that it can not get the value of&quot; ImobiliariaId &quot;to pass in Query that brings filial_contato</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="49087" data-cf-modified-39c4b65c3bd69b227ec3b800-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="49087" data-cf-modified-39c4b65c3bd69b227ec3b800-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="16399" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>