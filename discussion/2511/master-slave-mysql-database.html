---
layout: default
title: 'Master - Slave mysql database - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/25/configuration">Configuration</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Master - Slave mysql database</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/1780/zylden" class="user-moderator-N"><span itemprop="name">Zylden</span></a></span>
            <time itemprop="dateCreated" datetime="2014-06-09T21:14:37-07:00">Jun '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-06-09T21:14:37-07:00">Jun '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">1</span>
                </td>
                <td>
                    <label>Views</label><br>1617</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/6abf1459e9d9f5e3e2cdf8ac383c862d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/1780/zylden" class="user-moderator-N"><span itemprop="name">Zylden</span></a></span>
                <span class="karma">5.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2511" href="#C2511">
        <time class="action-date">Jun '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hi Guys
Has anyone set up a phalcon project that uses mysql databases but which makes use of both a master and a slave databse server?
So in other words we want to run some of the queries from a slave server and others from a master. But if the slave is too far behind we want to run all from the master.
Do we have to create all the models twice or can we just switch the configuration to use one or the other?
Thanx</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-cac362d002e01a492c4414f0-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-cac362d002e01a492c4414f0-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8508" href="#C8508">
                <time itemprop="dateCreated" datetime="2014-06-10T08:11:54-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The documentation is <a href="http://docs.phalcon.io/en/latest/reference/models.html#setting-multiple-databases">here</a> for how to create connections to multiple databases.  The part about sharding shows the <code>selectReadConnection()</code> method, which you may be able to use to check if the slave is up-to-date. </p>
<p>More than likely though, you don't want to be checking the slave every time.  You could check the slave once in your bootstrap, then set a constant or global variable which you could then check in <code>selectReadConnection()</code>.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8508" data-cf-modified-cac362d002e01a492c4414f0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8508" data-cf-modified-cac362d002e01a492c4414f0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/6abf1459e9d9f5e3e2cdf8ac383c862d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1780/zylden" class="user-moderator-N"><span itemprop="name">Zylden</span></a>        </span>
        <br>

        <span class="karma">5.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8529" href="#C8529">
                <time itemprop="dateCreated" datetime="2014-06-10T17:55:00-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you for that, I will definitly look into that.
I think the part our team is also looking into is to prevent writing to the slave by accident. So created double models and the slave models had an over ride on the save function to return false to make sure that the slave replication wont be broken but we will play around with trying to do a choose the correct db in the initialize.</p>
<p>So am I right in saying we can call  setConnectionService() in the initialize but then call it again in other functions in the model to switch schemas? Or should we do all the checks in the initialize and based on how far behind the slave is we might set the read to be on the master?</p>
<p>Sorry, this is our first project on phalcon so we are still trying to find our way around some of the aspects.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8529" data-cf-modified-cac362d002e01a492c4414f0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8529" data-cf-modified-cac362d002e01a492c4414f0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2511" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>