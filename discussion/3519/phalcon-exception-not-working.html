---
layout: default
title: 'phalcon exception not working - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">phalcon exception not working</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/1659/EleRam" class="user-moderator-N"><span itemprop="name">Ramin Firooz</span></a></span>
            <time itemprop="dateCreated" datetime="2014-09-23T09:36:23-07:00">Sep '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-09-23T09:36:23-07:00">Sep '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">5</span>
                </td>
                <td>
                    <label>Views</label><br>1908</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/9d7d2f04c4872aa46261fb481e30b7c1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/1659/EleRam" class="user-moderator-N"><span itemprop="name">Ramin Firooz</span></a></span>
                <span class="karma">18.4k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C3519" href="#C3519">
        <time class="action-date">Sep '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hi</p>
<p>with below code I giving error:</p>
<pre><code class="language-php">                $user = new \Modules\Shared\Models\Profile();
                $user-&gt;username         = $this-&gt;request-&gt;getPost('username');
                .
                .
                .
                if ($user-&gt;create() == false)
                {
                    // Failed
                    foreach ($user-&gt;getMessages() as $message) {
                        $message = $message;
                    }
                    $this-&gt;flash-&gt;error($message);
                }</code></pre>
<pre><code>Fatal error: Uncaught exception 'PDOException' with message 'SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry 'emo' for key 'username'' in /home/mojir/www/apps/frontend/controllers/AuthController.php:281 Stack trace: #0 [internal function]: PDOStatement-&gt;execute() #1 [internal function]: Phalcon\Db\Adapter\Pdo-&gt;executePrepared(Object(PDOStatement), Array, Array) #2 [internal function]: Phalcon\Db\Adapter\Pdo-&gt;execute('INSERT INTO `ma...', Array, Array) #3 [internal function]: Phalcon\Db\Adapter-&gt;insert('match_users', Array, Array, Array) #4 [internal function]: Phalcon\Mvc\Model-&gt;_doLowInsert(Object(Phalcon\Mvc\Model\MetaData\Memory), Object(Phalcon\Db\Adapter\Pdo\Mysql), 'match_users', false) #5 [internal function]: Phalcon\Mvc\Model-&gt;save() #6 /home/mojir/www/apps/frontend/controllers/AuthController.php(281): Phalcon\Mvc\Model-&gt;create() #7 [internal function]: Modules\Frontend\Controllers\AuthController-&gt;registerAction() #8 [internal function]: Phalcon\Dispatcher-&gt;dispatch() #9 /home/mojir/www/publi in /home/mojir/www/apps/frontend/controllers/AuthController.php on line 281</code></pre>
<p>and <code>if ($user-&gt;create() == false)</code> is in line 281 !</p>
<p>so I can not handle the error message anyway</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-0a5214725e8d3021ba1b7168-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-0a5214725e8d3021ba1b7168-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/6e9c131d69313b8a3ff940e47cc2c265?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1980/Rewt0r" class="user-moderator-N"><span itemprop="name">Michael Jephcote</span></a>        </span>
        <br>

        <span class="karma">13.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11553" href="#C11553">
                <time itemprop="dateCreated" datetime="2014-09-23T09:56:11-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Please read the error message</p>
<blockquote>
<p>Integrity constraint violation: 1062 Duplicate entry 'emo' for key 'username'</p>
</blockquote>
<p>This means that an entry already exists in the table with the username &quot;emo&quot;. The username column must have a primary or unique index.</p>
<p>You need to see if there are any users already inserted with that username before performing the create.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11553" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11553" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9d7d2f04c4872aa46261fb481e30b7c1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1659/EleRam" class="user-moderator-N"><span itemprop="name">Ramin Firooz</span></a>        </span>
        <br>

        <span class="karma">18.4k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C11553"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/6e9c131d69313b8a3ff940e47cc2c265?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Michael Jephcote                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="11555" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '14</span>
              </span><br/><a name="C11555" href="#C11555">
                <time itemprop="dateCreated" datetime="2014-09-23T10:07:16-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I know that.
I want to handle this error and show an error to user instead.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11555" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11555" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/6e9c131d69313b8a3ff940e47cc2c265?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1980/Rewt0r" class="user-moderator-N"><span itemprop="name">Michael Jephcote</span></a>        </span>
        <br>

        <span class="karma">13.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11557" href="#C11557">
                <time itemprop="dateCreated" datetime="2014-09-23T10:28:45-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>If you read the rest of my post I also state that:</p>
<blockquote>
<p>You need to see if there are any users already inserted with that username before performing the create</p>
</blockquote>
<p>You can do this by performing a <code>find()</code> <a href="http://docs.phalcon.io/pt/latest/reference/models.html#finding-records">http://docs.phalcon.io/pt/latest/reference/models.html#finding-records</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11557" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11557" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9d7d2f04c4872aa46261fb481e30b7c1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1659/EleRam" class="user-moderator-N"><span itemprop="name">Ramin Firooz</span></a>        </span>
        <br>

        <span class="karma">18.4k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C11557"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/6e9c131d69313b8a3ff940e47cc2c265?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Michael Jephcote                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="11562" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '14</span>
              </span><br/><a name="C11562" href="#C11562">
                <time itemprop="dateCreated" datetime="2014-09-23T11:17:55-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>anyway I want to handle the error </p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11562" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11562" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11565" href="#C11565">
                <time itemprop="dateCreated" datetime="2014-09-23T13:36:41-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You may want to add an UniquenessValidator there:</p>
<ul>
<li><a href="https://github.com/phalcon/invo/blob/master/app/models/Users.php#L13">https://github.com/phalcon/invo/blob/master/app/models/Users.php#L13</a></li>
<li><a href="http://docs.phalcon.io/en/latest/reference/models.html#validating-data-integrity">http://docs.phalcon.io/en/latest/reference/models.html#validating-data-integrity</a></li>
</ul></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11565" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11565" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/904c4ce01a63197158942d1203567cbf?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2353/VampireTiger" class="user-moderator-N"><span itemprop="name">VampireTiger</span></a>        </span>
        <br>

        <span class="karma">1.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="11571" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '14</span>
              </span><br/><a name="C11571" href="#C11571">
                <time itemprop="dateCreated" datetime="2014-09-24T01:36:05-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi,</p>
<p>I think everyone here is focussing on the <em>Uniqueness</em> aspect of the actual error, not what EleRam is asking for.</p>
<p>The error is caused by an <strong>exception</strong> being raised - probably within the create method.  You would need to wrap the create part with a try/catch block.  something like this:</p>
<p>try
{
if ($user-&gt;create() == false)
{
... other code here
}
}
catch( PDOException $e )
{
print 'An error occurred - more message details here';
}</p>
<p>I hope that helps.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11571" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11571" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9d7d2f04c4872aa46261fb481e30b7c1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1659/EleRam" class="user-moderator-N"><span itemprop="name">Ramin Firooz</span></a>        </span>
        <br>

        <span class="karma">18.4k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C11571"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/904c4ce01a63197158942d1203567cbf?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        VampireTiger                    </a>
                </div><div class="posts-buttons" align="right"><a name="C11573" href="#C11573">
                <time itemprop="dateCreated" datetime="2014-09-24T01:52:34-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>this is very close to what I asked.</p>
<p>my question is this:</p>
<p>when my code is:</p>
<pre><code class="language-php">if ($user-&gt;create() == false)
{
   echo 'an error accurred';
} else
{
   echo 'new record added';
}</code></pre>
<p>then when an error accurred, this line: <code>echo "an error accured";</code> must be run. is'nt this?</p>
<blockquote>
<p>Hi,</p>
<p>I think everyone here is focussing on the <em>Uniqueness</em> aspect of the actual error, not what EleRam is asking for.</p>
<p>The error is caused by an <strong>exception</strong> being raised - probably within the create method.  You would need to wrap the create part with a try/catch block.  something like this:</p>
<pre><code class="language-php">  try
  {
     if ($user-&gt;create() == false)
     {
        ... other code here
     }
  }
  catch( PDOException $e )
  {
      print 'An error occurred - more message details here';
  }</code></pre>
<p>I hope that helps.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11573" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11573" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11574" href="#C11574">
                <time itemprop="dateCreated" datetime="2014-09-24T01:56:07-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I know an exception is raised there, it's uncaught because it's directly generated by the database server (PDOException) and not by the ORM. To allow Phalcon to handle this situation in advance, you need to define a UniquenessValidator as I mentioned before, this way you'll get a 'false' as you're expecting and a message in $user-&gt;getMessages()</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11574" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span><span itemprop="downvoteCount">1</span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11574" data-cf-modified-0a5214725e8d3021ba1b7168-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="3519" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>