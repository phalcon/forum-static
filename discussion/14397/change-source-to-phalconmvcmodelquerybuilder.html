---
layout: default
title: 'Change source to Phalcon\Mvc\Model\Query\Builder - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Change source to Phalcon\Mvc\Model\Query\Builder</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/8337/andre-brudam" class="user-moderator-N"><span itemprop="name">andre-brudam</span></a></span>
            <time itemprop="dateCreated" datetime="2016-10-08T14:10:44-07:00">Oct '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-10-08T14:10:44-07:00">Oct '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Oct '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>677</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img  src="https://secure.gravatar.com/avatar/bed7737b978d70fef538278e908a6920?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/8337/andre-brudam" class="user-moderator-N"><span itemprop="name">andre-brudam</span></a></span>
                <span class="karma">796</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C14397" href="#C14397">
        <time class="action-date">Oct '16</time>
    </a>
</div>
<div class="post-content"><div><p>I'm following problem. I need to run a query in the CLI, however this query must be performed in various databases.
I change the database directly into the Model with setConnectionService($db) as in:</p>
<pre><code>$obj = new MyModel1();
$obj-&gt;setConnectionService($db);</code></pre>
<p>but I need to change the database in a query with join. I could not change the source of Phalcon\Mvc\Model\Query\Builder. I need to run a query like:</p>
<pre><code>$obj = (new Builder())-&gt;from(array('m1'=&gt;'MyModel1'))
    -&gt;innerJoin('MyModel2', 'm1.id = m2.id_m1', 'm2') ...
</code></pre>
<p>This query should be run on multiple databases.
Is there a way to do this? There is an equivalent function to setConnectionService?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-a3d6640625526de1ecdec609-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-a3d6640625526de1ecdec609-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41445" href="#C41445">
                <time itemprop="dateCreated" datetime="2016-10-08T15:09:29-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>For such database juggling you'd need PDO-only approach I guess.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41445" data-cf-modified-a3d6640625526de1ecdec609-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41445" data-cf-modified-a3d6640625526de1ecdec609-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/a245210673b1617af83d36b2935bf600?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4647/alec-w" class="user-moderator-N"><span itemprop="name">Alec Wilson</span></a>        </span>
        <br>

        <span class="karma">3.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41447" href="#C41447">
                <time itemprop="dateCreated" datetime="2016-10-08T15:10:19-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Do I understand correctly - you want to perform the join between tables in different databases?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41447" data-cf-modified-a3d6640625526de1ecdec609-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41447" data-cf-modified-a3d6640625526de1ecdec609-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41449" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '16</span>
              </span><br/><a name="C41449" href="#C41449">
                <time itemprop="dateCreated" datetime="2016-10-08T15:14:23-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>That's what it seems.
And database is bound to the connection itself, so even with PDO like in my example:</p>
<pre><code class="language-php"> private final function _connect(){
        $init = [\PDO::MYSQL_ATTR_INIT_COMMAND =&gt; 'SET NAMES UTF8'];
        $this-&gt;pdo = new \PDO("mysql:host={$this-&gt;db-&gt;connection-&gt;default-&gt;host};dbname={$this-&gt;db-&gt;connection-&gt;default-&gt;dbname};", $this-&gt;db-&gt;connection-&gt;default-&gt;username, $this-&gt;db-&gt;connection-&gt;default-&gt;password, $init);
        $this-&gt;pdo-&gt;setAttribute(\PDO::ATTR_ERRMODE, \PDO::ERRMODE_EXCEPTION);
        $this-&gt;pdo-&gt;setAttribute(\PDO::ATTR_DEFAULT_FETCH_MODE, \PDO::FETCH_OBJ);
        $this-&gt;pdo-&gt;setAttribute(\PDO::ATTR_CASE, \PDO::CASE_UPPER);
    }</code></pre>
<p>You'd need to have two separate PDO connections etc. And for that you need custom method specific to your use case of joining two databases.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41449" data-cf-modified-a3d6640625526de1ecdec609-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41449" data-cf-modified-a3d6640625526de1ecdec609-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/bed7737b978d70fef538278e908a6920?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8337/andre-brudam" class="user-moderator-N"><span itemprop="name">andre-brudam</span></a>        </span>
        <br>

        <span class="karma">796</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41453" href="#C41453">
                <time itemprop="dateCreated" datetime="2016-10-08T17:52:34-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Sorry, I guess I was not clear.
what I need is to run the same query in different databases, but not between different database tables.
I found a reasonable solution. All databases have the same structure, and all my Models are using a &quot;ConnectionService&quot; called db_client.
So I'm storing the settings for each database in CliDI()-&gt;setShared('client_name').
So for every database I change the setting of &quot;db_client&quot; like this:</p>
<pre><code class="language-php">$diCli = $this-&gt;getDI();
$diCli-&gt;setShared('db_client', $diCli-&gt;getShared($cliente));</code></pre>
<p>Thanks!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41453" data-cf-modified-a3d6640625526de1ecdec609-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41453" data-cf-modified-a3d6640625526de1ecdec609-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41469" href="#C41469">
                <time itemprop="dateCreated" datetime="2016-10-09T14:22:48-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yeah, that was clear now :)</p>
<p>But in general, application should not be providing fail over capabilities of such kind in case of a DB downtime. Load balancers in front of DB should take care of such events. Thus, your app targets one single point of entry, no matter what node might go down in the background.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41469" data-cf-modified-a3d6640625526de1ecdec609-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41469" data-cf-modified-a3d6640625526de1ecdec609-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="14397" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>