---
layout: default
title: 'Finding a way to know if a Phalcon\Mvc\Model instance is new or not - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Finding a way to know if a Phalcon\Mvc\Model instance is new or not</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/795/mapirelli" class="user-moderator-N"><span itemprop="name">Mariano Pirelli</span></a></span>
            <time itemprop="dateCreated" datetime="2015-10-06T09:04:32-07:00">Oct '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-10-06T09:04:32-07:00">Oct '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Oct '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>1503</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/35da59ba8838bb138d8f70f8c16ce7ab?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/795/mapirelli" class="user-moderator-N"><span itemprop="name">Mariano Pirelli</span></a></span>
                <span class="karma">9.6k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C8871" href="#C8871">
        <time class="action-date">Oct '15</time>
    </a>
</div>
<div class="post-content"><div><p>Hello Phalcon,</p>
<p>I'm looking for a method to know from a model instance if the model is new or not.</p>
<p>Fo me a new model is:</p>
<pre><code class="language-php">$car = new Car(); \\this is a new car.
if ($car-&gt;save() == true) {
    \\this is not a new car, because i saved it
} else {
    \\this is already a new car, becasue i dont save it successfully
}

$car = Car::findFirst(1); \\and this is a not new car.</code></pre>
<p>I'm looking for a method or something similar to this:</p>
<pre><code class="language-php">$car-&gt;isNew() : true | false</code></pre>
<p>And $car is new until i dont save it successfully on the database.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-cbf4bef9957fea29e980ca4c-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-cbf4bef9957fea29e980ca4c-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C24267" href="#C24267">
                <time itemprop="dateCreated" datetime="2015-10-06T09:25:38-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>If your model has an ID you can check that. </p>
<p>You could also have a base model that all other models extend:  That base model would have <code>afterFetch()</code> and <code>afterSave()</code> methods that could set a <code>$new</code> flag.  Your <code>isNew()</code> method could then check the status of <code>$new</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24267" data-cf-modified-cbf4bef9957fea29e980ca4c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24267" data-cf-modified-cbf4bef9957fea29e980ca4c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="24269" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '15</span>
              </span><br/><a name="C24269" href="#C24269">
                <time itemprop="dateCreated" datetime="2015-10-06T09:26:56-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>First thing, <code>$car-&gt;save()</code> will return true if the validation has passed, not if a row was inserted. There are two other methods: <code>create()</code>  and <code>update()</code>. </p>
<p>Also, the ORM only handles PRIMARY keys, so for eg UNIQUE keys will return an exception triggered by the PDO layer, not the ORM. You'll have to manually set up the proper validation with <code>Uniqueness</code> <a href="https://docs.phalcon.io/en/latest/reference/models.html#validating-data-integrity">https://docs.phalcon.io/en/latest/reference/models.html#validating-data-integrity</a></p>
<p>As for your question, there is no such method, exactly because these arbitrary parameters. You'll have to manually check with count for eg.
Or create a base Model with the required functionality and inherit your instances from there.</p>
<p>One lame trick could be to check if the primary property is set, like</p>
<pre><code class="language-php">/** @var $model SomeModel */
if($model-&gt;getId()&gt;0) {
    // exists
} else {
    // no primary key yet, probably just an instance without db record
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24269" data-cf-modified-cbf4bef9957fea29e980ca4c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24269" data-cf-modified-cbf4bef9957fea29e980ca4c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/35da59ba8838bb138d8f70f8c16ce7ab?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/795/mapirelli" class="user-moderator-N"><span itemprop="name">Mariano Pirelli</span></a>        </span>
        <br>

        <span class="karma">9.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="24297" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '15</span>
              </span><br/><a name="C24297" href="#C24297">
                <time itemprop="dateCreated" datetime="2015-10-07T00:38:48-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><h4>Thank you for the responses...</h4>
<p><a href="https://forum.phalcon.io/user/301/quasipickle">@quasipickle</a> i already use a base Model extended from my models and a own method to check the identity field:</p>
<pre><code class="language-php">abstract class ModelBase extends Model
{
    /**
     * @return string
     * @throws Exception
     */
    public function getIdentityField()
    {
        $metaData = $this-&gt;getModelsMetaData();
        $identityField = $metaData-&gt;getIdentityField($this);
        ...
        return $identityField;
    }
    public function isNew() {
        $identity = $this-&gt;getIdentityField();
        return empty($this-&gt;{$identity});
    }
}</code></pre>
<p>But with the update to Phalcon 2 i found a new beahviour during the save of the model:</p>
<pre><code class="language-php">
$car = new Car(); //id, name
$car-&gt;name = 'pippo';

$color = new Color(); //id, name
$color-&gt;name = null;

$car-&gt;Color = $color;

if ($car-&gt;save()) {
    \\inserted
} else {
    \\some error
}
</code></pre>
<p>Imagine that the model car pass the validation, but the model color dont pass it because the name is null.</p>
<p>But $car now has the ID valorized, so my method isNew() now return an incorrect value: false instead of true. This is my trouble!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24297" data-cf-modified-cbf4bef9957fea29e980ca4c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24297" data-cf-modified-cbf4bef9957fea29e980ca4c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/35da59ba8838bb138d8f70f8c16ce7ab?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/795/mapirelli" class="user-moderator-N"><span itemprop="name">Mariano Pirelli</span></a>        </span>
        <br>

        <span class="karma">9.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C24299" href="#C24299">
                <time itemprop="dateCreated" datetime="2015-10-07T01:41:37-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hello,</p>
<p>with this method i think that i solved my problem. Thank you</p>
<pre><code class="language-php">/**
     * @return bool
     */
    public function isNew() {

        return $this-&gt;isNew;
    }

    protected function afterSave() {
        $this-&gt;isNew = false;
    }

    protected function afterFetch() {
        $this-&gt;isNew = false;
    }</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24299" data-cf-modified-cbf4bef9957fea29e980ca4c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24299" data-cf-modified-cbf4bef9957fea29e980ca4c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="8871" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>