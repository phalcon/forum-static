---
layout: default
title: 'PHQL is showing Error 404 page. - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">PHQL is showing Error 404 page.</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/2357/viralj" class="user-moderator-N"><span itemprop="name">Viral Joshi</span></a></span>
            <time itemprop="dateCreated" datetime="2014-11-21T05:41:07-07:00">Nov '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-11-21T05:41:07-07:00">Nov '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>617</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/b078a71444f6c4c09a3bcab3992c3a34?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/2357/viralj" class="user-moderator-N"><span itemprop="name">Viral Joshi</span></a></span>
                <span class="karma">10.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C4043" href="#C4043">
        <time class="action-date">Nov '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hello friends, I am trying to use PHQL in my phalcon app but I a not able to understand how it works. I tried different ways to use mysql quesries by PHQL. But now I am getting error 404 page.</p>
<p>My public/index.php file has this codes</p>
<pre><code class="language-php">    $di-&gt;set('modelsManager', function() {
          return new Phalcon\Mvc\Model\Manager();
    });</code></pre>
<p>my sessions.php model has these codes,</p>
<pre><code class="language-php">&lt;?php

class Sessions extends \Phalcon\Mvc\Model
{

    /**
     *
     * @var integer
     */
    public $id;

    /**
     *
     * @var string
     */
    public $skey;

    /**
     *
     * @var string
     */
    public $time;

    /**
     * Independent Column Mapping.
     */
    public function columnMap()
    {
        return array(
            'id' =&gt; 'id', 
            'skey' =&gt; 'skey', 
            'time' =&gt; 'time'
        );
    }

    //constructor to set session
    public function setSessions(){

        if(!isset($_SESSION['CSRF'])){
            $_SESSION['CSRF'] = self::getSessionKey(self::generateKey());
        }
    }

    public function getSessionKey($var){
        $query = $this-&gt;modelsManager-&gt;createQuery("SELECT * FROM sessions WHERE skey = :skey:");
        $session = $query-&gt;execute(array(
                    'skey' =&gt; $var
                ));
    }

    public function generateKey(){

        $charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_';
        $len = 7;
        $numrows = 1;
        $csrf_token = '';

        while($numrows != 0 AND strlen($csrf_token) &lt; 8 ){
            for($i = 0; $i &lt;= $len; $i++){
                $rand = rand()% strlen($charset);
                $temp = substr($charset, $rand, 1);
                $csrf_token .= $temp;
            }

            $time = time();
            $find_query = "SELECT `id` FROM `sessions` WHERE BINARY `skey` = '$csrf_token' AND `time` &lt; '$time'";

            $query = new Phalcon\Mvc\Model\Query($find_query);

        }
        return $query;
    }

}</code></pre>
<p>and my index action in index controller has these codes</p>
<pre><code class="language-php">$session = new Sessions();
$session-&gt;setSession();</code></pre>
<p>I tried to follow documentation but I am not able to get it. Can anyone tell me which page should have which codes? And if anyone can suggest me some tutorials to use mysql in phalcon, please let me know.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/3f7853a23c7b1f200615f23bfc48eb71?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2699/kaiohken1982" class="user-moderator-N"><span itemprop="name">Sergio Rinaudo</span></a>        </span>
        <br>

        <span class="karma">6.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C13485" href="#C13485">
                <time itemprop="dateCreated" datetime="2014-11-21T06:09:11-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Viral Joshi,
if you place anything else in your IndexController::indexAction are you able to see it?</p>
<p>If not, post your index.php and your IndexController.php</p>
<p>Cheers</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13485" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13485" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b078a71444f6c4c09a3bcab3992c3a34?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2357/viralj" class="user-moderator-N"><span itemprop="name">Viral Joshi</span></a>        </span>
        <br>

        <span class="karma">10.1k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C13485"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/3f7853a23c7b1f200615f23bfc48eb71?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Sergio Rinaudo                    </a>
                </div><div class="posts-buttons" align="right"><a name="C13486" href="#C13486">
                <time itemprop="dateCreated" datetime="2014-11-21T06:13:04-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>If i remove that session model code then yes its working. Not with these codes </p>
<blockquote>
<p>Hi Viral Joshi,
if you place anything else in your IndexController::indexAction are you able to see it?</p>
<p>If not, post your index.php and your IndexController.php</p>
<p>Cheers</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13486" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13486" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C13488" href="#C13488">
                <time itemprop="dateCreated" datetime="2014-11-21T08:28:19-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Following section is using MySQL escapers which probably could lead to an error:</p>
<pre><code class="language-php">$time = time();
$find_query = "SELECT `id` FROM `sessions` WHERE BINARY `skey` = '$csrf_token' AND `time` &lt; '$time'";
$query = new Phalcon\Mvc\Model\Query($find_query);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13488" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13488" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b078a71444f6c4c09a3bcab3992c3a34?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2357/viralj" class="user-moderator-N"><span itemprop="name">Viral Joshi</span></a>        </span>
        <br>

        <span class="karma">10.1k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C13488"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Phalcon                    </a>
                </div><div class="posts-buttons" align="right"><a name="C13490" href="#C13490">
                <time itemprop="dateCreated" datetime="2014-11-21T15:15:59-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>So how can I run my queries in model? I will need to use funcltions of mysql like fetch array, num rows, affected rows etc. So can you tell me how can I use PHQL for that and which codes will go to public/index.php file and other required codes to run PHQL in all models?</p>
<blockquote>
<p>Following section is using MySQL escapers which probably could lead to an error:</p>
<pre><code class="language-php">$time = time();
$find_query = "SELECT `id` FROM `sessions` WHERE BINARY `skey` = '$csrf_token' AND `time` &lt; '$time'";
$query = new Phalcon\Mvc\Model\Query($find_query);</code></pre>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13490" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13490" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C13497" href="#C13497">
                <time itemprop="dateCreated" datetime="2014-11-21T21:41:44-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This way:</p>
<pre><code class="language-php">$time = time();
$find_query = "SELECT `id` FROM `sessions` WHERE BINARY `skey` = '$csrf_token' AND `time` &lt; '$time'";
$result = $this-&gt;db-&gt;fetchAll($find_query);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13497" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13497" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/75296831c33eb668045916530552233f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2706/dominickinyanjui" class="user-moderator-N"><span itemprop="name">Dominic Kinyanjui</span></a>        </span>
        <br>

        <span class="karma">31.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="13613" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '14</span>
              </span><br/><a name="C13613" href="#C13613">
                <time itemprop="dateCreated" datetime="2014-11-24T22:07:15-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Try this;
in your session model
public function getSessionKey($var){
$query = $this-&gt;modelsManager-&gt;createQuery(&quot;SELECT * FROM sessions WHERE skey = :skey:&quot;);
$this-&gt;db-&gt;query($query);
}</p>
<p>Then in your controller use the following inside the function you are executing
$this-&gt;getDi()-&gt;setShared('session', function() {
$session = new Phalcon\Session\Adapter\Files();
$session-&gt;start();
return $session;
});</p>
<p>error 404 page means your are calling a resource that is currently not in your web server at the time of execution.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13613" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13613" data-cf-modified-43f3dbb42f0c6b92b63481c7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="4043" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>