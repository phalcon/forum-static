---
layout: default
title: 'zend_mm_heap corrupted on db query - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">zend_mm_heap corrupted on db query</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/8201/aleksanderd" class="user-moderator-N"><span itemprop="name">Aleksander Dyomin</span></a></span>
            <time itemprop="dateCreated" datetime="2020-07-14T23:43:12-07:00">Jul '20</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2020-07-14T23:43:12-07:00">Jul '20</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '20</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">5</span>
                </td>
                <td>
                    <label>Views</label><br>433</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/7aaa6fe177c9d18767b268ae13a80798?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/8201/aleksanderd" class="user-moderator-N"><span itemprop="name">Aleksander Dyomin</span></a></span>
                <span class="karma">4.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C20749" href="#C20749">
        <time class="action-date">Jul '20</time>
    </a>
</div>
<div class="post-content"><div><p>Hi!</p>
<p>After upgrade php from 7.4.7 to 7.4.8 my app crashed at any DB query or DB model usage with no any error messages or info at the trace. The only message I found is <code>zend_mm_heap corrupted</code>.</p>
<p>Example:</p>
<pre><code class="language-php">$db-&gt;fetchAll('select * from `Option`')</code></pre>
<p>is OK, but</p>
<pre><code class="language-php">Option::findFirst();</code></pre>
<p>or </p>
<pre><code class="language-php">$q = $this-&gt;modelsManager-&gt;createBuilder()-&gt;from(Option::class)-&gt;getQuery();
$res = $q-&gt;execute();</code></pre>
<p>is failed :(</p>
<p>any ideas?</p>
<p>thanks!</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-88cc212a8ed84530533cb3b5-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-88cc212a8ed84530533cb3b5-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9842e74678b8a899c45d1c57223d12c9?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/10345/Nyde" class="user-moderator-N"><span itemprop="name">Nyde</span></a>        </span>
        <br>

        <span class="karma">4.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="63671" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '20</span>
              </span><br/><a name="C63671" href="#C63671">
                <time itemprop="dateCreated" datetime="2020-07-14T23:47:52-07:00" class="action-date">Jul '20</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This issue is already known. I suggest you to watch the bug report(s) on Github:</p>
<p><a href="https://github.com/phalcon/cphalcon/issues/15107">https://github.com/phalcon/cphalcon/issues/15107</a> (especially <a href="https://github.com/phalcon/cphalcon/issues/15107#issuecomment-658003615">https://github.com/phalcon/cphalcon/issues/15107#issuecomment-658003615</a>)</p>
<p><a href="https://github.com/phalcon/cphalcon/issues/15109">https://github.com/phalcon/cphalcon/issues/15109</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="63671" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="63671" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/7aaa6fe177c9d18767b268ae13a80798?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/8201/aleksanderd" class="user-moderator-N"><span itemprop="name">Aleksander Dyomin</span></a>        </span>
        <br>

        <span class="karma">4.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C63673" href="#C63673">
                <time itemprop="dateCreated" datetime="2020-07-15T01:41:57-07:00" class="action-date">Jul '20</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>thank you!</p>
<p>but what the solution? downgrade to 7.4.7 ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="63673" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="63673" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9842e74678b8a899c45d1c57223d12c9?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/10345/Nyde" class="user-moderator-N"><span itemprop="name">Nyde</span></a>        </span>
        <br>

        <span class="karma">4.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="63675" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '20</span>
              </span><br/><a name="C63675" href="#C63675">
                <time itemprop="dateCreated" datetime="2020-07-15T02:11:17-07:00" class="action-date">Jul '20</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Right now - yes. Personally, for me worked switching to 7.3.20 too, since I couldn't downgrade to 7.4.7.</p>
<p>Also, from the Discord, but I didn't test it yet:</p>
<blockquote>
<p>building from source fixed it, if anyone else runs into the same issue, but I'm curious as to the cause
and also how I can provide details for the core team to investigate?
FYI, I've reinstalled it via PECL and it also works again so cannot be too serious :slight_smile:</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="63675" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="63675" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/7aaa6fe177c9d18767b268ae13a80798?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/8201/aleksanderd" class="user-moderator-N"><span itemprop="name">Aleksander Dyomin</span></a>        </span>
        <br>

        <span class="karma">4.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="63677" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '20</span>
              </span><br/><a name="C63677" href="#C63677">
                <time itemprop="dateCreated" datetime="2020-07-15T02:49:35-07:00" class="action-date">Jul '20</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>since I couldn't downgrade to 7.4.7</p>
</blockquote>
<p>if you have cached previous versions, you can try:</p>
<pre><code>sudo dpkg -i /var/cache/apt/archives/php*7.4.7*</code></pre>
<p>and, to prevent upgrade create <code>/etc/apt/preferences.d/php</code> with:</p>
<pre><code>Package: php7.4*
Pin: origin ""
Pin: version 7.4.7*
Pin-Priority: 1111</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="63677" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="63677" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c90d3849ebfa2f2c3ccdedbbd3185efb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/13983/Scheibers" class="user-moderator-N"><span itemprop="name">Scheibers</span></a>        </span>
        <br>

        <span class="karma">72</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="63703" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '20</span>
              </span><br/><a name="C63703" href="#C63703">
                <time itemprop="dateCreated" datetime="2020-07-24T21:43:18-07:00" class="action-date">Jul '20</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>If you see the error zend_mm_heap corrupted in the global PHP-FPM error log file at /var/log/phpX.Y-fpm-sp.log, the most likely cause of the problem is a buggy PHP extension crashing PHP.</p>
<p>PHP extensions include the New Relic PHP extension and any PECL extension, such as memcache, redis, and others.</p>
<p>Step One: Disabling Third-Party PHP Extensions
If you are seeing &quot;zend_mm_heap corrupted&quot; in your logs, you should disable all third-party PHP extensions until you can identify which one is causing the problem <a href="https://www.thedailygrind.net/">CicisVisit</a></p>
<p>To disable a PHP extension, SSH into your server as root and then rename the extension's file at <a href="https://www.thedailygrind.net/cicisvisit/">www.CiCisvisit.com</a></p>
<p>/etc/phpX.Y-sp/conf.d/EXTENSION.ini
to:</p>
<p>/etc/phpX.Y-sp/conf.d/EXTENSION.ini.disabled
Next, restart PHP by running this command as root:</p>
<p>sudo service phpX.Y-fpm-sp restart
Replace &quot;X.Y&quot; with the version of PHP, for example &quot;5.6&quot;.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="63703" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="63703" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1fb94d198352c1753e8b20f2a4499319?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/14045/akiyamasensei555" class="user-moderator-N"><span itemprop="name">akiyamasensei555</span></a>        </span>
        <br>

        <span class="karma">94</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C63993" href="#C63993">
                <time itemprop="dateCreated" datetime="2020-08-10T07:18:49-07:00" class="action-date">Aug '20</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ive faced this issue and this is what you should do after upgrading. Assuming you install phalcon using brew, <strong>uninstall phalcon through brew</strong> and <strong>install phalcon using PECL command instead</strong>. This is what i did at my <strong>Mac</strong>. For some reason the phalcon repository for brew is not updated and needs to be rebuild.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="63993" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="63993" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/338fb90b60d06a58f055be307628b58b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/14509/Kovacke" class="user-moderator-N"><span itemprop="name">Kovacke</span></a>        </span>
        <br>

        <span class="karma">80</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="65033" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '20</span>
              </span><br/><a name="C65033" href="#C65033">
                <time itemprop="dateCreated" datetime="2020-12-04T22:47:55-07:00" class="action-date">Dec '20</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for the link, keep sharing this type of info <a href="https://www.myindigocard.us/">MyIndigoCard</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="65033" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="65033" data-cf-modified-88cc212a8ed84530533cb3b5-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="20749" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>