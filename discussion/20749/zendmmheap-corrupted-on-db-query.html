---
layout: default
title: 'zend_mm_heap corrupted on db query - Discussion'
---

<div class="container">
    {% include warning.html %}


    <div itemscope itemtype="https://schema.org/Question">
        <ol class="breadcrumb">
            <li><a href="/">Home</a></li>
            <li><a href="/category/29/database">Database</a></li>
        </ol>
        <div class="row table-title">
            <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
                <h1 class="" itemprop="name">zend_mm_heap corrupted on db
                    query</h1>
                <div class="visible-xs-block mobile-author">
                    <span itemprop="author" itemscope
                          itemtype="https://schema.org/Person"><a
                            class="user-moderator-N"
                            href="/user/8201/aleksanderd"><span itemprop="name">Aleksander Dyomin</span></a></span>
                    <time datetime="2020-07-14T23:43:12-07:00"
                          itemprop="dateCreated">Jul '20
                    </time>
                </div>
            </div>
            <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
                <table class="table-stats" width="100%">
                    <tr style="vertical-align: top;">
                        <td>
                            <label>Created</label><br>
                            <time datetime="2020-07-14T23:43:12-07:00"
                                  itemprop="dateCreated">Jul '20
                            </time>
                        </td>
                        <td>
                            <label>Last Reply</label><br>Dec '20
                        </td>
                        <td>
                            <label>Replies</label><br>
                            <span itemprop="answerCount">5</span>
                        </td>
                        <td>
                            <label>Views</label><br>433
                        </td>
                        <td>
                            <label>Votes</label><br>
                            <span itemprop="upvoteCount">0</span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="discussion">
            <div class="row reply-block">
                <div class="col-md-1 col-sm-1 hidden-xs text-center">
                    <img class="img-rounded avatar"
                         src="https://secure.gravatar.com/avatar/7aaa6fe177c9d18767b268ae13a80798?s=48&amp;r=pg&amp;d=identicon"/><br>
                    <span class="avatar-name" itemprop="author"
                          itemscope
                          itemtype="https://schema.org/Person"><a class="user-moderator-N"
                                                 href="/user/8201/aleksanderd"><span
                            itemprop="name">Aleksander Dyomin</span></a></span>
                    <span class="karma">4.9k</span>
                </div>
                <div class="col-md-11 col-sm-11 col-xs-12 post-body">
                    <div align="right" class="posts-date hidden-xs">
                        <a href="#C20749" name="C20749">
                            <time class="action-date">Jul '20</time>
                        </a>
                    </div>
                    <div class="post-content">
                        <div><p>Hi!</p>
                            <p>After upgrade php from 7.4.7 to 7.4.8 my app
                                crashed at any DB query or DB model usage with
                                no any error messages or info at the trace. The
                                only message I found is <code>zend_mm_heap
                                    corrupted</code>.</p>
                            <p>Example:</p>
                            <pre><code class="language-php">$db-&gt;fetchAll('select * from `Option`')</code></pre>
                            <p>is OK, but</p>
                            <pre><code
                                    class="language-php">Option::findFirst();</code></pre>
                            <p>or </p>
                            <pre><code class="language-php">$q = $this-&gt;modelsManager-&gt;createBuilder()-&gt;from(Option::class)-&gt;getQuery();
$res = $q-&gt;execute();</code></pre>
                            <p>is failed :(</p>
                            <p>any ideas?</p>
                            <p>thanks!</p></div>
                    </div>

                    <div class="posts-buttons text-right"><a class="btn btn-danger btn-xs"
                                                             data-cf-modified-88cc212a8ed84530533cb3b5-=""
                                                             href="#">
                        <span class="glyphicon glyphicon-thumbs-down"></span></a>
                        <a class="btn btn-success btn-xs" data-cf-modified-88cc212a8ed84530533cb3b5-=""
                           href="#">
                            <span class="glyphicon glyphicon-thumbs-up"></span></a>
                    </div>
                </div>
            </div>
            <div class="reply-block row" itemprop="suggestedAnswer"
                 itemscope itemtype="https://schema.org/Answer">
                <div align="center" class="col-md-1 small">
                    <img class="img-rounded"
                         src="https://secure.gravatar.com/avatar/9842e74678b8a899c45d1c57223d12c9?s=48&amp;r=pg&amp;d=identicon"/> <br>

                    <span itemprop="author" itemscope
                          itemtype="https://schema.org/Person">
            <a class="user-moderator-N" href="/user/10345/Nyde"><span
                    itemprop="name">Nyde</span></a>        </span>
                    <br>

                    <span class="karma">4.0k</span></div>
                <div class="col-md-11">
                    <div align="right" class="posts-buttons"><span
                            class="action-date action-reply-edit"
                            data-id="63671" data-target="#historyModal"
                            data-toggle="modal">
                edited <span>Jul '20</span>
              </span><br/><a href="#C63671" name="C63671">
                        <time class="action-date"
                              datetime="2020-07-14T23:47:52-07:00"
                              itemprop="dateCreated">Jul '20
                        </time>
                    </a>
                    </div>
                    <div class="post-content">
                        <div itemprop="text"><p>This issue is already known. I
                            suggest you to watch the bug report(s) on
                            Github:</p>
                            <p>
                                <a href="https://github.com/phalcon/cphalcon/issues/15107">https://github.com/phalcon/cphalcon/issues/15107</a>
                                (especially <a
                                    href="https://github.com/phalcon/cphalcon/issues/15107#issuecomment-658003615">https://github.com/phalcon/cphalcon/issues/15107#issuecomment-658003615</a>)
                            </p>
                            <p>
                                <a href="https://github.com/phalcon/cphalcon/issues/15109">https://github.com/phalcon/cphalcon/issues/15109</a>
                            </p></div>
                    </div>
                    <div align="right" class="posts-buttons"><a class="btn btn-danger btn-xs vote-login"
                                                                data-cf-modified-88cc212a8ed84530533cb3b5-=""
                                                                data-id="63671"
                                                                href="#">
                        <span class="glyphicon glyphicon-thumbs-down"></span></a>
                        <a class="btn btn-success btn-xs vote-login" data-cf-modified-88cc212a8ed84530533cb3b5-=""
                           data-id="63671"
                           href="#">
                            <span class="glyphicon glyphicon-thumbs-up"></span><span
                                itemprop="upvoteCount">1</span></a></div>
                </div>
            </div>
            <div class="reply-block row" itemprop="suggestedAnswer"
                 itemscope itemtype="https://schema.org/Answer">
                <div align="center" class="col-md-1 small">
                    <img class="img-rounded"
                         src="https://secure.gravatar.com/avatar/7aaa6fe177c9d18767b268ae13a80798?s=48&amp;r=pg&amp;d=identicon"/> <br>

                    <span itemprop="author" itemscope
                          itemtype="https://schema.org/Person">
            <a class="user-moderator-N" href="/user/8201/aleksanderd"><span
                    itemprop="name">Aleksander Dyomin</span></a>        </span>
                    <br>

                    <span class="karma">4.9k</span></div>
                <div class="col-md-11">
                    <div align="right" class="posts-buttons"><a href="#C63673"
                                                                name="C63673">
                        <time class="action-date"
                              datetime="2020-07-15T01:41:57-07:00"
                              itemprop="dateCreated">Jul '20
                        </time>
                    </a>
                    </div>
                    <div class="post-content">
                        <div itemprop="text"><p>thank you!</p>
                            <p>but what the solution? downgrade to 7.4.7 ?</p>
                        </div>
                    </div>
                    <div align="right" class="posts-buttons"><a class="btn btn-danger btn-xs vote-login"
                                                                data-cf-modified-88cc212a8ed84530533cb3b5-=""
                                                                data-id="63673"
                                                                href="#">
                        <span class="glyphicon glyphicon-thumbs-down"></span></a>
                        <a class="btn btn-success btn-xs vote-login" data-cf-modified-88cc212a8ed84530533cb3b5-=""
                           data-id="63673"
                           href="#">
                            <span class="glyphicon glyphicon-thumbs-up"></span></a>
                    </div>
                </div>
            </div>
            <div class="reply-block row" itemprop="suggestedAnswer"
                 itemscope itemtype="https://schema.org/Answer">
                <div align="center" class="col-md-1 small">
                    <img class="img-rounded"
                         src="https://secure.gravatar.com/avatar/9842e74678b8a899c45d1c57223d12c9?s=48&amp;r=pg&amp;d=identicon"/> <br>

                    <span itemprop="author" itemscope
                          itemtype="https://schema.org/Person">
            <a class="user-moderator-N" href="/user/10345/Nyde"><span
                    itemprop="name">Nyde</span></a>        </span>
                    <br>

                    <span class="karma">4.0k</span></div>
                <div class="col-md-11">
                    <div align="right" class="posts-buttons"><span
                            class="action-date action-reply-edit"
                            data-id="63675" data-target="#historyModal"
                            data-toggle="modal">
                edited <span>Jul '20</span>
              </span><br/><a href="#C63675" name="C63675">
                        <time class="action-date"
                              datetime="2020-07-15T02:11:17-07:00"
                              itemprop="dateCreated">Jul '20
                        </time>
                    </a>
                    </div>
                    <div class="post-content">
                        <div itemprop="text"><p>Right now - yes. Personally, for
                            me worked switching to 7.3.20 too, since I couldn't
                            downgrade to 7.4.7.</p>
                            <p>Also, from the Discord, but I didn't test it
                                yet:</p>
                            <blockquote>
                                <p>building from source fixed it, if anyone else
                                    runs into the same issue, but I'm curious as
                                    to the cause
                                    and also how I can provide details for the
                                    core team to investigate?
                                    FYI, I've reinstalled it via PECL and it
                                    also works again so cannot be too serious
                                    :slight_smile:</p>
                            </blockquote>
                        </div>
                    </div>
                    <div align="right" class="posts-buttons"><a class="btn btn-danger btn-xs vote-login"
                                                                data-cf-modified-88cc212a8ed84530533cb3b5-=""
                                                                data-id="63675"
                                                                href="#">
                        <span class="glyphicon glyphicon-thumbs-down"></span></a>
                        <a class="btn btn-success btn-xs vote-login" data-cf-modified-88cc212a8ed84530533cb3b5-=""
                           data-id="63675"
                           href="#">
                            <span class="glyphicon glyphicon-thumbs-up"></span></a>
                    </div>
                </div>
            </div>
            <div class="reply-block row" itemprop="suggestedAnswer"
                 itemscope itemtype="https://schema.org/Answer">
                <div align="center" class="col-md-1 small">
                    <img class="img-rounded"
                         src="https://secure.gravatar.com/avatar/7aaa6fe177c9d18767b268ae13a80798?s=48&amp;r=pg&amp;d=identicon"/> <br>

                    <span itemprop="author" itemscope
                          itemtype="https://schema.org/Person">
            <a class="user-moderator-N" href="/user/8201/aleksanderd"><span
                    itemprop="name">Aleksander Dyomin</span></a>        </span>
                    <br>

                    <span class="karma">4.9k</span></div>
                <div class="col-md-11">
                    <div align="right" class="posts-buttons"><span
                            class="action-date action-reply-edit"
                            data-id="63677" data-target="#historyModal"
                            data-toggle="modal">
                edited <span>Jul '20</span>
              </span><br/><a href="#C63677" name="C63677">
                        <time class="action-date"
                              datetime="2020-07-15T02:49:35-07:00"
                              itemprop="dateCreated">Jul '20
                        </time>
                    </a>
                    </div>
                    <div class="post-content">
                        <div itemprop="text">
                            <blockquote>
                                <p>since I couldn't downgrade to 7.4.7</p>
                            </blockquote>
                            <p>if you have cached previous versions, you can
                                try:</p>
                            <pre><code>sudo dpkg -i /var/cache/apt/archives/php*7.4.7*</code></pre>
                            <p>and, to prevent upgrade create <code>/etc/apt/preferences.d/php</code>
                                with:</p>
                            <pre><code>Package: php7.4*
Pin: origin ""
Pin: version 7.4.7*
Pin-Priority: 1111</code></pre>
                        </div>
                    </div>
                    <div align="right" class="posts-buttons"><a class="btn btn-danger btn-xs vote-login"
                                                                data-cf-modified-88cc212a8ed84530533cb3b5-=""
                                                                data-id="63677"
                                                                href="#">
                        <span class="glyphicon glyphicon-thumbs-down"></span></a>
                        <a class="btn btn-success btn-xs vote-login" data-cf-modified-88cc212a8ed84530533cb3b5-=""
                           data-id="63677"
                           href="#">
                            <span class="glyphicon glyphicon-thumbs-up"></span></a>
                    </div>
                </div>
            </div>
            <div class="reply-block row" itemprop="suggestedAnswer"
                 itemscope itemtype="https://schema.org/Answer">
                <div align="center" class="col-md-1 small">
                    <img class="img-rounded"
                         src="https://secure.gravatar.com/avatar/c90d3849ebfa2f2c3ccdedbbd3185efb?s=48&amp;r=pg&amp;d=identicon"/> <br>

                    <span itemprop="author" itemscope
                          itemtype="https://schema.org/Person">
            <a class="user-moderator-N" href="/user/13983/Scheibers"><span
                    itemprop="name">Scheibers</span></a>        </span>
                    <br>

                    <span class="karma">72</span></div>
                <div class="col-md-11">
                    <div align="right" class="posts-buttons"><span
                            class="action-date action-reply-edit"
                            data-id="63703" data-target="#historyModal"
                            data-toggle="modal">
                edited <span>Jul '20</span>
              </span><br/><a href="#C63703" name="C63703">
                        <time class="action-date"
                              datetime="2020-07-24T21:43:18-07:00"
                              itemprop="dateCreated">Jul '20
                        </time>
                    </a>
                    </div>
                    <div class="post-content">
                        <div itemprop="text"><p>If you see the error
                            zend_mm_heap corrupted in the global PHP-FPM error
                            log file at /var/log/phpX.Y-fpm-sp.log, the most
                            likely cause of the problem is a buggy PHP extension
                            crashing PHP.</p>
                            <p>PHP extensions include the New Relic PHP
                                extension and any PECL extension, such as
                                memcache, redis, and others.</p>
                            <p>Step One: Disabling Third-Party PHP Extensions
                                If you are seeing &quot;zend_mm_heap corrupted&quot;
                                in your logs, you should disable all third-party
                                PHP extensions until you can identify which one
                                is causing the problem
                            </p>
                            <p>To disable a PHP extension, SSH into your server
                                as root and then rename the extension's file at
                            </p>
                            <p>/etc/phpX.Y-sp/conf.d/EXTENSION.ini
                                to:</p>
                            <p>/etc/phpX.Y-sp/conf.d/EXTENSION.ini.disabled
                                Next, restart PHP by running this command as
                                root:</p>
                            <p>sudo service phpX.Y-fpm-sp restart
                                Replace &quot;X.Y&quot; with the version of PHP,
                                for example &quot;5.6&quot;.</p></div>
                    </div>
                    <div align="right" class="posts-buttons"><a class="btn btn-danger btn-xs vote-login"
                                                                data-cf-modified-88cc212a8ed84530533cb3b5-=""
                                                                data-id="63703"
                                                                href="#">
                        <span class="glyphicon glyphicon-thumbs-down"></span></a>
                        <a class="btn btn-success btn-xs vote-login" data-cf-modified-88cc212a8ed84530533cb3b5-=""
                           data-id="63703"
                           href="#">
                            <span class="glyphicon glyphicon-thumbs-up"></span></a>
                    </div>
                </div>
            </div>
            <div class="reply-block row" itemprop="suggestedAnswer"
                 itemscope itemtype="https://schema.org/Answer">
                <div align="center" class="col-md-1 small">
                    <img class="img-rounded"
                         src="https://secure.gravatar.com/avatar/1fb94d198352c1753e8b20f2a4499319?s=48&amp;r=pg&amp;d=identicon"/> <br>

                    <span itemprop="author" itemscope
                          itemtype="https://schema.org/Person">
            <a class="user-moderator-N"
               href="/user/14045/akiyamasensei555"><span
                    itemprop="name">akiyamasensei555</span></a>        </span>
                    <br>

                    <span class="karma">94</span></div>
                <div class="col-md-11">
                    <div align="right" class="posts-buttons"><a href="#C63993"
                                                                name="C63993">
                        <time class="action-date"
                              datetime="2020-08-10T07:18:49-07:00"
                              itemprop="dateCreated">Aug '20
                        </time>
                    </a>
                    </div>
                    <div class="post-content">
                        <div itemprop="text"><p>Ive faced this issue and this is
                            what you should do after upgrading. Assuming you
                            install phalcon using brew, <strong>uninstall
                                phalcon through brew</strong> and <strong>install
                                phalcon using PECL command instead</strong>.
                            This is what i did at my <strong>Mac</strong>. For
                            some reason the phalcon repository for brew is not
                            updated and needs to be rebuild.</p></div>
                    </div>
                    <div align="right" class="posts-buttons"><a class="btn btn-danger btn-xs vote-login"
                                                                data-cf-modified-88cc212a8ed84530533cb3b5-=""
                                                                data-id="63993"
                                                                href="#">
                        <span class="glyphicon glyphicon-thumbs-down"></span></a>
                        <a class="btn btn-success btn-xs vote-login" data-cf-modified-88cc212a8ed84530533cb3b5-=""
                           data-id="63993"
                           href="#">
                            <span class="glyphicon glyphicon-thumbs-up"></span></a>
                    </div>
                </div>
            </div>
            <div class="row">
                <div align="center" class="col-md-1 small"></div>
                <div class="col-md-11 login-comment">

                </div>
            </div>
        </div>
        <input id="post-id" name="post-id" type="hidden" value="20749"/>
        <div id="suggested-posts"></div>
        <div id="sticky-progress" style='display:none'></div>
    </div>
</div>