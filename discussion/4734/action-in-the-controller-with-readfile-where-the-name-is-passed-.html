---
layout: default
title: 'Action in the controller with readfile, where the name is passed by POST method through ajax call. - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Action in the controller with readfile, where the name is passed by POST method through ajax call.</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/1432/danieljmg" class="user-moderator-N"><span itemprop="name">Daniel Jesús Muñoz Guerra</span></a></span>
            <time itemprop="dateCreated" datetime="2015-02-13T15:45:42-07:00">Feb '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-02-13T15:45:42-07:00">Feb '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Mar '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>627</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/af92f0010d8513efb7ec8f4515f9a865?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/1432/danieljmg" class="user-moderator-N"><span itemprop="name">Daniel Jesús Muñoz Guerra</span></a></span>
                <span class="karma">9.2k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C4734" href="#C4734">
        <time class="action-date">Feb '15</time>
    </a>
</div>
<div class="post-content"><div><p>This is killing me ... dumbest thing but I dont see the point.
Summarizing I want an anchor run a controller action which is basically a readfile (typical save as... window). This I managed but what I do not get is run it with an ajax POST method, passing the file name in the call (not in the url). Calling, call the action, but not with variable ... lets see some code:</p>
<pre><code class="language-php">
public function descargarimagenAction(){

//Problem in the call, POST arrived here!

$nombre = $this-&gt;request-&gt;getPost("nombre");

$extension = "jpg";

$this-&gt;view-&gt;setRenderLevel(\Phalcon\Mvc\View::LEVEL_NO_RENDER);

header("Cache-Control: must-revalidate, post-check=0, pre-check=0");

header('Content-Description: File Transfer');

header('Content-type: image/' . $extension);

header('Content-Disposition: attachment; filename="'.$nombre.'"');

readfile("img/".$nombre);

die();

}
</code></pre>
<p>And the html:</p>
<pre><code class="language-html">
&lt;a class="btn btn-primary" href="notificaciones/descargarimagen" onclick="$.post(href,

{nombre: 'imagendeprueba.jpg'},function(data){alert('done')});return false"&gt;
</code></pre>
<p>The alert activated, and the POST request to the function too, but the readfile or doesn't work or doesn't answers to the view. Any ideas?
The thing is that by href = &quot;notifications / descargarimagen / imagendeprueba.jpg&quot;  I can download, everything perfect. (instead of getPost use a simple variable parameter in the action BTW).</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-552c9c4278831d8a8d3bb119-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-552c9c4278831d8a8d3bb119-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/533985d102feef881f5c41933bd43bfb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/283/calinrada" class="user-moderator-N"><span itemprop="name">Calin Rada</span></a>        </span>
        <br>

        <span class="karma">51.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15915" href="#C15915">
                <time itemprop="dateCreated" datetime="2015-02-15T10:12:40-07:00" class="action-date">Feb '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This is not related to Phalcon. If you want to achieve this, please check the answers from here <a href="http://stackoverflow.com/questions/16086162/handle-file-download-from-ajax-post">http://stackoverflow.com/questions/16086162/handle-file-download-from-ajax-post</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15915" data-cf-modified-552c9c4278831d8a8d3bb119-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15915" data-cf-modified-552c9c4278831d8a8d3bb119-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/af92f0010d8513efb7ec8f4515f9a865?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1432/danieljmg" class="user-moderator-N"><span itemprop="name">Daniel Jesús Muñoz Guerra</span></a>        </span>
        <br>

        <span class="karma">9.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C16278" href="#C16278">
                <time itemprop="dateCreated" datetime="2015-03-02T13:07:38-07:00" class="action-date">Mar '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You were right, I managed it with a form with POST.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="16278" data-cf-modified-552c9c4278831d8a8d3bb119-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="16278" data-cf-modified-552c9c4278831d8a8d3bb119-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2e0bae293948bec8ffec40de279cbe41?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/210/andresgutierrez" class="user-moderator-Y"><span itemprop="name">Andres Gutierrez</span></a>        </span>
        <br>

        <span class="karma">34.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C16279" href="#C16279">
                <time itemprop="dateCreated" datetime="2015-03-02T13:11:45-07:00" class="action-date">Mar '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I think there could be a huge security issue by allowing to show any file passed by $_POST. Consider filter path characters like . (dot) \ and / in $this-&gt;request-&gt;getPost(&quot;nombre&quot;).</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="16279" data-cf-modified-552c9c4278831d8a8d3bb119-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="16279" data-cf-modified-552c9c4278831d8a8d3bb119-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="4734" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>