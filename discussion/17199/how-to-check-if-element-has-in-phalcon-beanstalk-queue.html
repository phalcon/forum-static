---
layout: default
title: 'How to check if element has in Phalcon Beanstalk Queue - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/21/beginners">Beginners</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">How to check if element has in Phalcon Beanstalk Queue</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/9111/erickmajor" class="user-moderator-N"><span itemprop="name">Erick Major dos Santos</span></a></span>
            <time itemprop="dateCreated" datetime="2017-10-30T06:25:01-07:00">Oct '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-10-30T06:25:01-07:00">Oct '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">7</span>
                </td>
                <td>
                    <label>Views</label><br>607</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/8a264dc4384fd937b6c48443ccafd3b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/9111/erickmajor" class="user-moderator-N"><span itemprop="name">Erick Major dos Santos</span></a></span>
                <span class="karma">4.2k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C17199" href="#C17199">
        <time class="action-date">Oct '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hello everyone,</p>
<p>I want to use the Beanstalk queue structure that Phalcon already makes available. I want to know if a given element already exists in the queue, but I can't check it.</p>
<p>How can I do this check?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C51919" href="#C51919">
                <time itemprop="dateCreated" datetime="2017-10-30T06:44:15-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You can only peek the next job, there is no way you can retreive the list of queued items, but that's a limitation of Beanstalkd,</p>
<p>You could use <code>jobPeek ($id)</code>, but you'll have to keep track of the $ids returned by <code>put()</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51919" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51919" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a2658b5645f7a791cd1fbf709c4eb9b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8837/cosmy81" class="user-moderator-N"><span itemprop="name">Cosimo</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="51925" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '17</span>
              </span><br/><a name="C51925" href="#C51925">
                <time itemprop="dateCreated" datetime="2017-10-30T08:41:05-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I don't know if I've understood what you need but using the incubator extension of Beanstalk, if you use an identificator inside the job body, I think you can write a worker that returns  true if it find that id without deleting or burying the job.</p>
<blockquote>
<p>$job = $this-&gt;reserveFromTube($tube);<br />
if ($job &amp;&amp; ($job instanceof Job)) {<br />
$jobBody = $job-&gt;getBody();<br />
if($jobBody['id']=='whatyouWant') return true;<br />
}  </p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51925" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51925" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8a264dc4384fd937b6c48443ccafd3b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9111/erickmajor" class="user-moderator-N"><span itemprop="name">Erick Major dos Santos</span></a>        </span>
        <br>

        <span class="karma">4.2k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C51925"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/a2658b5645f7a791cd1fbf709c4eb9b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Cosimo                    </a>
                </div><div class="posts-buttons" align="right"><a name="C51929" href="#C51929">
                <time itemprop="dateCreated" datetime="2017-10-30T09:46:29-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hello @ cosmy81,</p>
<p>Could you give me an example of how to use the Incubator Extension? I use this queue in a modular Phalcon application.</p>
<blockquote>
<p>I don't know if I've understood what you need but using the incubator extension of Beanstalk, if you use an identificator inside the job body, I think you can write a worker that returns  true if it find that id without deleting or burying the job.</p>
<blockquote>
<p>$job = $this-&gt;reserveFromTube($tube);<br />
if ($job &amp;&amp; ($job instanceof Job)) {<br />
$jobBody = $job-&gt;getBody();<br />
if($jobBody['id']=='whatyouWant') return true;<br />
}</p>
</blockquote>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51929" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51929" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C51931" href="#C51931">
                <time itemprop="dateCreated" datetime="2017-10-30T09:56:29-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Im not sure hacking beanstalk will be the most beneficial... you are trying to make a use-case work where the underlying system was not desinged to support it.</p>
<p>Redis has the feature you are looking for out-of-the-box, if there is no environment limitation i'd go for it instead of meddling with beanstalk....</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51931" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51931" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a2658b5645f7a791cd1fbf709c4eb9b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8837/cosmy81" class="user-moderator-N"><span itemprop="name">Cosimo</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="51933" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '17</span>
              </span><br/><a name="C51933" href="#C51933">
                <time itemprop="dateCreated" datetime="2017-10-30T10:02:43-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This is the incubator beanstalk extension: <a href="https://github.com/phalcon/incubator/tree/master/Library/Phalcon/Queue/Beanstalk">https://github.com/phalcon/incubator/tree/master/Library/Phalcon/Queue/Beanstalk</a>.<br />
What I meant in the previous post is to add a method that works like i wrote and to use it instead of doWork, bacause If you don't delete or bury jobs, they still remain in your queue.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51933" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51933" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8a264dc4384fd937b6c48443ccafd3b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9111/erickmajor" class="user-moderator-N"><span itemprop="name">Erick Major dos Santos</span></a>        </span>
        <br>

        <span class="karma">4.2k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C51931"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Lajos Bencz                    </a>
                </div><div class="posts-buttons" align="right"><a name="C51935" href="#C51935">
                <time itemprop="dateCreated" datetime="2017-10-30T10:28:27-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hello<a href="https://forum.phalcon.io/user/4363/lajosbencz"> @lajosbencz</a></p>
<p>I really have this limitation. I can only use Beanstalk for this. Unfortunately.</p>
<blockquote>
<p>Im not sure hacking beanstalk will be the most beneficial... you are trying to make a use-case work where the underlying system was not desinged to support it.</p>
<p>Redis has the feature you are looking for out-of-the-box, if there is no environment limitation i'd go for it instead of meddling with beanstalk....</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51935" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51935" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="51945" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '17</span>
              </span><br/><a name="C51945" href="#C51945">
                <time itemprop="dateCreated" datetime="2017-10-31T01:33:05-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You're mixing responsibilities here. MQ broker is responsible for assigning jobs, not your app, as by definition, there might be many apps which makes use of the same MQ broker. So MQ broker is one large pool, while apps are workers (they do the hard work). Only thing you should do is reserve job in beanstakld in order to make sure your app (if many) have the exclusive lock over that certain job.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51945" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51945" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8a264dc4384fd937b6c48443ccafd3b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9111/erickmajor" class="user-moderator-N"><span itemprop="name">Erick Major dos Santos</span></a>        </span>
        <br>

        <span class="karma">4.2k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C51945"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><a name="C51953" href="#C51953">
                <time itemprop="dateCreated" datetime="2017-10-31T09:15:37-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hello<a href="https://forum.phalcon.io/user/4525/stamster"> @stamster</a>,</p>
<p>I did not get it right. Could you explain better?</p>
<blockquote>
<p>You're mixing responsibilities here. MQ broker is responsible for assigning jobs, not your app, as by definition, there might be many apps which makes use of the same MQ broker. So MQ broker is one large pool, while apps are workers (they do the hard work). Only thing you should do is reserve job in beanstakld in order to make sure your app (if many) have the exclusive lock over that certain job.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51953" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51953" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8a264dc4384fd937b6c48443ccafd3b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9111/erickmajor" class="user-moderator-N"><span itemprop="name">Erick Major dos Santos</span></a>        </span>
        <br>

        <span class="karma">4.2k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C51945"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><a name="C51955" href="#C51955">
                <time itemprop="dateCreated" datetime="2017-10-31T09:23:36-07:00" class="action-date">Oct '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Just to explain, I'm using a specific tube to store these jobs. My jobs consist of a simple array, enclosing keys and values.
I would like to check if a previously stored element exists in this queue. I could go through all the elements of it to do the check, but with Beanstalk I can only go through the elements if I delete the job at the end. Unfortunately.</p>
<blockquote>
<p>You're mixing responsibilities here. MQ broker is responsible for assigning jobs, not your app, as by definition, there might be many apps which makes use of the same MQ broker. So MQ broker is one large pool, while apps are workers (they do the hard work). Only thing you should do is reserve job in beanstakld in order to make sure your app (if many) have the exclusive lock over that certain job.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="51955" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="51955" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a2658b5645f7a791cd1fbf709c4eb9b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8837/cosmy81" class="user-moderator-N"><span itemprop="name">Cosimo</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C51955"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8a264dc4384fd937b6c48443ccafd3b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Erick Major dos Santos                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="52017" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '17</span>
              </span><br/><a name="C52017" href="#C52017">
                <time itemprop="dateCreated" datetime="2017-11-02T04:00:01-07:00" class="action-date">Nov '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<blockquote>
<p>Just to explain, I'm using a specific tube to store these jobs. My jobs consist of a simple array, enclosing keys and values.<br />
I would like to check if a previously stored element exists in this queue. I could go through all the elements of it to do the check, but with Beanstalk I can only go &gt;through the elements if I delete the job at the end. Unfortunately.</p>
</blockquote>
</blockquote>
<p>That's true, if you use beanstalk in the right way. But with a little bit hacking you can do a work without deleting and burying it.
How to do it depends on how you have integrated beanstalk. In my case i have the doWork cicle that launch the workers, and the workers return true or false. Then the doWork cicle decide to delete or bury the job depending on the value returned.
So you can write something similar to doWork, without running workers and without deleting jobs, just checkoing parameters in job's bodies.
It's not a good practice in my opinion but I think it's the only way to solve your problem.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52017" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52017" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8a264dc4384fd937b6c48443ccafd3b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9111/erickmajor" class="user-moderator-N"><span itemprop="name">Erick Major dos Santos</span></a>        </span>
        <br>

        <span class="karma">4.2k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C52017"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/a2658b5645f7a791cd1fbf709c4eb9b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Cosimo                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="52087" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '17</span>
              </span><br/><a name="C52087" href="#C52087">
                <time itemprop="dateCreated" datetime="2017-11-06T05:35:29-07:00" class="action-date">Nov '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hello<a href="https://forum.phalcon.io/user/8837/cosmy81"> @cosmy81</a>,</p>
<p>Do you have an example to illustrate?</p>
<p>Thank you very much!</p>
<blockquote>
<blockquote>
<blockquote>
<p>Just to explain, I'm using a specific tube to store these jobs. My jobs consist of a simple array, enclosing keys and values.<br />
I would like to check if a previously stored element exists in this queue. I could go through all the elements of it to do the check, but with Beanstalk I can only go &gt;through the elements if I delete the job at the end. Unfortunately.</p>
</blockquote>
</blockquote>
<p>That's true, if you use beanstalk in the right way. But with a little bit hacking you can do a work without deleting and burying it.
How to do it depends on how you have integrated beanstalk. In my case i have the doWork cicle that launch the workers, and the workers return true or false. Then the doWork cicle decide to delete or bury the job depending on the value returned.
So you can write something similar to doWork, without running workers and without deleting jobs, just checkoing parameters in job's bodies.
It's not a good practice in my opinion but I think it's the only way to solve your problem.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52087" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52087" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a2658b5645f7a791cd1fbf709c4eb9b0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8837/cosmy81" class="user-moderator-N"><span itemprop="name">Cosimo</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52167" href="#C52167">
                <time itemprop="dateCreated" datetime="2017-11-09T11:37:06-07:00" class="action-date">Nov '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Post your queue implementation and we'll see how to manage inside it.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52167" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52167" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8a264dc4384fd937b6c48443ccafd3b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9111/erickmajor" class="user-moderator-N"><span itemprop="name">Erick Major dos Santos</span></a>        </span>
        <br>

        <span class="karma">4.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52249" href="#C52249">
                <time itemprop="dateCreated" datetime="2017-11-13T04:02:06-07:00" class="action-date">Nov '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hello<a href="https://forum.phalcon.io/user/8837/cosmy81"> @cosmy81</a>,</p>
<p>I apologize for the delay. Follow the code:</p>
<p><strong>AbstractBeanstalkQueue:</strong></p>
<pre><code>&lt;?php

namespace Queue;

use Phalcon\Queue\Beanstalk as BQueue;

class AbstractBeanstalkQueue extends AbstractQueue
{
    /**
     * Tube, used in Beanstalk service
     * @var string
     */
    protected $tube = 'default';

    /**
     * {@inheritdoc}
     */
    public function __construct($host = '', $port = 0)
    {
        if (true === empty($port)) {
            $port = BQueue::DEFAULT_PORT;
        }

        if (true === empty($host)) {
            $host = BQueue::DEFAULT_HOST;
        }

        $this-&gt;queue = new BQueue([
            'host'       =&gt; $host,
            'port'       =&gt; $port,
            'persistent' =&gt; true,
        ]);

        try
        {
            @$this-&gt;queue-&gt;connect();
        } catch (\Exception $e) {
            $this-&gt;queue = null;
        }
        return $this-&gt;queue;
    }

    /**
     * {@inheritdoc}
     */
    public function setElementQueue($element, $urgent = false, $tube = '')
    {
        if (true === empty($tube)) {
            $tube = $this-&gt;tube;
        }

        $options      = [];
        $jobQueueData = [
            'type'    =&gt; $tube,
            'element' =&gt; $element,
        ];

        if (false === empty($urgent)) {
            $options = [
                'priority' =&gt; 0,
            ];
        }

        // Connect to the queue
        if (
            false === empty($this-&gt;queue) and
            false !== $this-&gt;queue-&gt;connect() and
            false !== $this-&gt;queue-&gt;choose($tube)
        ) {
            return $this-&gt;queue-&gt;put($jobQueueData, $options);
        }

        return 0;
    }

    /**
     * {@inheritdoc}
     */
    public function getElementQueue($tube = '')
    {
        if (true === empty($tube)) {
            $tube = $this-&gt;tube;
        }

        if (
            false === empty($this-&gt;queue) and
            false !== $this-&gt;queue-&gt;connect() and
            false !== $this-&gt;queue-&gt;choose($tube) and
            false !== ($queueJob = $this-&gt;queue-&gt;peekReady())
        ) {
            $jobBody = $queueJob-&gt;getBody();

            // Get the task of the attendance type
            if (false === empty($jobBody['type']) and $this-&gt;tube === $jobBody['type']) {
                $attendance = $jobBody['element'];
                $queueJob-&gt;delete();
                return $attendance;
            }
        }
        return null;
    }

    /**
     * {@inheritdoc}
     */
    public function isEmpty()
    {
        // Connect to the queue
        if (
            false === empty($this-&gt;queue) and
            false !== $this-&gt;queue-&gt;connect() and
            false !== $this-&gt;queue-&gt;choose($this-&gt;tube)
        ) {
            // Get the total jobs in the queue tube
            return !($this-&gt;queue-&gt;statsTube($this-&gt;tube)['total-jobs'] &gt; 0);
        }
        return true;
    }

    /**
     * {@inheritdoc}
     */
    public function count()
    {
        // Connect to the queue
        if (
            false === empty($this-&gt;queue) and
            false !== $this-&gt;queue-&gt;connect() and
            false !== $this-&gt;queue-&gt;choose($this-&gt;tube)
        ) {
            // Get the total jobs in the queue tube
            return $this-&gt;queue-&gt;statsTube($this-&gt;tube)['total-jobs'];
        }
        return 0;
    }
}
</code></pre>
<p><strong>AttendanceBeanstalkQueue:</strong></p>
<pre><code>&lt;?php

namespace Queue\BeanstalkQueue;

use Queue\AbstractBeanstalkQueue;

class AttendanceBeanstalkQueue extends AbstractBeanstalkQueue
{
    /**
     * {@inheritdoc}
     */
    protected $tube = 'attendance';
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52249" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52249" data-cf-modified-006a4cf52bb4ee72322e2d58-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="17199" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>