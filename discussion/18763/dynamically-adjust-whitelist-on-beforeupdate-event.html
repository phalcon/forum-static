---
layout: default
title: 'Dynamically adjust whitelist on beforeUpdate event - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Dynamically adjust whitelist on beforeUpdate event</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/11565/burkeallen" class="user-moderator-N"><span itemprop="name">Burke</span></a></span>
            <time itemprop="dateCreated" datetime="2018-08-28T14:28:28-07:00">Aug '18</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2018-08-28T14:28:28-07:00">Aug '18</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>272</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/345dd388e787b1cea570fd082fe6a79c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/11565/burkeallen" class="user-moderator-N"><span itemprop="name">Burke</span></a></span>
                <span class="karma">369</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C18763" href="#C18763">
        <time class="action-date">Aug '18</time>
    </a>
</div>
<div class="post-content"><div><p>We are trying to dynamically adjust the model whitelist from within the beforeUpdate.</p>
<p>use case</p>
<p>we want to make certain columns imutable int the systme if certain realtionships exist.</p>
<p>if relationship exist,  then we only allow certain columns to be &quot;updateable&quot;.</p>
<p>we were thinking we could provide a whitelist of mutable columns if the relationship exists then we could be sure only those columns would be updated. we are currently checking the relationship in the beforeUpdate using the addBehavior method on the model.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-01165e35ba4d48748e918ac2-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-01165e35ba4d48748e918ac2-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b59fecbff6d1afabf8da316028330df4?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2619/emiliodeg" class="user-moderator-N"><span itemprop="name">Emilio Degiovanni</span></a>        </span>
        <br>

        <span class="karma">32.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C57147" href="#C57147">
                <time itemprop="dateCreated" datetime="2018-08-29T05:00:53-07:00" class="action-date">Aug '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>take a look at this <a href="https://docs.phalcon.io/en/3.3/db-models#record-snapshots">snapshots</a></p>
<p>the rest you can do by applying the logic you need in the behavior</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="57147" data-cf-modified-01165e35ba4d48748e918ac2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="57147" data-cf-modified-01165e35ba4d48748e918ac2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/6221c81c81cd357c818daec1bb8b17ff?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4153/nikolay-mihaylov" class="user-moderator-N"><span itemprop="name">Nikolay Mihaylov</span></a>        </span>
        <br>

        <span class="karma">93.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="57149" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '18</span>
              </span><br/><a name="C57149" href="#C57149">
                <time itemprop="dateCreated" datetime="2018-08-29T05:28:58-07:00" class="action-date">Aug '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Someone correct me if I'm missing soemthing, but I could not find a way to update the <code>whitelist</code> fields in the behaviour methods.
Docs link: <a href="https://docs.phalcon.io/ja/3.3/api/Phalcon_Mvc_Model">https://docs.phalcon.io/ja/3.3/api/Phalcon_Mvc_Model</a></p>
<p>Here is a working solution tho, may not be the prettiest, but sure does the job :)</p>
<pre><code class="language-php">// Controller
$data = [
    'company_id' =&gt; mt_rand(1, 1900),
    'user_id' =&gt; mt_rand(1, 1900),
    'title' =&gt; 'New title - ' . mt_rand(1, 1900),
];
$object = \Models\Reports::findFirst(2); 
$object-&gt;save($data, $object-&gt;getWhitelist());

// Model
public function getWhitelist()
{
    $isCarSold = true; // Allow update of limited fiedls
    // $isCarSold = false; // Allow updating all fields
    return $isCarSold ? ['title'] : ['title', 'company_id', 'user_id'];
}</code></pre>
<p>You can modify the <code>getWhitelist()</code> method and add the neccessary conditions to check if car is being sold :)</p>
<p><strong>UPDATE:</strong> Another option would be to use setters/getters and apply business logic which fields to be updated when, but the above solution looks shorter to me :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="57149" data-cf-modified-01165e35ba4d48748e918ac2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="57149" data-cf-modified-01165e35ba4d48748e918ac2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a289e536a2d0d975110e320729ee811e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/11661/manaphp" class="user-moderator-N"><span itemprop="name">ManaPHP framework</span></a>        </span>
        <br>

        <span class="karma">323</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C57475" href="#C57475">
                <time itemprop="dateCreated" datetime="2018-09-27T06:55:59-07:00" class="action-date">Sep '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>overwrite <code>save</code> method  is the best and safest method!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="57475" data-cf-modified-01165e35ba4d48748e918ac2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="57475" data-cf-modified-01165e35ba4d48748e918ac2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="18763" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>