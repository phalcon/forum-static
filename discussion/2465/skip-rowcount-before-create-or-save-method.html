---
layout: default
title: 'Skip rowcount before create or save method - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/18/escaping-filtering">Escaping/Filtering</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Skip rowcount before create or save method</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/1745/shivanshuit914" class="user-moderator-N"><span itemprop="name">Shivanshu Patel</span></a></span>
            <time itemprop="dateCreated" datetime="2014-06-04T02:37:46-07:00">Jun '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-06-04T02:37:46-07:00">Jun '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">7</span>
                </td>
                <td>
                    <label>Views</label><br>1263</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/d08919d880a3950107a27e6cdbf18c52?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/1745/shivanshuit914" class="user-moderator-N"><span itemprop="name">Shivanshu Patel</span></a></span>
                <span class="karma">13.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2465" href="#C2465">
        <time class="action-date">Jun '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hi,</p>
<p>I would like to skip select rowcount before save or create method for model.
Anyone have idea how to do it ?</p>
<p>It's returning me notice <strong>Notice: Undefined index: rowcount</strong> .</p>
<p>I am using below code.</p>
<p>$instance = new $model();
$instance-&gt;create($obj_data)
// and
$instance-&gt;save($obj_data)</p>
<p>thanks</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8376" href="#C8376">
                <time itemprop="dateCreated" datetime="2014-06-04T09:29:43-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I really doubt the code you posted is generating that error.  Phalcon doesn't ask for &quot;rowcount&quot; before every insert/update statement.  Somewhere else in your code you're referencing an array element by index &quot;rowcount&quot;.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8376" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8376" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d08919d880a3950107a27e6cdbf18c52?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1745/shivanshuit914" class="user-moderator-N"><span itemprop="name">Shivanshu Patel</span></a>        </span>
        <br>

        <span class="karma">13.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8378" href="#C8378">
                <time itemprop="dateCreated" datetime="2014-06-04T09:38:07-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>HI,
we have developed custom adapter for cassandra pdo to work with phalcon.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8378" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8378" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8f636d5def058db2a2c1040b8b59262a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2368/dugwood" class="user-moderator-N"><span itemprop="name">Yvan</span></a>        </span>
        <br>

        <span class="karma">309</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="11902" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '14</span>
              </span><br/><a name="C11902" href="#C11902">
                <time itemprop="dateCreated" datetime="2014-10-05T06:54:58-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/1745/shivanshuit914">@shivanshuit914</a>: you're right, there's a SELECT COUNT(*) AS 'rowcount' that's run before any create/save/update. I found it's done on related records.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11902" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11902" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/983bef9a7e8fd48e4ef193e4b9e5a134?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2590/ovide" class="user-moderator-N"><span itemprop="name">ovide</span></a>        </span>
        <br>

        <span class="karma">93</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12768" href="#C12768">
                <time itemprop="dateCreated" datetime="2014-11-04T06:01:47-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Anything about this?
I control these things before and I don't want the model to check it again. I prefer to put a try catch and control the PDOException in the rare case of duplicity than a 'SELECT COUNT(*) &quot;rowcount&quot; FROM' before each 'INSERT'</p>
<p>The query is done before the 'beforeValidationOnCreate()' and I don't know how to skip this useless SELECTS</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12768" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12768" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C12768"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/983bef9a7e8fd48e4ef193e4b9e5a134?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        ovide                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="12769" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '14</span>
              </span><br/><a name="C12769" href="#C12769">
                <time itemprop="dateCreated" datetime="2014-11-04T06:16:02-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>How the ORM would know if the record exists and whether it must insert or update without a SELECT COUNT(*) &quot;rowcount&quot;?</p>
<blockquote>
<p>Anything about this?
I control these things before and I don't want the model to check it again. I prefer to put a try catch and control the PDOException in the rare case of duplicity than a 'SELECT COUNT(*) &quot;rowcount&quot; FROM' before each 'INSERT'</p>
<p>The query is done before the 'beforeValidationOnCreate()' and I don't know how to skip this useless SELECTS</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12769" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12769" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/983bef9a7e8fd48e4ef193e4b9e5a134?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2590/ovide" class="user-moderator-N"><span itemprop="name">ovide</span></a>        </span>
        <br>

        <span class="karma">93</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C12769"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Phalcon                    </a>
                </div><div class="posts-buttons" align="right"><a name="C12814" href="#C12814">
                <time itemprop="dateCreated" datetime="2014-11-05T05:04:20-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>As I understand, calling create() instead of save() or update() 'forces' the ORM to try an Insert
<a href="https://docs.phalcon.io/en/latest/reference/models.html#create-update-with-confidence">https://docs.phalcon.io/en/latest/reference/models.html#create-update-with-confidence</a></p>
<blockquote>
<p>How the ORM would know if the record exists and whether it must insert or update without a SELECT COUNT(*) &quot;rowcount&quot;?</p>
<blockquote>
<p>Anything about this?
I control these things before and I don't want the model to check it again. I prefer to put a try catch and control the PDOException in the rare case of duplicity than a 'SELECT COUNT(*) &quot;rowcount&quot; FROM' before each 'INSERT'</p>
<p>The query is done before the 'beforeValidationOnCreate()' and I don't know how to skip this useless SELECTS</p>
</blockquote>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12814" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12814" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12815" href="#C12815">
                <time itemprop="dateCreated" datetime="2014-11-05T05:26:54-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Calling create() does not force an insert, it just ensures than an update will not made if the record already exists:</p>
<p><a href="https://github.com/phalcon/cphalcon/blob/2.0.0/phalcon/mvc/model.zep#L2923">https://github.com/phalcon/cphalcon/blob/2.0.0/phalcon/mvc/model.zep#L2923</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12815" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span><span itemprop="downvoteCount">1</span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12815" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/983bef9a7e8fd48e4ef193e4b9e5a134?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2590/ovide" class="user-moderator-N"><span itemprop="name">ovide</span></a>        </span>
        <br>

        <span class="karma">93</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12853" href="#C12853">
                <time itemprop="dateCreated" datetime="2014-11-06T03:52:06-07:00" class="action-date">Nov '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes, now I see that these methods always return boolean values.</p>
<p>But the comment &quot;If the record already exists we must throw an exception&quot; means &quot;add an errorMessage to the model and return false&quot;</p>
<p>Handling &quot;errors&quot; with the return value and getMessages () instead of catching PDOExceptions is nice, but the price is an additional query for each INSERT / UPDATE using save().<br />
IMHO is not the philosophy that the Phalcon's ORM should follow but that's just my opinion.</p>
<p>The point is when I want to INSERT a row with a explicit PK id, the resulting SQL does two &quot;rowcount&quot; and then an insert:</p>
<p><a href="https://github.com/phalcon/cphalcon/blob/2.0.0/phalcon/mvc/model.zep#L2923">https://github.com/phalcon/cphalcon/blob/2.0.0/phalcon/mvc/model.zep#L2923</a></p>
<pre><code>function create()
{
if (SELECT COUNT(*) "rowcount"....) return false
    else this-&gt;save()
}</code></pre>
<p><a href="https://github.com/phalcon/cphalcon/blob/2.0.0/phalcon/mvc/model.zep#L2743">https://github.com/phalcon/cphalcon/blob/2.0.0/phalcon/mvc/model.zep#L2743</a></p>
<pre><code>function save()
{

    if (SELECT COUNT(*) "rowcount"....) 
        self::OP_UPDATE
    else
        self::OP_INSERT</code></pre>
<p>create() and update() checks if the row exists, then both call save() anyways where again checks if the row exists, so better just call save() in this situation
The other alternative (within the framework) would be using PHQL</p>
<p>Thanks :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12853" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12853" data-cf-modified-2bd629f2e11b88d2fd7ce140-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2465" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>