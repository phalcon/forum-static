---
layout: default
title: 'Transaction manager is corrupted... - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Transaction manager is corrupted...</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a></span>
            <time itemprop="dateCreated" datetime="2013-02-05T12:54:01-07:00">Feb '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-02-05T12:54:01-07:00">Feb '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Feb '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>1447</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">3</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/4fbdf4d34dbf4054700053297aed58ac?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a></span>
                <span class="karma">12.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C37" href="#C37">
        <time class="action-date">Feb '13</time>
    </a>
</div>
<div class="post-content"><div><p>Hi, here with another issue more weird than before:</p>
<p>My code</p>
<p>//Doing values insertion
try {
$transactionManager = new Phalcon\Mvc\Model\Transaction\Manager();</p>
<pre><code>    $transaction = $transactionManager-&gt;get();

    $user = Users::findFirst("uid='".$userId."'");

    if ($user == false) {
        echo '1,Invalid uid';
        return;
    }

    $ipAddress = explode(',', $app-&gt;request-&gt;getClientAddress(true));

    $user-&gt;status = 'active';

    if ($user-&gt;save() == false) {
        $messages = $user-&gt;getMessages();
        $errors = '';
        for ($i = 0; $i &lt; count($messages); $i++) {
            $errors .= '['.$messages[$i].'] ';
        }
        $transaction-&gt;rollback('Unable to save model [user], error: '.$errors);
    }

    $transaction-&gt;commit();

    echo '0';

} catch(Phalcon\Mvc\Model\Transaction\Failed $e) {
    echo '1,Some error happened';
} catch (Exception $e) {
    echo '1,Some error happened';
}</code></pre>
<p>here is the exception I'm getting </p>
<p>Line: 84, Code: 0, Message: The transaction manager is corrupted</p>
<p>And line 84 is related to: $transaction = $transactionManager-&gt;get();</p>
<p>Any clue about this? How can this happen?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-f362275d2e5a301d915b1b77-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-f362275d2e5a301d915b1b77-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">3</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4fbdf4d34dbf4054700053297aed58ac?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C217" href="#C217">
                <time itemprop="dateCreated" datetime="2013-02-08T15:36:40-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Any clue about this? </p>
<p>I updated my servers to 0.9.1 version, and I'm still having this issues some times.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="217" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="217" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C220" href="#C220">
                <time itemprop="dateCreated" datetime="2013-02-08T19:54:29-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Could you catch the exception and post the full backtrace? </p>
<pre><code class="language-php">try {
 //...
} catch(Exception $e) {
    print_r($e-&gt;getTrace());
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="220" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="220" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4fbdf4d34dbf4054700053297aed58ac?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C230" href="#C230">
                <time itemprop="dateCreated" datetime="2013-02-11T08:17:41-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Sure:</p>
<p>Line: 53
File: .../app/request/toolbars/uninstall.php
Message: The transaction manager is corrupted
Trace: #0 ../app/request/toolbars/uninstall.php(53): Phalcon\Mvc\Model\Transaction\Manager-&gt;get()</p>
<h1>1 [internal function]: {closure}()</h1>
<h1>2 .../public_html/index.php(167): Phalcon\Mvc\Micro-&gt;handle()</h1>
<h1>3 {main}</h1></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="230" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="230" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C235" href="#C235">
                <time itemprop="dateCreated" datetime="2013-02-11T10:51:16-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Could you use getTrace instead of getTraceAsString()?</p>
<pre><code class="language-php">try {
 //...
} catch(Exception $e) {
    print_r($e-&gt;getTrace());
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="235" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="235" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4fbdf4d34dbf4054700053297aed58ac?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C236" href="#C236">
                <time itemprop="dateCreated" datetime="2013-02-11T11:38:58-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Here you have it:</p>
<p>Line: 90
File: .../app/request/toolbars/install.php
Message: The transaction manager is corrupted
Trace: Array
(
[0] =&gt; Array
(
[file] =&gt; .../app/request/toolbars/install.php
[line] =&gt; 90
[function] =&gt; get
[class] =&gt; Phalcon\Mvc\Model\Transaction\Manager
[type] =&gt; -&gt;
[args] =&gt; Array
(
)</p>
<pre><code>    )

[1] =&gt; Array
    (
        [function] =&gt; {closure}
        [args] =&gt; Array
            (
            )

    )

[2] =&gt; Array
    (
        [file] =&gt; .../public_html/index.php
        [line] =&gt; 167
        [function] =&gt; handle
        [class] =&gt; Phalcon\Mvc\Micro
        [type] =&gt; -&gt;
        [args] =&gt; Array
            (
            )

    )</code></pre>
<p>)</p>
<p>Line change because are different request operations, on both I use the transaction manager.</p>
<p>I put [...] in the paths because they are related to prod servers.</p>
<p>Hope this give you a better clue :-/</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="236" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="236" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4fbdf4d34dbf4054700053297aed58ac?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C247" href="#C247">
                <time itemprop="dateCreated" datetime="2013-02-12T15:43:48-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Any news about this issue?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="247" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="247" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C263" href="#C263">
                <time itemprop="dateCreated" datetime="2013-02-13T23:02:30-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I wasn't able to reproduce your problem; I would appreciate if you can attach a script that always throws this so we can check the problem better.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="263" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="263" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4fbdf4d34dbf4054700053297aed58ac?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C271" href="#C271">
                <time itemprop="dateCreated" datetime="2013-02-14T08:32:29-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thats the issue, same script don't throw the exception all the time, until now I have no clue what is triggering this. I hoped you guys have at least a clue when this kind of exception can happen.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="271" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="271" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4fbdf4d34dbf4054700053297aed58ac?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C273" href="#C273">
                <time itemprop="dateCreated" datetime="2013-02-14T12:25:08-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Phalcon\Mvc\Model\Transaction\Manager Object (
[_dependencyInjector:protected] =&gt; Phalcon\DI\FactoryDefault Object
(
[_services:protected] =&gt; Array
(
[router] =&gt; Phalcon\DI\Service Object
(
[_name:protected] =&gt; router
[_definition:protected] =&gt; Phalcon\Mvc\Router
[_shared:protected] =&gt; 1
[_sharedInstance:protected] =&gt;
)</p>
<pre><code>                [dispatcher] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; dispatcher
                        [_definition:protected] =&gt; Phalcon\Mvc\Dispatcher
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [url] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; url
                        [_definition:protected] =&gt; Closure Object
                            (
                                [static] =&gt; Array
                                    (
                                    )

                            )

                        [_shared:protected] =&gt; 
                        [_sharedInstance:protected] =&gt; 
                    )

                [modelsManager] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; modelsManager
                        [_definition:protected] =&gt; Phalcon\Mvc\Model\Manager
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [modelsMetadata] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; modelsMetadata
                        [_definition:protected] =&gt; Closure Object
                            (
                            )

                        [_shared:protected] =&gt; 
                        [_sharedInstance:protected] =&gt; 
                    )

                [response] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; response
                        [_definition:protected] =&gt; Phalcon\Http\Response
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [request] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; request
                        [_definition:protected] =&gt; Phalcon\Http\Request
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [filter] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; filter
                        [_definition:protected] =&gt; Phalcon\Filter
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [escaper] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; escaper
                        [_definition:protected] =&gt; Phalcon\Escaper
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [security] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; security
                        [_definition:protected] =&gt; Phalcon\Security
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [annotations] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; annotations
                        [_definition:protected] =&gt; Phalcon\Annotations\Adapter\Memory
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [flash] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; flash
                        [_definition:protected] =&gt; Phalcon\Flash\Direct
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [flashSession] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; flashSession
                        [_definition:protected] =&gt; Phalcon\Flash\Session
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [session] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; session
                        [_definition:protected] =&gt; Phalcon\Session\Adapter\Files
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [sessionBag] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; sessionBag
                        [_definition:protected] =&gt; Phalcon\Session\Bag
                        [_shared:protected] =&gt; 
                        [_sharedInstance:protected] =&gt; 
                    )

                [eventsManager] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; eventsManager
                        [_definition:protected] =&gt; Phalcon\Events\Manager
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [transactionManager] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; eventsManager
                        [_definition:protected] =&gt; Phalcon\Mvc\Model\Transaction\Manager
                        [_shared:protected] =&gt; 1
                        [_sharedInstance:protected] =&gt; 
                    )

                [db] =&gt; Phalcon\DI\Service Object
                    (
                        [_name:protected] =&gt; db
                        [_definition:protected] =&gt; Closure Object
                            (
                                [static] =&gt; Array
                                    (
                                        [config] =&gt; Phalcon\Config Object
                                            (
                                                [database] =&gt; Phalcon\Config Object
                                                    (
                                                        [adapter] =&gt; Mysql
                                                        [host] =&gt; ...
                                                        [username] =&gt; ...
                                                        [password] =&gt; ...
                                                        [name] =&gt; ...
                                                        [charset] =&gt; utf8
                                                        [port] =&gt; 3306
                                                    )

                                                [application] =&gt; Phalcon\Config Object
                                                    (
                                                        [modelsDir] =&gt; .../config/../models/
                                                        [rootDir] =&gt; .../config/../
                                                        [appDir] =&gt; .../config/../app/
                                                        [baseUri] =&gt; 
                                                    )

                                                [models] =&gt; Phalcon\Config Object
                                                    (
                                                        [metadata] =&gt; Phalcon\Config Object
                                                            (
                                                                [adapter] =&gt; Memory
                                                            )

                                                    )

                                            )

                                    )

                            )

                        [_shared:protected] =&gt; 
                        [_sharedInstance:protected] =&gt; 
                    )

            )

        [_sharedInstances:protected] =&gt; Array
            (
                [db] =&gt; Phalcon\Db\Adapter\Pdo\Mysql Object
                    (
                        [_eventsManager:protected] =&gt; 
                        [_descriptor:protected] =&gt; Array
                            (
                                [host] =&gt; ...
                                [username] =&gt; ...
                                [password] =&gt; ...
                                [dbname] =&gt; ...
                                [port] =&gt; 3306
                            )

                        [_dialectType:protected] =&gt; mysql
                        [_type:protected] =&gt; mysql
                        [_dialect:protected] =&gt; Phalcon\Db\Dialect\Mysql Object
                            (
                                [_escapeChar:protected] =&gt; `
                            )

                        [_connectionId:protected] =&gt; 1
                        [_sqlStatement:protected] =&gt; 
                        [_sqlVariables:protected] =&gt; 
                        [_sqlBindTypes:protected] =&gt; 
                        [_pdo:protected] =&gt; PDO Object
                            (
                            )

                        [_affectedRows:protected] =&gt; 
                        [_transactionLevel:protected] =&gt; 1
                    )

            )

        [_freshInstance:protected] =&gt; 1
    )

[_initialized:protected] =&gt; 
[_rollbackPendent:protected] =&gt; 1
[_number:protected] =&gt; 1
[_service:protected] =&gt; db
[_transactions:protected] =&gt;</code></pre>
<p>)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="273" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="273" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C274" href="#C274">
                <time itemprop="dateCreated" datetime="2013-02-14T12:32:33-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>hey odiel, there is a password in the  Phalcon\Config section, I removed the comment</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="274" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="274" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4fbdf4d34dbf4054700053297aed58ac?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C275" href="#C275">
                <time itemprop="dateCreated" datetime="2013-02-14T12:42:46-07:00" class="action-date">Feb '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks so much, I didn't realize that same value was in more than one place. I will updated the comment.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="275" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="275" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4fbdf4d34dbf4054700053297aed58ac?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C546" href="#C546">
                <time itemprop="dateCreated" datetime="2013-03-13T08:57:45-07:00" class="action-date">Mar '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi guys, I'm still hammering my head with this issue. I set up a new env in a local VM computer, with Ubuntu and apache2, this is what I got from phpinfo() &quot;PHP Version 5.3.10-1ubuntu3.5&quot; for more details, I'm using phalcon 0.9.1</p>
<p>This is a completed new product on what I'm working on, here is the code for an action.</p>
<pre><code class="language-php">&lt;?php

namespace Modules\Project\Target;

class Create extends \Classes\General\BasicController
{

    public function post()
    {
        $this-&gt;filter-&gt;add('under', new \Filters\AlphaUnderscore());
        $this-&gt;filter-&gt;add('interval_choices', new \Filters\Choices(array('i', 'h', 'd', 'w', 'm')));

        $id = $this-&gt;filter-&gt;sanitize($this-&gt;request-&gt;getPost('id'), 'under');
        $projectId = $this-&gt;filter-&gt;sanitize($this-&gt;request-&gt;getPost('project_id'), 'under');

        $description = $this-&gt;request-&gt;getPost('description');

        $preBuild = $this-&gt;request-&gt;getPost('prebuild');
        $build = $this-&gt;request-&gt;getPost('build');
        $postBuild = $this-&gt;request-&gt;getPost('postbuild');

        if ($id == '') {
            $this-&gt;jsonError("&lt;b&gt;ID&lt;/b&gt; can't be empty.", 'id');
            return;
        }

        if ($projectId == '') {
            $this-&gt;jsonError("Unable to find the project you are working on, please reload the page and start over.", 'error');
            return;
        }

        //checking if project exist
        $project = \Models\Project::findFirst(array(
            'conditions' =&gt; 'id = ?1',
            'bind' =&gt; array(1 =&gt; $projectId)
        ));

        if ($project == false) {
            $this-&gt;jsonError("Unable to find the project you are working on, please reload the page and start over.", 'error');
            return;
        }

        //loading needed settings
        $setting = \Models\GlobalSetting::findFirst(array(
            'conditions' =&gt; 'id = ?1',
            'bind' =&gt; array(1 =&gt; 'scripts_path')
        ));

        if ($setting == false) {
            $this-&gt;jsonError("Unable to find the folder to store the projects, please contact the development team.", 'error');
            return;
        }

        //Creating project folder structure
        $this-&gt;_createFolderStructure($setting-&gt;value, $projectId, $id);

        //todo: log the errors creating project folder structure.

        //Creating script (xml) files
        $this-&gt;_createBuildFile($setting-&gt;value.'/'.$projectId.'/'.$id.'/scripts/', 'build.xml', $build);
        $this-&gt;_createBuildFile($setting-&gt;value.'/'.$projectId.'/'.$id.'/scripts/', 'prebuild.xml', $preBuild);
        $this-&gt;_createBuildFile($setting-&gt;value.'/'.$projectId.'/'.$id.'/scripts/', 'postbuild.xml', $postBuild);

        //todo: log the errors creating build files.

        //checking if target exist
        $targetModel = \Models\Target::findFirst(array(
            'conditions' =&gt; 'id = ?1',
            'bind' =&gt; array(1 =&gt; $id)
        ));

        if ($targetModel != false) {
            $this-&gt;jsonError("Target ID already exist, please choose another one.", 'error');
            return;
        }

        $manager = new \Phalcon\Mvc\Model\Transaction\Manager();
        $manager-&gt;collectTransactions();
        var_dump($manager);
        $transaction = $manager-&gt;get();

        $targetModel = new \Models\Target();
        $targetModel-&gt;setTransaction($transaction);
        $targetModel-&gt;id = $id;
        $targetModel-&gt;description = $description;
        $targetModel-&gt;project_id = $projectId;
        $result = $targetModel-&gt;save();

        //TODO: collect the errors and log it

        if ($result == false) {
            $transaction-&gt;rollback("Unable to save the Target, please try again the operation.");
            unset($transaction, $manager);
            //$this-&gt;jsonError("Unable to save the Target, please try again the operation.", 'error');
            return;
        }

        //Checking for triggers
        $triggers = $this-&gt;request-&gt;getPost('triggers');

        if ($triggers == 'commits') {
            $svnUrl = $this-&gt;request-&gt;getPost('svn_url');
            $svnUsername = $this-&gt;request-&gt;getPost('svn_username');
            $svnPassword = $this-&gt;request-&gt;getPost('svn_password');

            //Checking SVN connection
            $svn = new \Classes\SourceControl\Svn();
            try {
                $svn-&gt;checkConnection($svnUrl, $svnUsername, $svnPassword);
            } catch (\Exception $e) {
                $this-&gt;jsonError($e-&gt;getMessage(), 'error');
                return;
            }

            //Checking if SVN connection is already defined
            $svnModel = \Models\Def\SourceControl\Svn::findFirst(array(
                'conditions' =&gt; 'url = ?1 AND username = ?2 ',
                'bind'   =&gt; array(1 =&gt; $svnUrl, 2 =&gt; $svnUsername)
            ));

            if ($svnModel == false) {
                $svnModel = new \Models\Def\SourceControl\Svn();
            }

            //Storing the SVN connection params only if is new or password was updated
            if ($svnModel-&gt;password != $svnPassword) {
                $svnModel-&gt;setTransaction($transaction);
                $svnModel-&gt;url = $svnUrl;
                $svnModel-&gt;username = $svnUsername;
                $svnModel-&gt;password = $svnPassword;
                $result = $svnModel-&gt;save();

                if ($result == false) {
                    $transaction-&gt;rollback("Unable to save the SVN definition, please try again the operation.");
                    unset($transaction, $manager);
                    return;
                }
            }

            //Trigger interval values
            $svnCheckEvery = $this-&gt;filter-&gt;sanitize($this-&gt;request-&gt;getPost('svn_check_every'), 'int');
            $svnCheckInterval = $this-&gt;filter-&gt;sanitize($this-&gt;request-&gt;getPost('svn_check_interval'), 'interval_choices');

            if ($svnCheckEvery == 0) {
                $svnCheckEvery = 5;
                $svnCheckInterval= 'i';
            }

            if ($svnCheckInterval == false) {
                $svnCheckInterval= 'i';
            }

            switch ($svnCheckInterval) {
                case 'i':   //Minutes
                    $svnCheckInterval = 'minutes';
                    break;
                case 'h':   //Hours
                    $svnCheckInterval = 'hours';
                    break;
                case 'd':   //Days
                    $svnCheckInterval = 'days';
                    break;
                case 'w':   //Weeks
                    $svnCheckInterval = 'week';
                    break;
                case 'm':   //Months
                    $svnCheckInterval = 'month';
                    break;
            }

            $triggerModel = new \Models\Target\Trigger();
            $triggerModel-&gt;setTransaction($transaction);
            $triggerModel-&gt;type = 'commits';
            $triggerModel-&gt;code = 'svn::id='.$svnModel-&gt;id;
            $triggerModel-&gt;execute_every = " + ".$svnCheckEvery." ".$svnCheckInterval;
            $triggerModel-&gt;next_execution = date('Y-m-d H:i:s', strtotime(" + ".$svnCheckEvery." ".$svnCheckInterval));
            $triggerModel-&gt;target_id = $id;
            $result = $triggerModel-&gt;save();

            if ($result == false) {
                $transaction-&gt;rollback("Unable to save create the trigger for the target, please try again.");
                unset($transaction, $manager);
                return;
            }
        }

        $transaction-&gt;commit();
        unset($transaction, $manager);

        $this-&gt;jsonOk();
    }

    private function _createFolderStructure($path, $projectId, $targetId)
    {
        if (is_dir($path.'/'.$projectId.'/'.$targetId.'/scripts/') == false) {
            if (@mkdir($path.'/'.$projectId.'/'.$targetId.'/scripts/', 0777, true) == false) {
                $this-&gt;jsonError("Unable to create the project folder structure, please contact the development team.", 'error');
                return;
            }
        }

        if (is_dir($path.'/'.$projectId.'/'.$targetId.'/builds/') == false) {
            if (@mkdir($path.'/'.$projectId.'/'.$targetId.'/builds/', 0777, true) == false) {
                $this-&gt;jsonError("Unable to create the project folder structure, please contact the development team.", 'error');
                return;
            }
        }

        if (is_dir($path.'/'.$projectId.'/'.$targetId.'/temp/source/') == false) {
            if (@mkdir($path.'/'.$projectId.'/'.$targetId.'/temp/source', 0777, true) == false) {
                $this-&gt;jsonError("Unable to create the project folder structure, please contact the development team.", 'error');
                return;
            }
        }
    }

    private function _createBuildFile($path, $file, $content)
    {
        if (is_dir($path) == false) {
            $this-&gt;jsonError("Unable to find the Script directory for the project, please contact the development team.", 'error');
            return;
        }

        $hdl = fopen($path.$file, 'w');
        if ($hdl == false) {
            $this-&gt;jsonError("Unable to create the '.$file.' file in the script directory, please contact the development team.", 'error');
            return;
        }

        fwrite($hdl, $content);
        fclose($hdl);
    }

}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="546" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="546" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/4fbdf4d34dbf4054700053297aed58ac?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7/odiel" class="user-moderator-N"><span itemprop="name">odiel</span></a>        </span>
        <br>

        <span class="karma">12.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C548" href="#C548">
                <time itemprop="dateCreated" datetime="2013-03-13T09:01:01-07:00" class="action-date">Mar '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The issue, some times when I insert a new &quot;Target&quot; the values go to the DB without any problem, but in other occasions I get &quot;Transaction manager is corrupted&quot; exception, this is very randomly, and until now I haven't figure out the cause. As I said this is a local VM, there is not traffic rather than me accessing it.</p>
<p>Note: the root password is ok, you don't need to remove the object below because it.</p>
<p>Here is the $manager object dump.</p>
<p><a href="https://pastebin.com/W5rW3ij3">https://pastebin.com/W5rW3ij3</a></p>
<p>And the exception:</p>
<pre><code class="language-php">object(Phalcon\Mvc\Model\Transaction\Exception)#41 (7) {
  ["message":protected]=&gt;
  string(36) "The transaction manager is corrupted"
  ["string":"Exception":private]=&gt;
  string(0) ""
  ["code":protected]=&gt;
  int(0)
  ["file":protected]=&gt;
  string(67) "/home/www/dev.micro/site/site/app/modules/project/target/create.php"
  ["line":protected]=&gt;
  int(83)
  ["trace":"Exception":private]=&gt;
  array(4) {
    [0]=&gt;
    array(6) {
      ["file"]=&gt;
      string(67) "/home/www/dev.micro/site/site/app/modules/project/target/create.php"
      ["line"]=&gt;
      int(83)
      ["function"]=&gt;
      string(3) "get"
      ["class"]=&gt;
      string(37) "Phalcon\Mvc\Model\Transaction\Manager"
      ["type"]=&gt;
      string(2) "-&gt;"
      ["args"]=&gt;
      array(0) {
      }
    }
    [1]=&gt;
    array(4) {
      ["function"]=&gt;
      string(4) "post"
      ["class"]=&gt;
      string(29) "Modules\Project\Target\Create"
      ["type"]=&gt;
      string(2) "-&gt;"
      ["args"]=&gt;
      array(0) {
      }
    }
    [2]=&gt;
    array(6) {
      ["file"]=&gt;
      string(65) "/home/www/dev.micro/site/site/app/classes/General/Application.php"
      ["line"]=&gt;
      int(102)
      ["function"]=&gt;
      string(6) "handle"
      ["class"]=&gt;
      string(17) "Phalcon\Mvc\Micro"
      ["type"]=&gt;
      string(2) "-&gt;"
      ["args"]=&gt;
      array(0) {
      }
    }
    [3]=&gt;
    array(6) {
      ["file"]=&gt;
      string(51) "/home/www/dev.micro/site/site/public_html/index.php"
      ["line"]=&gt;
      int(139)
      ["function"]=&gt;
      string(5) "start"
      ["class"]=&gt;
      string(27) "Classes\General\Application"
      ["type"]=&gt;
      string(2) "-&gt;"
      ["args"]=&gt;
      array(0) {
      }
    }
  }
  ["previous":"Exception":private]=&gt;
  NULL
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="548" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="548" data-cf-modified-f362275d2e5a301d915b1b77-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="37" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>