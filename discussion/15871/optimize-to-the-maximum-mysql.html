---
layout: default
title: 'Optimize to the maximum mysql - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Optimize to the maximum mysql</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/9301/sebastiandev82" class="user-moderator-N"><span itemprop="name">sebastiandev82</span></a></span>
            <time itemprop="dateCreated" datetime="2017-04-03T06:09:20-07:00">Apr '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-04-03T06:09:20-07:00">Apr '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Apr '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">5</span>
                </td>
                <td>
                    <label>Views</label><br>648</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/108ffd7ef653f6b961961b1156234470?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/9301/sebastiandev82" class="user-moderator-N"><span itemprop="name">sebastiandev82</span></a></span>
                <span class="karma">5.3k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C15871" href="#C15871">
        <time class="action-date">Apr '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hi I'm starting with Phalcon and I find that it is really fast.
But at first I have 2 tables:
Inventary: 20 Million Records
Sales: 5 million records</p>
<p>I would like recommendations on how to optimize mysql from the configuration
And what precautions to take with Phalcon for this type of database with so many records.</p>
<p>Thank you</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-b439efc098dcc2c84e013f2a-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-b439efc098dcc2c84e013f2a-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47187" href="#C47187">
                <time itemprop="dateCreated" datetime="2017-04-03T06:17:45-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><ol>
<li>Use latest MariaDB</li>
<li>In phalcon use joins etc when possible(don't relate on relations)</li>
<li>Select data only you need(columns)</li>
</ol>
<p>About how to configure mysql/mariadb for performance etc you can just google it</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47187" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47187" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47205" href="#C47205">
                <time itemprop="dateCreated" datetime="2017-04-03T08:55:08-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I'd also add that pagination can have three sources: array, model and query builder.
When paging a large number of results, you should ALWAYS use QueryBuilder!</p>
<p><a href="https://docs.phalcon.io/en/latest/reference/pagination.html">https://docs.phalcon.io/en/latest/reference/pagination.html</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47205" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47205" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/108ffd7ef653f6b961961b1156234470?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/9301/sebastiandev82" class="user-moderator-N"><span itemprop="name">sebastiandev82</span></a>        </span>
        <br>

        <span class="karma">5.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47209" href="#C47209">
                <time itemprop="dateCreated" datetime="2017-04-03T10:26:13-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>In wamp I am using mysql 5.7.14
It's enough?</p>
<p>To start, if from phpmyadmin login to view the sales table with 5million registration, the first page shows it immediately.
But if I go to the last page it takes:</p>
<p>Showing rows 4475300 - 4475300 (4475301 total, Query took 11.6134 seconds.)</p>
<p>Without doing any join or anything is already taking 11 seconds.
The minimum structure of the table is:
Table name: sales
Primary key: NUM
Other fields, a, b, c, etc.</p>
<p>The query I'm running is:
SELECT NUM FROM SALES</p>
<p>But if I remove the revision of foreign keys takes between 1.6sec and 2.6sec.</p>
<p>SET FOREIGN_KEY_CHECKS = 0;</p>
<p>I definitely do not use CASCADE since it is a web system and has to go extremely fast.</p>
<p>Is it okay to disable the patch?</p>
<p>If I have to say that I use indexes: PRIMARY_KEY, INDEX and UNIQUE</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47209" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47209" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="47211" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '17</span>
              </span><br/><a name="C47211" href="#C47211">
                <time itemprop="dateCreated" datetime="2017-04-03T10:42:14-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You better use mariadb 10.1, also it will always take long to select last page in phpmyadmin</p>
<p>Also try to avoid OFFSET/TOP queries if it's possible, faster will be INDEX ON column + where + limit.</p>
<p>For example assume we have paging, instead of doing standard for 5th page:</p>
<p>SELECT columns OFFSET X LIMIT Y</p>
<p>You should try to make it if possible:</p>
<p>SELECT COLUMNS WHERE id &gt; LAST ID OF 4th page LIMIT Y</p>
<p>This will be much faster, especially for latest pages, you could use it without any problem on some lazy loading stuff, it will be hared to use it for any page, not sure how exactly your tables looks like but if you can anyhow avoid TOP/OFFSET queries do it, and if you can't - try to change your database/application logic to make it stop using top/offset.</p>
<p><a href="http://www.tocker.ca/2013/09/17/what-to-tune-in-mysql-56-after-installation.html">http://www.tocker.ca/2013/09/17/what-to-tune-in-mysql-56-after-installation.html</a> here you can read about configuration</p>
<p><a href="http://mysql.rjweb.org/doc.php/pagination">http://mysql.rjweb.org/doc.php/pagination</a></p>
<p>This is great article about this problem</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47211" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47211" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C47205"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Lajos Bencz                    </a>
                </div><div class="posts-buttons" align="right"><a name="C47213" href="#C47213">
                <time itemprop="dateCreated" datetime="2017-04-03T10:50:32-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Actually query builder pagination in phalcon is not optimized for big tables, <strong>YOU SHOULD NEVER</strong> use offset/top for big tables for pagination.</p>
<blockquote>
<p>I'd also add that pagination can have three sources: array, model and query builder.
When paging a large number of results, you should ALWAYS use QueryBuilder!</p>
<p><a href="https://docs.phalcon.io/en/latest/reference/pagination.html">https://docs.phalcon.io/en/latest/reference/pagination.html</a></p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47213" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47213" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/108ffd7ef653f6b961961b1156234470?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/9301/sebastiandev82" class="user-moderator-N"><span itemprop="name">sebastiandev82</span></a>        </span>
        <br>

        <span class="karma">5.3k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C47211"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Wojciech Ślawski                    </a>
                </div><div class="posts-buttons" align="right"><a name="C47215" href="#C47215">
                <time itemprop="dateCreated" datetime="2017-04-03T11:02:49-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>OK thanks. I'm going to put it into practice to see if it works for me.
What if I can say that disabling the FOREIGN_KEY_CHECKS speed difference is 10 to 1.
But I do not know if it's right to work like this?</p>
<blockquote>
<p>You better use mariadb 10.1, also it will always take long to select last page in phpmyadmin</p>
<p>Also try to avoid OFFSET/TOP queries if it's possible, faster will be INDEX ON column + where + limit.</p>
<p>For example assume we have paging, instead of doing standard for 5th page:</p>
<p>SELECT columns OFFSET X LIMIT Y</p>
<p>You should try to make it if possible:</p>
<p>SELECT COLUMNS WHERE id &gt; LAST ID OF 4th page LIMIT Y</p>
<p>This will be much faster, especially for latest pages, you could use it without any problem on some lazy loading stuff, it will be hared to use it for any page, not sure how exactly your tables looks like but if you can anyhow avoid TOP/OFFSET queries do it, and if you can't - try to change your database/application logic to make it stop using top/offset.</p>
<p><a href="http://www.tocker.ca/2013/09/17/what-to-tune-in-mysql-56-after-installation.html">http://www.tocker.ca/2013/09/17/what-to-tune-in-mysql-56-after-installation.html</a> here you can read about configuration</p>
<p><a href="http://mysql.rjweb.org/doc.php/pagination">http://mysql.rjweb.org/doc.php/pagination</a></p>
<p>This is great article about this problem</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47215" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47215" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="47217" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '17</span>
              </span><br/><a name="C47217" href="#C47217">
                <time itemprop="dateCreated" datetime="2017-04-03T11:04:44-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I don't think you can disable them globally, doing this will only disable them for current session. And it's not good idea to disable them anyway. Just update your mysqldb 5.7 to mariadb 10.1 first.</p>
<p>Also remember to use mysql query cache, just don't disable it by mistake.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47217" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47217" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/108ffd7ef653f6b961961b1156234470?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/9301/sebastiandev82" class="user-moderator-N"><span itemprop="name">sebastiandev82</span></a>        </span>
        <br>

        <span class="karma">5.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C47223" href="#C47223">
                <time itemprop="dateCreated" datetime="2017-04-03T13:06:05-07:00" class="action-date">Apr '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ok let's try</p>
<p>Thank you</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47223" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47223" data-cf-modified-b439efc098dcc2c84e013f2a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="15871" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>