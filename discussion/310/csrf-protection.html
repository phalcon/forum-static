---
layout: default
title: 'CSRF Protection - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/16/security">Security</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">CSRF Protection</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/192/ttnaa" class="user-moderator-N"><span itemprop="name">Pavlo Sadovyi</span></a></span>
            <time itemprop="dateCreated" datetime="2013-05-11T15:37:47-07:00">May '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-05-11T15:37:47-07:00">May '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '20</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">12</span>
                </td>
                <td>
                    <label>Views</label><br>6614</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">6</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/0a1ad36e0b22e05ecf8720f4a4a3eda3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/192/ttnaa" class="user-moderator-N"><span itemprop="name">Pavlo Sadovyi</span></a></span>
                <span class="karma">23.6k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C310" href="#C310">
        <time class="action-date">May '13</time>
    </a>
</div>
<div class="post-content"><div><p>Hi all! Who knows how can I protect all forms (~10 forms) on page of CSRF?
I already tried to set hidden input:</p>
<pre><code class="language-html">{% raw %}{{{% endraw %} form.render('csrf', ['value': security.getToken()]) {% raw %}}}{% endraw %}</code></pre>
<p>in form builder class:</p>
<pre><code class="language-php">// CSRF
$csrf = new Hidden('csrf');
$csrf-&gt;addValidator(
    new Identical(array(
        'value' =&gt; $this-&gt;security-&gt;getSessionToken(),
        'message' =&gt; $t-&gt;form-&gt;post-&gt;csrf
    ))
);</code></pre>
<p>But it's always validating as false. I have 3 suggestions:</p>
<ol>
<li>I should start session in some BaseController, but I don't know how to do it.. Help plz!</li>
<li>Every form have an unique value=&quot;...&quot;, but server side stores only last token... So on one page all forms protected from CSRF will fails except of last form. (I hope that's not true.)</li>
</ol>
<p>Any suggestions?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-24c47aaf7d384189729ec26b-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-24c47aaf7d384189729ec26b-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">6</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1251" href="#C1251">
                <time itemprop="dateCreated" datetime="2013-05-11T17:08:28-07:00" class="action-date">May '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Check the example in Vokuro:</p>
<p><a href="https://github.com/phalcon/vokuro/blob/master/app/config/services.php#L87">https://github.com/phalcon/vokuro/blob/master/app/config/services.php#L87</a>
<a href="https://github.com/phalcon/vokuro/blob/master/app/views/session/signup.volt#L53">https://github.com/phalcon/vokuro/blob/master/app/views/session/signup.volt#L53</a>
<a href="https://github.com/phalcon/vokuro/blob/master/app/forms/SignUpForm.php#L104">https://github.com/phalcon/vokuro/blob/master/app/forms/SignUpForm.php#L104</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1251" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1251" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0a1ad36e0b22e05ecf8720f4a4a3eda3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/192/ttnaa" class="user-moderator-N"><span itemprop="name">Pavlo Sadovyi</span></a>        </span>
        <br>

        <span class="karma">23.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1261" href="#C1261">
                <time itemprop="dateCreated" datetime="2013-05-12T07:01:18-07:00" class="action-date">May '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi! Thanks for your answer, have one more question can I use all of this but without form builder??</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1261" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1261" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1264" href="#C1264">
                <time itemprop="dateCreated" datetime="2013-05-12T11:06:36-07:00" class="action-date">May '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Check this chapter in the documentation: <a href="https://docs.phalcon.io/en/latest/reference/security.html#cross-site-request-forgery-csrf-protection">https://docs.phalcon.io/en/latest/reference/security.html#cross-site-request-forgery-csrf-protection</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1264" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1264" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0a1ad36e0b22e05ecf8720f4a4a3eda3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/192/ttnaa" class="user-moderator-N"><span itemprop="name">Pavlo Sadovyi</span></a>        </span>
        <br>

        <span class="karma">23.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1369" href="#C1369">
                <time itemprop="dateCreated" datetime="2013-05-16T12:35:19-07:00" class="action-date">May '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Huh! That's not so obivous, that what I need this line:</p>
<pre><code class="language-php">if ($this-&gt;request-&gt;isPost()) {</code></pre>
<p>to validate the token, even route to action is already declared as addPost(...)
;)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1369" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1369" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0a1ad36e0b22e05ecf8720f4a4a3eda3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/192/ttnaa" class="user-moderator-N"><span itemprop="name">Pavlo Sadovyi</span></a>        </span>
        <br>

        <span class="karma">23.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="1446" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '14</span>
              </span><br/><a name="C1446" href="#C1446">
                <time itemprop="dateCreated" datetime="2013-05-20T11:37:36-07:00" class="action-date">May '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>PFFFFFFFFFFFFF I need your help again!
I did exaclty the same like in that chapter.
I developing app like a forum, on one page I have a 10 themes on page and under each theme I have a form called &quot;Quick post&quot; each of this form protected from CSRF. And when I testing it, answering in many themes on one page, my token is invalidates very often.</p>
<p>Action that handles adding post request</p>
<pre><code class="language-php">public function addAction($boardAbbr)
    {
        if ($this-&gt;request-&gt;isPost()) {
            if ($this-&gt;security-&gt;checkToken()) {

              ..................

               if (!$post-&gt;save()) {
                    foreach ($post-&gt;getMessages() as $message)
                    $this-&gt;flash-&gt;error((string) $message);

                } else {
                    if ($this-&gt;request-&gt;isAjax()) {
                        echo json_encode(array(
                            'status' =&gt; true,
                            'message' =&gt; 'post added.',
                            'data' =&gt; array(
                                'post_id' =&gt; $post-&gt;id,
                                'pictures' =&gt; explode('|', $names)
                            )
                        ));
                    }
                    else {
                        $this-&gt;flashSession-&gt;success('post added.');
                        $this-&gt;response-&gt;redirect('#post-'.$post-&gt;id);
                    }
                }
            } else { echo 'token is bad.'; }</code></pre>
<p>In form:</p>
<pre><code class="language-volt">&lt;input type="hidden" name="{% raw %}{{{% endraw %} security.getTokenKey() {% raw %}}}{% endraw %}" value="{% raw %}{{{% endraw %} security.getToken() {% raw %}}}{% endraw %}"&gt;</code></pre>
<p>Token invalidates from time to time ..... What  can I do??</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1446" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1446" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b0118ac36d373acb24122c8183b087b4?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/578/JREAM" class="user-moderator-N"><span itemprop="name">Jesse Boyer</span></a>        </span>
        <br>

        <span class="karma">58.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4438" href="#C4438">
                <time itemprop="dateCreated" datetime="2013-11-25T20:50:06-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Get the CSRF tokens in the controller through the Security and assign it to the view.</p>
<pre><code class="language-php">&lt;?php
class AccountController extends BaseController
{
    public function indexAction()
    {
        $this-&gt;view-&gt;setVars([
            'tokenKey' =&gt; $this-&gt;security-&gt;getTokenKey(),
            'token' =&gt; $this-&gt;security-&gt;getToken()
        ]);
    }
}</code></pre>
<p>Then My view I re-used the variable:</p>
<pre><code class="language-html">&lt;form method="post" action="{% raw %}{{{% endraw %} url('account/doEmailUpdate') {% raw %}}}{% endraw %}"&gt;
    &lt;input type="text" name="email" class="form-control" placeholder="Email address" autofocus&gt;
    &lt;input type="text" name="confirm_email" class="form-control" placeholder="Confirm"&gt;
    &lt;input type="hidden" name="{% raw %}{{{% endraw %} tokenKey {% raw %}}}{% endraw %}" value="{% raw %}{{{% endraw %} token {% raw %}}}{% endraw %}" /&gt;
    &lt;input class="btn btn-lg btn-primary btn-block" type="submit" value="Submit"&gt;
&lt;/form&gt;
&lt;form method="post" action="{% raw %}{{{% endraw %} url('account/doPasswordUpdate') {% raw %}}}{% endraw %}"&gt;
    &lt;input type="text" name="password" class="form-control" placeholder="New Password"&gt;
    &lt;input type="text" name="confirm_password" class="form-control" placeholder="Confirm"&gt;
    &lt;input type="hidden" name="{% raw %}{{{% endraw %} tokenKey {% raw %}}}{% endraw %}" value="{% raw %}{{{% endraw %} token {% raw %}}}{% endraw %}" /&gt;
    &lt;input class="btn btn-lg btn-primary btn-block" type="submit" value="Submit"&gt;
&lt;/form&gt;</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4438" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4438" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">3</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1eb8846a496035ccf301c1918b8830c3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1526/cmeheut" class="user-moderator-N"><span itemprop="name">MEHEUT</span></a>        </span>
        <br>

        <span class="karma">4.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7568" href="#C7568">
                <time itemprop="dateCreated" datetime="2014-05-02T02:42:27-07:00" class="action-date">May '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you for this advice.
Actually, to manage token for form security, I found 2 things important:</p>
<ul>
<li>
<p>First One: if you want to add a form using getToken() from IndexController, you will have a problem as getToken() will be called each time, so that the csrf checking will fail.
My solution; create a HomeController and setup default controller at home</p>
</li>
<li>Second One: if you have more than one form for same action/controller, if each form call getToken(), you will have 2 different tokens. So the last form will work but not the first one
Jesse solution solve this problem.</li>
</ul>
<p>I learn Phalcon/csrf with Vokuro sample and I'm not sure this the best way as it's not dealing with form in index page or multi-form on same page</p>
<p>Sorry for my english, I hope that'll help</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7568" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7568" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/7a7cfceebd2b10146f978e15d22f5a35?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1811/ustasby" class="user-moderator-N"><span itemprop="name">Sergey</span></a>        </span>
        <br>

        <span class="karma">65</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C8665" href="#C8665">
                <time itemprop="dateCreated" datetime="2014-06-15T07:30:07-07:00" class="action-date">Jun '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>That version with support for multiple tokens.
<a href="https://github.com/ustasby/phalcon-class/blob/master/Token.php">https://github.com/ustasby/phalcon-class/blob/master/Token.php</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="8665" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="8665" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/19e92652bcf5fd50c9ddb3c0a8847554?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2531/saeed-jafari" class="user-moderator-N"><span itemprop="name">saeed-jafari</span></a>        </span>
        <br>

        <span class="karma">84</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C13964" href="#C13964">
                <time itemprop="dateCreated" datetime="2014-12-07T10:46:28-07:00" class="action-date">Dec '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I know the problem is solved but there is an easier way too,</p>
<p>if you see checkToken method defenition:</p>
<blockquote>
<p>public boolean checkToken ([string $tokenKey], [string $tokenValue])</p>
</blockquote>
<p>it gets input parameters so you just need to define unique key for each form and when you want to check token, pass both key and the value to checkToken method.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="13964" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="13964" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c6251d91458d83e25f95e63b4927dc39?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/5045/k7faq" class="user-moderator-N"><span itemprop="name">Steven Rhodes</span></a>        </span>
        <br>

        <span class="karma">1.8k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C7568"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/1eb8846a496035ccf301c1918b8830c3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        MEHEUT                    </a>
                </div><div class="posts-buttons" align="right"><a name="C34157" href="#C34157">
                <time itemprop="dateCreated" datetime="2016-05-16T16:24:10-07:00" class="action-date">May '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>For pages that have more than one form you can use the same token for all forms. You are protecting the page and all form(s) from cross site attacks. Protecting multiple forms individually has no advantage.</p>
<blockquote>
<p>Thank you for this advice.
Actually, to manage token for form security, I found 2 things important:</p>
<ul>
<li>
<p>First One: if you want to add a form using getToken() from IndexController, you will have a problem as getToken() will be called each time, so that the csrf checking will fail.
My solution; create a HomeController and setup default controller at home</p>
</li>
<li>Second One: if you have more than one form for same action/controller, if each form call getToken(), you will have 2 different tokens. So the last form will work but not the first one
Jesse solution solve this problem.</li>
</ul>
<p>I learn Phalcon/csrf with Vokuro sample and I'm not sure this the best way as it's not dealing with form in index page or multi-form on same page</p>
<p>Sorry for my english, I hope that'll help</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="34157" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="34157" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e6f3e4bab0da88ca16fe1e50078ec864?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9201/Videles" class="user-moderator-N"><span itemprop="name">Videles</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C13964"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/19e92652bcf5fd50c9ddb3c0a8847554?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        saeed-jafari                    </a>
                </div><div class="posts-buttons" align="right"><a name="C47921" href="#C47921">
                <time itemprop="dateCreated" datetime="2017-05-01T03:16:21-07:00" class="action-date">May '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I had a problem getting the check for the token to work on a login form and i could solve it using your method.</p>
<pre><code class="language-php">
$token    = $this-&gt;request-&gt;getPost('csrf');

if($this-&gt;security-&gt;checkToken( $token, $this-&gt;security-&gt;getSessionToken()) ) {

}
</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="47921" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="47921" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/638d82df5c0522a676bb4562e60fe935?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/10950/mostvotedplaya" class="user-moderator-N"><span itemprop="name">Lee Howarth</span></a>        </span>
        <br>

        <span class="karma">71</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C54438" href="#C54438">
                <time itemprop="dateCreated" datetime="2018-03-19T20:29:11-07:00" class="action-date">Mar '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I think it is worth noting that the code below:</p>
<h2></h2>
<pre><code>    $security = new Hidden('security');
    $security-&gt;addValidators([
        new Identical([
            'value' =&gt; $this-&gt;security-&gt;getSessionToken()
        ])
    ]);
    $this-&gt;add($security);</code></pre>
<h2></h2>
<p>Can be classed as insecure... the secure way would be:</p>
<h2></h2>
<pre><code>    $security = new Hidden('security');
    $security-&gt;addValidators([
        new PresenceOf([
        ]),
        new Identical([
            'value' =&gt; $this-&gt;security-&gt;getSessionToken()
        ])
    ]);
    $this-&gt;add($security);</code></pre>
<h2></h2>
<p>If the client does not have cookies enabled, then the session token would be null and that means the csrf input can be removed and the form would submit.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="54438" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="54438" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0f3d63965d2768a8f07c259d670f407e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/13139/DrJLT" class="user-moderator-N"><span itemprop="name">DrJLT</span></a>        </span>
        <br>

        <span class="karma">1.3k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C4438"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/b0118ac36d373acb24122c8183b087b4?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jesse Boyer                    </a>
                </div><div class="posts-buttons" align="right"><a name="C61563" href="#C61563">
                <time itemprop="dateCreated" datetime="2019-12-13T03:44:28-07:00" class="action-date">Dec '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This is the best solution IMO. </p>
<blockquote>
<p>Get the CSRF tokens in the controller through the Security and assign it to the view.</p>
<pre><code class="language-php">&lt;?php
class AccountController extends BaseController
{
   public function indexAction()
   {
       $this-&gt;view-&gt;setVars([
           'tokenKey' =&gt; $this-&gt;security-&gt;getTokenKey(),
           'token' =&gt; $this-&gt;security-&gt;getToken()
       ]);
   }
}</code></pre>
<p>Then My view I re-used the variable:</p>
<pre><code class="language-html">&lt;form method="post" action="{% raw %}{{{% endraw %} url('account/doEmailUpdate') {% raw %}}}{% endraw %}"&gt;
   &lt;input type="text" name="email" class="form-control" placeholder="Email address" autofocus&gt;
   &lt;input type="text" name="confirm_email" class="form-control" placeholder="Confirm"&gt;
   &lt;input type="hidden" name="{% raw %}{{{% endraw %} tokenKey {% raw %}}}{% endraw %}" value="{% raw %}{{{% endraw %} token {% raw %}}}{% endraw %}" /&gt;
   &lt;input class="btn btn-lg btn-primary btn-block" type="submit" value="Submit"&gt;
&lt;/form&gt;
&lt;form method="post" action="{% raw %}{{{% endraw %} url('account/doPasswordUpdate') {% raw %}}}{% endraw %}"&gt;
   &lt;input type="text" name="password" class="form-control" placeholder="New Password"&gt;
   &lt;input type="text" name="confirm_password" class="form-control" placeholder="Confirm"&gt;
   &lt;input type="hidden" name="{% raw %}{{{% endraw %} tokenKey {% raw %}}}{% endraw %}" value="{% raw %}{{{% endraw %} token {% raw %}}}{% endraw %}" /&gt;
   &lt;input class="btn btn-lg btn-primary btn-block" type="submit" value="Submit"&gt;
&lt;/form&gt;</code></pre>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="61563" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="61563" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0f3d63965d2768a8f07c259d670f407e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/13139/DrJLT" class="user-moderator-N"><span itemprop="name">DrJLT</span></a>        </span>
        <br>

        <span class="karma">1.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C61577" href="#C61577">
                <time itemprop="dateCreated" datetime="2019-12-14T07:20:49-07:00" class="action-date">Dec '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Need to point out that the answer above has a major issue with multiple windows / tabs.</p>
<p>I also found out the hard way that getSessionToken() is closely related to getToken(). It likes to become null unless getToken() is called on every form.</p>
<p>The only solution is to store the token in session. This is the only right solution that supports multiple windows: <a href="https://forum.phalcon.io/discussion/18827/csrf-security">https://forum.phalcon.io/discussion/18827/csrf-security</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="61577" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="61577" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/05d6fdf11a02818c83b3a4b6af5750c5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/13883/asdfd33e" class="user-moderator-N"><span itemprop="name">asdfd33e</span></a>        </span>
        <br>

        <span class="karma">69</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C63543" href="#C63543">
                <time itemprop="dateCreated" datetime="2020-06-22T17:16:30-07:00" class="action-date">Jun '20</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I developing app like a discussion board, on one web page I even have a ten issues on web <a href="https://motorcyclebeginners.com/">page</a> and below each subject I actually have a form called &quot;Quick submit&quot; every of this shape blanketed from CSRF.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="63543" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="63543" data-cf-modified-24c47aaf7d384189729ec26b-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="310" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>