---
layout: default
title: 'phalcon 3.1 logs out when klicking on link - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/17/acl">Acl</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">phalcon 3.1 logs out when klicking on link</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/9965/bobanmilano" class="user-moderator-N"><span itemprop="name">bobanmilano</span></a></span>
            <time itemprop="dateCreated" datetime="2017-08-08T00:21:10-07:00">Aug '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-08-08T00:21:10-07:00">Aug '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Aug '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>337</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/1149114fd32eb854a347f77b75f3c77f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/9965/bobanmilano" class="user-moderator-N"><span itemprop="name">bobanmilano</span></a></span>
                <span class="karma">407</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C16683" href="#C16683">
        <time class="action-date">Aug '17</time>
    </a>
</div>
<div class="post-content"><div><p>i noticed a weird behaviour after creating an usual link and klicking on it. it's just a simple link from one controller-page to the other but sometimes (not each time!) when i klick the link the user gets logged out and therefore the page can not be displayed (Unauthorized
You don't have access to this option. Contact an administrator). i have no idea what causes this random error as everything seems to be made correct programmatically. </p>
<p>so, before the link is clicked the user is always logged in with the correct role. after clicking on this link, sometimes he gets logged out and changes from authenticated role to role &quot;guest&quot; and therefore the page can not be displayed.</p>
<p>the link in the volt-page looks like this:
&lt;a href=&quot;<a href="http://localhost:8080/resort/snowropeway/details/{% raw %}{{{% endraw %}plant.UID{% raw %}}}{% endraw %}&quot;&gt;{% raw %}{{{% endraw %}plant.PlantName">http://localhost:8080/resort/snowropeway/details/{% raw %}{{{% endraw %}plant.UID{% raw %}}}{% endraw %}"&gt;{% raw %}{{{% endraw %}plant.PlantName</a>{% raw %}}}{% endraw %}&lt;/a&gt;</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-1b9028195918b25d38e6e7fa-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-1b9028195918b25d38e6e7fa-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50151" href="#C50151">
                <time itemprop="dateCreated" datetime="2017-08-08T01:19:53-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Idk, you didn't provided enough information, debug it with xdebug.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50151" data-cf-modified-1b9028195918b25d38e6e7fa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50151" data-cf-modified-1b9028195918b25d38e6e7fa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1149114fd32eb854a347f77b75f3c77f?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/9965/bobanmilano" class="user-moderator-N"><span itemprop="name">bobanmilano</span></a>        </span>
        <br>

        <span class="karma">407</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C50151"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Wojciech Ślawski                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="50153" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '17</span>
              </span><br/><a name="C50153" href="#C50153">
                <time itemprop="dateCreated" datetime="2017-08-08T01:57:58-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Idk, you didn't provided enough information, debug it with xdebug.</p>
</blockquote>
<p>i dont't know what more information is needed. it's just a simple link and the user gets randomly logged out when clicking on it. the error message in den Apache 2.4 log file maybe is interesting: </p>
<p>&quot;PHP Warning:  session_destroy(): Session object destruction failed&quot;</p>
<p>to make things more &quot;mysterious&quot; this weird behaviour is happending as well: when adding just an &quot;echo&quot; control output in the &quot;beforeDispatch&quot; method (in case the role is not accepted to access the resource) the error ist gone!</p>
<pre><code>    i$allowed = $acl-&gt;isAllowed($role, $controller, $action);
    if (!$allowed) {
                 echo "&lt;br&gt;before dispatch - role: " . $role . " not allowed"; exit;
                 return true;
        $dispatcher-&gt;forward(array(
            'controller' =&gt; 'errors',
            'action'     =&gt; 'show401'
        ));
                    $this-&gt;session-&gt;destroy();
        return false;
    } else {
                echo "&lt;br&gt;ACCESS ALLOWED";
            }                    </code></pre>
<p>so this echo (which is never reached as the &quot;allowed&quot; is alway true) leads to the error be gone. when i remove the echo the &quot;allowed&quot; results randomly in beeing false! completely unlogical behaviour!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50153" data-cf-modified-1b9028195918b25d38e6e7fa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50153" data-cf-modified-1b9028195918b25d38e6e7fa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="50155" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '17</span>
              </span><br/><a name="C50155" href="#C50155">
                <time itemprop="dateCreated" datetime="2017-08-08T02:31:15-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You didn't provided any code. Session_destory? When you use phalcon session adapters you don't need any <code>session_start</code>/<code>session_destroy</code> etc, you sure you have added session service and started it(that's necessary, by default phalcon have session service in DI but it's not started by default)?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50155" data-cf-modified-1b9028195918b25d38e6e7fa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50155" data-cf-modified-1b9028195918b25d38e6e7fa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50159" href="#C50159">
                <time itemprop="dateCreated" datetime="2017-08-08T04:38:39-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Just try to debug it with xdebug and find root of cause, never had problems like that really. Well i had once - i have in my app ip - session checking, maybe you use some vpn which is changing your ip?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50159" data-cf-modified-1b9028195918b25d38e6e7fa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50159" data-cf-modified-1b9028195918b25d38e6e7fa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="16683" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>