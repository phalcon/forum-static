---
layout: default
title: 'Join/compare multiple tables with querybuilder - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Join/compare multiple tables with querybuilder</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a></span>
            <time itemprop="dateCreated" datetime="2017-01-11T14:49:44-07:00">Jan '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-01-11T14:49:44-07:00">Jan '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jan '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">5</span>
                </td>
                <td>
                    <label>Views</label><br>1214</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/95593bdf7bc6c62dbd16767e520f13c8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a></span>
                <span class="karma">59.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C15277" href="#C15277">
        <time class="action-date">Jan '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hi,</p>
<p>I have a search filter table where i can save searchcriteria, like country, region, status.
I have also separate tables country, region, status.</p>
<p>Now i want to find all Users,
where searchcriteria.country = country.country
AND searchcriteria.region = region.region</p>
<p>For that i use the queryBuilder:</p>
<pre><code>     $users = $this-&gt;modelsManager-&gt;createBuilder()
       -&gt;from('Vokuro\Models\Users')
       -&gt;join('Vokuro\Models\Searchcriteria',null,'s')
       -&gt;join('Vokuro\Models\Region',null,'r')
       -&gt;join('Vokuro\Models\Country',null,'c')
       -&gt;where('Vokuro\Models\Users.id != '.$id.' AND s.usersId = '.$id)
       -&gt;andwhere("s.zipcode = r.region")
       -&gt;andwhere("s.country = c.country")
       -&gt;getQuery()
       -&gt;execute();</code></pre>
<p>The table searchcriteria has a usersId with the search data. So i think i have to choose the usersId first and then i have to select each other table. But how?</p>
<p>This is what i get</p>
<pre><code>Dispatcher has detected a cyclic routing causing stability problems
#0 [internal function]: Phalcon\Mvc\Dispatcher-&gt;_throwDispatchException('Dispatcher has ...', 1)
#1 [internal function]: Phalcon\Dispatcher-&gt;_dispatch()
#2 [internal function]: Phalcon\Dispatcher-&gt;dispatch()
#3 C:\xampp7013\htdocs\site\public\index.php(33): Phalcon\Mvc\Application-&gt;handle()
#4 {main}</code></pre>
<p>Thx</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-137f5bedf0e30d323b1b885a-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-137f5bedf0e30d323b1b885a-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0eb658098a90d286b29e99a38e010df3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/6067/ntesic" class="user-moderator-N"><span itemprop="name">ntesic</span></a>        </span>
        <br>

        <span class="karma">1.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C44843" href="#C44843">
                <time itemprop="dateCreated" datetime="2017-01-11T15:47:35-07:00" class="action-date">Jan '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This error have nothing to do with querybuilder. This is dispatcher error and probably you have problems with defined routes or wrong redirection in controller</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="44843" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="44843" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C44849" href="#C44849">
                <time itemprop="dateCreated" datetime="2017-01-11T17:00:11-07:00" class="action-date">Jan '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><code>Vokuro\Models</code> - i would recommend to use namespace model alias. So you can have M:Users etc. Also don't do this:</p>
<p><code>'Vokuro\Models\Users.id != '.$id.' AND s.usersId = '.$id</code> Don't use iterals ! This mean your application can be sql injected, use parameter binding.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="44849" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="44849" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/95593bdf7bc6c62dbd16767e520f13c8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a>        </span>
        <br>

        <span class="karma">59.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C44865" href="#C44865">
                <time itemprop="dateCreated" datetime="2017-01-12T03:22:07-07:00" class="action-date">Jan '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hello,</p>
<p>i changed the bindings.</p>
<pre><code> $users = $this-&gt;modelsManager-&gt;createBuilder()
   -&gt;from('Vokuro\Models\Users')
   -&gt;join('Vokuro\Models\Searchcriteria',null,'s')
   -&gt;join('Vokuro\Models\Region',null,'r')
   -&gt;join('Vokuro\Models\Country',null,'c')
   -&gt;where('Vokuro\Models\Users.id != :uId: AND s.usersId = :usersId:', array('uId' =&gt; $id, 'usersId' =&gt; $id))
   -&gt;andwhere("s.zipcode = r.region")
   -&gt;andwhere("s.country = c.country")
   -&gt;getQuery()
   -&gt;execute();</code></pre>
<p>But the QueryBuilder is not working with the Vokuro namespaces, i will check that again.
Do you have any idea, how i can compare the table searchcriteria with the other tables?</p>
<p>I also tried raw sql, but i only get 1 record.</p>
<p>Rgds</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="44865" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="44865" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C44869" href="#C44869">
                <time itemprop="dateCreated" datetime="2017-01-12T04:12:07-07:00" class="action-date">Jan '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What you mean no working? For me your code is correct and fine. What problem you have with this code? It should work without any problem. I have similar code in my app and works fine. You got only one record because obviously there is only one user with this id i guess ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="44869" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="44869" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/95593bdf7bc6c62dbd16767e520f13c8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a>        </span>
        <br>

        <span class="karma">59.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C44873" href="#C44873">
                <time itemprop="dateCreated" datetime="2017-01-12T04:41:11-07:00" class="action-date">Jan '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I meant this:</p>
<pre><code> $users = $this-&gt;modelsManager-&gt;createBuilder()
 -&gt;from('Users')
 -&gt;join('Searchcriteria',null,'s')
 -&gt;join('Region',null,'r')
 -&gt;join('Country',null,'c')
 -&gt;where('Users.id != :uId: AND s.usersId = :usersId:', array('uId' =&gt; $id, 'usersId' =&gt; $id))
 -&gt;andwhere("s.zipcode = r.region")
 -&gt;andwhere("s.country = c.country")
 -&gt;getQuery()
 -&gt;execute();</code></pre>
<p>Yes there is only this 1 user with this id(13). What i want ist to get the result of searchcriteria from this user(13) and compare these records with region, country and status. After that all users where this is true should be displayed, here i can't find a solution and need some help.</p>
<p>Rgds</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="44873" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="44873" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C44875" href="#C44875">
                <time itemprop="dateCreated" datetime="2017-01-12T05:04:45-07:00" class="action-date">Jan '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Then you need to select all columns like <code>-&gt;columns(*)</code>.  Then you can access Searchcriterai using your s alias from Row object.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="44875" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="44875" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C44877" href="#C44877">
                <time itemprop="dateCreated" datetime="2017-01-12T05:08:50-07:00" class="action-date">Jan '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Also if models have namespace you can't use them like this. You need to use:</p>
<pre><code>$modelsManager-&gt;registerNamespaceAlias('M', 'Vokuro\Models');</code></pre>
<p>And then <code>M:Users</code> <code>M:Searchcriteria</code> etc</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="44877" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="44877" data-cf-modified-137f5bedf0e30d323b1b885a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="15277" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>