---
layout: default
title: 'Phalcon ORM relations query optimization - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Phalcon ORM relations query optimization</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/10829/wajdijurry" class="user-moderator-N"><span itemprop="name">Wajdi Jurry</span></a></span>
            <time itemprop="dateCreated" datetime="2019-04-27T09:09:01-07:00">Apr '19</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2019-04-27T09:09:01-07:00">Apr '19</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Oct '20</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">7</span>
                </td>
                <td>
                    <label>Views</label><br>502</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/f4903b341d468b5b38aeae5803498f92?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/10829/wajdijurry" class="user-moderator-N"><span itemprop="name">Wajdi Jurry</span></a></span>
                <span class="karma">7.0k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C19619" href="#C19619">
        <time class="action-date">Apr '19</time>
    </a>
</div>
<div class="post-content"><div><p>I am using models relations offered by Phalcon, but there is an issue with queries optimization.
I see when fetching many records from reference model, It hits a separate query for each record to get data from related models, but it's bad on a big scale, from server load corner.</p>
<p>Is there any way to optimize this issue ? In other words, is there a way to hit one query to get related records then map them to reference model ?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-0d81c15cd0235685a748ab2f-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-0d81c15cd0235685a748ab2f-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a32e670bd00406cba6ee0accba19d1dd?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/12353/zsilbi" class="user-moderator-N"><span itemprop="name">Balázs Németh</span></a>        </span>
        <br>

        <span class="karma">297</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="59669" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '19</span>
              </span><br/><a name="C59669" href="#C59669">
                <time itemprop="dateCreated" datetime="2019-04-27T10:43:30-07:00" class="action-date">Apr '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You could try eager loading, it's in the incubator currently: <a href="https://github.com/phalcon/incubator/tree/master/Library/Phalcon/Mvc/Model/EagerLoading">https://github.com/phalcon/incubator/tree/master/Library/Phalcon/Mvc/Model/EagerLoading</a></p>
<p>Also make sure to use reusable relations (as default) and metadata caching for optimal performance.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59669" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59669" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f4903b341d468b5b38aeae5803498f92?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/10829/wajdijurry" class="user-moderator-N"><span itemprop="name">Wajdi Jurry</span></a>        </span>
        <br>

        <span class="karma">7.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C59669"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/a32e670bd00406cba6ee0accba19d1dd?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Balázs Németh                    </a>
                </div><div class="posts-buttons" align="right"><a name="C59671" href="#C59671">
                <time itemprop="dateCreated" datetime="2019-04-27T13:41:16-07:00" class="action-date">Apr '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for replying, but it does not answer my question.
I need a way to hit one time at database to get related records, not a hit per record which EagerLoading does.</p>
<blockquote>
<p>You could try eager loading, it's in the incubator currently: <a href="https://github.com/phalcon/incubator/tree/master/Library/Phalcon/Mvc/Model/EagerLoading">https://github.com/phalcon/incubator/tree/master/Library/Phalcon/Mvc/Model/EagerLoading</a></p>
<p>Also make sure to use reusable relations (as default) and metadata caching for optimal performance.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59671" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59671" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1eb2415bda000b22fd1f801bb9e8c003?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2/niden" class="user-moderator-Y"><span itemprop="name">Nikolaos Dimopoulos</span></a>        </span>
        <br>

        <span class="karma">39.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C59675" href="#C59675">
                <time itemprop="dateCreated" datetime="2019-04-27T16:45:23-07:00" class="action-date">Apr '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You can always use the <code>reusable = true</code> option to your relationships. Doing so will cache the relationship for the current request.</p>
<pre><code class="language-php">$this-&gt;hasOne(
    'local_id,
    Model1::class,
    'remote_id',
    [
        'alias'    =&gt; 'relationshipname',
         'reusable' =&gt; true,
    ]
);</code></pre>
<p>Then whenever you call </p>
<pre><code class="language-php">$results = $model-&gt;getRelated('relationshipname');</code></pre>
<p>will bring back the cached data.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59675" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59675" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f4903b341d468b5b38aeae5803498f92?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/10829/wajdijurry" class="user-moderator-N"><span itemprop="name">Wajdi Jurry</span></a>        </span>
        <br>

        <span class="karma">7.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C59675"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/1eb2415bda000b22fd1f801bb9e8c003?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Nikolaos Dimopoulos                    </a>
                </div><div class="posts-buttons" align="right"><a name="C59677" href="#C59677">
                <time itemprop="dateCreated" datetime="2019-04-28T12:33:41-07:00" class="action-date">Apr '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for replying, but unfortunately, it is not the answer which I am looking for.</p>
<p>Assume you have two tables, A and B.
Table A has 2 records and related to table B with one-many relationship.
Table B has 6 records, and referenced to table A by foriegn key, so each record in table A has 3 records in table B.</p>
<p>When fetching all records from table A, Phalcon will hit a separate query to get the related records from table B for each result , which is the current behavior.</p>
<p>Is there any way to hit one query on table B to get all records then map them to thier related reocrds in table A ?
This is my question.</p>
<p>Thanks in advance.</p>
<blockquote>
<p>You can always use the <code>reusable = true</code> option to your relationships. Doing so will cache the relationship for the current request.</p>
<pre><code class="language-php">$this-&gt;hasOne(
   'local_id,
   Model1::class,
  'remote_id',
  [
       'alias'    =&gt; 'relationshipname',
        'reusable' =&gt; true,
   ]
);</code></pre>
<p>Then whenever you call </p>
<pre><code class="language-php">$results = $model-&gt;getRelated('relationshipname');</code></pre>
<p>will bring back the cached data.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59677" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59677" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/1eb2415bda000b22fd1f801bb9e8c003?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2/niden" class="user-moderator-Y"><span itemprop="name">Nikolaos Dimopoulos</span></a>        </span>
        <br>

        <span class="karma">39.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="59679" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '19</span>
              </span><br/><a name="C59679" href="#C59679">
                <time itemprop="dateCreated" datetime="2019-04-28T17:43:20-07:00" class="action-date">Apr '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>So that I understand what you are looking for correctly.</p>
<p>Table Products</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Printer</td>
</tr>
<tr>
<td>2</td>
<td>Software</td>
</tr>
</tbody>
</table>
<p>Table Types</p>
<table>
<thead>
<tr>
<th>id</th>
<th>product_id</th>
<th>type</th>
<th>weight</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>physical</td>
<td>1.5</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>physical</td>
<td>2.5</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>physical</td>
<td>3.5</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>downloadable</td>
<td>null</td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>downloadable</td>
<td>null</td>
</tr>
<tr>
<td>6</td>
<td>2</td>
<td>downloadable</td>
<td>null</td>
</tr>
</tbody>
</table>
<p>Models</p>
<pre><code class="language-php">class Products
{
    public initialize()
    {
        $this-&gt;setSource('products');

        // All products
        $this-&gt;hasMany(
            'id,
            Types::class,
            'product_id',
            [
                'alias'    =&gt; 'types',
                'reusable' =&gt; true,
            ]
        );

        // Physical
        $this-&gt;hasMany(
            'id,
            Types::class,
            'product_id',
            [
                'alias'    =&gt; 'physical',
                'reusable' =&gt; true,
                'params'   =&gt; [
                    'conditions' =&gt; 'type = :type:',
                    'bind'       =&gt; [
                        'type' =&gt; 'physical',
                    ]
                ]
            ]
        );

        // Downloadable
        $this-&gt;hasMany(
            'id,
            Types::class,
            'product_id',
            [
                'alias'    =&gt; 'downloadable',
                'reusable' =&gt; true,
                'params'   =&gt; [
                    'conditions' =&gt; 'type = :type:',
                    'bind'       =&gt; [
                        'type' =&gt; 'downloadable',
                    ]
                ]
            ]
        );
    }
}</code></pre>
<p>Queries:</p>
<p><code>Products::find()</code> // one query returns 2 records</p>
<p><code>$product-&gt;getRelated('products')</code>     // one query - returns all records related to this product</p>
<p><code>$product-&gt;getRelated('physical')</code>     // one query - returns all physical related to this product</p>
<p><code>$product-&gt;getRelated('downloadable')</code> // one query - returns all downloadable related to this product</p>
<p>That is if you use <code>find</code> and <code>getRelated</code>.</p>
<p>If you use the builder you can get all the data in one go:</p>
<pre><code class="language-php">
$builder = new Builder();

$data = $builder
    -&gt;columns('p.id, t.type, p.name, t.weight')
    -&gt;addFrom(Products::class, 'p')
    -&gt;innerJoin(Types::class, 'id = product_id', 't')
    -&gt;orderBy('t.type, p.name')
    -&gt;executeQuery()
    ....</code></pre>
<p>That will be one query for both tables and all the data.</p>
<p>Can you explain a bit on what you really wanted to do? According to the issue you opened <a href="https://github.com/phalcon/cphalcon/issues/14007">here</a> the resultset you want back is a multi dimentional array/object that groups things according to what you want (in this case the product type)?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59679" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59679" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C59693" href="#C59693">
                <time itemprop="dateCreated" datetime="2019-05-01T13:02:50-07:00" class="action-date">May '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I don't believe there's any way to do this.  Using the QueryBuilder can get you all the data you want.  However, since you're asking for data from multiple tables, it will only return objects or arrays, it won't return Models.  If you just want the data and not the functionality - for example if you're outputing a table of data - then QueryBuilder will work.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59693" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59693" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f4903b341d468b5b38aeae5803498f92?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/10829/wajdijurry" class="user-moderator-N"><span itemprop="name">Wajdi Jurry</span></a>        </span>
        <br>

        <span class="karma">7.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C59679"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/1eb2415bda000b22fd1f801bb9e8c003?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Nikolaos Dimopoulos                    </a>
                </div><div class="posts-buttons" align="right"><a name="C59699" href="#C59699">
                <time itemprop="dateCreated" datetime="2019-05-01T14:06:12-07:00" class="action-date">May '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for clarification and writing an example.
Yes, your example is close about my needs.</p>
<p>The issue opened is not related to this discussion at all. What I was looking for is to hit less queries on database as much as I can,  but the NFR is to do inheritcance mapping on records instead of doing them manually.</p>
<blockquote>
<p>So that I understand what you are looking for correctly.</p>
<p>Table Products</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Printer</td>
</tr>
<tr>
<td>2</td>
<td>Software</td>
</tr>
</tbody>
</table>
<p>Table Types</p>
<table>
<thead>
<tr>
<th>id</th>
<th>product_id</th>
<th>type</th>
<th>weight</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>1</td>
<td>physical</td>
<td>1.5</td>
</tr>
<tr>
<td>2</td>
<td>1</td>
<td>physical</td>
<td>2.5</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>physical</td>
<td>3.5</td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>downloadable</td>
<td>null</td>
</tr>
<tr>
<td>5</td>
<td>2</td>
<td>downloadable</td>
<td>null</td>
</tr>
<tr>
<td>6</td>
<td>2</td>
<td>downloadable</td>
<td>null</td>
</tr>
</tbody>
</table>
<p>Models</p>
<pre><code class="language-php">class Products
{
   public initialize()
   {
       $this-&gt;setSource('products');

       // All products
       $this-&gt;hasMany(
           'id,
           Types::class,
           'product_id',
           [
               'alias'    =&gt; 'types',
               'reusable' =&gt; true,
           ]
       );

       // Physical
       $this-&gt;hasMany(
           'id,
           Types::class,
           'product_id',
           [
               'alias'    =&gt; 'physical',
               'reusable' =&gt; true,
               'params'   =&gt; [
                   'conditions' =&gt; 'type = :type:',
                   'bind'       =&gt; [
                       'type' =&gt; 'physical',
                   ]
               ]
           ]
       );

       // Downloadable
       $this-&gt;hasMany(
           'id,
           Types::class,
           'product_id',
           [
               'alias'    =&gt; 'downloadable',
               'reusable' =&gt; true,
               'params'   =&gt; [
                   'conditions' =&gt; 'type = :type:',
                   'bind'       =&gt; [
                       'type' =&gt; 'downloadable',
                   ]
               ]
           ]
       );
   }
}</code></pre>
<p>Queries:</p>
<p><code>Products::find()</code> // one query returns 2 records</p>
<p><code>$product-&gt;getRelated('products')</code>     // one query - returns all records related to this product</p>
<p><code>$product-&gt;getRelated('physical')</code>     // one query - returns all physical related to this product</p>
<p><code>$product-&gt;getRelated('downloadable')</code> // one query - returns all downloadable related to this product</p>
<p>That is if you use <code>find</code> and <code>getRelated</code>.</p>
<p>If you use the builder you can get all the data in one go:</p>
<pre><code class="language-php">
$builder = new Builder();

$data = $builder
   -&gt;columns('p.id, t.type, p.name, t.weight')
   -&gt;addFrom(Products::class, 'p')
   -&gt;innerJoin(Types::class, 'id = product_id', 't')
   -&gt;orderBy('t.type, p.name')
   -&gt;executeQuery()
   ....</code></pre>
<p>That will be one query for both tables and all the data.</p>
<p>Can you explain a bit on what you really wanted to do? According to the issue you opened <a href="https://github.com/phalcon/cphalcon/issues/14007">here</a> the resultset you want back is a multi dimentional array/object that groups things according to what you want (in this case the product type)?</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59699" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59699" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f4903b341d468b5b38aeae5803498f92?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/10829/wajdijurry" class="user-moderator-N"><span itemprop="name">Wajdi Jurry</span></a>        </span>
        <br>

        <span class="karma">7.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C59693"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Dylan Anderson                    </a>
                </div><div class="posts-buttons" align="right"><a name="C59701" href="#C59701">
                <time itemprop="dateCreated" datetime="2019-05-01T14:08:47-07:00" class="action-date">May '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes, I agree, the query builder will do the job, but I need more performed way to do that instead of writing queries depending on ORM.</p>
<blockquote>
<p>I don't believe there's any way to do this.  Using the QueryBuilder can get you all the data you want.  However, since you're asking for data from multiple tables, it will only return objects or arrays, it won't return Models.  If you just want the data and not the functionality - for example if you're outputing a table of data - then QueryBuilder will work.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59701" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59701" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/747be74e038e35ba2207da09388e3a0d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8217/talal424" class="user-moderator-N"><span itemprop="name">talal424</span></a>        </span>
        <br>

        <span class="karma">8.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="59749" data-toggle="modal" data-target="#historyModal">
                edited <span>May '19</span>
              </span><br/><a name="C59749" href="#C59749">
                <time itemprop="dateCreated" datetime="2019-05-06T17:31:27-07:00" class="action-date">May '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>for me i do both cache and inner joins</p>
<p>for example:</p>
<p>let say this is our tables:</p>
<pre><code class="language-sql">CREATE TABLE robots (
    id int(10) unsigned NOT NULL AUTO_INCREMENT,
    name varchar(70) NOT NULL,
    type varchar(32) NOT NULL,
    year int(11) NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE robots_parts (
    id int(10) unsigned NOT NULL AUTO_INCREMENT,
    robots_id int(10) NOT NULL,
    parts_id int(10) NOT NULL,
    created_at DATE NOT NULL,
    PRIMARY KEY (id),
    KEY robots_id (robots_id),
    KEY parts_id (parts_id)
);

CREATE TABLE parts (
    id int(10) unsigned NOT NULL AUTO_INCREMENT,
    name varchar(70) NOT NULL,
    PRIMARY KEY (id)
);</code></pre>
<p>now if i want to query <code>robots_parts</code> </p>
<pre><code class="language-php">RobotsParts::find();</code></pre>
<p>this would return resultset of <code>RobotsParts</code></p>
<p>if you want for example <code>Robots</code>, <code>RobotsParts</code>and <code>Parts</code> in  a single query you have to use inner joins whether using phql or query builder</p>
<p>this is a static method in <code>RobotsParts</code></p>
<pre><code class="language-php"> public static function getAll()
{
    $di = Phalcon\Di::getDefault();

    $modelsManager = $di-&gt;getModelsManager();

    // assuming you made all the relationships in all models involved

    // otherwise you have to specify primary keys in inner joins (  INNER JOIN Robots on RobotsParts.robots_id = Robots.id )

    $phql = 'SELECT RobotsParts.*, Robots.*, Parts.* FROM RobotsParts INNER JOIN Robots INNER JOIN Parts';

    return $modelsManager-&gt;executeQuery($phql);
}</code></pre>
<p>this would return resultset of <code>Robots</code>, <code>RobotsParts</code>and <code>Parts</code></p>
<pre><code class="language-php">
$records = RobotsParts::getAll();

foreach ($records as $key =&gt; $record) {
    $robot = $record-&gt;Robots;
    $robots_parts = $record-&gt;RobotsParts;
    $parts = $record-&gt;Parts;
}</code></pre>
<p>if you select some columns instead of <code>Robots.*</code> for example <code>Robots.name</code></p>
<pre><code class="language-php">
$records = RobotsParts::getAll();

foreach ($records as $key =&gt; $record) {
    $robotName = $record-&gt;name;
    $robotsParts = $record-&gt;RobotsParts;
    $parts = $record-&gt;Parts;
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59749" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59749" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f4903b341d468b5b38aeae5803498f92?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/10829/wajdijurry" class="user-moderator-N"><span itemprop="name">Wajdi Jurry</span></a>        </span>
        <br>

        <span class="karma">7.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C59749"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/747be74e038e35ba2207da09388e3a0d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        talal424                    </a>
                </div><div class="posts-buttons" align="right"><a name="C59795" href="#C59795">
                <time itemprop="dateCreated" datetime="2019-05-09T11:24:04-07:00" class="action-date">May '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I agree to use this method in querying data, but how to handle pagination in this case ?
If you limit the query by 3, it would get the first three results only and it's wrong, since the first record in the reference table may have 5 records in the related table. Did you get my concern ?</p>
<blockquote>
<p>for me i do both cache and inner joins</p>
<p>for example:</p>
<p>let say this is our tables:</p>
<pre><code class="language-sql">CREATE TABLE robots (
   id int(10) unsigned NOT NULL AUTO_INCREMENT,
   name varchar(70) NOT NULL,
   type varchar(32) NOT NULL,
   year int(11) NOT NULL,
   PRIMARY KEY (id)
);

CREATE TABLE robots_parts (
   id int(10) unsigned NOT NULL AUTO_INCREMENT,
   robots_id int(10) NOT NULL,
   parts_id int(10) NOT NULL,
   created_at DATE NOT NULL,
   PRIMARY KEY (id),
   KEY robots_id (robots_id),
   KEY parts_id (parts_id)
);

CREATE TABLE parts (
   id int(10) unsigned NOT NULL AUTO_INCREMENT,
   name varchar(70) NOT NULL,
   PRIMARY KEY (id)
);</code></pre>
<p>now if i want to query <code>robots_parts</code> </p>
<pre><code class="language-php">RobotsParts::find();</code></pre>
<p>this would return resultset of <code>RobotsParts</code></p>
<p>if you want for example <code>Robots</code>, <code>RobotsParts</code>and <code>Parts</code> in  a single query you have to use inner joins whether using phql or query builder</p>
<p>this is a static method in <code>RobotsParts</code></p>
<pre><code class="language-php">public static function getAll()
{
   $di = Phalcon\Di::getDefault();

   $modelsManager = $di-&gt;getModelsManager();

   // assuming you made all the relationships in all models involved

  // otherwise you have to specify primary keys in inner joins (  INNER JOIN Robots on RobotsParts.robots_id = Robots.id )

   $phql = 'SELECT RobotsParts.*, Robots.*, Parts.* FROM RobotsParts INNER JOIN Robots INNER JOIN Parts';

   return $modelsManager-&gt;executeQuery($phql);
}</code></pre>
<p>this would return resultset of <code>Robots</code>, <code>RobotsParts</code>and <code>Parts</code></p>
<pre><code class="language-php">
$records = RobotsParts::getAll();

foreach ($records as $key =&gt; $record) {
   $robot = $record-&gt;Robots;
   $robots_parts = $record-&gt;RobotsParts;
   $parts = $record-&gt;Parts;
}</code></pre>
<p>if you select some columns instead of <code>Robots.*</code> for example <code>Robots.name</code></p>
<pre><code class="language-php">
$records = RobotsParts::getAll();

foreach ($records as $key =&gt; $record) {
   $robotName = $record-&gt;name;
   $robotsParts = $record-&gt;RobotsParts;
   $parts = $record-&gt;Parts;
}</code></pre>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59795" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59795" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/747be74e038e35ba2207da09388e3a0d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8217/talal424" class="user-moderator-N"><span itemprop="name">talal424</span></a>        </span>
        <br>

        <span class="karma">8.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C59797" href="#C59797">
                <time itemprop="dateCreated" datetime="2019-05-09T15:13:29-07:00" class="action-date">May '19</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>even if you limit the results would be the same.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="59797" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="59797" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/022f3278181f3f6ee6d2e35f121c7390?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/14255/afsdefdse" class="user-moderator-N"><span itemprop="name">afsdefdse</span></a>        </span>
        <br>

        <span class="karma">73</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C64479" href="#C64479">
                <time itemprop="dateCreated" datetime="2020-10-09T03:55:47-07:00" class="action-date">Oct '20</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>If you've got don't have an index on call, depening for your database, it could be a piece bit slower. But please start with some measurements. For instance the usage of microtime get here <a href="https://dogsfreedom.com/">guide</a> <a href="https://forum.phalcon.io/discussion/19917/phalcon-task-is-very-slow-for-migrating-old-tables-to-new-tables">https://forum.phalcon.io/discussion/19917/phalcon-task-is-very-slow-for-migrating-old-tables-to-new-tables</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="64479" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="64479" data-cf-modified-0d81c15cd0235685a748ab2f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="19619" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>