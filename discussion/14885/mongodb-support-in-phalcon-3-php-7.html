---
layout: default
title: 'MongoDB support in Phalcon 3 + PHP 7 - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">MongoDB support in Phalcon 3 + PHP 7</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/8663/sankethpb" class="user-moderator-N"><span itemprop="name">Sanketh P B</span></a></span>
            <time itemprop="dateCreated" datetime="2016-11-27T06:22:03-07:00">Nov '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-11-27T06:22:03-07:00">Nov '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">7</span>
                </td>
                <td>
                    <label>Views</label><br>1947</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/227224eac8c5bbf3a1a953ee9bb40141?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/8663/sankethpb" class="user-moderator-N"><span itemprop="name">Sanketh P B</span></a></span>
                <span class="karma">2.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C14885" href="#C14885">
        <time class="action-date">Nov '16</time>
    </a>
</div>
<div class="post-content"><div><p>Dear Team,</p>
<p>When could we expect MongoDB support in Phalcon 3 + PHP7? I read the other discussions but I could not find any date or current status.</p>
<p>Thanks in advance.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C43299" href="#C43299">
                <time itemprop="dateCreated" datetime="2016-11-27T06:32:12-07:00" class="action-date">Nov '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>It's already supported in incubator. There is a problem that it could be only done using new class or some hacky stuff. I guess in phalcon 4 we will drop php 5 support and then just switch to proper mongo classes and update code.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="43299" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="43299" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/227224eac8c5bbf3a1a953ee9bb40141?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8663/sankethpb" class="user-moderator-N"><span itemprop="name">Sanketh P B</span></a>        </span>
        <br>

        <span class="karma">2.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C43303" href="#C43303">
                <time itemprop="dateCreated" datetime="2016-11-27T10:18:29-07:00" class="action-date">Nov '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>it's 3.x now, will version 4.x be available soon?, by when? Until then could you please give some examples of using the MongoDB support in Incubator?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="43303" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="43303" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/877a54304e07c8cb38c47b43e1d6b6b3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2828/sergeyklay" class="user-moderator-Y"><span itemprop="name">Serghei Iakovlev</span></a>        </span>
        <br>

        <span class="karma">39.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C43311" href="#C43311">
                <time itemprop="dateCreated" datetime="2016-11-27T14:38:55-07:00" class="action-date">Nov '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Did you tried </p>
<blockquote>
<p><a href="https://github.com/phalcon/incubator/tree/master/Library/Phalcon/Db/Adapter#mongodbclient">https://github.com/phalcon/incubator/tree/master/Library/Phalcon/Db/Adapter#mongodbclient</a></p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="43311" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="43311" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-positive">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d2e078d2ed052bb33828cd0b016c946d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9583/chyro" class="user-moderator-N"><span itemprop="name">chyro</span></a>        </span>
        <br>

        <span class="karma">131</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C48123" href="#C48123">
                <time itemprop="dateCreated" datetime="2017-05-11T20:55:42-07:00" class="action-date">May '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Considering how difficult it was to find information on the internet, let me share my experience.
First of all, Sanketh, I feel your pain. The lack of compatibility between the technologies involved (PHP 5-&gt;7, Phalcon 2-&gt;3, MongoClient-&gt;MongoDB) made this a painful and confusing process. MongoClient is not compatible with PHP7, MongoDB is not backward-compatible, the doc of the incubator class recommended by Serghei specifically points to Phalcon 2.1. Some other article said that Phalcon 2.1 broke compatibility and would thus be renamed 3.0 though, so that might be a technically accurate yet misleading documentation. Anyway, the incubator class pointed out by Serghei seemed to do the trick for me.</p>
<p>Add the Incubator library - in my case, I ran the following Bash command in the library folder:</p>
<pre><code class="language-bash">$ git clone -b 3.1.x https://github.com/phalcon/incubator.git</code></pre>
<p>Register the Incubator in the class autoloader - in my case, I added one line in the bootstrap:</p>
<pre><code class="language-php">$loader-&gt;registerNamespaces([
    /* other libs */
    'Phalcon' =&gt; BASE_DIR . '/' . $config-&gt;application-&gt;librariesDir . 'incubator/Library/Phalcon/'
] )-&gt;register();</code></pre>
<p>Replace the old Mongo library with the Incubator one - in my case, in the <em>$config['di']-&gt;set('mongo')</em> function:</p>
<pre><code class="language-PHP">$mongoClient = new \Phalcon\Db\Adapter\MongoDB\Client(); // was: new \MongoClient();
return $mongoClient-&gt;selectDatabase($config-&gt;database-&gt;name); // unchanged</code></pre>
<p>That got me a &quot;Call to undefined method rewind&quot; until I changed my models from <code>extends \Phalcon\Mvc\Collection</code> to <code>extends \Phalcon\Mvc\MongoCollection</code>.  With that, my app seemed to work as normal.</p>
<p>I hope this will be useful to someone.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="48123" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="48123" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">4</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e939df2df031203c1118686abce4e624?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1915/garakh" class="user-moderator-N"><span itemprop="name">Iliya Garakh</span></a>        </span>
        <br>

        <span class="karma">753</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C48123"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/d2e078d2ed052bb33828cd0b016c946d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        chyro                    </a>
                </div><div class="posts-buttons" align="right"><a name="C48145" href="#C48145">
                <time itemprop="dateCreated" datetime="2017-05-15T04:26:17-07:00" class="action-date">May '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Is new model class from the incubator 100% compatible with old one?
They look similar but I couldn't find no official remark if new class is compatible and simple changing of parent class won't break anything up.</p>
<blockquote>
<p>Considering how difficult it was to find information on the internet, let me share my experience.
First of all, Sanketh, I feel your pain. The lack of compatibility between the technologies involved (PHP 5-&gt;7, Phalcon 2-&gt;3, MongoClient-&gt;MongoDB) made this a painful and confusing process. MongoClient is not compatible with PHP7, MongoDB is not backward-compatible, the doc of the incubator class recommended by Serghei specifically points to Phalcon 2.1. Some other article said that Phalcon 2.1 broke compatibility and would thus be renamed 3.0 though, so that might be a technically accurate yet misleading documentation. Anyway, the incubator class pointed out by Serghei seemed to do the trick for me.</p>
<p>Add the Incubator library - in my case, I ran the following Bash command in the library folder:</p>
<pre><code class="language-bash">$ git clone -b 3.1.x https://github.com/phalcon/incubator.git</code></pre>
<p>Register the Incubator in the class autoloader - in my case, I added one line in the bootstrap:</p>
<pre><code class="language-php">$loader-&gt;registerNamespaces([
  /* other libs */
  'Phalcon' =&gt; BASE_DIR . '/' . $config-&gt;application-&gt;librariesDir . 'incubator/Library/Phalcon/'
] )-&gt;register();</code></pre>
<p>Replace the old Mongo library with the Incubator one - in my case, in the <em>$config['di']-&gt;set('mongo')</em> function:</p>
<pre><code class="language-PHP">$mongoClient = new \Phalcon\Db\Adapter\MongoDB\Client(); // was: new \MongoClient();
return $mongoClient-&gt;selectDatabase($config-&gt;database-&gt;name); // unchanged</code></pre>
<p>That got me a &quot;Call to undefined method rewind&quot; until I changed my models from <code>extends \Phalcon\Mvc\Collection</code> to <code>extends \Phalcon\Mvc\MongoCollection</code>.  With that, my app seemed to work as normal.</p>
<p>I hope this will be useful to someone.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="48145" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="48145" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C48149" href="#C48149">
                <time itemprop="dateCreated" datetime="2017-05-15T12:21:10-07:00" class="action-date">May '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What you mean compatible? You obviously new need extension and to use mongo client from incubator too, then it should be fine.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="48149" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="48149" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/66745b8f1a995a3f9a850b1b5eb8bea5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/11905/armageAR" class="user-moderator-N"><span itemprop="name">Ariel Gerling</span></a>        </span>
        <br>

        <span class="karma">85</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C48123"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/d2e078d2ed052bb33828cd0b016c946d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        chyro                    </a>
                </div><div class="posts-buttons" align="right"><a name="C58219" href="#C58219">
                <time itemprop="dateCreated" datetime="2018-12-23T10:29:00-07:00" class="action-date">Dec '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>It was a great help for me!
But now I have a new error I can't resolve:</p>
<p>Fatal error: Uncaught Error: Class 'MongoDB\Manager' not found</p>
<p>my code is </p>
<pre><code class="language-php">$di-&gt;setShared('collectionManager', function () {
            return new Manager();
      });</code></pre>
<blockquote>
<p>Considering how difficult it was to find information on the internet, let me share my experience.
First of all, Sanketh, I feel your pain. The lack of compatibility between the technologies involved (PHP 5-&gt;7, Phalcon 2-&gt;3, MongoClient-&gt;MongoDB) made this a painful and confusing process. MongoClient is not compatible with PHP7, MongoDB is not backward-compatible, the doc of the incubator class recommended by Serghei specifically points to Phalcon 2.1. Some other article said that Phalcon 2.1 broke compatibility and would thus be renamed 3.0 though, so that might be a technically accurate yet misleading documentation. Anyway, the incubator class pointed out by Serghei seemed to do the trick for me.</p>
<p>Add the Incubator library - in my case, I ran the following Bash command in the library folder:</p>
<pre><code class="language-bash">$ git clone -b 3.1.x https://github.com/phalcon/incubator.git</code></pre>
<p>Register the Incubator in the class autoloader - in my case, I added one line in the bootstrap:</p>
<pre><code class="language-php">$loader-&gt;registerNamespaces([
  /* other libs */
  'Phalcon' =&gt; BASE_DIR . '/' . $config-&gt;application-&gt;librariesDir . 'incubator/Library/Phalcon/'
] )-&gt;register();</code></pre>
<p>Replace the old Mongo library with the Incubator one - in my case, in the <em>$config['di']-&gt;set('mongo')</em> function:</p>
<pre><code class="language-PHP">$mongoClient = new \Phalcon\Db\Adapter\MongoDB\Client(); // was: new \MongoClient();
return $mongoClient-&gt;selectDatabase($config-&gt;database-&gt;name); // unchanged</code></pre>
<p>That got me a &quot;Call to undefined method rewind&quot; until I changed my models from <code>extends \Phalcon\Mvc\Collection</code> to <code>extends \Phalcon\Mvc\MongoCollection</code>.  With that, my app seemed to work as normal.</p>
<p>I hope this will be useful to someone.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="58219" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="58219" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d2e078d2ed052bb33828cd0b016c946d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9583/chyro" class="user-moderator-N"><span itemprop="name">chyro</span></a>        </span>
        <br>

        <span class="karma">131</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C58219"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/66745b8f1a995a3f9a850b1b5eb8bea5?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Ariel Gerling                    </a>
                </div><div class="posts-buttons" align="right"><a name="C58227" href="#C58227">
                <time itemprop="dateCreated" datetime="2018-12-25T04:49:19-07:00" class="action-date">Dec '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>My code does a as follows instead:
<code>return new \Phalcon\Mvc\Collection\Manager();</code>
Maybe you can try that?</p>
<blockquote>
<p>It was a great help for me!
But now I have a new error I can't resolve:</p>
<p>Fatal error: Uncaught Error: Class 'MongoDB\Manager' not found</p>
<p>my code is </p>
<pre><code class="language-php">$di-&gt;setShared('collectionManager', function () {
           return new Manager();
     });</code></pre>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="58227" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="58227" data-cf-modified-d071e6ae3e88dd6963c1704e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="14885" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>