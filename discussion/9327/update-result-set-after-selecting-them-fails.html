---
layout: default
title: 'Update result set after selecting them fails - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Update result set after selecting them fails</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/4477/bilikaz" class="user-moderator-N"><span itemprop="name">Valdas Barakauskas</span></a></span>
            <time itemprop="dateCreated" datetime="2015-11-05T13:51:56-07:00">Nov '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-11-05T13:51:56-07:00">Nov '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>434</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/24d0950501b2769ba3c1bde3daa8853b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/4477/bilikaz" class="user-moderator-N"><span itemprop="name">Valdas Barakauskas</span></a></span>
                <span class="karma">2.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C9327" href="#C9327">
        <time class="action-date">Nov '15</time>
    </a>
</div>
<div class="post-content"><div><p>when i try to reset and update ad some new records it fails, i do someting like that:</p>
<pre><code class="language-php">
$robot = Robots::findFirst("user_id=100");
count($robot-&gt;parts);

$new_parts = array();
$part = new Parts();
$part-&gt;name = 'part1';
$new_parts[] = $part;
$part = new Parts();
$part-&gt;name = 'part2';
$new_parts[] = $part;

$robot-&gt;parts = $new_parts;
$robot-&gt;save();</code></pre>
<p>it fails to save and if i remove</p>
<pre><code class="language-php">
count($robot-&gt;parts);
</code></pre>
<p>it works fine and adds 2 new parts</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-b56d274297b62228911c8478-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-b56d274297b62228911c8478-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C25907" href="#C25907">
                <time itemprop="dateCreated" datetime="2015-11-05T16:42:21-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>But why you add this to resultset ? What returns getMessages() after save when fail ? You should findFirst if you have only one $robot, if you have multiple then loop through them(you can select only ids of robots and create parts with robot id).</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25907" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25907" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/24d0950501b2769ba3c1bde3daa8853b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4477/bilikaz" class="user-moderator-N"><span itemprop="name">Valdas Barakauskas</span></a>        </span>
        <br>

        <span class="karma">2.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="25929" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '15</span>
              </span><br/><a name="C25929" href="#C25929">
                <time itemprop="dateCreated" datetime="2015-11-06T01:23:43-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Sorry, single entity was passed to metod, so findFirst was in my case. </p>
<p>The main point is that if i select records and then try to reset it or add new elements it's not saved. getMessages returns nothing, as it was no errors it seams that parts are simply ignored when robot is saved. (updated sorce code now to represent correct case)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25929" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25929" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C25937" href="#C25937">
                <time itemprop="dateCreated" datetime="2015-11-06T04:41:54-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Show us your relation then.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25937" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25937" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/24d0950501b2769ba3c1bde3daa8853b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4477/bilikaz" class="user-moderator-N"><span itemprop="name">Valdas Barakauskas</span></a>        </span>
        <br>

        <span class="karma">2.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="25941" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '15</span>
              </span><br/><a name="C25941" href="#C25941">
                <time itemprop="dateCreated" datetime="2015-11-06T04:58:48-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>ok here is code parts for better understanding. i am building Form manager that handles all models and submodels</p>
<pre><code class="language-php">
    class Events extends Model
{

    public function initialize()
    {
        $this-&gt;hasOne('event_id', 'Events\Models\EventDetails', 'event_id', array(
            'alias' =&gt; 'details'
        ));
        $this-&gt;hasMany('event_id', 'Events\Models\EventToArtist', 'event_id', array(
            'alias' =&gt; 'artistsList'
        ));
        $this-&gt;hasMany('event_id', 'Events\Models\EventPhotos', 'event_id', array(
            'alias' =&gt; 'photos'
        ));
        $this-&gt;hasManyToMany(
            'event_id', 'Events\Models\EventToArtist', 'event_id',
            'artist_id', 'Events\Models\Artists', 'artist_id', array(
            'alias' =&gt; 'artists'
        ));
    }

    public function validation()
    {
        $this-&gt;validate(new UniquenessValidator(array(
            'field' =&gt; 'url',
            'message' =&gt; DI::getDefault()-&gt;get('t')-&gt;_('event already exists'),
        )));
        if ($this-&gt;validationHasFailed() == true) {
            return false;
        }
    }

    public function setParentEventId($parent_event_id)
    {
        if (!$parent_event_id) {
            $this-&gt;parent_event_id = null;
        } else {
            $this-&gt;parent_event_id = $parent_event_id;
        }
    }

    public function beforeValidationOnCreate()
    {
        $this-&gt;created_time = date('Y-m-d H:i:s');
        $this-&gt;user_id = DI::getDefault()-&gt;get('session')-&gt;get('user')-&gt;user_id;
        $this-&gt;views = 0;
    }

}

class EventPhotos extends Model
{

    public function initialize()
    {
        $this-&gt;belongsTo('event_id', 'Events\Models\Events', 'event_id', array(
            'alias' =&gt; 'event'
        ));
    }

}
</code></pre>
<p>and if you try to do something like that:</p>
<pre><code class="language-php">
$event = Events::findFirstByEventId($id);
$photos = count($event-&gt;photos); //if this line is removed everithing works fine
$list = array();
$photo = new EventPhotos();
$photo-&gt;file = '123.jpg';
$list[] = $photo;
$photo = new EventPhotos();
$photo-&gt;file = '1234.jpg';
$list[] = $photo;

$event-&gt;photos = $list;
$event-&gt;save();
</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25941" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25941" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="25947" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '15</span>
              </span><br/><a name="C25947" href="#C25947">
                <time itemprop="dateCreated" datetime="2015-11-06T06:18:06-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><pre><code class="language-php">$this-&gt;belongsTo('event_id', 'Events\Models\Events', 'event_id', array(
            'alias' =&gt; 'event'
        ));</code></pre>
<p>Thrid parameter should be field in related model - 'id'.</p>
<pre><code class="language-php">$this-&gt;hasMany('event_id', 'Events\Models\EventPhotos', 'event_id', array(
            'alias' =&gt; 'photos'
        ));</code></pre>
<p>Here the same, but first parameter is field in current model for which is relation builded in EventPhotos so i guess id too. Fix your relations and it should work fine.</p>
<p>Read documentation there is everything about relations:</p>
<p><a href="https://docs.phalcon.io/pl/latest/reference/models.html#relationships-between-models">https://docs.phalcon.io/pl/latest/reference/models.html#relationships-between-models</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25947" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25947" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/24d0950501b2769ba3c1bde3daa8853b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4477/bilikaz" class="user-moderator-N"><span itemprop="name">Valdas Barakauskas</span></a>        </span>
        <br>

        <span class="karma">2.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="25963" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '15</span>
              </span><br/><a name="C25963" href="#C25963">
                <time itemprop="dateCreated" datetime="2015-11-06T08:27:06-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Lol it's just a name &quot;event_id&quot; or &quot;id&quot; should be same (in my case in bot tables this field is called same), main thing it must be index or primary key. so i dont think it would have any impact, althou i noticed if you do something like that:</p>
<pre><code class="language-php">
$event = Events::findFirstByEventId($id);
$event-&gt;photos-&gt;delete();
$list = array();
$photo = new EventPhotos();
$photo-&gt;file = '123.jpg';
$list[] = $photo;
$photo = new EventPhotos();
$photo-&gt;file = '1234.jpg';
$list[] = $photo;

$event-&gt;photos = $list;
$event-&gt;save();
</code></pre>
<p>it fails to save to</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25963" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25963" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="25989" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '15</span>
              </span><br/><a name="C25989" href="#C25989">
                <time itemprop="dateCreated" datetime="2015-11-06T12:26:22-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>NO, it shouldnt be SAME, but if they are same in tables then okay. well maybe try to set $photo-&gt;event_id = $id, if that will save, then its for 100% bad relations.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25989" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25989" data-cf-modified-b56d274297b62228911c8478-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="9327" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>