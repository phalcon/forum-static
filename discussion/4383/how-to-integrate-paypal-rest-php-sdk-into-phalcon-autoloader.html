---
layout: default
title: 'How to integrate PayPal REST PHP SDK into phalcon autoloader?! - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/27/external-tools">External Tools</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">How to integrate PayPal REST PHP SDK into phalcon autoloader?!</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/1340/elchueko" class="user-moderator-N"><span itemprop="name">elchueko</span></a></span>
            <time itemprop="dateCreated" datetime="2015-01-04T02:54:19-07:00">Jan '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-01-04T02:54:19-07:00">Jan '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>4106</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/17f330e272315f09f5acbe31df734dd7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/1340/elchueko" class="user-moderator-N"><span itemprop="name">elchueko</span></a></span>
                <span class="karma">8.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C4383" href="#C4383">
        <time class="action-date">Jan '15</time>
    </a>
</div>
<div class="post-content"><div><p>Hi there,</p>
<p>I want to integrate the PayPal REST PHP SDK into my phalcon project. You can find the SDK here:</p>
<p><a href="https://github.com/paypal/PayPal-PHP-SDK">https://github.com/paypal/PayPal-PHP-SDK</a></p>
<p>The documentation of this SDK says, that I have to include the autoloader.php file in my project:</p>
<p>&quot;If your application has a bootstrap/autoload file, you should add include '&lt;vendor directory location&gt;/vendor/autoload.php' in it. The location of the &lt;vendor directory&gt; should be replaced based on where you downloaded vendor directory in your application.&quot;</p>
<p>So I tried several things:</p>
<pre><code class="language-php">include($config-&gt;application-&gt;libraryDir . "paypal-vendor/autoload.php");</code></pre>
<p>and</p>
<pre><code class="language-php">$loader-&gt;registerDirs(array(
    $config-&gt;application-&gt;controllersDir,
    $config-&gt;application-&gt;modelsDir,
    $config-&gt;application-&gt;libraryDir,
    $config-&gt;application-&gt;libraryDir . "paypal-vendor/",
    $config-&gt;application-&gt;pluginsDir,
    $config-&gt;application-&gt;langDir,
));</code></pre>
<p>I inserted the namespaces into my controller file:</p>
<pre><code class="language-php">use PayPal\Rest\ApiContext;
use PayPal\Auth\OAuthTokenCredential;
use PayPal\Api\Payment;</code></pre>
<p>But when I want to create an object like this:</p>
<pre><code class="language-php">$apiContext = new ApiContext(new OAuthTokenCredential('&lt;clientId&gt;', '&lt;clientSecret&gt;'));</code></pre>
<p>I got an error:</p>
<blockquote>
<p>Fatal error: Class 'PayPal\Rest\ApiContext' not found in .../app/controllers/IndexController.php on line 23</p>
</blockquote>
<p>What am I doing wrong?</p>
<p>Thanks for your help!</p>
<p>Best,
elchueko</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-234ecb5ee305daf574079d9c-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-234ecb5ee305daf574079d9c-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14535" href="#C14535">
                <time itemprop="dateCreated" datetime="2015-01-04T04:21:34-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I think you need to use the namespace strategy: <a href="http://docs.phalcon.io/en/latest/reference/loader.html#registering-namespaces">http://docs.phalcon.io/en/latest/reference/loader.html#registering-namespaces</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14535" data-cf-modified-234ecb5ee305daf574079d9c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14535" data-cf-modified-234ecb5ee305daf574079d9c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/97cfdb3586f82c3e1e4fe562bda688b8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/571/duythien" class="user-moderator-Y"><span itemprop="name">Thien Tran</span></a>        </span>
        <br>

        <span class="karma">58.4k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14539" href="#C14539">
                <time itemprop="dateCreated" datetime="2015-01-04T07:12:50-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hey</p>
<p>You just must inserting paypal library into composer</p>
<pre><code class="language-php">"require": {
        "phalcon/incubator": "dev-master",
        "swiftmailer/swiftmailer": "@stable",
        "kzykhys/ciconia": "~1.0.0",
        "paypal/rest-api-sdk-php" : "*",
        "fabfuel/prophiler": "~1.0"
    }</code></pre>
<p>Then use it</p>
<pre><code class="language-php">
&lt;?php
namespace ZPhalcon\Tools;

use Phalcon\Mvc\User\Component;

if (!file_exists(ROOT_DIR . 'vendor/autoload.php')) {
    echo "The 'vendor' folder is missing. You must run 'composer update' to resolve application dependencies.\nPlease see the README for more information.\n";
    exit(1);
}
require_once ROOT_DIR . 'vendor/autoload.php';

use PayPal\Api\Address;
use PayPal\Api\CreditCard;
use PayPal\Api\Amount;
use PayPal\Api\Details;
use PayPal\Rest\ApiContext;
use PayPal\Auth\OAuthTokenCredential;
use PayPal\Api\Payer;
use PayPal\Api\Payment;
use PayPal\Api\Transaction;
use PayPal\Api\RedirectUrls;
use PayPal\Api\FundingInstrument;
use PayPal\Api\Item;
use PayPal\Api\ItemList;

class Paypal extends Component
{

    /**
    * ### getBaseUrl function
    * // utility function that returns base url for
    * // determining return/cancel urls
    * @return string
    */
    public function getBaseUrl()
    {
        $protocol = 'http';
        if ($_SERVER['SERVER_PORT'] == 443 || (!empty($_SERVER['HTTPS']) &amp;&amp; strtolower($_SERVER['HTTPS']) == 'on')) {
            $protocol .= 's';
            $protocol_port = $_SERVER['SERVER_PORT'];
        } else {
            $protocol_port = 80;
        }
        $host = $_SERVER['HTTP_HOST'];
        $port = $_SERVER['SERVER_PORT'];
        $request = $_SERVER['PHP_SELF'];
        return dirname($protocol . '://' . $host . ($port == $protocol_port ? '' : ':' . $port) . $request);
    }

    public function makePaymentUsingPayPal($id, $total, $paymentDesc = null)
    {

        $currency = $this-&gt;config-&gt;payment-&gt;currency;
        $tax      = $this-&gt;config-&gt;payment-&gt;tax;
        $shipping = $this-&gt;config-&gt;payment-&gt;shipping;
        $cancelUrl = $this-&gt;config-&gt;payment-&gt;paypal-&gt;cancelUrl;
        $returnUrl = $this-&gt;config-&gt;payment-&gt;paypal-&gt;returnUrl;
        $itemQuantity = 1;
        $itemName = "Post jobs on Phalconjobs.com";

        $payer = new Payer();
        $payer-&gt;setPaymentMethod("paypal");

        $item = new Item();
        $item-&gt;setQuantity($itemQuantity);
        $item-&gt;setName($itemName);
        $item-&gt;setPrice($total);
        $item-&gt;setCurrency($currency);

        $itemList = new ItemList();
        $itemList-&gt;setItems(array($item));

        // Specify the payment amount.
        $amount = new Amount();
        $amount-&gt;setCurrency($currency)
               -&gt;setTotal($total + $shipping + $tax);

        //Transaction
        $transaction = new Transaction();
        $transaction-&gt;setDescription($paymentDesc)
                    -&gt;setAmount($amount)
                    -&gt;setItemList($itemList);

        // Create the payment and redirect buyer to paypal for payment approval.
        $redirectUrls = new RedirectUrls();
        $redirectUrls-&gt;setReturnUrl($this-&gt;getBaseUrl() . $returnUrl .'&amp;id='. $id . '&amp;success=true');
        $redirectUrls-&gt;setCancelUrl($this-&gt;getBaseUrl() . $cancelUrl . '&amp;success=false');

        $payment = new Payment();
        $payment-&gt;setRedirectUrls($redirectUrls);
        $payment-&gt;setIntent("authorize");
        $payment-&gt;setPayer($payer);
        $payment-&gt;setTransactions(array($transaction));
        try {
            $payment-&gt;create($this-&gt;getApiContext());
        } catch (PayPal\Exception\PPConnectionException $ex) {
            echo "Exception: " . $ex-&gt;getMessage() . PHP_EOL;
            var_dump($ex-&gt;getData());
            exit(1);
        }

        /**
         * Get redirect url
         * The API response provides the url that you must redirect
         * the buyer to. Retrieve the url from the $payment-&gt;getLinks() method
         *
         */
        foreach ($payment-&gt;getLinks() as $key =&gt; $link) {
            if ($link-&gt;getRel() == 'approval_url') {
                $redirectUrl = $link-&gt;getHref();
                break;
            }
        }
        if (isset($redirectUrl)) {
            return $this-&gt;response-&gt;redirect($redirectUrl);
            exit;
        }
    }
    /**
     * Helper method for getting an APIContext for all calls
     *
     * @return PayPal\Rest\ApiContext
     */
    public function getApiContext()
    {

        // ### Api context
        // Use an ApiContext object to authenticate
        // API calls. The clientId and clientSecret for the
        // OAuthTokenCredential class can be retrieved from
        // developer.paypal.com

        $apiContext = new ApiContext(
            new OAuthTokenCredential(
                $this-&gt;config-&gt;payment-&gt;paypal-&gt;clientId,
                $this-&gt;config-&gt;payment-&gt;paypal-&gt;secret
            )
        );
        // #### SDK configuration

        // Comment this line out and uncomment the PP_CONFIG_PATH
        // 'define' block if you want to use static file
        // based configuration
        $apiContext-&gt;setConfig(
            array(
                'mode' =&gt; $this-&gt;config-&gt;payment-&gt;paypal-&gt;env,
                'http.ConnectionTimeOut' =&gt; $this-&gt;config-&gt;payment-&gt;paypal-&gt;timeout,
                'log.LogEnabled' =&gt; $this-&gt;config-&gt;payment-&gt;paypal-&gt;log,
                'log.FileName' =&gt; $this-&gt;config-&gt;payment-&gt;paypal-&gt;fileName,
                'log.LogLevel' =&gt; $this-&gt;config-&gt;payment-&gt;paypal-&gt;logLevel
            )
        );
        return $apiContext;
    }
}
//</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14539" data-cf-modified-234ecb5ee305daf574079d9c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14539" data-cf-modified-234ecb5ee305daf574079d9c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/17f330e272315f09f5acbe31df734dd7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1340/elchueko" class="user-moderator-N"><span itemprop="name">elchueko</span></a>        </span>
        <br>

        <span class="karma">8.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14544" href="#C14544">
                <time itemprop="dateCreated" datetime="2015-01-04T09:21:44-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for your solution!</p>
<p>Honestly I have the following problem:</p>
<blockquote>
<p>Fatal error: Class 'Paypal' not found in /app/controllers/IndexController.php on line 23</p>
</blockquote>
<p>What I did:</p>
<ul>
<li>creating a file &quot;Paypal.php&quot; in &quot;library&quot; dir with your sourcecode</li>
<li>adding the following line to my index.php</li>
</ul>
<blockquote>
<p>$di-&gt;set('paypal',
function(){
return new Paypal();
});</p>
</blockquote>
<p>In my <em>ControllerFile</em> I called this:</p>
<blockquote>
<p>$this-&gt;paypal-&gt;getApiContext();</p>
</blockquote>
<p>...btw, when I delete this:</p>
<blockquote>
<p>namespace ZPhalcon\Tools;</p>
</blockquote>
<p>I get another error:</p>
<blockquote>
<p>Fatal error: Class 'PayPal\Rest\ApiContext' not found in /app/library/Paypal.php on line 132</p>
</blockquote>
<p>Paypal Class is found, but no context from PayPal vendor directory.</p>
<p>What did I wrong?</p>
<p>Thx!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14544" data-cf-modified-234ecb5ee305daf574079d9c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14544" data-cf-modified-234ecb5ee305daf574079d9c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/17f330e272315f09f5acbe31df734dd7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1340/elchueko" class="user-moderator-N"><span itemprop="name">elchueko</span></a>        </span>
        <br>

        <span class="karma">8.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14545" href="#C14545">
                <time itemprop="dateCreated" datetime="2015-01-04T09:31:11-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Sry, it works!</p>
<p>Using the vendor dir, downloaded from composer (before used vendor dir from paypal sdk Zipfile).</p>
<p>Thx for your help!!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14545" data-cf-modified-234ecb5ee305daf574079d9c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14545" data-cf-modified-234ecb5ee305daf574079d9c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/95593bdf7bc6c62dbd16767e520f13c8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a>        </span>
        <br>

        <span class="karma">59.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C44189" href="#C44189">
                <time itemprop="dateCreated" datetime="2016-12-20T08:56:31-07:00" class="action-date">Dec '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi,</p>
<p>maybe someone can help me. I tried to rebuild this library, but i get this error message:</p>
<pre><code>    Fatal error: Class 'Vokuro\Paypal\Paypal' not found in /Users/stefan/Sites/website/app/config/services.php on line 214</code></pre>
<p>Library Paypal.php</p>
<pre><code>  namespace Vokuro\Paypal;
  namespace ZPhalcon\Tools;
  use Phalcon\Mvc\User\Component;
  use PayPal\Api\Address;
  use PayPal\Api\CreditCard;
  use PayPal\Api\Amount;
  use PayPal\Api\Details;
  use PayPal\Rest\ApiContext;
  use PayPal\Auth\OAuthTokenCredential;
  use PayPal\Api\Payer;
  use PayPal\Api\Payment;
  use PayPal\Api\Transaction;
  use PayPal\Api\RedirectUrls;
  use PayPal\Api\FundingInstrument;
  use PayPal\Api\Item;
  use PayPal\Api\ItemList;

  class Paypal extends Component{</code></pre>
<p>loader.php</p>
<pre><code>  $loader = new \Phalcon\Loader();
  $loader-&gt;registerNamespaces(array(
      'Vokuro\Models' =&gt; $config-&gt;application-&gt;modelsDir,
      'Vokuro\Controllers' =&gt; $config-&gt;application-&gt;controllersDir,
      'Vokuro\Forms' =&gt; $config-&gt;application-&gt;formsDir,
      'Vokuro' =&gt; $config-&gt;application-&gt;libraryDir
  ));

  $loader-&gt;register();

  require_once __DIR__ . '/../../vendor/autoload.php';</code></pre>
<p>services.php</p>
<pre><code>  use Vokuro\Paypal\Paypal;
  $di-&gt;set('paypal', function(){
      return new Paypal();
  });</code></pre>
<p>Thx
Stefan</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="44189" data-cf-modified-234ecb5ee305daf574079d9c-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="44189" data-cf-modified-234ecb5ee305daf574079d9c-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="4383" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>