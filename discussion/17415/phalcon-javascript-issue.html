---
layout: default
title: 'Phalcon Javascript Issue - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/5/general">General</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Phalcon Javascript Issue</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/10053/Karthik261193" class="user-moderator-N"><span itemprop="name">Karthik261193</span></a></span>
            <time itemprop="dateCreated" datetime="2017-12-07T06:02:56-07:00">Dec '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-12-07T06:02:56-07:00">Dec '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">6</span>
                </td>
                <td>
                    <label>Views</label><br>851</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/93e7cfcbdc51bc1670816a6dea09cb56?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/10053/Karthik261193" class="user-moderator-N"><span itemprop="name">Karthik261193</span></a></span>
                <span class="karma">7.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C17415" href="#C17415">
        <time class="action-date">Dec '17</time>
    </a>
</div>
<div class="post-content"><div><p>In Phalcon when I calling the ajax call then it is returning the complete html page instead of response. </p>
<p>When I am clicking on the image I am calling the javascript function. In that function I am having the below ajax call. But the saveEventIdAction is not calling. </p>
<p>Please help me on this. </p>
<p>{% raw %}ex: $.ajax({
type: &quot;POST&quot;,
url: &quot;index/saveEventId/&quot;,
crossDomain: true,
dataType: &quot;json&quot;,
data: { event_id: eventId, event_name: eventName} ,
success: function(response) {}}{% endraw %});</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-e11775186daa2e72469d6589-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-e11775186daa2e72469d6589-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="52777" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '17</span>
              </span><br/><a name="C52777" href="#C52777">
                <time itemprop="dateCreated" datetime="2017-12-07T06:19:46-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Phalcon will respond with what you code it to respond with.</p>
<pre><code class="language-php">class IndexController extends PhController
{
    function saveEventIdAction() {
        if($this-&gt;request-&gt;isPost()) {
            $data = $this-&gt;request-&gt;getPost();
            // app logic
            return $this-&gt;response-&gt;setJsonContent(['some'=&gt;'response data'])-&gt;send();
        }
    }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52777" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52777" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/93e7cfcbdc51bc1670816a6dea09cb56?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/10053/Karthik261193" class="user-moderator-N"><span itemprop="name">Karthik261193</span></a>        </span>
        <br>

        <span class="karma">7.7k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C52777"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Lajos Bencz                    </a>
                </div><div class="posts-buttons" align="right"><a name="C52779" href="#C52779">
                <time itemprop="dateCreated" datetime="2017-12-07T06:25:47-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I tried the same example you gave but I am getting the index page html code is returning instead of response we sent from saveEventIdAction</p>
<blockquote>
<p>Phalcon will respond with what you code it to respond with.</p>
<pre><code class="language-php">class IndexController extends PhController
{
  function saveEventIdAction() {
      if($this-&gt;request-&gt;isPost()) {
          $data = $this-&gt;request-&gt;getPost();
          // app logic
          return $this-&gt;response-&gt;setJsonContent(['some'=&gt;'response data'])-&gt;send();
      }
  }
}</code></pre>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52779" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52779" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d13fbfe44ba667e08060bc76bd53108d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/8211/borisdelev" class="user-moderator-N"><span itemprop="name">Boris Delev</span></a>        </span>
        <br>

        <span class="karma">1.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="52781" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '17</span>
              </span><br/><a name="C52781" href="#C52781">
                <time itemprop="dateCreated" datetime="2017-12-07T06:35:53-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Are we need  <code>-&gt;send();</code> ? Or just without it.</p>
<pre><code>return $this-&gt;response-&gt;setJsonContent(['some'=&gt;'response data']);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52781" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52781" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4769/Izopi4a" class="user-moderator-Y"><span itemprop="name">Izo</span></a>        </span>
        <br>

        <span class="karma">85.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="52783" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '17</span>
              </span><br/><a name="C52783" href="#C52783">
                <time itemprop="dateCreated" datetime="2017-12-07T07:08:41-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>here is an old code of mine that i am using everywhere for ajax calls</p>
<pre><code class="language-php">
&lt;?php

namespace Whatever\api\Controllers;

use Phalcon\Mvc\Controller;

/**
 * Class UsersController
 *
 * @package Api\Controller
 */
class BaseController extends Controller
{

    protected $translationService;

    public function onConstruct() {

        $this-&gt;translationService = $this-&gt;getDI()-&gt;getShared("getTranslationMessages");
    }

    public function translate($name) {
        return $this-&gt;translationService-&gt;query($name);
    }
    /**
     * allows only ajax calls
     *
     * @param bool $onlyGet
     * @param bool $token
     * @param bool $soft
     */

    public function onlyAjax($onlyGet = false, $token = false, $soft = false)
    {

        if ($this-&gt;request-&gt;isAjax() == false) {
            return $this-&gt;handleAjaxError($soft);
        }

        if ($onlyGet === true) {
            if ($this-&gt;request-&gt;isGet() === false) {
                return $this-&gt;handleAjaxError($soft);
            }
        }

        if ($token &amp;&amp; $this-&gt;security-&gt;checkToken() == false) {
            return $this-&gt;handleAjaxError($soft);
        }
    }

    public function handleAjaxError($soft = false)
    {

        if ($soft === false) {
            $this-&gt;response-&gt;setStatusCode(404, 'Not found');
            $this-&gt;response-&gt;redirect("/404");
        }

        $this-&gt;response-&gt;setJsonContent(
            array(
            'success' =&gt; false,
            'url' =&gt; $this-&gt;request-&gt;getURI(),
            'parameters' =&gt; $this-&gt;dispatcher-&gt;getParams()
            )
        );
    }

    public function afterExecuteRoute(\Phalcon\Mvc\Dispatcher $dispatcher)
    {

        if ($this-&gt;request-&gt;isAjax() == true) {

            $this-&gt;response-&gt;setContentType('application/json', 'UTF-8');
            $data = $this-&gt;view-&gt;getParamsToView();

            $json = [];

            if (isset($data['error']) &amp;&amp; $data['error'] !== 0 &amp;&amp; $data['error'] !== true) {
                $json['success'] = false;
                $json['message'] = $data['error'];
            } else {
                $json['success'] = true;
                if (isset($data['message'])) {
                    $json['message'] = $data['message'];
                }
                if (isset($data['results'])) {
                    $json['results'] = $data['results'];
                }

            }

            $this-&gt;response-&gt;setJsonContent($json);
        }
    }

    public function onlyLoggedUsers()
    {
        if ($this-&gt;getDI()-&gt;getShared("auth")-&gt;isUserSignedIn() === false) {

            http_response_code(401); //unauthorized

            echo json_encode(
                [
                'success' =&gt; false
                ]
            );
            exit;

        }
    }

}
</code></pre>
<p>and then for actually stuff</p>
<pre><code class="language-php">
&lt;?php

namespace Whatever\api\Controllers;

use Helpers\Uploads\HandleUpload;

class UploadsController extends BaseController {

    public function AvatarAction(){

        $this-&gt;onlyAjax();
        $this-&gt;onlyLoggedUsers();

        $this-&gt;view-&gt;error = 0;

        $user_id = $this-&gt;auth-&gt;getUserId();

        $uploadAdapter = new \whatever\Plugins\Uploads\Adapter\UserAvatar($user_id, [
                "watermark" =&gt; false,
                "trim" =&gt; true
            ]
        );

        $handleUpload = new HandleUpload($uploadAdapter);

        $errors = $handleUpload-&gt;errors;

        if (count($errors) &gt; 0){
            $this-&gt;view-&gt;error = $errors[0];
            return false;
        }

        $result = [];

        $result['success'] = true;
        $this-&gt;view-&gt;results = $result;
        return false;
    }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52783" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52783" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52791" href="#C52791">
                <time itemprop="dateCreated" datetime="2017-12-07T10:45:04-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ahh.. but routes will be transformed to kebab case!</p>
<p>Use this url: <code>index/save-event-id</code> instead of <code>index/saveEventId</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52791" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52791" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52875" href="#C52875">
                <time itemprop="dateCreated" datetime="2017-12-12T14:14:16-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>My guess is your ajax call is to the wrong URL.  Do you have an .htaccess rule that redirects 404 requests to your index page?  If so, then likely you're not requesting the correct url.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52875" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52875" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/326946b764185770c24d400c34cb8ad7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/10261/etshy" class="user-moderator-N"><span itemprop="name">etshy</span></a>        </span>
        <br>

        <span class="karma">8.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C52931" href="#C52931">
                <time itemprop="dateCreated" datetime="2017-12-17T15:06:56-07:00" class="action-date">Dec '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Maybe you need to disable the view </p>
<p><code>$this-&gt;view-&gt;disable();</code></p>
<p>setJsonContent in your response</p>
<pre><code>$response = new \Phalcon\Http\Response();
$response-&gt;setJsonContent([...]);</code></pre>
<p>and return $response</p>
<pre><code>return $response;</code></pre>
<p>That worked well for me</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="52931" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="52931" data-cf-modified-e11775186daa2e72469d6589-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="17415" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>