---
layout: default
title: '_postSaveRelated record error when saving related model. - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">_postSaveRelated record error when saving related model.</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/56/jeffreycahyono" class="user-moderator-N"><span itemprop="name">jeffreycahyono</span></a></span>
            <time itemprop="dateCreated" datetime="2013-04-25T01:59:02-07:00">Apr '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-04-25T01:59:02-07:00">Apr '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Apr '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">1</span>
                </td>
                <td>
                    <label>Views</label><br>508</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/8fcad302d31f7f007b93f0395701e112?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/56/jeffreycahyono" class="user-moderator-N"><span itemprop="name">jeffreycahyono</span></a></span>
                <span class="karma">27.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C252" href="#C252">
        <time class="action-date">Apr '13</time>
    </a>
</div>
<div class="post-content"><div><p>Using magic property to store related records has a problem when the related record fails to vaidate, it out put _postSaveRelalated bla bla error. </p>
<p>So the doc example below, </p>
<pre><code class="language-php">$artist = new Artists();
$artist-&gt;country = 'Japan';

$album = new Albums();
$album-&gt;name = 'The One';
$album-&gt;artist = $artist; //Assign the artist
$album-&gt;year = 2008;

//Save both records
$album-&gt;save();</code></pre>
<p>If the Artist validation fails, the save operation in album model would produce </p>
<pre><code class="language-bash">Fatal error: Phalcon\Mvc\Model::_postSaveRelatedRecords(): Call to method setmodel() on a non object in ....</code></pre>
<p>My question is how to store related record like the example docs without producing this fatal error </p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-98d268f7c3b73129fa3968a9-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-98d268f7c3b73129fa3968a9-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/7a7213a60bcf0bbbfa0fba625b4b3420?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/135/igorzg" class="user-moderator-N"><span itemprop="name">Igor</span></a>        </span>
        <br>

        <span class="karma">368</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1017" href="#C1017">
                <time itemprop="dateCreated" datetime="2013-04-25T06:25:22-07:00" class="action-date">Apr '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What version of phalcon you have installd ?
Thats fixed in 1.0.0</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1017" data-cf-modified-98d268f7c3b73129fa3968a9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1017" data-cf-modified-98d268f7c3b73129fa3968a9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8fcad302d31f7f007b93f0395701e112?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/56/jeffreycahyono" class="user-moderator-N"><span itemprop="name">jeffreycahyono</span></a>        </span>
        <br>

        <span class="karma">27.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1019" href="#C1019">
                <time itemprop="dateCreated" datetime="2013-04-25T06:46:34-07:00" class="action-date">Apr '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>0.9.1, I have to stick to 0.9.1 because skipAttribute does not work in 1.x.x</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1019" data-cf-modified-98d268f7c3b73129fa3968a9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1019" data-cf-modified-98d268f7c3b73129fa3968a9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8fcad302d31f7f007b93f0395701e112?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/56/jeffreycahyono" class="user-moderator-N"><span itemprop="name">jeffreycahyono</span></a>        </span>
        <br>

        <span class="karma">27.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1036" href="#C1036">
                <time itemprop="dateCreated" datetime="2013-04-26T03:59:43-07:00" class="action-date">Apr '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I've tried version 1.1.0 and the fatal error still exist. it happened when all model is not descended directly from Phalcon\MVC\Model but from my ModelBase class.
Below is my base model class.</p>
<pre><code class="language-php">namespace BI\Models;

class ModelBase extends \Phalcon\MVC\Model {
    protected $fieldLabel = array();

    public function setValues($data, $keys){
        foreach($keys as $key=&gt;$default){
            $val = isset($data[$key]) ? $data[$key] : $default;
            $this-&gt;{$key} = $data[$key];
        }
    }

    public function loadMsgs(&amp;$msgs){
        $listmsg = $this-&gt;getMessages();
        foreach ($listmsg as $message) {
            $msgs[] = $message;
        }
        return count($listmsg)==0;
    }

    public function valid(&amp;$errors){
        if(empty($errors))
            $errors = array();
        if(!$this-&gt;validation()){ 
            $this-&gt;loadMsgs($errors);
            return false;
        }
        return true;      
    }

    public function validation(){
        return true;
    }

    public function getMessages(){
        $messages = array();
        if(count(parent::getMessages()))
            foreach (parent::getMessages() as $message) {
                $field = isset($this-&gt;fieldLabel[$message-&gt;getField()])?
                    $this-&gt;fieldLabel[$message-&gt;getField()] : $message-&gt;getField(); 
                switch ($message-&gt;getType()) {
                    case 'InvalidCreateAttempt':
                        $messages[] = 'Data tidak dapat disimpan karena sudah ada.';
                        break;
                    case 'InvalidUpdateAttempt':
                        $messages[] = 'Data tidak dapat disimpan karena sudah ada.';
                        break;
                    case 'ConstraintViolation' :
                        $messages[] =  $field . ' yang Anda pilih tidak ada.';
                        break;          
                    case 'PresenceOf':
                        $messages[] = 'Kolom '. $field . ' wajib diisi.';
                        break;
                    case 'Email' : 
                        $messages[] = $field . " tidak valid.";
                        break;
                    case 'Unique':
                        $messages[] = $field . " yang Anda masukkan sudah terpakai. ".
                            " Silakan masukkan ".$field." yang lain.";
                        break;  
                    default:
                        $messages[] = /* $message-&gt;getType() . '::' .*/ $message;               
                }
            }
        return $messages;
    }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1036" data-cf-modified-98d268f7c3b73129fa3968a9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1036" data-cf-modified-98d268f7c3b73129fa3968a9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8fcad302d31f7f007b93f0395701e112?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/56/jeffreycahyono" class="user-moderator-N"><span itemprop="name">jeffreycahyono</span></a>        </span>
        <br>

        <span class="karma">27.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C1063" href="#C1063">
                <time itemprop="dateCreated" datetime="2013-04-28T07:11:22-07:00" class="action-date">Apr '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I reproduce the error in the github Issue #584,</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="1063" data-cf-modified-98d268f7c3b73129fa3968a9-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="1063" data-cf-modified-98d268f7c3b73129fa3968a9-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="252" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>