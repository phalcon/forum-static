---
layout: default
title: 'Снова баг(?) в Router - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Снова баг(?) в Router</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a></span>
            <time itemprop="dateCreated" datetime="2013-12-05T07:41:50-07:00">Dec '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-12-05T07:41:50-07:00">Dec '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">12</span>
                </td>
                <td>
                    <label>Views</label><br>1266</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a></span>
                <span class="karma">10.2k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C1288" href="#C1288">
        <time class="action-date">Dec '13</time>
    </a>
</div>
<div class="post-content"><div><p>Добрый день. Снова какая-то не понятная (для меня) ситуация с роутами. Знатоки внутренностей, объясните plz...
Если коротко, есть 2 роута:</p>
<pre><code class="language-php">$router
    -&gt;add('/:controller', [
        'controller'    =&gt; 1,
        'action'        =&gt; 'index',
    ]);

$router
    -&gt;add('/', [
        'controller'    =&gt; 'index',
        'action'        =&gt; 'index',
    ]);</code></pre>
<p>Есть 1 контроллер: IndexController. Захожу на /123 и... попадаю в IndexController. Где логика?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/23f127b8afebc5e0cedb57e4eb524af7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/33/xboston" class="user-moderator-Y"><span itemprop="name">Nikolay Kirsh</span></a>        </span>
        <br>

        <span class="karma">5.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4566" href="#C4566">
                <time itemprop="dateCreated" datetime="2013-12-06T04:45:42-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>А если местами их поменять, для эксперимента?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4566" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4566" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d256c23599c7ddbb7085ee23f2499f6e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/741/vanchelo" class="user-moderator-N"><span itemprop="name">Брежнев Иван</span></a>        </span>
        <br>

        <span class="karma">1.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4567" href="#C4567">
                <time itemprop="dateCreated" datetime="2013-12-06T05:23:42-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>И в чем косяк?
Вроде как PHP на такие вещи ругается</p>
<pre><code class="language-php">class 123Controller</code></pre>
<p>И я так думаю что пытается следущий роут использовать, или дефолтные настройки</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4567" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4567" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4568" href="#C4568">
                <time itemprop="dateCreated" datetime="2013-12-06T05:41:56-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ну да, это глобальный баг PHP.
Нужно публиковать баг-репорт. Только не сейчас, а 1 апреля.
По-сути.
Вы вызываете контроллер. Контроллер - класс, значит, он не может иметь имя, начинающееся с цифры, как и любая переменная в PHP.
Далее, замечено, что, если не описана обработка события, когда роут не найден, идет переадресация на index контроллер.
Так что никакго бага нет.
Сделайте обработку NotFound, и все.
И при разработке включите E_ALL &amp; display_errors = On
Еще внимательно перечитайте документацию на предмет порядка обработки маршрутов</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4568" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4568" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4569" href="#C4569">
                <time itemprop="dateCreated" datetime="2013-12-06T06:22:26-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/boston">@boston</a>, пробовал. Не влияет на результат.<a href="https://forum.phalcon.io/user/0/vanchelo">
@vanchelo</a>, да какая разница? Если в системе нет роута с таким классом, должен сработать exception, а не браться дефолтный роут. Для /asd работает правильно (показывает 404-ю ошибку), а для цифр нет.<a href="https://forum.phalcon.io/user/0/Oleg">
@Oleg</a>, да ладно? Серьезно? Ну ты гений... Уточню (для гениев), роут создавался так:</p>
<pre><code class="language-php">$router = new \Phalcon\Mvc\Router(false);</code></pre>
<p>Должна с false идти на дефолтный контроллер? Обработка notFound есть. Вывод ошибок включен в index.php. Хоть бы проверил сначала...
Далее: автолоадер обрабатывает запрос на файл с классом контроллера. Файла нет. С чего бы вдруг не выбросить стандартное исключение?
Ну и последний вопрос: почему для /asd и /123 фреймворк работает по разному? Ни в первом, ни во втором случае нет роута, который можно использовать. Соответственно, работать должно идентично. С сарказмом у тебя плохо, тренируйся...</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4569" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4569" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d256c23599c7ddbb7085ee23f2499f6e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/741/vanchelo" class="user-moderator-N"><span itemprop="name">Брежнев Иван</span></a>        </span>
        <br>

        <span class="karma">1.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4570" href="#C4570">
                <time itemprop="dateCreated" datetime="2013-12-06T07:03:26-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Действительно странно работает
Сделал тоже самое
/123 - 200 OK
/123a - 123aController handler class cannot be loaded</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4570" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4570" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d256c23599c7ddbb7085ee23f2499f6e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/741/vanchelo" class="user-moderator-N"><span itemprop="name">Брежнев Иван</span></a>        </span>
        <br>

        <span class="karma">1.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4571" href="#C4571">
                <time itemprop="dateCreated" datetime="2013-12-06T07:21:44-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>МБ он проверяет на что-то типа</p>
<pre><code class="language-php">if ( ! is_numeric($controller)) {}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4571" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4571" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4582" href="#C4582">
                <time itemprop="dateCreated" datetime="2013-12-06T12:47:01-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>А смысл в такой проверке?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4582" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4582" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d256c23599c7ddbb7085ee23f2499f6e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/741/vanchelo" class="user-moderator-N"><span itemprop="name">Брежнев Иван</span></a>        </span>
        <br>

        <span class="karma">1.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4583" href="#C4583">
                <time itemprop="dateCreated" datetime="2013-12-06T12:56:21-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ты у меня спрашиваешь за смысл? Я не предлогаю никаких проверок, а всего лишь сделал предположение</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4583" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4583" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4584" href="#C4584">
                <time itemprop="dateCreated" datetime="2013-12-06T13:07:35-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Да, ты прав: <a href="https://github.com/phalcon/cphalcon/blob/master/ext/mvc/router.c#L840">https://github.com/phalcon/cphalcon/blob/master/ext/mvc/router.c#L840</a>
Бред какой-то...</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4584" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4584" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d256c23599c7ddbb7085ee23f2499f6e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/741/vanchelo" class="user-moderator-N"><span itemprop="name">Брежнев Иван</span></a>        </span>
        <br>

        <span class="karma">1.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4585" href="#C4585">
                <time itemprop="dateCreated" datetime="2013-12-06T13:26:58-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>согласен) поведение не совсем логичное)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4585" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4585" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="4596" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '14</span>
              </span><br/><a name="C4596" href="#C4596">
                <time itemprop="dateCreated" datetime="2013-12-07T11:10:54-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ну и еще один баг в роутере phalcon. Досконально его изучать не стал, т.к. уже понял, что надо написать замену Router и Route для полноценной работы, но для информации другим расскажу. В общем, в роутах есть именованные параметры. Баг заключается в том, что они поддерживаются не полностью. Например так будет работать:</p>
<pre><code class="language-php">$router-&gt;add('/test/{id:[0-9]+}', [
    'module'     =&gt; 'backend',
    'controller' =&gt; 'test',
    'action'     =&gt; 'index',
    'id'         =&gt; 2,
]);</code></pre>
<p>А вот так уже не будет работать:</p>
<pre><code class="language-php">$router-&gt;add('/test(/{id:[0-9]+})?', [
    'module'     =&gt; 'backend',
    'controller' =&gt; 'test',
    'action'     =&gt; 1,
    'id'         =&gt; 2,
]);</code></pre>
<p>Баг все тот-же: криво работает роутер с опциональными параметрами. Решение, кому необходимо, заключается в использовании полноценных регулярок в роутах. Для данного примера оно будет примерно таким:</p>
<pre><code class="language-php">$router-&gt;add('/test(/(?P&lt;id&gt;[0-9]+))?', [
    'module'     =&gt; 'backend',
    'controller' =&gt; 'test',
    'action'     =&gt; 1,
    'id'         =&gt; 2,
]);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4596" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4596" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4602" href="#C4602">
                <time itemprop="dateCreated" datetime="2013-12-08T09:18:23-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ну и еще один баг: роутер в упор не понимает русский язык. Нет, я не создаю ссылки на русском, хотя и не считаю, что это не правильно - для .рф доменов это абсолютная норма.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4602" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4602" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4603" href="#C4603">
                <time itemprop="dateCreated" datetime="2013-12-08T09:28:49-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Интересно, &quot;гений&quot;<a href="https://forum.phalcon.io/user/0/Oleg"> @Oleg</a> снова порекомендует &quot;писать багрепорт 1-го апреля&quot; и &quot;перечитать документацию&quot;?) Или снова скажет &quot;никакго бага нет&quot;? А,<a href="https://forum.phalcon.io/user/0/Oleg"> @Oleg</a>? )))</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4603" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4603" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/23f127b8afebc5e0cedb57e4eb524af7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/33/xboston" class="user-moderator-Y"><span itemprop="name">Nikolay Kirsh</span></a>        </span>
        <br>

        <span class="karma">5.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4608" href="#C4608">
                <time itemprop="dateCreated" datetime="2013-12-08T21:23:22-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/aktuba">@aktuba</a> не надо и в этой теме переходить на личности.</p>
<p>Для найденных багов есть специальное место, при правильном описании проблемы решение будет получено очень быстро: <a href="https://github.com/phalcon/cphalcon/issues">https://github.com/phalcon/cphalcon/issues</a></p>
<p>// Про &quot;нет бага&quot; - каждый фреймворк ведёт себя оп своему, привыкшим к одному fw поведение другого будет считаться нелогичным, и наоборот.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4608" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4608" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4610" href="#C4610">
                <time itemprop="dateCreated" datetime="2013-12-08T22:50:42-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/boston">@boston</a>, да разве-ж я перехожу на личности? так, небольшой троллинг умников, которые сами не знают, но других поучают... все-все, больше не буду).
По поводу баг-трекера на гитхабе - сорри, не могу. Плохенько у меня с инглишем. Ну и поведение fw тут не при чем: если заявлена поддержка PCRE - значит должно быть реализовано. Ну и обработка любых урлов должна присутствовать.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4610" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4610" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/23f127b8afebc5e0cedb57e4eb524af7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/33/xboston" class="user-moderator-Y"><span itemprop="name">Nikolay Kirsh</span></a>        </span>
        <br>

        <span class="karma">5.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4612" href="#C4612">
                <time itemprop="dateCreated" datetime="2013-12-09T00:14:16-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Phalcon только развивается, причем активно. Если не указывать разработчикам на ошибки и несоответствия - то они и не будут предпринимать действия для их исправления.</p>
<p>Опиши на русском тут описание проблемы и код для её воспроизведения, перенесу всё в issue. Кратко и лаконично.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4612" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4612" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4614" href="#C4614">
                <time itemprop="dateCreated" datetime="2013-12-09T08:27:54-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Блин... Что за глюки на форуме - постоянно разлогинивает. Расписывал все баги, которые нашел, нажал &quot;Add Comment&quot;, получил &quot;error user_id&quot; и комментарий стерся (.
Вечером попробую еще раз написать (.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4614" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4614" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="4617" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '14</span>
              </span><br/><a name="C4617" href="#C4617">
                <time itemprop="dateCreated" datetime="2013-12-09T09:00:06-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://forum.phalcon.io/user/0/boston">@boston</a>, лови:</p>
<ol>
<li>Баг с цифрами в параметрах ссылки (контроллер, действие, возможно namespace и module тоже - их не проверял). Например, есть роуты:</li>
</ol>
<pre><code class="language-php">$router-&gt;add('/admin/:controller', [
    'module'        =&gt; 'test',
    'controller'    =&gt; 1,
    'action'        =&gt; 'index',
]);

$router-&gt;add('/admin/:controller/:action', [
    'module'        =&gt; 'test',
    'controller'    =&gt; 1,
    'action'        =&gt; 2,
]);</code></pre>
<p>Вот как будут обрабатываться ссылки:</p>
<p>/admin/controller - откроет контроллер Controller и дефолтный action, т.е. работает правильно
/admin/123 - откроет дефолтный контроллер и дефолтный action, вместо 404-й ошибки
/admin/controller/edit - откроет контроллер Controller и action edit, все нормально
/admin/controller/123 - откроет контроллер Controller и дефолтный action вместо 404-й ошибки.</p>
<p>Причина ошибки где-то здесь: <a href="https://github.com/phalcon/cphalcon/blob/master/ext/mvc/router.c#L840">https://github.com/phalcon/cphalcon/blob/master/ext/mvc/router.c#L840</a></p>
<ol start="2">
<li>Баг с русским языком в ссылках. Для тех-же роутов, что выше, проверяем:</li>
</ol>
<pre><code class="language-php">$router-&gt;handle('/admin/index/eng');
if ($router-&gt;wasMatched()) {
    echo 'Модуль (Module): ', $router-&gt;getModuleName(), '&lt;br/&gt;';
    echo 'Контроллер (Controller): ', $router-&gt;getControllerName(), '&lt;br&gt;';
    echo 'Действие (Action): ', $router-&gt;getActionName(), '&lt;br&gt;';
} else {
    echo 'Маршрут не поддерживается&lt;br&gt;';
};
die;</code></pre>
<p>для /admin/index/eng выдает:
Модуль (Module): test
Контроллер (Controller): index
Действие (Action): eng</p>
<p>для /admin/index/русский - &quot;Маршрут не поддерживается&quot;, хотя должен был определить модуль и контроллер для корректной обработки 404-й ошибки.</p>
<ol start="3">
<li>Проблема с опциональными параметрами в роутах. Вот так будет нормально работать:</li>
</ol>
<pre><code class="language-php">$router-&gt;add('/test/{id:[0-9]+}', [
  'module'     =&gt; 'backend',
  'controller' =&gt; 'test',
  'action'     =&gt; 'index',
  'id'         =&gt; 1,
]);</code></pre>
<p>а вот так работать уже не будех, хотя заявлена поддержка PCRE:</p>
<pre><code class="language-php">$router-&gt;add('/test(/{id:[0-9]+})?', [
  'module'     =&gt; 'backend',
  'controller' =&gt; 'test',
  'action'     =&gt; 'index',
  'id'         =&gt; 2,
]);</code></pre>
<p>Вообще, с опциональными параметрами полная беда. Регулярки поддерживаются только частично.</p>
<ol start="4">
<li>Есть проблема с View. Если назначить нативный шаблонизатор для .php - часть функционала начинает глючить. Если использовать .phtml (т.е. не прописывать дополнительные расширения для рендера) - все работает отлично. Обнаружил, когда делал модуль для e-mail. Сейчас уже не помню деталей, будет время - постараюсь восстановить последовательность действий и конкретные ошибки и выложу сюда.</li>
</ol></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4617" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4617" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/23f127b8afebc5e0cedb57e4eb524af7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/33/xboston" class="user-moderator-Y"><span itemprop="name">Nikolay Kirsh</span></a>        </span>
        <br>

        <span class="karma">5.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4618" href="#C4618">
                <time itemprop="dateCreated" datetime="2013-12-09T10:40:14-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>По п.2 - в дефолтных роутах правила для :action не поддерживают русский язык, это есть в доках ( <a href="http://docs.phalcon.io/en/latest/reference/routing.html#defining-routes">http://docs.phalcon.io/en/latest/reference/routing.html#defining-routes</a> ):
/:action - /([a-zA-Z0-9_]+) , но т.к. система ожидает там корректное значений action - выводится ошибка маршрутизации.</p>
<p>В остальном (кроме п.4) понял, перепроверю и буду разбираться.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4618" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4618" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4622" href="#C4622">
                <time itemprop="dateCreated" datetime="2013-12-09T11:39:09-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>По п.2 понял свою ошибку, спасибо.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4622" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4622" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5cfc1eb34e142b9035b986311e0e8468?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/306/sjinks" class="user-moderator-Y"><span itemprop="name">Volodymyr Kolesnykov</span></a>        </span>
        <br>

        <span class="karma">1.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="4671" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '14</span>
              </span><br/><a name="C4671" href="#C4671">
                <time itemprop="dateCreated" datetime="2013-12-13T09:19:45-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>1 -- the bug report is here: <a href="https://github.com/phalcon/cphalcon/issues/1688">https://github.com/phalcon/cphalcon/issues/1688</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4671" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4671" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5cfc1eb34e142b9035b986311e0e8468?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/306/sjinks" class="user-moderator-Y"><span itemprop="name">Volodymyr Kolesnykov</span></a>        </span>
        <br>

        <span class="karma">1.2k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4679" href="#C4679">
                <time itemprop="dateCreated" datetime="2013-12-14T10:39:17-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><a href="https://github.com/phalcon/cphalcon/pull/1694">https://github.com/phalcon/cphalcon/pull/1694</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4679" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4679" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0ff0b05acd6b028a0e18f4032c4f345e?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/491/aktuba" class="user-moderator-N"><span itemprop="name">aktuba</span></a>        </span>
        <br>

        <span class="karma">10.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4683" href="#C4683">
                <time itemprop="dateCreated" datetime="2013-12-14T12:05:56-07:00" class="action-date">Dec '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Во, хорошая новость, спс!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4683" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4683" data-cf-modified-b8ee22dd81e8105afb834d7a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="1288" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>