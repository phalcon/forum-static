---
layout: default
title: 'Phalcon not able to load multiple pages at once - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/5/general">General</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Phalcon not able to load multiple pages at once</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/8055/sergio1346" class="user-moderator-N"><span itemprop="name">sergio1346</span></a></span>
            <time itemprop="dateCreated" datetime="2016-08-26T03:18:09-07:00">Aug '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-08-26T03:18:09-07:00">Aug '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Aug '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>622</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/99d8141769e13d7a463348dce892db62?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/8055/sergio1346" class="user-moderator-N"><span itemprop="name">sergio1346</span></a></span>
                <span class="karma">1.5k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C13225" href="#C13225">
        <time class="action-date">Aug '16</time>
    </a>
</div>
<div class="post-content"><div><p>Hi, I'm using Phalcon 2.0 in our internal web page. We have this problem: While Phalcon is loading a large piece of code, for example this one:</p>
<pre><code class="language-php">    set_include_path(APP_PATH . "/app/vendor/phpseclib");
    include_once APP_PATH . "/app/vendor/phpseclib/Net/SFTP.php";

    if (!defined('NET_SFTP_LOGGING')) define('NET_SFTP_LOGGING', NET_SFTP_LOG_COMPLEX);
    $sftp = new Net_SFTP($server);

    if (!$sftp-&gt;login($username, $password)) {
        echo 'Login Failed.';
        echo $sftp-&gt;getSFTPLog();
    } else {
        echo 'Connected by SFTP.&lt;br&gt;';
        if (!empty($files)) {
            if ($sftp-&gt;put($remote_directory . $name, $local_directory . $files, NET_SFTP_LOCAL_FILE)) {
                echo "Upload completed&lt;br&gt;";
            } else {
                echo "Fail uploading&lt;br&gt;";
            }
        }
    }</code></pre>
<p>It uploads multiple and large files, and while is uploading it, no one page is responding until it finish. How can I avoid it generally? The above code is only an example.</p>
<p>Thanks</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-dfc16106401a917ad53df192-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-dfc16106401a917ad53df192-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4769/Izopi4a" class="user-moderator-Y"><span itemprop="name">Izo</span></a>        </span>
        <br>

        <span class="karma">85.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39211" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C39211" href="#C39211">
                <time itemprop="dateCreated" datetime="2016-08-26T03:36:06-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>its a bit too long to explain. Simple as that php runs line by line, same as function <a href="https://php.net/sleep">sleep</a>. So its just waiting for the file to be uplaoded until it moves to the next line.</p>
<p><a href="https://www.google.com/search?q=php%20workers&amp;rct=j">https://www.google.com/search?q=php%20workers&amp;rct=j</a></p>
<p><a href="https://devcenter.heroku.com/articles/php-workers">https://devcenter.heroku.com/articles/php-workers</a></p>
<p><a href="https://php.net/manual/en/gearmanclient.dobackground.php">https://php.net/manual/en/gearmanclient.dobackground.php</a></p>
<p>people mostly uses them to send emials, cuz its the same crap when you want to send user activating link for example.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39211" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39211" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/99d8141769e13d7a463348dce892db62?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8055/sergio1346" class="user-moderator-N"><span itemprop="name">sergio1346</span></a>        </span>
        <br>

        <span class="karma">1.5k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39211"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Izo                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39215" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C39215" href="#C39215">
                <time itemprop="dateCreated" datetime="2016-08-26T03:43:36-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I searched a lot on internet about it but i didn't found so many examples running it with an MVC.</p>
<blockquote>
<p>its a bit too long to explain. Simple as that php runs line by line, same as function <a href="https://php.net/sleep">sleep</a>. So its just waiting for the file to be uplaoded until it moves to the next line.</p>
<p><a href="https://www.google.com/search?q=php%20workers&amp;rct=j">https://www.google.com/search?q=php%20workers&amp;rct=j</a></p>
<p><a href="https://devcenter.heroku.com/articles/php-workers">https://devcenter.heroku.com/articles/php-workers</a></p>
<p><a href="https://php.net/manual/en/gearmanclient.dobackground.php">https://php.net/manual/en/gearmanclient.dobackground.php</a></p>
<p>people mostly uses them to send emials, cuz its the same crap when you want to send user activating link for example.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39215" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39215" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39219" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C39219" href="#C39219">
                <time itemprop="dateCreated" datetime="2016-08-26T05:05:31-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You can put those file transfers into message queue. Phalcon supports <code>beanstalkd</code> out of the box, so you can give it a try (you need to install first <code>beanstalkd</code> daemon). That way, just after the browser sends all the buffered data to web server -&gt; phalcon app, your app can continue it's execution flow.</p>
<p>But if the files are that large, your user will wait for physical upload anyway from their browser to the server. Since you're running an Intranet application, that should be 1 Gbps connection in LAN, so that's not an issue but SFTP going through entire Internet later on.</p>
<p>HTTP is a stateless procotol while PHP is Synchronous environment. There are ways to overcome those limitations. </p>
<p>But for the start just take a look at this example:
<a href="https://gist.github.com/joepie91/dc67316d2a22f321d1a1">https://gist.github.com/joepie91/dc67316d2a22f321d1a1</a></p>
<p>I refer here to node.js only to demonstrate the basic difference betweeen Synchronous and Asynchronous process.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39219" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39219" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/99d8141769e13d7a463348dce892db62?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8055/sergio1346" class="user-moderator-N"><span itemprop="name">sergio1346</span></a>        </span>
        <br>

        <span class="karma">1.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39227" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C39227" href="#C39227">
                <time itemprop="dateCreated" datetime="2016-08-26T05:47:31-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>So I understand that two simple PHP files can be executed at same time, but Phalcon execute config, loader and services.php and they are blocked until one page finishes, so the other page cannot load this config, loader and services.php files? Am I right?</p>
<p>I tested doing an sleep(100); and then execute another .php and it is loaded. I put an sleep(100); into any controller and all phalcon is blocked.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39227" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39227" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a20d655bbeff97e2c393510348ddb7cd?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3162/Graphmatic" class="user-moderator-N"><span itemprop="name">graphmatic</span></a>        </span>
        <br>

        <span class="karma">11.6k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C39229" href="#C39229">
                <time itemprop="dateCreated" datetime="2016-08-26T06:11:22-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>as Stamster suggest, use Beanstalk and parallel CLI app for example, it's the way I choose in my app, processing longer task (disk write ops) from a cli script filled with data from web app thru beanstalk queue. As php-cli and regular php are two separate proccess, they can run in concurency on the same server. and if you need to send some feedback from cli to your web app when background job is finished, you can use websocket..</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39229" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39229" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C39227"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/99d8141769e13d7a463348dce892db62?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        sergio1346                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="39239" data-toggle="modal" data-target="#historyModal">
                edited <span>Aug '16</span>
              </span><br/><a name="C39239" href="#C39239">
                <time itemprop="dateCreated" datetime="2016-08-26T07:48:42-07:00" class="action-date">Aug '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>So I understand that two simple PHP files can be executed at same time, but Phalcon execute config, loader and services.php and they are blocked until one page finishes, so the other page cannot load this config, loader and services.php files? Am I right?</p>
</blockquote>
<p>PHP files are all separate process (child processes from main PHP binary). </p>
<p>Phalcon loads different files as you told it (him?) to do. Normally those are components - loader, config, services etc.
If you try to open new tab from the same user session, you should be able to load something else which is non blocking (let's say homepage).</p>
<blockquote>
<p>I tested doing an sleep(100); and then execute another .php and it is loaded. I put an sleep(100); into any controller and all phalcon is blocked.</p>
</blockquote>
<p>Well, if you put something blocking in services container or anywhere where the app might need it during bootstrap (i.e. on every page), you're stuck.
Such blocking and long running tasks should be only called per controller.
The file after sleep is loaded only after sleep finishes execution. There's no way to see the page untill sleep finishes w/o using something from the <code>pcntl_</code> <a href="https://php.net/manual/en/book.pcntl.php">universe</a>.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="39239" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="39239" data-cf-modified-dfc16106401a917ad53df192-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="13225" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>