---
layout: default
title: 'CodeCeption Undefined di / PHPUnit_Framework_Assert already defined - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/12/developer-tools">Developer Tools</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">CodeCeption Undefined di / PHPUnit_Framework_Assert already defined</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/578/JREAM" class="user-moderator-N"><span itemprop="name">Jesse Boyer</span></a></span>
            <time itemprop="dateCreated" datetime="2017-08-23T11:07:08-07:00">Aug '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-08-23T11:07:08-07:00">Aug '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Aug '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">1</span>
                </td>
                <td>
                    <label>Views</label><br>774</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/b0118ac36d373acb24122c8183b087b4?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/578/JREAM" class="user-moderator-N"><span itemprop="name">Jesse Boyer</span></a></span>
                <span class="karma">58.6k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C16789" href="#C16789">
        <time class="action-date">Aug '17</time>
    </a>
</div>
<div class="post-content"><div><p>I am trying to get Codeception to run and I can get it working based off <a href="https://github.com/Codeception/phalcon-demo">CodeCeption Phalcon</a>. However, I cannot get my own project working when I use namespaces. Any advice would be appreciated.</p>
<h1>Using</h1>
<ul>
<li>Phalcon 3.2</li>
<li>Php 7.0 (Both OS's)</li>
<li>Ubuntu x64 16.04 LTS</li>
<li>Windows 10 </li>
</ul>
<p><strong>Other Question)</strong> It seems all of Phalcon Autoloading files works. However when I add namespaces for reasons I dont know, some of the CSS gets broken. I am using webpack. This seems totally irrelevent but it isnt because using the exact fsame compiled SASS gives me a different result when using a namespace or not. Im quite confused.</p>
<h1>Question 1</h1>
<p>Can you test <strong>if phalcon is doing something wrong with loading files?</strong> I should get a warning but the namespaces break things I am not sure if Im overwriting in my loader.php file. Does <code>get_declared_classes()</code> output what Phalcon has loaded in the Loader?</p>
<h1>Question 2</h1>
<p>I get an error like this <code>undefined variable di</code>, I am not sure where to look.</p>
<p>I also get an error just recently of this:  <code>Cannot declare class PHPUnit_Framework_Assert, because the name is already in use in /home/jesse/projects/jream.com/vendor/codeception/codeception/shim.php on line 17</code></p>
<p>Here are my files that seem releveant. I made sure to set <code>index.php</code> to require_once it hasn't had any effect.</p>
<h1>Composer.json</h1>
<pre><code>    ],
    "require": {
        "aws/aws-sdk-php": "^3.33",
        "erusev/parsedown": "^1.6",
        "facebook/graph-sdk": "^5.6",
        "filp/whoops": "^2.1",
        "google/auth": "^1.0",
        "guzzlehttp/guzzle": "^6.3",
        "monolog/monolog": "^1.23",
        "omnipay/common": "^2.5",
        "omnipay/paypal": "^2.6",
        "phalcon/incubator": "^v3.2",
        "php-http/guzzle6-adapter": "^1.1",
        "sendgrid/php-http-client": "^3.7",
        "sendgrid/sendgrid": "^5.6",
        "sentry/sentry": "^1.7",
        "stripe/stripe-php": "^v3.23",
        "swiftmailer/swiftmailer": "^5.4",
        "symfony/dotenv": "^v3.3",
        "symfony/var-dumper": "^3.3",
        "php": "&gt;=7.0",
        "ext-phalcon": "&gt;=3.2"
    },
    "require-dev": {
        "codeception/codeception": "^2.3",
        "codeception/specify": "^0.4",
        "codeception/verify": "^0.4",
        "phalcon/ide-stubs": "^3.2",
        "squizlabs/php_codesniffer": "^2.9"
    },
    "autoload-dev": {
        "psr-4": {
            "App\\Test\\Unit\\": "tests/unit/"
        }
    }</code></pre>
<h1>Structure</h1>
<ul>
<li>app/     --  No Namespace</li>
<li>app/components/  -- Namespace: <code>Components</code></li>
<li>app/controllers/      -- Namespace <code>Controllers</code></li>
<li>app/controllers/api -- Namespace  <code>Controllers\Api</code></li>
<li>app/controllers/dashboard  -- Namespcae <code>Controllers\Dashboard</code></li>
<li>app/forms/  -- No Namespace</li>
<li>app/library/  -- Namespace <code>Library</code> (Not Used)</li>
<li>app/middleware/ -- Namespace <code>Middleware</code></li>
<li>app/models/  -- No Namespace (easiest to access)</li>
<li>app/plugins/  -- Namespace <code>Plugins</code> (Not Used)</li>
<li>app/tasks/  -- No Namespace, Issues with  <code>Tasks</code> namespace I removed it.</li>
<li>app/views/ -- No namespace (Just views)</li>
</ul>
<h1>Loader.php</h1>
<pre><code> &lt;?php

 $loader = new \Phalcon\Loader();

$loader-&gt;registerNamespaces([
    'Components'            =&gt; $config-&gt;get('componentsDir'),
    'Controllers'           =&gt; $config-&gt;get('controllersDir'),
    'Controllers\Api'       =&gt; $config-&gt;get('controllersDir') . 'api/',
    'Controllers\Dashboard' =&gt; $config-&gt;get('controllersDir') . 'dashboard/',
    'Library'               =&gt; $config-&gt;get('libraryDir'),
    'Middleware'            =&gt; $config-&gt;get('middlewareDir'),
    'Migrations'            =&gt; $config-&gt;get('migrationsDir'),
    'Plugins'               =&gt; $config-&gt;get('pluginsDir'),
]);

$loader-&gt;registerClasses([
    'Phalcon' =&gt; DOCROOT . 'vendor/phalcon/incubator/Library/Phalcon/',
]);

$registerDirs = [
    $config-&gt;get('configDir'),
    $config-&gt;get('formsDir'),
    $config-&gt;get('modelsDir'),
    $config-&gt;get('tasksDir'),
];

// 1: For running unit tests
// 2: For the CLI Tasks
if (strtolower(\PHP_SAPI) === 'cli')
{
    // Auto Load the Tests Directory.
    $registerDirs[] = $config-&gt;get('testsDir');
}

// Register Remaining Directories
$loader-&gt;registerDirs($registerDirs);

// Finished
$loader-&gt;register();</code></pre>
<h1>public/index.php</h1>
<pre><code>use Phalcon\Mvc\Application;

/**
 * ==============================================================
 * Load Environment (Composer Auto-Loader, Constants)
 *
 * @important   The Order of file loading is crucial.
 * =============================================================
 */
require_once realpath(dirname(__DIR__)) . '/config/env.php';

/**
 * ==============================================================
 * Phalcon Bootstrap
 * =============================================================
 */
try {

    /** Read the configuration  */
    $config = require_once DOCROOT . "config/config.php";
    $api    = require_once $config-&gt;get('configDir') . "api.php";

    /** Read phalcon auto-loader */
    require_once $config-&gt;get('configDir') . "loader.php";

    /** Read services */
    require_once $config-&gt;get('configDir') . "services.php";

    /** Handle the request */
    $application = new Application($di);

    if (\APPLICATION_ENV === \APP_TEST) {
        return $application;
    }

    echo $application-&gt;handle()-&gt;getContent();
} catch(Exception $e) {
  // etc..
}</code></pre>
<h1>Running Codeception</h1>
<h3>Phalcon Linux Output from Codeception</h3>
<pre><code>./vendor/bin/codecept run unit -vvv
PHP Warning:  Cannot declare class PHPUnit_Framework_Assert, because the name is already in use in /home/jesse/projects/justrun/vendor/codeception/codeception/shim.php on line 17
PHP Stack trace:
PHP   1. {main}() /home/jesse/projects/justrun/vendor/codeception/codeception/codecept:0
PHP   2. require_once() /home/jesse/projects/justrun/vendor/codeception/codeception/codecept:7
PHP   3. include_once() /home/jesse/projects/justrun/vendor/codeception/codeception/autoload.php:45
PHP   4. class_alias() /home/jesse/projects/justrun/vendor/codeception/codeception/shim.php:17

Warning: Cannot declare class PHPUnit_Framework_Assert, because the name is already in use in /home/jesse/projects/justrun/vendor/codeception/codeception/shim.php on line 17

Call Stack:
    0.0002     379088   1. {main}() /home/jesse/projects/justrun/vendor/codeception/codeception/codecept:0
    0.0004     406896   2. require_once('/home/jesse/projects/justrun/vendor/codeception/codeception/autoload.php') /home/jesse/projects/justrun/vendor/codeception/codeception/codecept:7
    0.0279    2081144   3. include_once('/home/jesse/projects/justrun/vendor/codeception/codeception/shim.php') /home/jesse/projects/justrun/vendor/codeception/codeception/autoload.php:45
    0.0296    2336016   4. class_alias() /home/jesse/projects/justrun/vendor/codeception/codeception/shim.php:17

Codeception PHP Testing Framework v2.3.5
Powered by PHPUnit 6.2.4 by Sebastian Bergmann and contributors.</code></pre>
<h3>Phalcon Linux Output from Windows 10</h3>
<pre><code>Warning: Cannot declare class PHPUnit_Framework_Assert, because the name is already in use in C:\Users\inno\projects\justrun\veodeception\codeception\shim.php on line 17

Codeception PHP Testing Framework v2.3.5
Powered by PHPUnit 6.2.4 by Sebastian Bergmann and contributors.

Unit Tests (21) --------------------------------------------------------------------------------------------------------
Modules: Asserts, \Helper\Unit, Phalcon
------------------------------------------------------------------------------------------------------------------------
- AuthTest: Login action
  [Database] Transaction started
+ AuthTest: Login action (0.00s)
  [Database] Transaction cancelled; all changes reverted.
- AuthTest: Register actionUndefined variable: di
<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="d1b8bfbfbe919b8394909c">[email&#160;protected]</a> MINGW64 ~/projects/justrun (master)</code></pre>
<p>Any ideas :) ?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-5fc6303fd5606b454c22d01e-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-5fc6303fd5606b454c22d01e-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9313f1372d05717a64d1665973f963c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/10069/cdcchen" class="user-moderator-N"><span itemprop="name">Dong Chen</span></a>        </span>
        <br>

        <span class="karma">60</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C50537" href="#C50537">
                <time itemprop="dateCreated" datetime="2017-08-26T02:12:49-07:00" class="action-date">Aug '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Remove <code>codeception/verify</code> is OK.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="50537" data-cf-modified-5fc6303fd5606b454c22d01e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="50537" data-cf-modified-5fc6303fd5606b454c22d01e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="16789" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>