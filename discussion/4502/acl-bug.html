---
layout: default
title: 'ACL BUG - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/17/acl">Acl</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">ACL BUG</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a></span>
            <time itemprop="dateCreated" datetime="2015-01-17T05:06:22-07:00">Jan '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-01-17T05:06:22-07:00">Jan '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jan '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">10</span>
                </td>
                <td>
                    <label>Views</label><br>1001</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a></span>
                <span class="karma">18.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C4502" href="#C4502">
        <time class="action-date">Jan '15</time>
    </a>
</div>
<div class="post-content"><div><p>Someone using the latest version of Phalcon can create an ACL that works following the example of INVO ???</p>
<p>Using Wamp Server latest version also, I have done tests on windows 8.1 64bit and Windows 7 32-bit and both simply I can not make it work, does anyone know tell if this is a bug?</p>
<p>I have lost more than a month trying to make it funcionard and all forms and could not functioning as it should, even including copying the code to ensure that there were no typos, but no use.</p>
<p>Does anyone have a response because I'm about to give up trying to use this framework, or is there any other efficient way to develop private areas on my system without using this ACL system.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14995" href="#C14995">
                <time itemprop="dateCreated" datetime="2015-01-17T05:23:12-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What error do you have? Blank page? Exception?</p>
<p>Does the <code>error.log</code> says something?</p>
<p><a href="https://forum.phalcon.io/user/0/phalcon">@phalcon</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14995" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14995" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a>        </span>
        <br>

        <span class="karma">18.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14996" href="#C14996">
                <time itemprop="dateCreated" datetime="2015-01-17T05:28:32-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The pages are not private or public when they should, for example, I created a controller called open, it leaves this controller as an independent public I put it as private or not, it also leaves the public index controller others as it gets private, independent of the configuration that I do.</p>
<p>And even that it leaves open controller as standard public do not know why because I did not see it in the documentation, it's just the index action, the others are private as well.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14996" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14996" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14997" href="#C14997">
                <time itemprop="dateCreated" datetime="2015-01-17T05:44:15-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Did you create a session auth to check in every request if the user has access to that part of the app?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14997" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14997" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a>        </span>
        <br>

        <span class="karma">18.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="14998" data-toggle="modal" data-target="#historyModal">
                edited <span>Jan '15</span>
              </span><br/><a name="C14998" href="#C14998">
                <time itemprop="dateCreated" datetime="2015-01-17T07:36:04-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>when the session there is no role should be defined as a guest and have access to areas defined as public but it does not.</p>
<blockquote>
<p>$auth = $this-&gt;session-&gt;get('auth');</p>
</blockquote>
<pre><code>    if (!$auth){
        $role = 'Guests';
    } else {
        $role = 'Users';
    }</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14998" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14998" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C14999" href="#C14999">
                <time itemprop="dateCreated" datetime="2015-01-17T07:47:19-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Mmmm...</p>
<ol>
<li>Maybe you set the auth somewhere before in the code, so it is always <code>Users</code>.</li>
<li>You haven't attached the events manager to the security plugin.</li>
</ol>
<p>Else I think could be a bug as you say: Windows Phalcon has some problems, not like others OS, as I remember from reading.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="14999" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="14999" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a>        </span>
        <br>

        <span class="karma">18.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15000" href="#C15000">
                <time itemprop="dateCreated" datetime="2015-01-17T08:16:24-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>SecurityPlugin.php</p>
<pre><code>public function beforeDispatch(Event $event, Dispatcher $dispatcher)
{
    $auth = $this-&gt;session-&gt;get('auth');

    //Definindo Tipo User
    if (!$auth){
        $role = 'Guests';
    } else {
        $role = 'Users';
    }

    //$role = 'Users';

    $controller = $dispatcher-&gt;getControllerName();
    $action = $dispatcher-&gt;getActionName();
    $acl = $this-&gt;getAcl();

    $allowed = $acl-&gt;isAllowed($role, $controller, $action);

    if ($allowed != Acl::ALLOW) {
        $dispatcher-&gt;forward(array(
            'controller' =&gt; 'errors',
            'action'     =&gt; 'index'
        ));
        return false;
    }</code></pre>
<p>services.php</p>
<pre><code>$di-&gt;set('dispatcher', function() use ($di) {
$eventsManager = new EventsManager;
/**
 * Check if the user is allowed to access certain action using the SecurityPlugin
 */
$eventsManager-&gt;attach('dispatch:beforeDispatch', new SecurityPlugin);
/**
 * Handle exceptions and not-found exceptions using NotFoundPlugin
 */
//$eventsManager-&gt;attach('dispatch:beforeException', new NotFoundPlugin);
$dispatcher = new Dispatcher;
$dispatcher-&gt;setEventsManager($eventsManager);
return $dispatcher;
});</code></pre>
<p>When I set the user as User to test it is as user, to enter the contest I created called Close is private, but it does not access the actions other than the index, and when the role is Guest he also does not access any action than the index, nor any other controller than the ones I created with the name of Open, Errors and the Index, any I create even being in the public list it does not release the access.</p>
<p>I have no idea why these three controllers are public by default, even if I will not declare, like Open for example.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15000" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15000" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="15001" data-toggle="modal" data-target="#historyModal">
                edited <span>Jan '15</span>
              </span><br/><a name="C15001" href="#C15001">
                <time itemprop="dateCreated" datetime="2015-01-17T09:43:06-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I've seen other things comparing with the INVO tutorial or with my code: I don't know if you don't have it in your code, or just skipped it here, but I'll tell you (also tips for your code).</p>
<p>services.php</p>
<pre><code>$di-&gt;set('dispatcher', function() use ($di)
{
    $eventsManager = new EventsManager();
    $dispatcher    = new Dispatcher();

    /*
     * Check if the user is allowed to access certain action using the 'SecurityPlugin'.
     * Handle exceptions and not-found exceptions using 'NotFoundPlugin'.
     *
     * Tip: I would recomend creating a class only to pass the dispatcher's events.
     * From it, call the functions for security and error 404 from other classes.
     */
    $eventsManager-&gt;attach('dispatch:beforeExecuteRoute', new SecurityPlugin($di));
    // or $eventsManager-&gt;attach('dispatch', new SecurityPlugin($di));
    $eventsManager-&gt;attach('dispatch:beforeException', new NotFoundPlugin($di));
    // or $eventsManager-&gt;attach('dispatch', new NotFoundPlugin($di));

    /*
     * Set the events manager of the dispatcher and return it.
     */
    $dispatcher-&gt;setEventsManager($eventsManager);
    return $dispatcher;
});</code></pre>
<p>SecurityPlugin.php</p>
<pre><code>class SecurityPlugin extends Phalcon\Mvc\User\Plugin
{
    public function beforeExecuteRoute(Event $event, Dispatcher $dispatcher)
    {
        // Here I would only change (if you don't have need of) the forwarding by a redirect.
       $this-&gt;response-&gt;redirect('errors/index');
    }
}</code></pre>
<p>I think this should do the trick.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15001" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15001" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a>        </span>
        <br>

        <span class="karma">18.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15002" href="#C15002">
                <time itemprop="dateCreated" datetime="2015-01-17T10:35:36-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I made the changes that u suggested but still resulting in the same, when I changed the &quot;$eventsManager-&gt;attach('dispatch: beforeExecuteRoute', new SecurityPlugin ($ id));&quot;  al all pages are opened out, what should not happen, I tried other variations you also suggested did not work.</p>
<blockquote>
<p>Note the controllers and actions in public and private areas, the controller 'Open' is an independent public to put it al in mapping or not, and the 'Close' is as a private in the same way, when I it below define the role as 'Users' I can access the controller 'Close', but can not access the action 'DOIS' that is contained in this controller, nor the Block controller that remains blocked, as well as other controllers with index of exception, open and errors, the actions 'LOGIN' and 'OPEN' are also not accessible to any role that are redirected to the error controller to be a guest user or...</p>
</blockquote>
<p>Complete code</p>
<p>SecurityPlugin.php</p>
<pre><code>class SecurityPlugin extends Plugin
{
/**
 * Returns an existing or new access control list
 *
 * @returns AclList
 */
public function getAcl()
{
    //throw new \Exception("something");
    if (!isset($this-&gt;persistent-&gt;acl)) {
        $acl = new AclList();
        $acl-&gt;setDefaultAction(Acl::DENY);

        //Register roles
        $roles = array(
            'users'  =&gt; new Role('Users'),
            'guests' =&gt; new Role('Guests')
        );
        foreach ($roles as $role) {
            $acl-&gt;addRole($role);
        }
        //Private area resources
        $privateResources = array(
            'close' =&gt; array('index', 'dois'),
            'block' =&gt; array('index')
        );
        foreach ($privateResources as $resource =&gt; $actions) {
            $acl-&gt;addResource(new Resource($resource), $actions);
        }
        //Public area resources
        $publicResources = array(
            'index'  =&gt; array('index', 'login'),
            'open'   =&gt; array('index', 'aberta'),
            'errors' =&gt; array('index'),
            'teste'  =&gt; array('index')
        );
        foreach ($publicResources as $resource =&gt; $actions) {
            $acl-&gt;addResource(new Resource($resource), $actions);
        }
        //Grant access to public areas to both users and guests
        foreach ($roles as $role) {
            foreach ($publicResources as $resource =&gt; $actions) {
                foreach ($actions as $action){
                    $acl-&gt;allow($role-&gt;getName(), $resource, $action);
                }
            }
        }

        //Grant acess to private area to role Users
        foreach ($privateResources as $resource =&gt; $actions) {
            foreach ($actions as $action){
                $acl-&gt;allow('Users', $resource, $action);
            }
        }
        //The acl is stored in session, APC would be useful here too
        $this-&gt;persistent-&gt;acl = $acl;
    }
    return $this-&gt;persistent-&gt;acl;
}
/**
 * This action is executed before execute any action in the application
 *
 * @param Event $event
 * @param Dispatcher $dispatcher
 */
public function beforeDispatch(Event $event, Dispatcher $dispatcher)
{
    $auth = $this-&gt;session-&gt;get('auth');

    //Definindo Tipo User
    /* if (!$auth){
        $role = 'Guests';
    } else {
        $role = 'Users';
    } */

    $role = 'Users';

    $controller = $dispatcher-&gt;getControllerName();
    $action = $dispatcher-&gt;getActionName();
    $acl = $this-&gt;getAcl();

    $allowed = $acl-&gt;isAllowed($role, $controller, $action);

    if ($allowed != Acl::ALLOW) {
        /* $dispatcher-&gt;forward(array(
            'controller' =&gt; 'errors',
            'action'     =&gt; 'index'
        )); */
        $this-&gt;response-&gt;redirect('errors/index');
        return false;
    }
}
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15002" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15002" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15003" href="#C15003">
                <time itemprop="dateCreated" datetime="2015-01-17T10:51:10-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>I made the changes that u suggested but still resulting in the same, when I changed the &quot;$eventsManager-&gt;attach('dispatch: beforeExecuteRoute', new SecurityPlugin ($ id));&quot; al all pages are opened out, what should not happen, I tried other variations you also suggested did not work</p>
</blockquote>
<p>Did you changed the name method to <code>beforeExecuteRoute</code>?</p>
<p>Try not using a persistent ACL (just return <code>$acl</code>) and the conditional IF in <code>getAcl()</code>. Also comment the <code>return false;</code> if you do a redirect.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15003" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15003" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a>        </span>
        <br>

        <span class="karma">18.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15004" href="#C15004">
                <time itemprop="dateCreated" datetime="2015-01-17T10:53:59-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Did you changed the name method to beforeExecuteRoute?</p>
</blockquote>
<p>yes, it was like he was not working for all controllers were open for all roles.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15004" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15004" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15005" href="#C15005">
                <time itemprop="dateCreated" datetime="2015-01-17T11:00:40-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Not working for all controllers? That cannot be, I use that event to restrict access, and I've 5 controllers with 2 to 8 actions inside.</p>
<p>And what about the second option? If that doesn't work, maybe it'll be a bug, 'cause I have no cards left in my deck.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15005" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15005" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a>        </span>
        <br>

        <span class="karma">18.8k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C15005"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        RompePC                    </a>
                </div><div class="posts-buttons" align="right"><a name="C15006" href="#C15006">
                <time itemprop="dateCreated" datetime="2015-01-17T12:12:43-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Not working for all controllers? That cannot be, I use that event to restrict access, and I've 5 controllers with 2 to 8 actions inside.</p>
<p>And what about the second option? If that doesn't work, maybe it'll be a bug, 'cause I have no cards left in my deck.</p>
</blockquote>
<p>What is your version of Phalcon and your OS and webserver?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15006" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15006" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15009" href="#C15009">
                <time itemprop="dateCreated" datetime="2015-01-17T14:40:15-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Phalcon 1.3.2, Ubuntu 12.04, apache2.4.10, PHP 5.5.17.</p>
<p>Yeah, I've older version, but I think that if is a bug it would had saw the light some time ago.</p>
<p>I would recomend changing to older version: as far as I know, Phalcon 2 is still in beta.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15009" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15009" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a>        </span>
        <br>

        <span class="karma">18.8k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C15009"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        RompePC                    </a>
                </div><div class="posts-buttons" align="right"><a name="C15016" href="#C15016">
                <time itemprop="dateCreated" datetime="2015-01-17T17:59:03-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Phalcon 1.3.2, Ubuntu 12.04, apache2.4.10, PHP 5.5.17.</p>
<p>Yeah, I've older version, but I think that if is a bug it would had saw the light some time ago.</p>
<p>I would recomend changing to older version: as far as I know, Phalcon 2 is still in beta.</p>
</blockquote>
<p>I will continue doing tests trying to figure out, honestly I believe I did everything right and is a bug, or this new version of Phalcon for windows or web server or both.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15016" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15016" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a>        </span>
        <br>

        <span class="karma">18.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15017" href="#C15017">
                <time itemprop="dateCreated" datetime="2015-01-17T18:14:53-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>My Phalcon 1.3.4, so you have an idea in my pc the INVO project carries no page in addition to the index, pages are displayed in white, including About and Contact.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15017" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15017" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15021" href="#C15021">
                <time itemprop="dateCreated" datetime="2015-01-18T04:30:51-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I never did any tutorial pass the first one, so I cannot tell anything more with INVO. If you push the code to Github, maybe I would give it a try to see if it fails with my version.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15021" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15021" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2f0942cfa836b766da6c060c84eb8703?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2775/edwardhew" class="user-moderator-N"><span itemprop="name">Edward Hew</span></a>        </span>
        <br>

        <span class="karma">5.7k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15026" href="#C15026">
                <time itemprop="dateCreated" datetime="2015-01-18T06:23:25-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Maybe a quick and dirty tests independent of routing, something like this, this the gist of my ACL study code, I'm a little embarrassed, but what the hell: </p>
<pre><code class="language-php">    $acl = new \Phalcon\Acl\Adapter\Memory();
    $acl-&gt;setDefaultAction(\Phalcon\Acl::DENY);

    //Register roles
    $roles = array(
        'admin'  =&gt; new \Phalcon\Acl\Role('admin'),
        'guest' =&gt; new \Phalcon\Acl\Role('guest')
    );
    foreach ($roles as $role) {
        $acl-&gt;addRole($role);
    }

    //Private area resources
    $privateResources = array(
        'acl-protected'    =&gt; array('protected'),
    );
    foreach ($privateResources as $resource =&gt; $actions) {
        $acl-&gt;addResource(new \Phalcon\Acl\Resource($resource), $actions);
    }

    //Public area resources
    $publicResources = array(
        'index'   =&gt; array('index'),
        'acl-protected'   =&gt; array('index')
    );
    foreach ($publicResources as $resource =&gt; $actions) {
        $acl-&gt;addResource(new \Phalcon\Acl\Resource($resource), $actions);
    }

    //Grant access to public areas to both users and guests
    foreach ($roles as $role) {
        foreach ($publicResources as $resource =&gt; $actions) {
            $acl-&gt;allow('admin', $resource, '*'); // every controller's actions allowed, Carte blanche
            $acl-&gt;allow('guest', $resource, $actions); // A controller has both public and protected actions, only specified ones are allowed, instead of * (all)
        }
    }

    //Grant acess to private area to role admin
    foreach ($privateResources as $resource =&gt; $actions) {
        foreach ($actions as $action){
            //echo $resource,' ', $action.'&lt;br&gt;';
            $acl-&gt;allow('admin', $resource, $action);
        }
    }

    // eyeball test
    foreach ($roles as $role) {
        foreach ($publicResources as $resource =&gt; $actions) {
            foreach ($actions as $action){
                echo $role ,' - ', $resource, '/', $action,' [access: ';
                echo ($acl-&gt;isAllowed((string)$role, (string)$resource, $action) ? 'allowed' : 'false'),'] &lt;br&gt;';
            }
        }
        foreach ($privateResources as $resource =&gt; $actions) {
            foreach ($actions as $action){
                echo $role ,' - ', $resource, '/', $action,' [access: ';
                echo ($acl-&gt;isAllowed((string)$role, (string)$resource, $action) ? 'allowed' : 'false'),'] &lt;br&gt;';
            }
        }
        echo '&lt;hr&gt;';
    }
</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15026" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15026" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a>        </span>
        <br>

        <span class="karma">18.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="15038" data-toggle="modal" data-target="#historyModal">
                edited <span>Jan '15</span>
              </span><br/><a name="C15038" href="#C15038">
                <time itemprop="dateCreated" datetime="2015-01-18T12:20:37-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I installed an old version of WAMP who comes with version 5.3 of PHP and the first test I did the ACL worked perfectly, soon will be with time and will perform more tests in case of confirmation is a bug Phalcon with the latest version of WAMP with PHP 5.5+.</p>
<p>When performing the tests will post here to be corrected if someone perform these tests before please report here.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15038" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15038" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2f0942cfa836b766da6c060c84eb8703?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2775/edwardhew" class="user-moderator-N"><span itemprop="name">Edward Hew</span></a>        </span>
        <br>

        <span class="karma">5.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="15048" data-toggle="modal" data-target="#historyModal">
                edited <span>Jan '15</span>
              </span><br/><a name="C15048" href="#C15048">
                <time itemprop="dateCreated" datetime="2015-01-18T18:04:17-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>FYI I'm on PHP 5.6, Phalcon 1.3.3, I do have an actual test with dispatch working correctly, but have not tested with other versions or php/phalcon combo.</p>
<p>Result of testing your ACL, with one critical modification, I don't know what is <code>$acl = new AclList();</code> and so replaced it with <code>$acl = new \Phalcon\Acl\Adapter\Memory();</code>. The results look correct.</p>
<pre><code>Users - index/index[allow]
Users - index/login[allow]
Users - open/index[allow]
Users - open/aberta[allow]
Users - errors/index[allow]
Users - teste/index[allow]
Users - close/index[allow]
Users - close/dois[allow]
Users - block/index[allow]
------
Guests - index/index[allow]
Guests - index/login[allow]
Guests - open/index[allow]
Guests - open/aberta[allow]
Guests - errors/index[allow]
Guests - teste/index[allow]
Guests - close/index[not]
Guests - close/dois[not]
Guests - block/index[not]</code></pre>
<p>If you've set up a serialized cache, obviously clear that before test, and kill <code>$this-&gt;persistent-&gt;acl</code> with this <code>$this-&gt;session-&gt;destroy();</code>, I do not know another way to kill <code>persistent</code> data.</p>
<p>Some ACL links:</p>
<ul>
<li><a href="http://docs.phalcon.io/en/latest/reference/tutorial-invo.html#securing-the-backend">http://docs.phalcon.io/en/latest/reference/tutorial-invo.html#securing-the-backend</a></li>
<li><a href="http://docs.phalcon.io/en/latest/api/Phalcon_Acl.html">http://docs.phalcon.io/en/latest/api/Phalcon_Acl.html</a></li>
<li><a href="http://docs.phalcon.io/en/latest/api/Phalcon_Acl_Adapter_Memory.html">http://docs.phalcon.io/en/latest/api/Phalcon_Acl_Adapter_Memory.html</a></li>
</ul></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15048" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15048" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/88c20f295ea45b0801ec3c2ee9488ba1?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2826/MarcosJrBR" class="user-moderator-N"><span itemprop="name">Marcos Junior</span></a>        </span>
        <br>

        <span class="karma">18.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C15138" href="#C15138">
                <time itemprop="dateCreated" datetime="2015-01-21T04:12:51-07:00" class="action-date">Jan '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>It worked finally, all that was causing the problem was if the code where the function GETACL was inside.</p>
<blockquote>
<p>if (!isset($this-&gt;persistent-&gt;acl))</p>
</blockquote>
<p>Simply removing this snippet of code up as Edward Hew had recommended did all work perfectly in both PHP version I was testing.</p>
<p>I greatly appreciate the Edward Hew and RompePC the commitment to help solve this problem, is recorded here for if someone has the same problem in the future know how to troubleshoot quickly and easily.</p>
<p>Problem solved.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="15138" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="15138" data-cf-modified-6cc533a4770d6410cc0b38f2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="4502" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>