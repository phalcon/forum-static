---
layout: default
title: 'Accentuation Query - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Accentuation Query</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/1935/diogocavilha" class="user-moderator-N"><span itemprop="name">Diogo Alexsander Cavilha</span></a></span>
            <time itemprop="dateCreated" datetime="2018-12-03T07:01:21-07:00">Dec '18</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2018-12-03T07:01:21-07:00">Dec '18</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Dec '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>243</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/752faeec18cdeb480f13e0729dd37021?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/1935/diogocavilha" class="user-moderator-N"><span itemprop="name">Diogo Alexsander Cavilha</span></a></span>
                <span class="karma">519</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C19067" href="#C19067">
        <time class="action-date">Dec '18</time>
    </a>
</div>
<div class="post-content"><div><p>Hello, </p>
<p>I'm facing a problem when trying to search for a specific string. The problem is, in the database I have both strings, for example: <code>João</code> and <code>Joao</code>.</p>
<p>When I type <code>Joao</code> in the search field, it should return both strings: <code>João</code> and <code>Joao</code>. The same should happen if I typed <code>João</code>.</p>
<p>What I'm trying to do is ignoring the accentuation.</p>
<p>This is executed with <code>QueryBuilder</code> by running a <code>LIKE "%$term%"</code>.</p>
<p>I've already tried to use <code>LIKE "%$term%" collate utf8_general_ci</code> but it throws me an error.</p>
<p>By the way, the table collation is already set as <code>utf8_general_ci</code></p>
<p>Thank you in any advance.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="58027" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '18</span>
              </span><br/><a name="C58027" href="#C58027">
                <time itemprop="dateCreated" datetime="2018-12-03T08:02:53-07:00" class="action-date">Dec '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Make sure to pass in <code>utf8</code> as the charset when constructing the db adapter:</p>
<pre><code class="language-php">$connection = new \Phalcon\Db\Adapter\Pdo\Mysql(
    [
        'host'     =&gt; 'localhost',
        'username' =&gt; 'root',
        'password' =&gt; 'sigma',
        'dbname'   =&gt; 'test_db',
        'charset'  =&gt; 'utf8',
    ]
);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="58027" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="58027" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/752faeec18cdeb480f13e0729dd37021?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1935/diogocavilha" class="user-moderator-N"><span itemprop="name">Diogo Alexsander Cavilha</span></a>        </span>
        <br>

        <span class="karma">519</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C58027"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Lajos Bencz                    </a>
                </div><div class="posts-buttons" align="right"><a name="C58029" href="#C58029">
                <time itemprop="dateCreated" datetime="2018-12-03T08:20:05-07:00" class="action-date">Dec '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Make sure to pass in <code>utf8</code> as the charset when constructing the db adapter:</p>
<pre><code class="language-php">$connection = new \Phalcon\Db\Adapter\Pdo\Mysql(
   [
       'host'     =&gt; 'localhost',
       'username' =&gt; 'root',
       'password' =&gt; 'sigma',
       'dbname'   =&gt; 'test_db',
      'charset'  =&gt; 'utf8',
   ]
);</code></pre>
</blockquote>
<p>Yep, I've already did that. Even so, the problem persists.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="58029" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="58029" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C58033" href="#C58033">
                <time itemprop="dateCreated" datetime="2018-12-03T15:32:39-07:00" class="action-date">Dec '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Are you using raw SQL?  Can you show us the full query?</p>
<p>After some cursory searching, it seems changing the collation on the fly disables indexes, so your query could <em>really</em> slow down.  One common suggestion is to make a separate column in the table just for searching.  When saving, both <code>Joao</code> and <code>João</code> get converted to <code>Joao</code> and stored in that special &quot;search&quot; column.  This allows indexing to still work, greatly speeding up the query.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="58033" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="58033" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/752faeec18cdeb480f13e0729dd37021?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1935/diogocavilha" class="user-moderator-N"><span itemprop="name">Diogo Alexsander Cavilha</span></a>        </span>
        <br>

        <span class="karma">519</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C58033"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Dylan Anderson                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="58045" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '18</span>
              </span><br/><a name="C58045" href="#C58045">
                <time itemprop="dateCreated" datetime="2018-12-04T03:20:28-07:00" class="action-date">Dec '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Are you using raw SQL?  Can you show us the full query?</p>
<p>After some cursory searching, it seems changing the collation on the fly disables indexes, so your query could <em>really</em> slow down.  One common suggestion is to make a separate column in the table just for searching.  When saving, both <code>Joao</code> and <code>João</code> get converted to <code>Joao</code> and stored in that special &quot;search&quot; column.  This allows indexing to still work, greatly speeding up the query.</p>
</blockquote>
<p>Hi, Dylan.</p>
<p>No, I'm not using raw SQL, I'm using the Phalcon Query Builder object (<code>\Phalcon\Mvc\Model\Query\Builder</code>).</p>
<p>This is how I'm trying to mount the where clause:</p>
<pre><code>    private function getWhereClause(string $searchTerm): string
    {
        $subtaskTitle = htmlentities($searchTerm, ENT_QUOTES, "UTF-8", false);
        $subtaskTitleNoAccent = $this-&gt;removeAccent($subtaskTitle);

        $whereClause = [
            'DWTasks.id LIKE "%%%1$s%%"',
            'DWTasks.taskTitle LIKE "%%%1$s%%"',
            'DWTasks.taskTitle LIKE "%%%3$s%%"',
            'DWTasks.subtaskTitle LIKE "%%%2$s%%"',
            'DWTasks.subtaskTitle LIKE "%%%3$s%%"',
            'DWProject.clientName LIKE "%%%1$s%%"',
            'DWProject.projectTitle LIKE "%%%1$s%%"',
            'Status.name LIKE "%%%1$s%%"',
            'DWTasks.estimated LIKE "%%%1$s%%"',
            'DWTasks.worked LIKE "%%%1$s%%"',
            'DWProjectDocs.involveds LIKE "%%%1$s%%"',
            'DWTasks.item LIKE "%%%1$s%%"',
            'DATE_FORMAT(DWTasks.deadline, "%%d/%%m/%%Y %%H:%%i:%%s") LIKE "%%%1$s%%"',
        ];

        return sprintf(
            implode(' OR ', $whereClause),
            $searchTerm,
            $subtaskTitle,
            $subtaskTitleNoAccent
        );
    }</code></pre>
<p>That part of code is going to be used on the <code>$queryBuilder-&gt;where();</code>.</p>
<p>As you can see, I've had to implement a <code>removeAccent()</code> method because the query isn't working. The problem here is that this works when I search for <code>João</code>, because in this case I just need to remove the accents, but when I search for <code>Joao</code>, of course I would have to test plenty of possibilities of accents once I haven't got a clue if the word has accents or not.</p>
<p>Yes, I know, I'm not proud of that, but it was a partial workaround to the problem.</p>
<p>But, when I run a simple query directly in the database it works.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="58045" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="58045" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/752faeec18cdeb480f13e0729dd37021?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1935/diogocavilha" class="user-moderator-N"><span itemprop="name">Diogo Alexsander Cavilha</span></a>        </span>
        <br>

        <span class="karma">519</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C58047" href="#C58047">
                <time itemprop="dateCreated" datetime="2018-12-04T05:53:52-07:00" class="action-date">Dec '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Well, I've changed to PHQL and it's working now.</p>
<p>Thank you Dylan and Lajos.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="58047" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="58047" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="58049" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '18</span>
              </span><br/><a name="C58049" href="#C58049">
                <time itemprop="dateCreated" datetime="2018-12-04T06:14:45-07:00" class="action-date">Dec '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p><code>removeAccent</code> -&gt; are you sure you've covered every possible case out there? Systems which support such search are way complex than MySQL/MariaDB.</p>
<p>Also, with that many wildcarded <code>LIKE</code> I believe performance is just bad as hell with many rows. If possible you should use full text search syntax as DB engine will use indexes for sure then.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="58049" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="58049" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/752faeec18cdeb480f13e0729dd37021?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1935/diogocavilha" class="user-moderator-N"><span itemprop="name">Diogo Alexsander Cavilha</span></a>        </span>
        <br>

        <span class="karma">519</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C58049"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Jonathan Aaron Steel                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="58051" data-toggle="modal" data-target="#historyModal">
                edited <span>Dec '18</span>
              </span><br/><a name="C58051" href="#C58051">
                <time itemprop="dateCreated" datetime="2018-12-04T06:18:15-07:00" class="action-date">Dec '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Provide &quot;simple query&quot; which works for this scenario.
<code>removeAccent</code> -&gt; are you sure you've covered every possible case out there? Systems which support such search are way complex than MySQL/MariaDB.</p>
</blockquote>
<p>Hi, Jonathan.</p>
<p>Yes, the query is way simple now.</p>
<p>And yes, I've replaced that <code>removeAccent</code> for a more comlete package which does that.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="58051" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="58051" data-cf-modified-b2f10f6c1d664120ec8c1d74-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="19067" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>