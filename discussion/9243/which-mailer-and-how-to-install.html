---
layout: default
title: 'Which mailer and how to install - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/21/beginners">Beginners</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Which mailer and how to install</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a></span>
            <time itemprop="dateCreated" datetime="2015-10-30T13:56:28-07:00">Oct '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-10-30T13:56:28-07:00">Oct '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>1415</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/95593bdf7bc6c62dbd16767e520f13c8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a></span>
                <span class="karma">59.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C9243" href="#C9243">
        <time class="action-date">Oct '15</time>
    </a>
</div>
<div class="post-content"><div><p>Hi again,</p>
<p>i need a mailer, which can i use and how should i install it. Do someone has an idea for me.</p>
<p>Thank you in advance.</p>
<p>Rgds</p>
<p>Stefan</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="25517" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '15</span>
              </span><br/><a name="C25517" href="#C25517">
                <time itemprop="dateCreated" datetime="2015-10-30T14:01:46-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Use Swift Mailer: <a href="https://github.com/swiftmailer/swiftmailer">https://github.com/swiftmailer/swiftmailer</a></p>
<p>Put it anywhere you want in your application and then create service:</p>
<pre><code class="language-php">$di-&gt;set('mailer',function() use ($config) {
   include 'path to swift_required.php';
    $transport = Swift_SmtpTransport::newInstance($config-&gt;smtp-&gt;address,$config-&gt;smtp-&gt;port)
        -&gt;setUsername($config-&gt;smtp-&gt;username)
        -&gt;setPassword($config-&gt;smtp-&gt;password);
    $mailer = Swift_Mailer::newInstance($transport);
    return $mailer;
});</code></pre>
<p>Where $config is ini file with smtp username, password, address and port.</p>
<p>Also i STRONGLY RECOMMEND to sending emails using queue, benstalkd and crontab, especially if you have many mails and IMHO MUST if you send mails in foreach, not during response.</p>
<p>Here i wrote comment about using queue, beanstalkd and crontab for handling of mail sending:
<a href="https://forum.phalcon.io/discussion/9157/how-to-run-php-function-after-redirecting-user-to-another-page#C25513">https://forum.phalcon.io/discussion/9157/how-to-run-php-function-after-redirecting-user-to-another-page#C25513</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25517" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25517" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/95593bdf7bc6c62dbd16767e520f13c8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a>        </span>
        <br>

        <span class="karma">59.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C25519" href="#C25519">
                <time itemprop="dateCreated" datetime="2015-10-30T14:26:36-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Jurigag,</p>
<p>thank you for your answer, i will try it :-)</p>
<p>Rgds</p>
<p>Stefan</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25519" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25519" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/95593bdf7bc6c62dbd16767e520f13c8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a>        </span>
        <br>

        <span class="karma">59.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C25535" href="#C25535">
                <time itemprop="dateCreated" datetime="2015-10-31T15:46:47-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Jurigag,</p>
<p>i am sorry but i can't get it to run, here are my questions:</p>
<ol>
<li>How looks the config.ini?</li>
<li>How looks the directory structure?</li>
<li>Where do i implemet the MailTask?</li>
</ol>
<p>Please can you help me? </p>
<p>Rgds</p>
<p>Stefan</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25535" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25535" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C25537" href="#C25537">
                <time itemprop="dateCreated" datetime="2015-10-31T16:52:03-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><ol>
<li>
</li>
</ol>
<p>[smtp]
address = address of your mail server
port = port of your mail server
username = your username
password = your password</p>
<ol start="2">
<li>In my application config.ini is put in /app/config under root directory, swift_mailer library is put under /lib/swift, and services.php is put under /app/</li>
<li>You implement it in cli, i have implemented it in /cli/tasks under root directory, and cli boostrap file is under /cli/</li>
</ol>
<p>What problems you have ? Just write here your errors.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25537" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25537" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/95593bdf7bc6c62dbd16767e520f13c8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a>        </span>
        <br>

        <span class="karma">59.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="25553" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '15</span>
              </span><br/><a name="C25553" href="#C25553">
                <time itemprop="dateCreated" datetime="2015-11-01T09:57:54-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Jurigag,</p>
<p>thank you for your reply and your help :-)</p>
<p>I have problems to understand the general structure of the mailer code, in the past i used phpmailer with jquery ajax url.
Do i have my replace my bootstrap which i have used until now, or do i just have to replace some code? </p>
<p>This is my index bootstrap:</p>
<pre><code>&lt;?php

use Phalcon\Loader;
use Phalcon\Mvc\View;
use Phalcon\Mvc\Application;
use Phalcon\DI\FactoryDefault;
use Phalcon\Mvc\Url as UrlProvider;
use Phalcon\Db\Adapter\Pdo\Mysql as DbAdapter;
use Phalcon\Config\Adapter\Ini as ConfigIni;

try {

// Register an autoloader
$loader = new Loader();
$loader-&gt;registerDirs(array(
    '../app/frontend/controllers/',
    '../app/frontend/models/',
    '../app/frontend/config/'
))-&gt;register();

$loader-&gt;registerNamespaces(
  array(
  '../app/frontend/forms/'
 )
)-&gt;register();

// Create a DI
$di = new FactoryDefault();

// Setup the view component
$di-&gt;set('view', function(){
$view = new \Phalcon\Mvc\View();
$view-&gt;setViewsDir('../app/frontend/views/');

    $view-&gt;registerEngines(array(
        '.volt' =&gt; function($view, $di) {
        $volt = new \Phalcon\Mvc\View\Engine\Volt($view, $di);
        $volt-&gt;setOptions(array(
          'compiledPath' =&gt; '../app/compiled/',
          'stat' =&gt; true,
          'compileAlways' =&gt; true
        ));
        return $volt;
        }
    ));

return $view;
});

// Setup a base URI so that all generated URIs include the "tutorial" folder
$di-&gt;set('url', function(){
    $url = new UrlProvider();
    $url-&gt;setBaseUri('/projects/fletcher-phalcon/');
    return $url;
});

define('BASE_DIR', dirname(__DIR__));
define('APP_DIR', BASE_DIR . '/app');

$config = include APP_DIR . '/frontend/config/config.php';

$di-&gt;set('mailer',function() use ($config) {
    include 'vendor/swiftmailer/lib/swift_required.php';
    $transport = Swift_SmtpTransport::newInstance($config-&gt;smtp-&gt;address,$config-&gt;smtp-&gt;port)
        -&gt;setUsername($config-&gt;smtp-&gt;username)
        -&gt;setPassword($config-&gt;smtp-&gt;password);
    $mailer = Swift_Mailer::newInstance($transport);
    return $mailer;
});

define('VERSION', '1.0.0');
// Using the CLI factory default services container
$di = new Cli();
// Define path to application directory
defined('APPLICATION_PATH')
|| define('APPLICATION_PATH', realpath(dirname(__FILE__)));
/**
 * Register the autoloader and tell it to register the tasks directory
 */
$loader = new \Phalcon\Loader();
$loader-&gt;registerDirs(
array(
    APPLICATION_PATH . 'app/tasks'
)
);
// Loading your classes
$loader-&gt;register();
$config = new Ini(APPLICATION_PATH."/../app/config/config.ini");
// Create a console application
$console = new ConsoleApp();
$console-&gt;setDI($di);
$di-&gt;set('queue', function () {
$queue = new Beanstalk(
    array(
        'host' =&gt; '127.0.0.1',
        'port' =&gt; '11300'
    )
);
return $queue;
});
$di-&gt;set('mailLogger', function () {
$mailLogger = new Phalcon\Logger\Adapter\File(APPLICATION_PATH."/logs/mail-log-" . date('Y-m-d') . ".log");
return $mailLogger;
});
$di-&gt;set('mailer', function () use ($config) {
include APPLICATION_PATH.'/../lib/swift/swift_required.php';
$transport = Swift_SmtpTransport::newInstance($config-&gt;smtp-&gt;address, $config-&gt;smtp-&gt;port)
    -&gt;setUsername($config-&gt;smtp-&gt;username)
    -&gt;setPassword($config-&gt;smtp-&gt;password);
$mailer = Swift_Mailer::newInstance($transport);
return $mailer;
});
/**
 * Process the console arguments
 */
$arguments = array();
foreach($argv as $k =&gt; $arg) {
if($k == 1) {
    $arguments['task'] = $arg;
} elseif($k == 2) {
    $arguments['action'] = $arg;
} elseif($k &gt;= 3) {
    $arguments['params'][] = $arg;
}
}
// Define global constants for the current task and action
define('CURRENT_TASK', (isset($argv[1]) ? $argv[1] : null));
define('CURRENT_ACTION', (isset($argv[2]) ? $argv[2] : null));

// Handle the request
$application = new Application($di);

echo $application-&gt;handle()-&gt;getContent();

} catch (\Exception $e) {
 echo "PhalconException: ", $e-&gt;getMessage();
}</code></pre>
<p>In app/tasks i have set the MailTask.php, which can't be loaded and the variable $argv  is undefined. Or ist he cli bootstrap seperatedf rom the index bootstrap?</p>
<p>Thx again Jurigag</p>
<p>Rgds</p>
<p>Stefan</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25553" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25553" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C25651" href="#C25651">
                <time itemprop="dateCreated" datetime="2015-11-02T08:20:39-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>CLI boostrap is Command Line Interface Boostrap - for command line application. You have 2 boostrap files - one for cli app, one for normal app, you can place mailer in both, but you should sending mails only by cli using queue, tasks and cron.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25651" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25651" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/95593bdf7bc6c62dbd16767e520f13c8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a>        </span>
        <br>

        <span class="karma">59.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="25721" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '15</span>
              </span><br/><a name="C25721" href="#C25721">
                <time itemprop="dateCreated" datetime="2015-11-03T14:09:43-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Jurigag,</p>
<p>now i have this exception: PhalconException: CliController handler class cannot be loaded, how looks my  form action /cli/task/send?</p>
<p>This is my Directory structure:</p>
<pre><code>/app
 /frontend
  /config
   config.ini
   services.php
/cli
 /task
   index.php
 index.php
/lib
  swift_required.php
/public</code></pre>
<p>config.ini</p>
<pre><code> [smpt]
 address = 'xxxxx'
 port = xxxxx
 security = 'xxxxx',
 username = 'xxxxx',
 password = 'xxxxx'</code></pre>
<p>Cli index.php</p>
<pre><code>&lt;?php
use Phalcon\CLI\Console as ConsoleApp;
use Phalcon\Config\Adapter\Ini;
use Phalcon\Di\FactoryDefault\Cli;
use Phalcon\Logger;
use Phalcon\Mvc\Model\Manager;
use Phalcon\Queue\Beanstalk;

define('VERSION', '1.0.0');
// Using the CLI factory default services container
$di = new Cli();
// Define path to application directory
defined('APPLICATION_PATH')
|| define('APPLICATION_PATH', realpath(dirname(__FILE__)));
/**
* Register the autoloader and tell it to register the tasks directory
 */
$loader = new \Phalcon\Loader();
$loader-&gt;registerDirs(
array(
    APPLICATION_PATH . 'cli/task/'
)
);
// Loading your classes
$loader-&gt;register();  
$config = new Ini(APPLICATION_PATH."/../app/frontend/config/config.ini");
// Create a console application
$console = new ConsoleApp();
$console-&gt;setDI($di);
$di-&gt;set('queue', function () {
$queue = new Beanstalk(
    array(
        'host' =&gt; '127.0.0.1',
        'port' =&gt; '11300'
    )
);
return $queue;
});
$di-&gt;set('mailLogger', function () {
$mailLogger = new Phalcon\Logger\Adapter\File(APPLICATION_PATH."/logs/mail-log-" . date('Y-m-d') .       ".log");
return $mailLogger;
});
$di-&gt;set('mailer', function () use ($config) {
include APPLICATION_PATH.'/../lib/swift/swift_required.php';
$transport = Swift_SmtpTransport::newInstance($config-&gt;smtp-&gt;address, $config-&gt;smtp-&gt;port)
    -&gt;setUsername($config-&gt;smtp-&gt;username)
    -&gt;setPassword($config-&gt;smtp-&gt;password);
$mailer = Swift_Mailer::newInstance($transport);
return $mailer;
});

$arguments = array();
foreach($argv as $k =&gt; $arg) {
if($k == 1) {
    $arguments['task'] = $arg;
} elseif($k == 2) {
    $arguments['action'] = $arg;
} elseif($k &gt;= 3) {
    $arguments['params'][] = $arg;
}
}
// Define global constants for the current task and action
define('CURRENT_TASK', (isset($argv[1]) ? $argv[1] : null));
define('CURRENT_ACTION', (isset($argv[2]) ? $argv[2] : null));
try {
// Handle incoming arguments
$console-&gt;handle($arguments);
} catch(\Phalcon\Exception $e) {
echo $e-&gt;getMessage();
exit(255);
}</code></pre>
<p>task index.php</p>
<pre><code>  require __DIR__ . '/../../lib/swift_required.php';

        class Mail extends Phalcon\Mvc\User\Component {
            protected $_transport;

            public function send($to, $subject, $name, $params) {
                $config = new Phalcon\Config\Adapter\Ini(__DIR__ . '/../../config/config.ini');
                $mailConfig = $config-&gt;mail;

                $template = $this-&gt;getTemplate($name, $params);
                // Create the message
                $message = Swift_Message::newInstance()
                    -&gt;setSubject($subject)
                    -&gt;setTo($to)
                    -&gt;setFrom(array(
                        $mailConfig-&gt;fromEmail =&gt; $mailConfig-&gt;fromName
                    ))
                    -&gt;setBody($template, 'text/html');
                if (!$this-&gt;_transport) {
                    $this-&gt;_transport = Swift_SmtpTransport::newInstance(
                        $mailConfig-&gt;smtpServer,
                        $mailConfig-&gt;smtpPort,
                        $mailConfig-&gt;smtpSecurity
                    )
                        -&gt;setUsername($mailConfig-&gt;smtpUsername)
                        -&gt;setPassword($mailConfig-&gt;smtpPassword);
                }
                // Create the Mailer using your created Transport
                $mailer = Swift_Mailer::newInstance($this-&gt;_transport);
                $mailer-&gt;send($message);

            }
            public function getTemplate($name, $params) {
                $parameters = array_merge(array(
                    'publicUrl' =&gt; "website.com",
                ), $params);
                return $this-&gt;view-&gt;getRender('emailTemplates', $name, $parameters, function($view){
                    $view-&gt;setRenderLevel(View::LEVEL_LAYOUT);
                });
                return $view-&gt;getContent();
            }
        }</code></pre>
<p>Do you have somewhere an live example?</p>
<p>Thx again Jurigag</p>
<p>Rgds</p>
<p>Stefan</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25721" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25721" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C25725" href="#C25725">
                <time itemprop="dateCreated" datetime="2015-11-03T15:18:32-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>But whats is clicontroller ? Where are you calling it ? From command line ? There are no such a thing as clicontroller in cli application. Task code is pretty simple:</p>
<pre><code class="language-php">&lt;?php
use Phalcon\Cli\Task;
use Phalcon\Logger\Adapter\File;
use Phalcon\Queue\Beanstalk;

/**
 * Created by PhpStorm.
 * User: User
 * Date: 30.09.15
 * Time: 13:04
 */
class MailTask extends Task
{
    /**
     * @var Beanstalk
     */
    protected $queue;
    /**
     * @var Swift_Mailer
     */
    protected $mailer;
    /**
     * @var File
     */
    protected $mailLogger;

    public function initialize()
    {
        $this-&gt;queue = $this-&gt;di-&gt;get('queue');
        $this-&gt;mailer = $this-&gt;di-&gt;get('mailer');
        $this-&gt;mailLogger = $this-&gt;di-&gt;get('mailLogger');
    }

    public function sendAction()
    {
        $this-&gt;queue-&gt;watch('mail');
        while ($this-&gt;queue-&gt;stats()["current-jobs-ready"] &gt; 0 &amp;&amp; ($job = $this-&gt;queue-&gt;reserve())) {

            $message=$job-&gt;getBody()['mail'];
            if($this-&gt;mailer-&gt;send($message)){
                $this-&gt;mailLogger-&gt;info(PHP_EOL."Mail Sended: ".PHP_EOL.
                "Subject: ".$message-&gt;getSubject().PHP_EOL.
                "To: ".json_encode($message-&gt;getTo()).PHP_EOL.
                "Reply To: ".json_encode($message-&gt;getReplyTo()).PHP_EOL.
                "From: ".json_encode($message-&gt;getFrom()).PHP_EOL.
                "=======================================================");
            }
            else{
                $this-&gt;mailLogger-&gt;error(PHP_EOL."Mail Failed: ".PHP_EOL.
                    "Subject: ".$message-&gt;getSubject().PHP_EOL.
                    "To: ".json_encode($message-&gt;getTo()).PHP_EOL.
                    "Reply To: ".json_encode($message-&gt;getReplyTo()).PHP_EOL.
                    "From: ".json_encode($message-&gt;getFrom()).PHP_EOL.
                    "=======================================================");
            };

            $job-&gt;delete();
        }
    }
}</code></pre>
<p>Your Mail should extends Task, not component. And somwhere in app you are rendering view, setting where to send from who etc, just prepare whole email, putting to queue and let your task only to just send it - cuz it cost a most of time.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25725" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25725" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/95593bdf7bc6c62dbd16767e520f13c8?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2249/Stefjoe" class="user-moderator-N"><span itemprop="name">Stefjoe</span></a>        </span>
        <br>

        <span class="karma">59.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C25785" href="#C25785">
                <time itemprop="dateCreated" datetime="2015-11-04T12:50:06-07:00" class="action-date">Nov '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Jurigag,</p>
<p>thank you so much for your help, but i will try something else. I can't get it run and i  don't  really understand this structure.</p>
<p>Wish you the best.</p>
<p>Rgds</p>
<p>Stefan</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="25785" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="25785" data-cf-modified-c2f62f6aca2dc5a970ee59f4-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="9243" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>