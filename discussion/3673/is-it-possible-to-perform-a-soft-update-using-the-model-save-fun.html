---
layout: default
title: 'Is it possible to perform a &quot;soft update&quot; using the model save() function - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Is it possible to perform a &quot;soft update&quot; using the model save() function</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/2119/NetbearSoftware" class="user-moderator-N"><span itemprop="name">Tim Mohr</span></a></span>
            <time itemprop="dateCreated" datetime="2014-10-13T03:33:43-07:00">Oct '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-10-13T03:33:43-07:00">Oct '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Oct '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">5</span>
                </td>
                <td>
                    <label>Views</label><br>1394</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/f41b7f0b8344e9963c6da2afb437566c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/2119/NetbearSoftware" class="user-moderator-N"><span itemprop="name">Tim Mohr</span></a></span>
                <span class="karma">13.7k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C3673" href="#C3673">
        <time class="action-date">Oct '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hello,</p>
<p>I have been developing an application using Phalcon models and it works great.</p>
<p>However there are a few situations where I need to use the save() function without overwriting certain fields on update operations. For example if I have a table with the columns:</p>
<blockquote>
<p>id, name, age</p>
<p>1, bob, 20</p>
<p>2, anna, 28,</p>
<p>3, tracey, 37</p>
</blockquote>
<p>Now if I perform an update, without specifing the name anna:</p>
<blockquote>
<p>2, , 29</p>
</blockquote>
<p>It overwrites anna with nothing and I've destroyed the record...</p>
<p>Obviously this is an extremely simple example. I have real tables with &gt;25 fields which I need to update maybe only half of them in certain controllers.</p>
<p>Making an initial database call to retrieve the record is too expensive in my opinion and therefore not an option.</p>
<p>I hope I'm missing something obvious.</p>
<p>Tim</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-797afc99120b4e80df10917e-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-797afc99120b4e80df10917e-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bdee79ea2680ec179fa34b9201fc74b7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1873/RompePC" class="user-moderator-N"><span itemprop="name">RompePC</span></a>        </span>
        <br>

        <span class="karma">33.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12148" href="#C12148">
                <time itemprop="dateCreated" datetime="2014-10-13T04:16:57-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>I hope I'm missing something obvious.</p>
</blockquote>
<p>Yeah, I think you're right. In your model <code>initialize()</code> function, code this:</p>
<pre><code>$this-&gt;useDynamicUpdate(true);</code></pre>
<p>This will only update your record fields that had changed (I think this is what you want). Then, when you change the value of <code>$record-&gt;property</code>, it will only update that field.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12148" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12148" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f41b7f0b8344e9963c6da2afb437566c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2119/NetbearSoftware" class="user-moderator-N"><span itemprop="name">Tim Mohr</span></a>        </span>
        <br>

        <span class="karma">13.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12151" href="#C12151">
                <time itemprop="dateCreated" datetime="2014-10-13T12:19:49-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for the suggestion.</p>
<p>I forgot to mention that I had already tried <code>$this-&gt;useDynamicUpdate()</code>, but unfortunately it makes no difference.</p>
<p>I just tested again to be sure but when I set <code>$this-&gt;useDynamicUpdate(true);</code> in my model, then comment out some <code>$record-&gt;property</code> fields in my save function, the fields I just commented out still get blasted away.</p>
<p>I'm using Phalcon 1.3.2... Could that be the problem?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12151" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12151" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ac092c450c8eb55b187c4b63af35daee?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2415/sventunus" class="user-moderator-N"><span itemprop="name">sventunus</span></a>        </span>
        <br>

        <span class="karma">3.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="12158" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '14</span>
              </span><br/><a name="C12158" href="#C12158">
                <time itemprop="dateCreated" datetime="2014-10-13T17:49:40-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You're looking to hook in to the 'beforeUpdate' event on a model.</p>
<pre><code class="language-php">&lt;?php

use Phalcon\Mvc\Model,
    Phalcon\Events\Manager as EventsManager;

class Robots extends Model
{
    public function initialize()
    {
        $eventsManager = new EventsManager();

        //Attach an anonymous function as a listener for "model" events
        $eventsManager-&gt;attach('model', function($event, $robot) {
            if ($event-&gt;getType() == 'beforeUpdate') {
                if (!$robot-&gt;someProperty) {
                    // skip property update;
                }
            }
            return true;
        });

        //Attach the events manager to the event
        $this-&gt;setEventsManager($eventsManager);
    }
}</code></pre>
<p>Check the docs at <a href="https://docs.phalcon.io/en/latest/reference/models.html#events-and-events-manager">https://docs.phalcon.io/en/latest/reference/models.html#events-and-events-manager</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12158" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12158" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f41b7f0b8344e9963c6da2afb437566c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2119/NetbearSoftware" class="user-moderator-N"><span itemprop="name">Tim Mohr</span></a>        </span>
        <br>

        <span class="karma">13.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12159" href="#C12159">
                <time itemprop="dateCreated" datetime="2014-10-13T18:00:56-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for the suggestion!</p>
<p>I have thought about doing this as well, but doesn't this restrict my options for updating the model globally??</p>
<p>I still need to update all the fields, just not all in the same action.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12159" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12159" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ac092c450c8eb55b187c4b63af35daee?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2415/sventunus" class="user-moderator-N"><span itemprop="name">sventunus</span></a>        </span>
        <br>

        <span class="karma">3.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12161" href="#C12161">
                <time itemprop="dateCreated" datetime="2014-10-13T18:06:33-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I don't see how?
You could just loop over the fields in a key=&gt;value construct, and only update those fields that have a value.
Or you could implement &quot;dirty&quot; flags on your models to flag which properties have been modified, and then only update the values for those properties &amp; persist them to your DB.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12161" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12161" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f41b7f0b8344e9963c6da2afb437566c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2119/NetbearSoftware" class="user-moderator-N"><span itemprop="name">Tim Mohr</span></a>        </span>
        <br>

        <span class="karma">13.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12166" href="#C12166">
                <time itemprop="dateCreated" datetime="2014-10-13T20:36:27-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ok I think I understand what you mean although I'm still not sure it is going to work because...</p>
<p>When I look at the  $robot object in the 'beforeSave' I only see the fields that I've specified in the save() call within the controller... However ALL the fields are still being fried in the table. So even if I override the fields in a key =&gt; value construct I think it is still going to overwrite the other values that I can't catch.</p>
<p>Is there any other documentation or examples I could look at?</p>
<p>Thanks for your help either way... I'm surprised this isn't a bit more built in to Phalcon.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12166" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12166" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ac092c450c8eb55b187c4b63af35daee?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2415/sventunus" class="user-moderator-N"><span itemprop="name">sventunus</span></a>        </span>
        <br>

        <span class="karma">3.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12171" href="#C12171">
                <time itemprop="dateCreated" datetime="2014-10-14T00:13:17-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I'm not quite sure I'm still following you...
Are you trying to save an update to an object with unknown (runtime)
properties in your controller?
If not, then what is the reason that you can't &quot;catch&quot; the values for
your object's properties?</p>
<p>Maybe it would help if you posted a code example of what you're trying
to accomplish.</p>
<p>On 14/10/2014 5:36, Tim Mohr wrote:</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12171" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12171" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f41b7f0b8344e9963c6da2afb437566c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2119/NetbearSoftware" class="user-moderator-N"><span itemprop="name">Tim Mohr</span></a>        </span>
        <br>

        <span class="karma">13.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12173" href="#C12173">
                <time itemprop="dateCreated" datetime="2014-10-14T01:44:03-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Sventunus,</p>
<p>Sorry, I'm not being very clear because I've spent so long on this problem, I think I've confused myself.</p>
<p>So I want to only update the fields in the DB that I present to the ORM in the save() function.</p>
<p>In my controller I'm testing for user variable values like this:</p>
<pre><code>if(isset($progress)) {
            $task-&gt;setProgress($progress);
        }
$result = $task-&gt;save();</code></pre>
<p>Then in the model I have your example code:</p>
<pre><code>        $eventsManager = new EventsManager();

        //Attach an anonymous function as a listener for "model" events
        $eventsManager-&gt;attach('model', function($event, $object) {
                if ($event-&gt;getType() == 'beforeSave') {
                    foreach($object as $key =&gt; $value) {
                        // Update database here???
                    }
                }
                return true;
            });

        //Attach the events manager to the event
        $this-&gt;setEventsManager($eventsManager);</code></pre>
<p>I don't understand how to push all the keys/values to the DB. Seeing as only the keys and values that I set in the save() appear in the <code>beforeSave</code> function I want to update everything in this object.</p>
<p>Parallel to that I still don't understand why I even have to do this in the first place. I'm only giving the save() function the &quot;fields&quot; I want to update. Why does it overwrite everything else in the process?</p>
<p>Does this make any sense?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12173" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12173" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/ac092c450c8eb55b187c4b63af35daee?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2415/sventunus" class="user-moderator-N"><span itemprop="name">sventunus</span></a>        </span>
        <br>

        <span class="karma">3.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12344" href="#C12344">
                <time itemprop="dateCreated" datetime="2014-10-19T14:29:29-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Tim,</p>
<p>It makes alot of sense, yes!
I'll see if I can make some time this week to set up a test case for your use case (shouldn't take me more than 10 minutes or so, but even those or hard to find :-/). I think your case is a valid one, because I recon having seen other similar questions here on the board that suggest the same problem.
I'll get back on this one, promised!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12344" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12344" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f41b7f0b8344e9963c6da2afb437566c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2119/NetbearSoftware" class="user-moderator-N"><span itemprop="name">Tim Mohr</span></a>        </span>
        <br>

        <span class="karma">13.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="12347" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '14</span>
              </span><br/><a name="C12347" href="#C12347">
                <time itemprop="dateCreated" datetime="2014-10-19T18:19:54-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Sventunus,</p>
<p>Thank-you very much for getting back to me.</p>
<p>I really appreciate any time you can put into this!</p>
<p>Tim</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12347" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12347" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f41b7f0b8344e9963c6da2afb437566c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/2119/NetbearSoftware" class="user-moderator-N"><span itemprop="name">Tim Mohr</span></a>        </span>
        <br>

        <span class="karma">13.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C12636" href="#C12636">
                <time itemprop="dateCreated" datetime="2014-10-28T14:29:36-07:00" class="action-date">Oct '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi Sventunus,</p>
<p>Do you have any idea when you might get a chance to look at this?</p>
<p>Tim</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="12636" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="12636" data-cf-modified-797afc99120b4e80df10917e-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="3673" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>