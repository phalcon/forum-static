---
layout: default
title: 'Csrf [SOLVED] - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/16/security">Security</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Csrf [SOLVED]</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/291/xAockd" class="user-moderator-N"><span itemprop="name">xAockd</span></a></span>
            <time itemprop="dateCreated" datetime="2013-07-09T11:30:38-07:00">Jul '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-07-09T11:30:38-07:00">Jul '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Feb '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">5</span>
                </td>
                <td>
                    <label>Views</label><br>3190</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">3</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/17d9dd52719635af7876594159222a45?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/291/xAockd" class="user-moderator-N"><span itemprop="name">xAockd</span></a></span>
                <span class="karma">11.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C555" href="#C555">
        <time class="action-date">Jul '13</time>
    </a>
</div>
<div class="post-content"><div><p>How to correctly use crsf?</p>
<pre><code class="language-php">        $csrf = new Hidden('csrf',
            array(
            'name' =&gt; $this-&gt;security-&gt;getTokenKey(),
            'value' =&gt; $this-&gt;security-&gt;getToken(),
        ));
        $csrf-&gt;addValidator(
            new Identical(array(
                'value' =&gt; $this-&gt;security-&gt;getSessionToken(),
                'message' =&gt; 'CSRF validation failed'
            ))
        );
        $this-&gt;add($csrf);</code></pre>
<p>OR</p>
<pre><code class="language-php"> $csrf = new Hidden('csrf',
            array(
            'value' =&gt; $this-&gt;security-&gt;getSessionToken(),
        ));
        $csrf-&gt;addValidator(
            new Identical(array(
                'value' =&gt; $this-&gt;security-&gt;getSessionToken(),
                'message' =&gt; 'CSRF validation failed'
            ))
        );
        $this-&gt;add($csrf);</code></pre></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-f35f1f826ae524fbf947642d-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-f35f1f826ae524fbf947642d-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">3</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0a4893b2103244c9dfdb6b83dd334d78?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/66/arantir" class="user-moderator-N"><span itemprop="name">arantir</span></a>        </span>
        <br>

        <span class="karma">32.4k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2288" href="#C2288">
                <time itemprop="dateCreated" datetime="2013-07-09T15:34:50-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Actually, using only the value is enough secure for the most of cases. A token live only between two requests. So a hacker can only one attempt to guess. It's just impossible, even without a random name. But... if someone even amazingly guess it once... you can be sure such event will not repeat for the next septillion years...</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2288" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2288" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8fcad302d31f7f007b93f0395701e112?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/56/jeffreycahyono" class="user-moderator-N"><span itemprop="name">jeffreycahyono</span></a>        </span>
        <br>

        <span class="karma">27.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2294" href="#C2294">
                <time itemprop="dateCreated" datetime="2013-07-09T22:18:18-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>getToken and getTokenKey will (re)generate new hash in the session, whereas getSessionToken only get the hash value from the session. So, you should use getToken for the newly created form, and getSessionToken for checking. Please check the Vokuro example.
I also use csrf for preventing users to double submit the form.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2294" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2294" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/17d9dd52719635af7876594159222a45?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/291/xAockd" class="user-moderator-N"><span itemprop="name">xAockd</span></a>        </span>
        <br>

        <span class="karma">11.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2317" href="#C2317">
                <time itemprop="dateCreated" datetime="2013-07-10T07:34:22-07:00" class="action-date">Jul '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thank you all =)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2317" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2317" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d8ff73fe4bdd5a3bf4c6f15ab6503ced?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1055/avra911" class="user-moderator-N"><span itemprop="name">avra911</span></a>        </span>
        <br>

        <span class="karma">785</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5620" href="#C5620">
                <time itemprop="dateCreated" datetime="2014-02-22T02:58:11-07:00" class="action-date">Feb '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi,</p>
<p>I have a strange behavior with Csrf. On Safari and Firefox the first attempt fails, than it works every time after first fail (or after refresh the page).
However on Chrome it does not work, never.</p>
<p>I printed out the post form and the session token:</p>
<p>firefox: 'ylzSyttP6UPUAGT' =&gt; string '27a71405a83b9fb24ec2e0de82176c79' (length=32) vs string '27a71405a83b9fb24ec2e0de82176c79' (length=32)
chrome:   'tcUnmPBQ1HHIYmhv' =&gt; string '4cd119033e49ae97e15cc1ff8fae7fe9' (length=32) vs string 'ab02ca662e82d4847b01a7c7bc229bb5' (length=32)</p>
<p>Any help will be appreciate!
Thanks,
R</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5620" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5620" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5621" href="#C5621">
                <time itemprop="dateCreated" datetime="2014-02-22T03:37:48-07:00" class="action-date">Feb '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Phalcon has such behavior:
you can use any form on your page ( often use a whole herd of modal windows )
Tokens for each form are generated and stored in session.
Thus you can check last token generated, and last only.
The rest of the behavior subject to the rules of sessions PHP</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5621" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5621" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/d8ff73fe4bdd5a3bf4c6f15ab6503ced?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1055/avra911" class="user-moderator-N"><span itemprop="name">avra911</span></a>        </span>
        <br>

        <span class="karma">785</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5623" href="#C5623">
                <time itemprop="dateCreated" datetime="2014-02-22T12:32:30-07:00" class="action-date">Feb '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>here is the full code with the issue, i left there the var_dump: <a href="https://github.com/avra911/test.phalcon/tree/master/app">https://github.com/avra911/test.phalcon/tree/master/app</a></p>
<p>maybe with the code somebody can figured out what is wrong and i repeat this is happening every time on chrome, not firefox :-|</p>
<p>after searching the forum i found <a href="http://forum.phalcon.io/discussion/922/csrf-protection-not-working#C3567">http://forum.phalcon.io/discussion/922/csrf-protection-not-working#C3567</a> which is exactly the same issue. it looks like csrf has a strange behavior on index/index.</p>
<p>i need to thanks,<a href="https://forum.phalcon.io/user/0/Max"> @Max</a> Castro (changing &quot;/&quot; route to something different than index/index worked perfectly)</p>
<p>thanks</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5623" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5623" data-cf-modified-f35f1f826ae524fbf947642d-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="555" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>