---
layout: default
title: 'CSRF validation failed - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/5/general">General</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">CSRF validation failed</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a></span>
            <time itemprop="dateCreated" datetime="2013-10-28T00:01:22-07:00">Oct '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-10-28T00:01:22-07:00">Oct '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">21</span>
                </td>
                <td>
                    <label>Views</label><br>1965</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">3</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a></span>
                <span class="karma">42.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C1091" href="#C1091">
        <time class="action-date">Oct '13</time>
    </a>
</div>
<div class="post-content"><div><p>Hello everyone.
There was a CSRF validation failed
Everything works fine if I do not use plug-in
service.php</p>
<pre><code class="language-php">/**
 * Dispatcher use a default namespace
 */
$di-&gt;set('dispatcher', function() use ($di) {
    $eventsManager = $di-&gt;getShared('eventsManager');

    $security = new Security($di);

    /**
     * We listen for events in the dispatcher using the Security plugin
     */
    $eventsManager-&gt;attach('dispatch', $security);

    $dispatcher = new Dispatcher();
    $dispatcher-&gt;setEventsManager($eventsManager);
    $dispatcher-&gt;setDefaultNamespace('EasyPay\Controllers');

    return $dispatcher;
});</code></pre>
<p>Security.php</p>
<pre><code class="language-php">/**
 * This action is executed before execute any action in the application
 */
public function beforeDispatch(Event $event, Dispatcher $dispatcher)
{
    $auth = $this-&gt;session-&gt;get('auth-identity');

    if (!$auth) {
        if ($dispatcher-&gt;getControllerName() != 'session') {
            $dispatcher-&gt;forward(array(
                'controller' =&gt; 'session',
                'action' =&gt; 'login'
            ));

            return false;
        }
    }
}</code></pre></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-92be7d5898b1eaa029df5978-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-92be7d5898b1eaa029df5978-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">3</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4026" href="#C4026">
                <time itemprop="dateCreated" datetime="2013-10-28T02:00:24-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>LoginForm.php</p>
<pre><code class="language-php">...
//CSRF
$csrf = new Hidden('csrf');

$csrf-&gt;addValidator(
    new Identical(array(
        'value' =&gt; $this-&gt;security-&gt;getSessionToken(),
        'message' =&gt; 'CSRF validation failed'
    ))
);

$this-&gt;add($csrf);</code></pre>
<p>login.volt</p>
<pre><code class="language-php">...
{% raw %}{{{% endraw %} form.render('csrf', ['value': security.getToken()]) {% raw %}}}{% endraw %}</code></pre>
<p>When you open the login page in the value field 'csfr' is not equal to what is in session</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4026" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4026" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4027" href="#C4027">
                <time itemprop="dateCreated" datetime="2013-10-28T02:27:36-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Your generated html code of form must contain CSRF string like</p>
<pre><code class="language-php">&lt;input type="hidden" name="ReJLqVYMXeHVieg9" value="c3b71a6ca4e79b35257b614684705bc8"/&gt;</code></pre>
<p>This string generated from code like</p>
<pre><code class="language-php">&lt;input type="hidden" name="&lt;?php echo $this-&gt;security-&gt;getTokenKey() ?&gt;" value="&lt;?php echo $this-&gt;security-&gt;getToken() ?&gt;"/&gt;</code></pre>
<p>You may to put to your form view 2 elemets :
1) name of hidden csrf field by <code>php getTokenKey()</code>
2) and value of token by <code>php getToken()</code></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4027" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4027" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4029" href="#C4029">
                <time itemprop="dateCreated" datetime="2013-10-28T02:34:57-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Alas, it did not solve my problem</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4029" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4029" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4030" href="#C4030">
                <time itemprop="dateCreated" datetime="2013-10-28T02:44:24-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The problem remains the same. After sending the post data $this-&gt;security-&gt;getSessionToken() returns a different value, not what's in the hidden field.
Note that this problem only occurs when running plugin.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4030" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4030" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4031" href="#C4031">
                <time itemprop="dateCreated" datetime="2013-10-28T04:17:40-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Quote:</p>
<pre><code class="language-php">/*
* LoginForm.php
*/
$csrf = new Hidden('csrf');</code></pre>
<p>Try replace this to </p>
<pre><code class="language-php">
$csrf = new Hidden(array(
     'name'    =&gt; $this-&gt;security-&gt;getTokenKey(),
     'value'    =&gt; $this-&gt;security-&gt;getToken(),
));```
Meaning - 
when Security class initializing csrf token, this token is writing to session in special name, that generated once in session by Security class ( function getTokenKey ).
That is session not have key 'csrf' with Token, but have key with name Security-&gt;getTokenKey() generated and with value Security-&gt;getToken()
Call var_dump of $_SESSION and you see.
You use key 'csrf' - this is erroneous decision.
And note for the html code that is generated, you may see input hidden with generic name and value from Security class.</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4031" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4031" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4042" href="#C4042">
                <time itemprop="dateCreated" datetime="2013-10-28T11:58:49-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>//Олег Вы говорите по русски?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4042" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4042" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4044" href="#C4044">
                <time itemprop="dateCreated" datetime="2013-10-28T13:51:53-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Да.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4044" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4044" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4045" href="#C4045">
                <time itemprop="dateCreated" datetime="2013-10-28T20:39:23-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Олег я сделал как Вы рекомендовали. Все равно в сессиях каким-то образом записывается другой хеш, нежели тот что в хайден поле. Заметьте что это только если я использую свой плагин, т.е. без этого плагина все прекрасно работает. Что-то с этими событиями диспетчера.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4045" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4045" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4046" href="#C4046">
                <time itemprop="dateCreated" datetime="2013-10-29T00:25:47-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>1) Я не понимаю, зачем в service.php вы создаете новый security объект и никуда его не возвращаете. Security - это самостоятельный сервис, к тому же автомаnически инициализируется. Переназначение нужно только для изменения пераметров.
2) Зачем проверять csrf формы в beforeDispatch?
Достаточно в действии контроллера проверить </p>
<pre><code class="language-php">if ( $this-&gt;request-&gt;isPost() &amp;&amp; $this-&gt;security-&gt;checkToken() ) {
...
}</code></pre>
<p>3) Попробуйте сделать поле csrf  в форме напрямую (см. выше), и в принимающем действии отследите входные данные запроса и данные сессии.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4046" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4046" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4047" href="#C4047">
                <time itemprop="dateCreated" datetime="2013-10-29T01:13:56-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Мой Sercurity класс это не совсем тот о котором Вы говорите. Речь идет о <a href="https://docs.phalcon.io/en/latest/reference/tutorial-invo.html#events-management">https://docs.phalcon.io/en/latest/reference/tutorial-invo.html#events-management</a> Задача состоит в том, чтобы защитить приложение от не авторизованных пользователей.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4047" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4047" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4048" href="#C4048">
                <time itemprop="dateCreated" datetime="2013-10-29T01:55:03-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Я делаю приложения всегда мультимодульные, так уж получилось. Да и не вижу смысла в другом. Все равно есть бэкенд и фронтенд. Ну вот у себя мне нужно закрыть один модуль. В нем есть фронтенд контроллер и контроллер пользоватлей. В последнем, при логировании пользователя я в форму включаю csrf тем способом, который описал вам выше. При успешном логировании я инициализирую сессию </p>
<pre><code class="language-php">public function loginAction() {
      ....
    if ( $this-&gt;request-&gt;isPost() &amp;&amp; $this-&gt;security-&gt;checkToken() ) {
   //if user ok   
            $this-&gt;_registerSession($user);
}</code></pre>
<pre><code class="language-php">private function _registerSession($user) {
    $this-&gt;session-&gt;set('auth', [
          'id' =&gt; $user-&gt;id,
          'name' =&gt; $user-&gt;name,
          ]);
  }</code></pre>
<p>Далее, в защищаемом контроллере я использую</p>
<pre><code class="language-php">
public function beforeExecuteRoute($dispatcher) {
    $auth = $this-&gt;session-&gt;get('auth');
    ....
}
...

Б.... , я кажется понял вашу ошибку. Вы пытаетесь опереться на данные сессии в части генерируемого csrf, может быть. Но здесь есть одно НО. При каждом запросе данные csrf сессии генерируются заново и никогда не будут совпадать с сохраненным значением. В этом смысл csrf защиты.
Т.е. по запросу мы выводим форму  - в нее генерируется поле csrf и заносится в сессию. При обработке формы мы проверяем токен при помощи функции checkToken().
Т.е. если вы будете проверять сессию по генерируемому csrf, то при каждом запросе получите новые данные.
Вот как-то так. Насколько я увидел, в INVO приблизительно также решается этот вопрос.</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4048" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4048" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4050" href="#C4050">
                <time itemprop="dateCreated" datetime="2013-10-29T02:23:48-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>У меня не мультимодульное приложение, и я хочу контролировать доступ пользователей в одном месте, поэтому я использую плагин Security. Проблема в том, что когда я его использую, валидация csfr не проходит. Без плагина все работает нормально (оба варианта, мой и Ваш). Таже проблема и с ControllerBase с его методом beforeExecuteRoute. Что же здесь не так?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4050" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4050" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4053" href="#C4053">
                <time itemprop="dateCreated" datetime="2013-10-29T05:05:57-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>А что вы пишете в сессию, и что проверяете? Просто csrf проверятся только для формы, для контроля доступа используется ACL.
Т.е. когда пользователь прошел проверку, его данные нужно сохранить в сессии, и далее использовать эти данные. И csrf использовать здесь уже не стоит. Т.е. валидация csrf отрабатывает только при обработке формы.
Больше мне нечего сказать.
Можете выложить код на github, когда будет время, я посмотрю. Но ничего гарантировать не могу.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4053" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4053" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4054" href="#C4054">
                <time itemprop="dateCreated" datetime="2013-10-29T05:25:07-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Вы все верно говорите. Так дело в том что csrf я использую для валидации формы, мне он больше не нужен. После авторизации пользователя, в сессию я записываю его id и name. За основу проекта используется код проекта vokuro</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4054" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4054" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4055" href="#C4055">
                <time itemprop="dateCreated" datetime="2013-10-29T06:21:38-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Форма у вас проходит проверку? Если нет, тогда покажите, как генерируете форму, код html на выходе (для формы) и код функции проверки. А то я уже несколько запутался, что именно у вас не работает. Началось у вас с CSRF validation failed.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4055" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4055" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4057" href="#C4057">
                <time itemprop="dateCreated" datetime="2013-10-29T09:02:00-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>views/session/login.volt</p>
<pre><code class="language-php">&lt;!-- Login Formular --&gt;
{% raw %}{{{% endraw %} form('class': 'form-vertical login-form') {% raw %}}}{% endraw %}
    &lt;!-- Title --&gt;
    &lt;h3 class="form-title"&gt;Вход в личный кабинет&lt;/h3&gt;

    &lt;!-- Error Message --&gt;
    {% raw %}{{{% endraw %} content() {% raw %}}}{% endraw %}
    &lt;div class="alert fade in alert-danger" style="display: none;"&gt;
        &lt;i class="icon-remove close" data-dismiss="alert"&gt;&lt;/i&gt;
        Enter any username and password.
    &lt;/div&gt;

    &lt;!-- Input Fields --&gt;
    &lt;div class="form-group"&gt;
        &lt;!--&lt;label for="username"&gt;Username:&lt;/label&gt;--&gt;
        &lt;div class="input-icon"&gt;
            &lt;i class="icon-envelope"&gt;&lt;/i&gt;
            {% raw %}{{{% endraw %} form.render('email', ['class': 'form-control', 'placeholder': 'Электронная почта', 'autofocus': 'autofocus', 'data-rule-required': 'true', 'data-msg-required': 'Введите адрес электронной почты']) {% raw %}}}{% endraw %}
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;div class="form-group"&gt;
        &lt;!--&lt;label for="password"&gt;Password:&lt;/label&gt;--&gt;
        &lt;div class="input-icon"&gt;
            &lt;i class="icon-lock"&gt;&lt;/i&gt;
            {% raw %}{{{% endraw %} form.render('password', ['class': 'form-control', 'placeholder': 'Пароль', 'data-rule-required': 'true', 'data-msg-required': 'Введите пароль']) {% raw %}}}{% endraw %}
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;!-- /Input Fields --&gt;

    &lt;!-- Form Actions --&gt;
    &lt;div class="form-actions"&gt;
        &lt;label class="checkbox pull-left"&gt;{% raw %}{{{% endraw %} form.render('remember', ['class': 'uniform']) {% raw %}}}{% endraw %} {% raw %}{{{% endraw %} form.getLabel('remember') {% raw %}}}{% endraw %}&lt;/label&gt;
        &lt;button type="submit" class="submit btn btn-primary pull-right"&gt;
            Войти &lt;i class="icon-angle-right"&gt;&lt;/i&gt;
        &lt;/button&gt;
    &lt;/div&gt;
    {% raw %}{{{% endraw %} form.render('csrf', ['value': security.getToken()]) {% raw %}}}{% endraw %}
&lt;/form&gt;
&lt;!-- /Login Formular --&gt;</code></pre>
<p>controllers/SessionController.php</p>
<pre><code class="language-php">if (!$this-&gt;request-&gt;isPost()) {
if ($form-&gt;isValid($this-&gt;request-&gt;getPost()) == false) {
                    foreach ($form-&gt;getMessages() as $message) {
                        $this-&gt;flash-&gt;error($message);
                    }
                } else {
                    $this-&gt;auth-&gt;check(array(
                        'email' =&gt; $this-&gt;request-&gt;getPost('email'),
                        'password' =&gt; $this-&gt;request-&gt;getPost('password'),
                        'remember' =&gt; $this-&gt;request-&gt;getPost('remember')
                    ));

                    return $this-&gt;response-&gt;redirect('index');
                }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4057" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4057" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4058" href="#C4058">
                <time itemprop="dateCreated" datetime="2013-10-29T09:02:43-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>У меня форма не проходит валидацию</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4058" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4058" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4059" href="#C4059">
                <time itemprop="dateCreated" datetime="2013-10-29T09:37:27-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Покажите код html, который генерирует views/session/login.volt , часть в тэгах &lt;form&gt;&lt;/form&gt;</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4059" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4059" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4060" href="#C4060">
                <time itemprop="dateCreated" datetime="2013-10-29T09:49:10-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>forms/Session/Login.php</p>
<pre><code class="language-php">class Login extends Form
{

    public function initialize()
    {
        //Email
        $email = new Text('email', array(
            'placeholder' =&gt; 'Email'
        ));

        $email-&gt;addValidators(array(
            new PresenceOf(array(
                'message' =&gt; 'The e-mail is required'
            )),
            new Email(array(
                'message' =&gt; 'The e-mail is not valid'
            ))
        ));

        $this-&gt;add($email);

        //Password
        $password = new Password('password', array(
            'placeholder' =&gt; 'Password'
        ));

        $password-&gt;addValidator(
            new PresenceOf(array(
                'message' =&gt; 'The password is required'
            ))
        );

        $this-&gt;add($password);

        //Remember
        $remember = new Check('remember', array(
            'value' =&gt; 'yes'
        ));

        $remember-&gt;setLabel('Запомнить');

        $this-&gt;add($remember);

        //CSRF
        $csrf = new Hidden('csrf');

        $csrf-&gt;addValidator(
            new Identical(array(
                'value' =&gt; $this-&gt;security-&gt;getSessionToken(),
                'message' =&gt; 'CSRF validation failed'
            ))
        );

        $this-&gt;add($csrf);
    }
}</code></pre>
<p>Это оно?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4060" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4060" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4061" href="#C4061">
                <time itemprop="dateCreated" datetime="2013-10-29T10:23:27-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Когда у вас форма отображается в браузере нажмите Ctrl+U , в соседней вкладке получите код страницы. Оттуда скопируйте сюда содержимое между &lt;form&gt; и &lt;/form&gt;</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4061" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4061" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8ac62b3845c98e2c93c24f457e0701a6?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/189/Farkhod" class="user-moderator-N"><span itemprop="name">Farkhod</span></a>        </span>
        <br>

        <span class="karma">42.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4062" href="#C4062">
                <time itemprop="dateCreated" datetime="2013-10-29T10:32:40-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>&lt;form class=&quot;form-vertical login-form&quot; method=&quot;post&quot;&gt;   &lt;!-- Title --&gt;
&lt;h3 class=&quot;form-title&quot;&gt;Вход в личный кабинет&lt;/h3&gt;</p>
<pre><code>&lt;!-- Error Message --&gt;
    &lt;div class="alert fade in alert-danger" style="display: none;"&gt;
    &lt;i class="icon-remove close" data-dismiss="alert"&gt;&lt;/i&gt;
    Enter any username and password.
&lt;/div&gt;

&lt;!-- Input Fields --&gt;
&lt;div class="form-group"&gt;
    &lt;!--&lt;label for="username"&gt;Username:&lt;/label&gt;--&gt;
    &lt;div class="input-icon"&gt;
        &lt;i class="icon-envelope"&gt;&lt;/i&gt;
        &lt;input placeholder="&amp;#x42d;&amp;#x43b;&amp;#x435;&amp;#x43a;&amp;#x442;&amp;#x440;&amp;#x43e;&amp;#x43d;&amp;#x43d;&amp;#x430;&amp;#x44f; &amp;#x43f;&amp;#x43e;&amp;#x447;&amp;#x442;&amp;#x430;" class="form-control" autofocus="autofocus" data-rule-required="true" data-msg-required="&amp;#x412;&amp;#x432;&amp;#x435;&amp;#x434;&amp;#x438;&amp;#x442;&amp;#x435; &amp;#x430;&amp;#x434;&amp;#x440;&amp;#x435;&amp;#x441; &amp;#x44d;&amp;#x43b;&amp;#x435;&amp;#x43a;&amp;#x442;&amp;#x440;&amp;#x43e;&amp;#x43d;&amp;#x43d;&amp;#x43e;&amp;#x439; &amp;#x43f;&amp;#x43e;&amp;#x447;&amp;#x442;&amp;#x44b;" name="email" id="email" value="a.farkhod&amp;#x40;gmail.com" type="text" /&gt;     &lt;/div&gt;
&lt;/div&gt;
&lt;div class="form-group"&gt;
    &lt;!--&lt;label for="password"&gt;Password:&lt;/label&gt;--&gt;
    &lt;div class="input-icon"&gt;
        &lt;i class="icon-lock"&gt;&lt;/i&gt;
        &lt;input placeholder="&amp;#x41f;&amp;#x430;&amp;#x440;&amp;#x43e;&amp;#x43b;&amp;#x44c;" class="form-control" data-rule-required="true" data-msg-required="&amp;#x412;&amp;#x432;&amp;#x435;&amp;#x434;&amp;#x438;&amp;#x442;&amp;#x435; &amp;#x43f;&amp;#x430;&amp;#x440;&amp;#x43e;&amp;#x43b;&amp;#x44c;" name="password" id="password" value="password" type="password" /&gt;       &lt;/div&gt;
&lt;/div&gt;
&lt;!-- /Input Fields --&gt;

&lt;!-- Form Actions --&gt;
&lt;div class="form-actions"&gt;
    &lt;label class="checkbox pull-left"&gt;&lt;input class="uniform" name="remember" id="remember" value="yes" type="checkbox" /&gt; Запомнить&lt;/label&gt;
    &lt;button type="submit" class="submit btn btn-primary pull-right"&gt;
        Войти &lt;i class="icon-angle-right"&gt;&lt;/i&gt;
    &lt;/button&gt;
&lt;/div&gt;
&lt;input value="22a39a9c1aecd158af1c9ee5fa0b813d" name="csrf" id="csrf" type="hidden" /&gt;&lt;/form&gt;</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4062" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4062" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4063" href="#C4063">
                <time itemprop="dateCreated" datetime="2013-10-29T11:04:15-07:00" class="action-date">Oct '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Цитата: </p>
<pre><code class="language-php">&lt;input value="22a39a9c1aecd158af1c9ee5fa0b813d" name="csrf" id="csrf" type="hidden" /&gt;&lt;/form&gt;</code></pre>
<p>я объяснял выше - именно поэтому у вас форма не работает.
Класс Security  генерирует ПАРУ скрытого поля csrf - имя =&gt; значение.
Сгенрированный код формы выглядит пимерно так</p>
<pre><code class="language-html">&lt;form class="userform" method="post" action="#"&gt;
&lt;input type="hidden" name="dTSUWVpKSDjKRfsw" value="4ec47f99a7999633a418b61d88a5e4c6"/&gt;
&lt;div&gt;
&lt;label for="email"&gt;Email&lt;/label&gt;
&lt;input type="text" size="24" placeholder="email" value="" maxlength="32" name="email" id="email" /&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;label for="password"&gt;Password&lt;/label&gt;
&lt;input type="password" size="24" placeholder="password" value="" maxlength="16" name="password" id="password" /&gt;
&lt;/div&gt;
&lt;div&gt;
&lt;input type="submit" class="btn" value="Войти" style="width:auto;"&gt;
&lt;/div&gt;
&lt;/form&gt;</code></pre>
<p>Обратите внимание на поле Hidden с &quot;мудреным&quot; именем и значением - это и есть поле CSRF.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4063" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4063" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9460ad04f394aa29d5c99e5f462ba481?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/374/romanlex" class="user-moderator-N"><span itemprop="name">Roman O</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4444" href="#C4444">
                <time itemprop="dateCreated" datetime="2013-11-26T04:16:23-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Олег, меня интересует следующий вопрос! Почему в демо приложениях используют также как выше в примере? Т.е. у инпута name = csrf, а value = токен?
У меня на локалхосте в 3 приложениях формы работают без проблем именно так...но вот в последнем приложении в упор понять не могу почему не работает  и вываливается с ошибкой валидации :( токен в сессии и в форме разные :( почему разные - не могу ответить сам!!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4444" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4444" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4445" href="#C4445">
                <time itemprop="dateCreated" datetime="2013-11-26T05:32:27-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Честно говоря, я в демо-приложениях смотрю только код. А дальше уже самостоятельно пробую функциональность.
Заметил, что со времени первого анонса демо-приложения не изменились (по-моему), поэтому полезность их, наверное, только в том, чтобы посмотреть (как говорят &quot;покурить&quot;) код. Но это мое личное мнение.
По поводу csrf -</p>
<ul>
<li>csrf токены генерируются сервисом и сохраняются в сессии - это факт :)</li>
<li>при обработке формы нам необходимо сравнить токен в сессии с токеном из запроса</li>
<li>в сессии токен хранится в виде пары ключ-значение, где ключ - это getTokenkey, значение - getToken.
Эту пару и следует проверять.
Поэтому, несмотря на примеры, я пришел к выводу, что наиболее логично генерировать пару Tokenkey =&gt; getToken в контроллере,
передавать эти данные в форму. Затем проверять csrf при помощи checkToken.
Тогда это работает.
И, главное, я это понимаю. :)
А почему там в примерах по-другому...? Я эти примеры посмотрел только после вашей ссылки на них. Поэтому даже не знаю, работает ли там такой подход.
Я их не пробовал.
А вот без фреймворков, просто на PHP, делал csrf защиту по такой-же схеме (только сессии использовал на Redis) и стараюсь не отступать от нее. Но там было имя поля фиксированное, а phalcon сделал его динамическим - это большой плюс.
Чтобы понять, прогоните (перехватите) полностью цепочку запросов и проанализируйте их. Это бывает неудобно, но для понимания необходимо.</li>
</ul></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4445" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4445" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9460ad04f394aa29d5c99e5f462ba481?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/374/romanlex" class="user-moderator-N"><span itemprop="name">Roman O</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4449" href="#C4449">
                <time itemprop="dateCreated" datetime="2013-11-26T09:12:30-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Понятно....переписал все формы по токен-ключ методу...собака все равно не работает :( впервые пишу модульное приложение с фронтендом и бэкендом...в контроллере пытаюсь посмотреть сессию </p>
<pre><code class="language-php">var_dump($_SESSION);</code></pre>
<p>Получаю в ответ Undefined variable: _SESSION :(
Хотя сессия типо стартуется(если удалить PHPSESSID то он создастся снова) В другом приложении не модульном все в порядке - работает...выводит содержимое сессии полностью :( походу в этом то и проблема...скрипт пытается проверить токен а его проверить не с чем :(</p>
<p>Также не понятно...$this-&gt;security-&gt;checkToken() принимает в качестве аргументов ключ и сам токен...но при валидации формы мы не можем знать ключ и токен...как принять из с POST'а? во всех примерах эта функция используется без аргументов почему то</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4449" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4449" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4450" href="#C4450">
                <time itemprop="dateCreated" datetime="2013-11-26T10:01:14-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>security-&gt;checkToken берет данные и из запроса, и из сессии. Поэтому и без параметров.
Протестируйте, в конце концов, пример из документации. Он точно работает.
Может вы инициализируете приложение неправильно?
Посмотрите у меня на Github скелетон мультимодульного приложения, может, там что полезное найдете.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4450" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4450" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9460ad04f394aa29d5c99e5f462ba481?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/374/romanlex" class="user-moderator-N"><span itemprop="name">Roman O</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4459" href="#C4459">
                <time itemprop="dateCreated" datetime="2013-11-27T01:29:38-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Вообщем сессия не дампилась до инициализации формы...токен также не проверяется при инициализации :(
Получается значит такая тема: при инициализации формы токен и ключ в сессии меняются, соответственно если инициализация формы проходит раньше чем вызов функции checkToken, то сверяет он уже совершенно новые данные :(
Если же проверят токен до инициализации - выдаёт необходимое мне TRUE</p>
<pre><code class="language-php">public function loginAction()
    {
        var_dump($this-&gt;security-&gt;checkToken()); // TRUE
        $form = new LoginForm();
        echo '&lt;pre&gt;';
        echo '================= SESSION DUMP ===============&lt;br&gt;';
        var_dump($_SESSION);
        echo '====================== END ===================&lt;br&gt;&lt;br&gt;';

            if (!$this-&gt;request-&gt;isPost()) {

                if ($this-&gt;auth-&gt;hasRememberMe()) {
                    return $this-&gt;auth-&gt;loginWithRememberMe();
                }

            } else {
                echo '================= GETTED POST ================&lt;br&gt;';
                var_dump($this-&gt;request-&gt;getPost());
                echo '===================== END ====================&lt;br&gt;&lt;br&gt;';
                echo 'checkToken: ';
                var_dump($this-&gt;security-&gt;checkToken()); // FALSE

                if($this-&gt;security-&gt;checkToken()) {
                    if ( $form-&gt;isValid($this-&gt;request-&gt;getPost()) == false ) {
                        var_dump('FORM NOT VALID');
                        foreach ($form-&gt;getMessages() as $message) {
                            $this-&gt;flashSession-&gt;error($message);
                        }
                    } else {
                        var_dump('FORM VALID');

                        // $this-&gt;auth-&gt;check(array(
                        //  'login' =&gt; $this-&gt;request-&gt;getPost('login'),
                        //  'password' =&gt; $this-&gt;request-&gt;getPost('password'),
                        //  'remember' =&gt; $this-&gt;request-&gt;getPost('remember')
                        // ));

                        //return $this-&gt;response-&gt;redirect('dashboard');
                    }
                } else
                    $this-&gt;flashSession-&gt;error("[CSRF] Ошибка валидации формы");

            }
        echo '&lt;/pre&gt;';
        $this-&gt;view-&gt;form = $form;
    }</code></pre>
<p>В форме использую</p>
<pre><code class="language-php">$csrf = new Hidden('csrf', array(
    'name' =&gt; $this-&gt;security-&gt;getTokenKey(),
        'value' =&gt; $this-&gt;security-&gt;getToken()
));
$this-&gt;add($csrf);</code></pre>
<p>Полагаю как вариант CSRF инициализировать во вьюхе...просто в таком виде невозможно использовать в экшене, которые также отвечает за обработку POST</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4459" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4459" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4462" href="#C4462">
                <time itemprop="dateCreated" datetime="2013-11-27T04:12:52-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>По-моему, правильно. Так и должно быть.
Мне кажется, у вас ошибка в логике.
Вы сначала генерируете форму, не проверяя тип запроса. Т.е. у вас в любом случае сначала обрабатыватеся любой запрос с генерацией формы и нового csrf, а потом уже идет обработка POST запроса.
Попробуйте изменить логику:</p>
<pre><code class="language-php">public function loginAction() {
     if ( $this-request-&gt;isPost() ) {
          // handle Post request with csrf validation
    } else {
         // handle Get request with Form generation
    }
}</code></pre>
<p>как-то так.
Посмотрите пример еще здесь <a href="https://habrahabr.ru/post/197254/">https://habrahabr.ru/post/197254/</a>
Поле csrf можете добавить в класс EntityForm в initialize перед кнопкой отправки.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4462" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4462" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4469" href="#C4469">
                <time itemprop="dateCreated" datetime="2013-11-27T13:29:28-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Появилось время, залил пример на github  - там введена CSRF защита.
<a href="https://github.com/oleg578/PhalconAnnotationsExample">https://github.com/oleg578/PhalconAnnotationsExample</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4469" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4469" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9460ad04f394aa29d5c99e5f462ba481?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/374/romanlex" class="user-moderator-N"><span itemprop="name">Roman O</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4474" href="#C4474">
                <time itemprop="dateCreated" datetime="2013-11-28T03:01:03-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Посмотрел пример:</p>
<ul>
<li>для чего переопределять сервис security?</li>
<li>понял что формы по сути повторяют поля моделей с условиями аннотаций...позволяет ли такой подход использовать динамичность в формах? надеюсь верно выражаюсь))</li>
</ul></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4474" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4474" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4475" href="#C4475">
                <time itemprop="dateCreated" datetime="2013-11-28T03:33:22-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Формы генерируются по правилам, определенным нами в аннотациях.
Аннотации определяем в моделях.
Общий класс обрабатывает любую модель.
Отсюда делайте выводы.
Security сервис определяю автоматом...
С CSRF вам уже понятно?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4475" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4475" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/9460ad04f394aa29d5c99e5f462ba481?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/374/romanlex" class="user-moderator-N"><span itemprop="name">Roman O</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4476" href="#C4476">
                <time itemprop="dateCreated" datetime="2013-11-28T04:36:46-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Да, огромное спасибо :))</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4476" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4476" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C4477" href="#C4477">
                <time itemprop="dateCreated" datetime="2013-11-28T05:54:15-07:00" class="action-date">Nov '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Ну вот и хорошо. Пожалуйста.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="4477" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="4477" data-cf-modified-92be7d5898b1eaa029df5978-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="1091" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>