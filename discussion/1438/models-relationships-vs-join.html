---
layout: default
title: 'Models Relationships vs JOIN - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Models Relationships vs JOIN</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/921/Jeckerson" class="user-moderator-Y"><span itemprop="name">Anton Vasiliev</span></a></span>
            <time itemprop="dateCreated" datetime="2014-01-13T04:58:59-07:00">Jan '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-01-13T04:58:59-07:00">Jan '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jan '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>1480</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/26f29ef2ab85f8c6855381e68ca04fea?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/921/Jeckerson" class="user-moderator-Y"><span itemprop="name">Anton Vasiliev</span></a></span>
                <span class="karma">6.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C1438" href="#C1438">
        <time class="action-date">Jan '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hello</p>
<p>I saw that there are some models relationships (<a href="http://docs.phalcon.io/en/latest/reference/models.html#relationships-between-models">http://docs.phalcon.io/en/latest/reference/models.html#relationships-between-models</a>) in Phalcon framework, so I tested it and saw in profiler that it makes child queries inside cycle. So it makes nice object but also tons of simple queries.</p>
<p>Is there are some alternative methods that use id collector and find them with IN SQL operator? And what are suggestions (maybe benchmarks?) about using table-relations or JOIN'ing.</p>
<p>Cheers.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-b13e7cf99e42dda6a2374834-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-b13e7cf99e42dda6a2374834-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5014" href="#C5014">
                <time itemprop="dateCreated" datetime="2014-01-13T05:11:14-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I also found this behavior.
Good idea for developers - implementation lazy queries.
I create manually such requests through PHQL now, unfortunately.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5014" data-cf-modified-b13e7cf99e42dda6a2374834-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5014" data-cf-modified-b13e7cf99e42dda6a2374834-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5077" href="#C5077">
                <time itemprop="dateCreated" datetime="2014-01-14T08:26:34-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I was wrong!
RTFM ( it's for me)</p>
<p>Lazy load solution
For example:</p>
<ul>
<li>we have table Discussion, and Discussion has many Replays.
<pre><code class="language-php">$discussion = Discussions::findFirst([
        'conditions'    =&gt; 'id=2'
        ]);
$replays = $discussion-&gt;getReplays();</code></pre>
<p>Queries (log from MariaDB)</p></li>
</ul>
<p>140114 16:55:22    14 Connect   <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b0c2dfdfc4f0dcdfd3d1dcd8dfc3c4">[email&#160;protected]</a> as anonymous on forum
14 Query     SELECT <code>discussions</code>.<code>id</code>, <code>discussions</code>.<code>title</code>, <code>discussions</code>.<code>topic</code>, <code>discussions</code>.<code>categories_id</code>, <code>discussions</code>.<code>users_id</code>, <code>discussions</code>.<code>created_at</code>, <code>discussions</code>.<code>slug</code> FROM <code>discussions</code> WHERE <code>discussions</code>.<code>id</code> = 2 LIMIT 1
14 Query     SELECT <code>replays</code>.<code>id</code>, <code>replays</code>.<code>body</code>, <code>replays</code>.<code>discussions_id</code>, <code>replays</code>.<code>users_id</code>, <code>replays</code>.<code>created_at</code>, <code>replays</code>.<code>updated_at</code> FROM <code>replays</code> WHERE <code>replays</code>.<code>discussions_id</code> = '2'
14 Quit</p>
<pre><code class="language-php"></code></pre>
<p>Query</p>
<pre><code class="language-php">$d = Discussions::findFirst([
            'conditions'    =&gt; 'id=2'
            ]);
$replays = $d-&gt;getReplays();
echo '&lt;pre style="font-size:11pt"&gt;';
var_dump($replays-&gt;toArray());
echo "&lt;/pre&gt;";</code></pre>
<p>Result</p>
<pre><code class="language-php">array (size=3)
  0 =&gt; 
    array (size=6)
      'id' =&gt; string '10' (length=2)
      'body' =&gt; string 'message to discussion ' (length=22)
      'discussions_id' =&gt; string '2' (length=1)
      'users_id' =&gt; string '7' (length=1)
      'created_at' =&gt; string '0' (length=1)
      'updated_at' =&gt; string '0' (length=1)
  1 =&gt; 
    array (size=6)
      'id' =&gt; string '11' (length=2)
      'body' =&gt; string 'message to discussion ' (length=22)
      'discussions_id' =&gt; string '2' (length=1)
      'users_id' =&gt; string '11' (length=2)
      'created_at' =&gt; string '0' (length=1)
      'updated_at' =&gt; string '0' (length=1)
  2 =&gt; 
    array (size=6)
      'id' =&gt; string '13' (length=2)
      'body' =&gt; string 'message to discussion ' (length=22)
      'discussions_id' =&gt; string '2' (length=1)
      'users_id' =&gt; string '10' (length=2)
      'created_at' =&gt; string '0' (length=1)
      'updated_at' =&gt; string '0' (length=1)</code></pre>
<p>Log</p>
<pre><code class="language-php"></code></pre>
<p>140114 17:18:14    22 Connect   <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="6f1d00001b2f03000c0e0307001c1b">[email&#160;protected]</a> as anonymous on forum
22 Query     SELECT <code>discussions</code>.<code>id</code>, <code>discussions</code>.<code>title</code>, <code>discussions</code>.<code>topic</code>, <code>discussions</code>.<code>categories_id</code>, <code>discussions</code>.<code>users_id</code>, <code>discussions</code>.<code>created_at</code>, <code>discussions</code>.<code>slug</code> FROM <code>discussions</code> WHERE <code>discussions</code>.<code>id</code> = 2 LIMIT 1
22 Query     SELECT <code>replays</code>.<code>id</code>, <code>replays</code>.<code>body</code>, <code>replays</code>.<code>discussions_id</code>, <code>replays</code>.<code>users_id</code>, <code>replays</code>.<code>created_at</code>, <code>replays</code>.<code>updated_at</code> FROM <code>replays</code> WHERE <code>replays</code>.<code>discussions_id</code> = '2'
22 Quit</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5077" data-cf-modified-b13e7cf99e42dda6a2374834-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5077" data-cf-modified-b13e7cf99e42dda6a2374834-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5096" href="#C5096">
                <time itemprop="dateCreated" datetime="2014-01-14T15:04:43-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>In continuation.
I read the manual again :)
We will automatically solve the problem of lazy loading, if we use stters &amp; getters in model.
Like : </p>
<pre><code class="language-php">&lt;?php

namespace Forum\Apps\Models;

use Forum\Apps\Library\Aux as Aux;

/**
 * Description of Discussions
 *
 * @author oleh
 */
class Discussions extends \Phalcon\Mvc\Model {

    /**
     * @Primary
     * @Identity
     * @Column(type="integer", nullable=false)
     *
     * @FormOptions(type=hidden)
     */
    protected $id;

    /**
     * @Column(type="string", nullable=false)
     *
     * @FormOptions(type=text, length=128)
     */
    protected $title;

    /**
     * @Column(type="string", nullable=false)
     *
     * @FormOptions(type=textarea)
     */
    protected $topic;

    /**
     * @Column(type="integer", nullable=false)
     *
     * @FormOptions(type=hidden)
     */
    protected $categories_id;

    /**
     * @Column(type="integer", nullable=false)
     *
     * @FormOptions(type=hidden)
     */
    protected $users_id;

    /**
     *
     * @Column(type="integer", nullable=false)
     *
     * @FormOptions(type=hidden)
     */
    protected $created_at;

    /**
     *
     * @Column(type="string", nullable=false)
     *
     * @FormOptions(type=hidden)
     */
    protected $slug;

    /**
     * get id
     * @return int 
     */
    public function getId() {
        return $this-&gt;id;
    }

    /**
     * Get title
     * @return string
     */
    public function getTitle() {
        return $this-&gt;title;
    }

    /**
     * Get Topic
     * @return string 
     */
    public function getTopic() {
        return $this-&gt;topic;
    }

    /**
     * Get categories_id
     * @return int 
     */
    public function getCategoriesId() {
        return $this-&gt;categories_id;
    }

    /**
     * Get user_id
     * @return int 
     */
    public function getUserId() {
        return $this-&gt;users_id;
    }        

    /**
     * get created_at
     * @return  date
     */
    public function getCreatedAt() {
        return $this-&gt;created_at;
    }

    /**
     * get slug
     * @return string 
     */
    public function getSlug() {
        return $this-&gt;slug;
    }

    /**
     * Set id
     * @return int 
     */
    public function setId($id) {
        $this-&gt;id = $id;
    }

    public function setTitle($title) {
        $this-&gt;title = $title;
    }

    public function setTopic($topic) {
        $this-&gt;topic = $topic;
    }

    public function setCategoriesId($categories_id) {
        $this-&gt;categories_id = $categories_id;
    }

    public function setUserId($users_id) {
        $this-&gt;users_id = $users_id;
    }        

    public function setCreatedAt($created_at) {
        $this-&gt;created_at = $created_at;
    }

    public function setSlug($slug) {
        $this-&gt;slug = $slug;
    }

    public function initialize() {
        $this-&gt;belongsTo('categories_id', "Forum\Apps\Models\Categories", "id", [
            'alias' =&gt; 'category',
        ]);
        $this-&gt;belongsTo('users_id', "Forum\Apps\Models\Users", "id", [
            'alias' =&gt; 'author',
        ]);
        $this-&gt;hasMany('id', 'Forum\Apps\Models\Replays', 'discussions_id', [
            'alias' =&gt; "replays"
        ]);
    }

    public function beforeValidation() {

        $this-&gt;setCreatedAt(time());
        $this-&gt;setSlug(Aux::slugMake($this-&gt;getTitle()));
    }

    public function getReplays($parameters=NULL) {

        return $this-&gt;getRelated('replays', $parameters);

    }

    public function getCategory($parameters=NULL) {

        return $this-&gt;getRelated('category', $parameters);

    }

    public function getAuthor($parameters=NULL) {

        return $this-&gt;getRelated('author', $parameters);

    }

}</code></pre>
<p>Ars longa, vita brevis  :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5096" data-cf-modified-b13e7cf99e42dda6a2374834-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5096" data-cf-modified-b13e7cf99e42dda6a2374834-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/26f29ef2ab85f8c6855381e68ca04fea?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/921/Jeckerson" class="user-moderator-Y"><span itemprop="name">Anton Vasiliev</span></a>        </span>
        <br>

        <span class="karma">6.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5097" href="#C5097">
                <time itemprop="dateCreated" datetime="2014-01-14T16:23:18-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Your example is about one-to-many which is ok in this case. But imagine the next situation, here are 3 tables:</p>
<pre><code>products
product_images
product_specs</code></pre>
<p>And there are one-to-one relationships in models of this 3 tables.</p>
<p>By showing 50 products on page - it get more +2 extra queries inside cycle, so in total there are 150 rows and cool object:</p>
<pre><code class="language-php">$products = Products::find();
foreach ($products as $product)
{
    $product-&gt;name;
    $product-&gt;images-&gt;filename;
    $product-&gt;specs-&gt;volume;
}</code></pre>
<p>Or just create custom method in Products Model and JOIN all necessary tables:</p>
<pre><code class="language-php">$products = Products::getComplete();
foreach ($products as $product)
{
    $product-&gt;name;
    $product-&gt;imageFile;
    $product-&gt;specVolume;
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5097" data-cf-modified-b13e7cf99e42dda6a2374834-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5097" data-cf-modified-b13e7cf99e42dda6a2374834-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5101" href="#C5101">
                <time itemprop="dateCreated" datetime="2014-01-15T03:43:00-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Yes, in this case it holds.
But, in my opinion, we can choose another way.
We may create the special methods with our quiries in model.
We may use  Query Builder or PHQL in these methods.
These methods can return one of Phalcon\Mvc\Model\Resultset.
Then we will be able to collect the result of a single request.
What is your opinion?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5101" data-cf-modified-b13e7cf99e42dda6a2374834-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5101" data-cf-modified-b13e7cf99e42dda6a2374834-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="1438" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>