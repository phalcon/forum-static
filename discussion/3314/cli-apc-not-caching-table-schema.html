---
layout: default
title: 'CLI APC not caching table schema - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/8/cache">Cache</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">CLI APC not caching table schema</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/1780/zylden" class="user-moderator-N"><span itemprop="name">Zylden</span></a></span>
            <time itemprop="dateCreated" datetime="2014-09-01T01:47:25-07:00">Sep '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-09-01T01:47:25-07:00">Sep '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>710</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/6abf1459e9d9f5e3e2cdf8ac383c862d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/1780/zylden" class="user-moderator-N"><span itemprop="name">Zylden</span></a></span>
                <span class="karma">5.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C3314" href="#C3314">
        <time class="action-date">Sep '14</time>
    </a>
</div>
<div class="post-content"><div><p>Hi
We managed to get APC working for a system we built in phalcon but we also have crons running as cli tasks. And these tasks dont seem to save the meta data with apc.
They keep running queries like this:
SELECT IF(COUNT(*)&gt;0, 1 , 0) FROM <code>INFORMATION_SCHEMA</code>.<code>TABLES</code> WHERE <code>TABLE_NAME</code>='TABLENAME';
Does anyone know how to fix this? The apc is enabled in the cli php.ini.
Thanx</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C10920" href="#C10920">
                <time itemprop="dateCreated" datetime="2014-09-02T13:55:11-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What version are you using?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="10920" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="10920" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/6abf1459e9d9f5e3e2cdf8ac383c862d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1780/zylden" class="user-moderator-N"><span itemprop="name">Zylden</span></a>        </span>
        <br>

        <span class="karma">5.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C10923" href="#C10923">
                <time itemprop="dateCreated" datetime="2014-09-02T17:50:21-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi
We are using version 1.3</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="10923" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="10923" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C10930" href="#C10930">
                <time itemprop="dateCreated" datetime="2014-09-02T21:32:42-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Have you checked if <code>apc_store</code>/<code>apc_fetch</code> are working fine under CLI?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="10930" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="10930" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/87b5a9f1433eb9708f2e15915119da87?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/2235/destinychoice" class="user-moderator-N"><span itemprop="name">Jason</span></a>        </span>
        <br>

        <span class="karma">846</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C10931" href="#C10931">
                <time itemprop="dateCreated" datetime="2014-09-02T22:11:34-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>the response shows the test variable in the browser via a normal controller. </p>
<p>however the cli just returns empty value.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="10931" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="10931" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/6abf1459e9d9f5e3e2cdf8ac383c862d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1780/zylden" class="user-moderator-N"><span itemprop="name">Zylden</span></a>        </span>
        <br>

        <span class="karma">5.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="10983" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '14</span>
              </span><br/><a name="C10983" href="#C10983">
                <time itemprop="dateCreated" datetime="2014-09-03T17:18:12-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>As my colleague above mentions the apc_fetch was returning empty.
I have since made sure the cli.php had apc.enable_cli on which it does now.
Now it does return the apt_fetch but the crons still return the same queries in my mysql log
SELECT IF(COUNT(*)&gt;0, 1 , 0) FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME='TABLENAME';
one for each cron thread.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="10983" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="10983" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11151" href="#C11151">
                <time itemprop="dateCreated" datetime="2014-09-08T05:08:32-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>That's how APC works in CLI, it creates a new memory pool for every process created which could be a very unexpected behavior: <a href="http://stackoverflow.com/a/10423978/1022921">http://stackoverflow.com/a/10423978/1022921</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11151" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11151" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/6abf1459e9d9f5e3e2cdf8ac383c862d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/1780/zylden" class="user-moderator-N"><span itemprop="name">Zylden</span></a>        </span>
        <br>

        <span class="karma">5.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C11184" href="#C11184">
                <time itemprop="dateCreated" datetime="2014-09-08T18:15:10-07:00" class="action-date">Sep '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I guess to some extent that does make sense, thanx.
It still means that all these table metadata queries are seen as un-indexed queries and gets logged 100 times per minute.
However, am I not correct in saying that even without APC phalcon will still run these queries each time my threads run?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="11184" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="11184" data-cf-modified-1a6ab6176620d1dd7b866ddf-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="3314" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>