---
layout: default
title: 'How to check dB connection - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">How to check dB connection</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/9823/TimurFlush" class="user-moderator-N"><span itemprop="name">timurflush</span></a></span>
            <time itemprop="dateCreated" datetime="2017-07-04T12:41:50-07:00">Jul '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-07-04T12:41:50-07:00">Jul '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jul '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>1974</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/2f860fa4cd8cf16b3e98196f510ccdf0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/9823/TimurFlush" class="user-moderator-N"><span itemprop="name">timurflush</span></a></span>
                <span class="karma">2.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C16489" href="#C16489">
        <time class="action-date">Jul '17</time>
    </a>
</div>
<div class="post-content"><div><p>RU: Здравствуйте. Хотелось бы узнать, возможно ли в Phalcon как-то проверить коннект к базе. Т.е если коннекта к базе нет, то вернуть false, если есть, то true.</p>
<p>EN: Hello. I would like to know, is it possible in Phalcon to check the connection to the database. Ie if the connection to the database, then return false, if there is, it is true.</p>
<p>Thnx.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-5a9a4b4f2b2e5cd004fe7afb-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-5a9a4b4f2b2e5cd004fe7afb-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5915f25e654c4f9e60fe51700cdee683?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4769/Izopi4a" class="user-moderator-Y"><span itemprop="name">Izo</span></a>        </span>
        <br>

        <span class="karma">85.5k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C49339" href="#C49339">
                <time itemprop="dateCreated" datetime="2017-07-05T00:08:06-07:00" class="action-date">Jul '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi</p>
<p><a href="https://forum.phalcon.io/discussion/12669/how-to-check-if-there-is-connection-to-the-database">https://forum.phalcon.io/discussion/12669/how-to-check-if-there-is-connection-to-the-database</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="49339" data-cf-modified-5a9a4b4f2b2e5cd004fe7afb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="49339" data-cf-modified-5a9a4b4f2b2e5cd004fe7afb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="49345" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '17</span>
              </span><br/><a name="C49345" href="#C49345">
                <time itemprop="dateCreated" datetime="2017-07-05T04:25:21-07:00" class="action-date">Jul '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I've extended the default adapter class:</p>
<pre><code class="language-php">use Phalcon\Db\Adapter\Pdo\Mysql as PhalconMysql;

class MysqlCustom extends PhalconMysql
{
    public function isConnected() {
        try {
            $this-&gt;fetchAll('SELECT 1');
        } catch (\Exception $e) {
            if (strpos($e-&gt;getMessage(), 'MySQL server has gone away') !== false) {
                $this-&gt;connect();
                return true;
            }
            return false;
        }
        return true;
    }
}</code></pre>
<p>Don't forget to initialize this custom class instead of the default in your services!</p>
<p>Usage inside a controller:</p>
<pre><code class="language-php">class SomeController {
    public function indexAction() {
        echo $this-&gt;db-&gt;isConnected() ? 'connected!' : 'db is offline!';
    }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="49345" data-cf-modified-5a9a4b4f2b2e5cd004fe7afb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="49345" data-cf-modified-5a9a4b4f2b2e5cd004fe7afb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2f860fa4cd8cf16b3e98196f510ccdf0?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9823/TimurFlush" class="user-moderator-N"><span itemprop="name">timurflush</span></a>        </span>
        <br>

        <span class="karma">2.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C49397" href="#C49397">
                <time itemprop="dateCreated" datetime="2017-07-09T14:08:58-07:00" class="action-date">Jul '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Did as you said, but it is somehow even does not throw an exception in case of unsuccessful connection.</p>
<p><img src="https://savepic.ru/14802753.png" alt="" /></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="49397" data-cf-modified-5a9a4b4f2b2e5cd004fe7afb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="49397" data-cf-modified-5a9a4b4f2b2e5cd004fe7afb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/660e8c9b157b0029b6e0ba24c0ea3eba?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4363/lajosbencz" class="user-moderator-N"><span itemprop="name">Lajos Bencz</span></a>        </span>
        <br>

        <span class="karma">77.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="49415" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '17</span>
              </span><br/><a name="C49415" href="#C49415">
                <time itemprop="dateCreated" datetime="2017-07-10T02:49:29-07:00" class="action-date">Jul '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>That code only runs once, when you first access the <strong>db</strong> service.</p>
<p>Create the class that i've pasted above somewhere in your namespace (it has to be autoloaded), then instantiate it in the services like this:</p>
<pre><code class="language-php">use My\Custom\DbAdapter; // this class is the one i've pasted above

$di-&gt;setShared('db', function() {
    $config = $this-&gt;getConfig();
    $class = new DbAdapter($config-&gt;database-&gt;toArray());
    return $class;
});</code></pre>
<p>Then, in a ServiceAware context (like Controllers or Tasks), you can do this:</p>
<pre><code class="language-php">class MyController extends \Phalcon\Mvc\Controller {
    public function indexAction() {
        echo $this-&gt;db-&gt;isConnected() ? 'true' : 'false';
    }
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="49415" data-cf-modified-5a9a4b4f2b2e5cd004fe7afb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="49415" data-cf-modified-5a9a4b4f2b2e5cd004fe7afb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="16489" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>