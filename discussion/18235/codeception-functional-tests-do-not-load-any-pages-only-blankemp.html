---
layout: default
title: 'Codeception functional tests do not load any pages (only blank/empty pages) - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Codeception functional tests do not load any pages (only blank/empty pages)</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/1795/fsando" class="user-moderator-N"><span itemprop="name">Finn Sandø</span></a></span>
            <time itemprop="dateCreated" datetime="2018-05-12T11:39:19-07:00">May '18</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2018-05-12T11:39:19-07:00">May '18</time>
                </td>
                <td>
                    <label>Last Reply</label><br>May '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>848</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/21697c9beb69ab1f65753c880a077141?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/1795/fsando" class="user-moderator-N"><span itemprop="name">Finn Sandø</span></a></span>
                <span class="karma">9.5k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C18235" href="#C18235">
        <time class="action-date">May '18</time>
    </a>
</div>
<div class="post-content"><div><p>Not sure how to accurately describe the situation (please advise if I'm missing something)</p>
<p>All functional tests return a blank page but I believe they hit the correct routes/urls because when I try to go to a route that requires login it is correctly redirected to the login page but the page is stil blank.</p>
<p>Can you help me figuring out what I am doing wrong?
Thanks! </p>
<p>The test: func2Cept.php</p>
<pre><code class="language-php">&lt;?php
$I = new FunctionalTester($scenario);

$I-&gt;wantTo('try to make functional tests work');
$I-&gt;amOnPage("/");
$x = $I-&gt;grabPageSource();
var_dump($x);</code></pre>
<p>I followed the setup here: <a href="https://github.com/Codeception/phalcon-demo">https://github.com/Codeception/phalcon-demo</a>
as well as the setup here: <a href="https://codeception.com/docs/modules/Phalcon">https://codeception.com/docs/modules/Phalcon</a></p>
<p>Running the test in debug mode gives me the following (note that the output of <code>var_dump()</code> is an empty string)</p>
<pre><code>$ vendor/bin/codecept run functional --debug
Codeception PHP Testing Framework v2.4.0
Powered by PHPUnit 7.0.3 by Sebastian Bergmann and contributors.

Functional Tests (1) 
----------------------------------------------------------------------------------
Modules: \Helper\Functional, Asserts, Phalcon
----------------------------------------------------------------------------------
func2Cept: Try to make functional tests work
Signature: func2Cept
Test: tests/functional/func2Cept.php
Scenario --
  [Database] Transaction started
 I am on page "/"
  [Request Headers] []
  [Page] /
  [Response] 200
  [Request Cookies] []
  [Response Headers] []
 I grab page source 
/var/www/phalcon/kdlab/tests/functional/func2Cept.php:19:
string(0) ""
 PASSED 

  [Database] Transaction cancelled; all changes reverted.
----------------------------------------------------------------------------------

Time: 18 ms, Memory: 12.00MB

OK (1 test, 0 assertions)</code></pre>
<p>Test redirect (try to go to a url which requires login, redirects to the login page)</p>
<pre><code>$ vendor/bin/codecept run functional --debug
Codeception PHP Testing Framework v2.4.0
Powered by PHPUnit 7.0.3 by Sebastian Bergmann and contributors.

Functional Tests (1)
----------------------------------------------------------------------------------
Modules: \Helper\Functional, Asserts, Phalcon
----------------------------------------------------------------------------------
func2Cept: Try to make functional tests work
Signature: func2Cept
Test: tests/functional/func2Cept.php
Scenario --
  [Database] Transaction started
 I am on page "/welcome"
  [Request Headers] []
  [Page] /welcome
  [Response] 302
  [Request Cookies] []
  [Response Headers] {"HTTP/1.1 302 Found":null,"Status":"302 Found","Location":"/login"}
  [Redirecting to] /login
  [Page] /login
  [Response] 200
  [Request Cookies] []
  [Response Headers] []
 I grab page source 
/var/www/phalcon/kdlab/tests/functional/func2Cept.php:19:
string(0) ""
 PASSED 

  [Database] Transaction cancelled; all changes reverted.
----------------------------------------------------------------------------------

Time: 22 ms, Memory: 12.00MB

OK (1 test, 0 assertions)
</code></pre></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="55501" data-toggle="modal" data-target="#historyModal">
                edited <span>May '18</span>
              </span><br/><a name="C55501" href="#C55501">
                <time itemprop="dateCreated" datetime="2018-05-17T05:39:01-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Interesting.<a href="https://forum.phalcon.io/user/2828/sergeyklay"> @sergeyklay</a> will be able to help you on this for sure.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55501" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55501" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/7f19eda68ce7976e552e53f2b09a6c2b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3459/Druid33" class="user-moderator-N"><span itemprop="name">Peter Skultety</span></a>        </span>
        <br>

        <span class="karma">718</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C55529" href="#C55529">
                <time itemprop="dateCreated" datetime="2018-05-18T07:19:11-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi, i try to use codeception functional test on phlacon project, and have same problem.</p>
<p>When i use <code>echo</code>, <code>print()</code> or <code>var_dump()</code> in my controller, then i can get output with <code>$I-&gt;grabPageSource()</code>. But when i use view to get output from controller ( fill view-&gt;content property with controller output), then <code>$I-&gt;grabPageSource()</code> return empty string.
I try use  <a href="https://codeception.com/docs/modules/Phalcon#_request">_request</a> and <a href="https://codeception.com/docs/modules/Phalcon#_loadPage">_loadPage</a> methods to make request, but result was same.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55529" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55529" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/7f19eda68ce7976e552e53f2b09a6c2b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3459/Druid33" class="user-moderator-N"><span itemprop="name">Peter Skultety</span></a>        </span>
        <br>

        <span class="karma">718</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C55531" href="#C55531">
                <time itemprop="dateCreated" datetime="2018-05-18T10:43:40-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I fiddle around with codeception for a few hours and i figured that handling application (<code>$application-&gt;handle()</code>) in <code>Codeception/Lib/Connector/Phalcon</code> dont  render view.</p>
<p>I insert some outputs to <code>Codeception/Lib/Connector/Phalcon-&gt;doRequest()</code> function and get results in comments:</p>
<pre><code class="language-php">  public function doRequest($request)
  {
        // ...here is original code...

       // --- I ADD THIS ---
        var_dump($response-&gt;getContent());
        // string(0) ""
        $view = $di-&gt;get('view');
        var_dump($view-&gt;content);
        // array(3) {
        //   ["success"]=&gt;
        //   bool(false)
        //   ["errorCode"]=&gt;
        //   int(1)
        //   ["errorDesc"]=&gt;
        //   string(13) "Invalid input"
        // }
        // -----------------------

        return new Response(
            $response-&gt;getContent(),
            $status ? $status : 200,
            $headers
        );
    }   </code></pre>
<p>controller action :</p>
<pre><code class="language-php">    public function codeceptAction()
    {
        $this-&gt;view-&gt;layout = 'json';
        $this-&gt;view-&gt;content = [
            "someKey" =&gt; "some value"
        ];
    }</code></pre>
<p>cest function:</p>
<pre><code class="language-php">     public function testCodeceptAction(\FunctionalTester $I) {
        $response = $I-&gt;callControllerAction('/test/codecept', []);
        var_dump($response);
    }</code></pre>
<p>helper for function tester:</p>
<pre><code class="language-php">    public function callControllerAction($controllerUri, array $params = []) {
        $response = $this-&gt;getModule('Phalcon')-&gt;_request('POST', $controllerUri, $params);
        return $response;
    }</code></pre>
<p>and finaly output from console:</p>
<pre><code>
druid33:~/$ ./codecept run -vvv functional LoadDashboardsConfigCest.php
Codeception PHP Testing Framework v2.3.0
Powered by PHPUnit 5.7.27 by Sebastian Bergmann and contributors.

  Rebuilding FunctionalTester...

Functional Tests (1) -------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Modules: REST, PhpBrowser, \Helper\Functional, Filesystem, Asserts, Phalcon
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
LoadDashboardsConfigCest: Test codecept action
Signature: Tests\Functional\LoadDashboardsConfigCest:testCodeceptAction
Test: tests/functional/LoadDashboardsConfigCest.php:testCodeceptAction
Scenario --
 I call controller action "/test/codecept",[]
  [Request Headers] []
string(0) ""
array(1) {
  ["someKey"]=&gt;
  string(10) "some value"
}
  [Page] /test/codecept
  [Response] 200
  [Request Cookies] []
  [Response Headers] []
string(0) ""
 PASSED 

----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Time: 143 ms, Memory: 10.00MB

OK (1 test, 0 assertions)
</code></pre>
<p>Hope, this information help someone to explain, whats is going on :)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55531" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55531" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/21697c9beb69ab1f65753c880a077141?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1795/fsando" class="user-moderator-N"><span itemprop="name">Finn Sandø</span></a>        </span>
        <br>

        <span class="karma">9.5k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="55533" data-toggle="modal" data-target="#historyModal">
                edited <span>May '18</span>
              </span><br/><a name="C55533" href="#C55533">
                <time itemprop="dateCreated" datetime="2018-05-18T11:10:17-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks, everybody.</p>
<p>After three full days of intense debugging I finally found the error. Turns out it was a trivial but subtle error on my part. However, the process of debugging may still be of some interest.</p>
<p>The error was setting the constant APP_PATH like this: </p>
<pre><code class="language-php">    define('APP_PATH', realpath('..'));</code></pre>
<p>instead of this:</p>
<pre><code class="language-php">    define('APP_PATH', realpath(__DIR__.'/..'));</code></pre>
<p>So when running the application normally it just happened to be correct but not when running the functional tests.</p>
<p>In order to debug this issue I found a  <a href="https://stackoverflow.com/questions/18606807/debugging-codeception-tests-with-xdebug/41956462">stackoverflow answer</a></p>
<p>Instead of running the test from the command line I run then codecept file directly after changing it to a proper php file (I just copied the vendor/bin/codecept file to my root of my project renamed it run.php and removed the first line: #!/usr/bin/env php) like this:</p>
<pre><code class="language-php">&lt;?php
/**
 * Codeception CLI
 */

require_once __DIR__.'/autoload.php';

use Codeception\Application;

$app = new Application('Codeception', Codeception\Codecept::VERSION);
$app-&gt;add(new Codeception\Command\Build('build'));
$app-&gt;add(new Codeception\Command\Run('run'));
$app-&gt;add(new Codeception\Command\Init('init'));
$app-&gt;add(new Codeception\Command\Console('console'));
$app-&gt;add(new Codeception\Command\Bootstrap('bootstrap'));
$app-&gt;add(new Codeception\Command\GenerateCept('generate:cept'));
$app-&gt;add(new Codeception\Command\GenerateCest('generate:cest'));
$app-&gt;add(new Codeception\Command\GenerateTest('generate:test'));
$app-&gt;add(new Codeception\Command\GenerateSuite('generate:suite'));
$app-&gt;add(new Codeception\Command\GenerateHelper('generate:helper'));
$app-&gt;add(new Codeception\Command\GenerateScenarios('generate:scenarios'));
$app-&gt;add(new Codeception\Command\Clean('clean'));
$app-&gt;add(new Codeception\Command\GenerateGroup('generate:groupobject'));
$app-&gt;add(new Codeception\Command\GeneratePageObject('generate:pageobject'));
$app-&gt;add(new Codeception\Command\GenerateStepObject('generate:stepobject'));
$app-&gt;add(new Codeception\Command\GenerateEnvironment('generate:environment'));
$app-&gt;add(new Codeception\Command\GenerateFeature('generate:feature'));
$app-&gt;add(new Codeception\Command\GherkinSnippets('gherkin:snippets'));
$app-&gt;add(new Codeception\Command\GherkinSteps('gherkin:steps'));
$app-&gt;add(new Codeception\Command\DryRun('dry-run'));
$app-&gt;add(new Codeception\Command\ConfigValidate('config:validate'));

// Suggests package
if (class_exists('Stecman\Component\Symfony\Console\BashCompletion\CompletionCommand')) {
    $app-&gt;add(new Codeception\Command\Completion());
} else {
    $app-&gt;add(new Codeception\Command\CompletionFallback());
}

$app-&gt;registerCustomCommands();
$app-&gt;run();
</code></pre>
<p>Then I set up a debug entry as a PHP script in phpstorm and added the parameters &quot;run functional&quot;</p>
<p>Now it's possible to debug the tests in xdebug.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55533" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55533" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/21697c9beb69ab1f65753c880a077141?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1795/fsando" class="user-moderator-N"><span itemprop="name">Finn Sandø</span></a>        </span>
        <br>

        <span class="karma">9.5k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C55529"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/7f19eda68ce7976e552e53f2b09a6c2b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Peter Skultety                    </a>
                </div><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="55535" data-toggle="modal" data-target="#historyModal">
                edited <span>May '18</span>
              </span><br/><a name="C55535" href="#C55535">
                <time itemprop="dateCreated" datetime="2018-05-18T11:22:20-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><blockquote>
<p>Hi, i try to use codeception functional test on phlacon project, and have same problem.</p>
<p>When i use <code>echo</code>, <code>print()</code> or <code>var_dump()</code> in my controller, then i can get output with <code>$I-&gt;grabPageSource()</code>. But when i use view to get output from controller ( fill view-&gt;content property with controller output), then <code>$I-&gt;grabPageSource()</code> return empty string.
I try use  <a href="https://codeception.com/docs/modules/Phalcon#_request">_request</a> and <a href="https://codeception.com/docs/modules/Phalcon#_loadPage">_loadPage</a> methods to make request, but result was same.</p>
</blockquote>
<p>I solved it (see my answer here in the thread). In my case it was how I set the APP_PATH constant. It may be in your case too as I believe I copied it from one of the official docs.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55535" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55535" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/7f19eda68ce7976e552e53f2b09a6c2b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3459/Druid33" class="user-moderator-N"><span itemprop="name">Peter Skultety</span></a>        </span>
        <br>

        <span class="karma">718</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C55543" href="#C55543">
                <time itemprop="dateCreated" datetime="2018-05-19T02:51:23-07:00" class="action-date">May '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hey, you're right! My APP_PATH constant was wrong. </p>
<p>Iam angry with myself, becouse there was a problem with Phalcon\Loader in my aplication when i run tests, but i ignore it.  And it should be a hint to me, that something is wrong with paths.</p>
<p>As usual, the problem was between the keyboard and the chair. :)</p>
<p>Thank you very much.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="55543" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="55543" data-cf-modified-7201ae528c572fd7fd9b92f7-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="18235" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>