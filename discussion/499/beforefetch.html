---
layout: default
title: 'beforeFetch() - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">beforeFetch()</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/11/doit76" class="user-moderator-N"><span itemprop="name">Karol Marcinkiewicz</span></a></span>
            <time itemprop="dateCreated" datetime="2013-06-27T00:11:13-07:00">Jun '13</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2013-06-27T00:11:13-07:00">Jun '13</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jun '13</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>963</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/693cd29a926f2659ccec45ba126abd71?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/11/doit76" class="user-moderator-N"><span itemprop="name">Karol Marcinkiewicz</span></a></span>
                <span class="karma">40.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C499" href="#C499">
        <time class="action-date">Jun '13</time>
    </a>
</div>
<div class="post-content"><div><p>Do you plan any method like beforeFetch() model event?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-6b442846bd7b72a061fc03eb-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-6b442846bd7b72a061fc03eb-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2072" href="#C2072">
                <time itemprop="dateCreated" datetime="2013-06-27T07:25:17-07:00" class="action-date">Jun '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What would be the practical usage of beforeFetch?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2072" data-cf-modified-6b442846bd7b72a061fc03eb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2072" data-cf-modified-6b442846bd7b72a061fc03eb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/693cd29a926f2659ccec45ba126abd71?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/11/doit76" class="user-moderator-N"><span itemprop="name">Karol Marcinkiewicz</span></a>        </span>
        <br>

        <span class="karma">40.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2075" href="#C2075">
                <time itemprop="dateCreated" datetime="2013-06-27T09:44:06-07:00" class="action-date">Jun '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>beforeFetch = beforeQuery = beforeExecuteQuery / method name proposition
It would be man in the middle method, to modify query, find&amp;replace, posibility to usemade row/column level accesibility, log if string exist in query etc
I mean to have something similar like mysqlproxy</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2075" data-cf-modified-6b442846bd7b72a061fc03eb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2075" data-cf-modified-6b442846bd7b72a061fc03eb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/5d6f567f9109789fd9f702959768e35d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1/phalcon" class="user-moderator-Y"><span itemprop="name">Phalcon</span></a>        </span>
        <br>

        <span class="karma">98.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2076" href="#C2076">
                <time itemprop="dateCreated" datetime="2013-06-27T09:49:42-07:00" class="action-date">Jun '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The greatest difficulty in implementing this approach (i.e beforeExecuteQuery) is that although often the queries are executed in a single model there are often JOINS that use several models so place this event in every model would not be appropriate, for example:</p>
<pre><code class="language-php">$this-&gt;modelsManager-&gt;executeQuery("SELECT r.*, p.* FROM Robots r JOIN Parts p ORDER BY r.name");</code></pre>
<p>Pretending that there is a many to many relationship between Robots and Parts then the above query requires 3 models:</p>
<pre><code class="language-php">&lt;?php

class Robots extends Phalcon\Mvc\Model
{
    public function beforeExecuteQuery()
    {

    }   
}

class RobotsParts extends Phalcon\Mvc\Model
{
    public function beforeExecuteQuery()
    {

    }   
}

class Parts extends Phalcon\Mvc\Model
{
    public function beforeExecuteQuery()
    {

    }   
}</code></pre>
<p>We can check every model for that method and execute it, but what parameters pass to them? Not all queries have a query builder, if we pass the PHQL it could be really hard change things on it, also changing the original PHQL we must re-parse it to take into account the new changes, re-parse and execute beforeExecuteQuery again?</p>
<pre><code class="language-php">class Robots extends Phalcon\Mvc\Model
{
    public function beforeExecuteQuery($phql)
    {
        if (preg_match('/ WHERE /i', $phql)) {
            $parts = explode(' WHERE ', $phql);
            $phql = $parts[0] . ' WHERE robots.shard_id = 1 AND '.$parts[1];
        }
        return $phql;
    }   
}</code></pre>
<p>Like this, there are more complex scenarios where the event, instead of make things easier it will make applications more complex and will lead to all kind of misunderstanding and wrong expectations, so implement an event that sometimes work as expected and sometimes does not is not the ideal.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2076" data-cf-modified-6b442846bd7b72a061fc03eb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2076" data-cf-modified-6b442846bd7b72a061fc03eb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/693cd29a926f2659ccec45ba126abd71?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/11/doit76" class="user-moderator-N"><span itemprop="name">Karol Marcinkiewicz</span></a>        </span>
        <br>

        <span class="karma">40.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C2077" href="#C2077">
                <time itemprop="dateCreated" datetime="2013-06-27T11:23:25-07:00" class="action-date">Jun '13</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I see, but it is worth to add this method, at the end it would be easy posibility to log queries from model, or break execute query if not allowed string exist in query?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="2077" data-cf-modified-6b442846bd7b72a061fc03eb-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="2077" data-cf-modified-6b442846bd7b72a061fc03eb-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="499" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>