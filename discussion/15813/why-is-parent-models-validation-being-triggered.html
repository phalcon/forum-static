---
layout: default
title: 'Why is &quot;parent model&#039;s&quot; validation being triggered?! - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Why is &quot;parent model&#039;s&quot; validation being triggered?!</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/9065/Vorta" class="user-moderator-N"><span itemprop="name">Vorta</span></a></span>
            <time itemprop="dateCreated" datetime="2017-03-24T09:28:43-07:00">Mar '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-03-24T09:28:43-07:00">Mar '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Mar '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>412</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/2c8a155adfd514ca175d45f8b2dddf0a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/9065/Vorta" class="user-moderator-N"><span itemprop="name">Vorta</span></a></span>
                <span class="karma">2.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C15813" href="#C15813">
        <time class="action-date">Mar '17</time>
    </a>
</div>
<div class="post-content"><div><p>Hello!</p>
<p>I have a folowing relationship:
Gallery model, which has all the gallery information and
GalleryImage model, which has images from the Gallery. GalleryImage has:</p>
<pre><code>$this-&gt;belongsTo('galleryId', 'Gallery', 'id', ['alias' =&gt; 'gallery']);</code></pre>
<p>Gallery has it's own <code>validation()</code> method used which makes sure user can't create a gallery without a name and that the gallery's slug (URL) is unique.</p>
<p>GalleryImage has no validation method as there are no model-level validations required.</p>
<p>However, for some reason when I trigger <code>save()</code> in the GalleryImage model, the validation in Gallery model is executed and fails with an error saying that &quot;Slug is not unique&quot;.</p>
<p>How can this happen? I'm using Phalcon 3.1.0.</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-b2dc599e1b972c961f52289a-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-b2dc599e1b972c961f52289a-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="46905" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '17</span>
              </span><br/><a name="C46905" href="#C46905">
                <time itemprop="dateCreated" datetime="2017-03-24T09:39:51-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Post your code causing a problem, this is expected behavior i guess.</p>
<p>If you will do something like:</p>
<pre><code class="language-php">$galleryImage = new GalleryImage();
$galleryImage-&gt;gallery = new Gallery();
$galleryImage-&gt;save();</code></pre>
<p>Then this save will try to create and validate both Gallery object and GalleryImage.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46905" data-cf-modified-b2dc599e1b972c961f52289a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46905" data-cf-modified-b2dc599e1b972c961f52289a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/2c8a155adfd514ca175d45f8b2dddf0a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/9065/Vorta" class="user-moderator-N"><span itemprop="name">Vorta</span></a>        </span>
        <br>

        <span class="karma">2.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46987" href="#C46987">
                <time itemprop="dateCreated" datetime="2017-03-28T03:40:06-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I was trying to avoid posting a whole lot of code, but here goes:</p>
<p>Gallery model:</p>
<pre><code>use Phalcon\Validation;
use Phalcon\Validation\Validator\Uniqueness;

class Gallery extends ModelBase {

    public function initialize() {

        $this-&gt;setSource('gallery');

        $this-&gt;hasMany(
            'id',
            'GalleryImage',
            'galleryId',
            [
                'alias' =&gt; 'images'
            ]
        );

    }

    public function columnMap() {
        return [
            'id' =&gt; 'id', 
            'name' =&gt; 'name', 
            'slug' =&gt; 'slug', 
            'description' =&gt; 'description',
            'rating' =&gt; 'rating'
        ];
    }

    public function validation() {

        $validator = new Validation();

        $validator-&gt;add('slug', new Uniqueness([
            'message' =&gt; 'This slug already exists!'
        ]));

        return $this-&gt;validate($validator);

    }

}</code></pre>
<p>GalleryImage model:</p>
<pre><code>class GalleryImage extends ModelBase {

    public function initialize() {

        parent::initialize();

        $this-&gt;setSource('gallery_image');
        $this-&gt;belongsTo('galleryId', 'Gallery', 'id', ['alias' =&gt; 'gallery']);

    }

    public function columnMap() {

        return [
            'id' =&gt; 'id', 
            'gallery_id' =&gt; 'galleryId',
            'title' =&gt; 'title',
            'image' =&gt; 'image',
            'link' =&gt; 'link'
        ];

    }

    public function beforeSave () {

        $this-&gt;link = trim($this-&gt;link);

        if (empty($this-&gt;link) &amp;&amp; !is_null($this-&gt;link)) {
            $this-&gt;link = NULL;
        }

    }

}</code></pre>
<p>The Gallery model may have NULL slug, in which case gallery is not accessible on the web site. However, since Uniqueness checks NULL against other NULLs, it will fail, even though it was not the Gallery object that was being saved, rather a GalleryImage object.</p>
<p>The fix was to do this in the Gallery object:</p>
<pre><code>public function validation() {

    $validator = new Validation();

    if (!empty($this-&gt;slug)) {

        $validator-&gt;add('slug', new Uniqueness([
            'message' =&gt; 'This slug already exists!'
        ]));

    }

    return $this-&gt;validate($validator);
}</code></pre>
<p>However, I'm still puzzled why is Gallery object being validated if save is being made on GalleryImage.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46987" data-cf-modified-b2dc599e1b972c961f52289a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46987" data-cf-modified-b2dc599e1b972c961f52289a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="46997" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '17</span>
              </span><br/><a name="C46997" href="#C46997">
                <time itemprop="dateCreated" datetime="2017-03-28T05:45:37-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>But you didn't provide code how are you saving</p>
<p>Instead of:</p>
<pre><code class="language-php"> if (!empty($this-&gt;slug)) {

        $validator-&gt;add('slug', new Uniqueness([
            'message' =&gt; 'This slug already exists!'
        ]));

    }</code></pre>
<p>Do:</p>
<pre><code class="language-php">        $validator-&gt;add('slug', new Uniqueness([
            'message' =&gt; 'This slug already exists!',
            'allowEmpty' =&gt; true
        ]));</code></pre>
<p>But better post your code, it might be about something other. Maybe you just need to change your relation:</p>
<pre><code class="language-php">$this-&gt;belongsTo('galleryId', 'Gallery', 'id', ['alias' =&gt; 'gallery', 'foreignKey' =&gt; ['allowNulls' =&gt; true]]);</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46997" data-cf-modified-b2dc599e1b972c961f52289a-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46997" data-cf-modified-b2dc599e1b972c961f52289a-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="15813" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>