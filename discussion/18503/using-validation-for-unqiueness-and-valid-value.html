---
layout: default
title: 'Using Validation for unqiueness and valid value - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Using Validation for unqiueness and valid value</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/10972/iRickyJ" class="user-moderator-N"><span itemprop="name">iRickyJ</span></a></span>
            <time itemprop="dateCreated" datetime="2018-07-01T13:35:27-07:00">Jul '18</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2018-07-01T13:35:27-07:00">Jul '18</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jul '18</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">2</span>
                </td>
                <td>
                    <label>Views</label><br>291</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/cd7b9c404d3f2e981db53d45e1b7c13b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/10972/iRickyJ" class="user-moderator-N"><span itemprop="name">iRickyJ</span></a></span>
                <span class="karma">8.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C18503" href="#C18503">
        <time class="action-date">Jul '18</time>
    </a>
</div>
<div class="post-content"><div><p>Need to validate a field in database for uniqueness before saving in model, I can do : </p>
<pre><code class="language-php">     public function validation()
    {
        $validator = new Validation();
        $validator-&gt;add('unit', new Uniqueness([
            "message" =&gt; "The unit is already in use"
        ]));
        return $this-&gt;validate($validator);
    }</code></pre>
<p>But I need to do two make two more tests: </p>
<ol>
<li>I need to first check UNIT in other table-- if it exists there or not , </li>
<li>Units with value = 0 has to be ignored as there are multiple units with 0 value. </li>
</ol>
<p>So how can properly utilize phalcon Validation for my need. </p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-3a233125943f0e79f4b1d649-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-3a233125943f0e79f4b1d649-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="56475" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '18</span>
              </span><br/><a name="C56475" href="#C56475">
                <time itemprop="dateCreated" datetime="2018-07-01T13:54:57-07:00" class="action-date">Jul '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><pre><code class="language-php">if($unitExists) { // just check here if unit exists in other table
  $validator-&gt;add('unit', new Uniqueness([
              "message" =&gt; "The unit is already in use",
              "except" =&gt; [
                  0
              ]
  ]));
}</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="56475" data-cf-modified-3a233125943f0e79f4b1d649-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="56475" data-cf-modified-3a233125943f0e79f4b1d649-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/cd7b9c404d3f2e981db53d45e1b7c13b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/10972/iRickyJ" class="user-moderator-N"><span itemprop="name">iRickyJ</span></a>        </span>
        <br>

        <span class="karma">8.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="56477" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '18</span>
              </span><br/><a name="C56477" href="#C56477">
                <time itemprop="dateCreated" datetime="2018-07-01T14:20:04-07:00" class="action-date">Jul '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks , that was quick and precise, need little more guidance as I am still confused about proper use of MVC thing and placing of codes.</p>
<p>As per examples I am seeing for validation of Model, Say I have table named 'store' with following model where I need to use it. :</p>
<pre><code class="language-php">class Store extends Model
{

    public $id;

    public $name;

    public $unitId;

    public function validation()
    {
        $validator = new Validation();
        $validator-&gt;add('unitId', new Uniqueness([
            "message" =&gt; "The unit is already in use",
            "except" =&gt; [
               0
            ]
        ]));
        return $this-&gt;validate($validator); 
    }

}</code></pre>
<ol>
<li>
<p>How method validation() is evoked on data of model, is it that validation() method is auto called when data is updated /saved by a MODEL ?</p>
</li>
<li>I suppose to find unit is valid or not, I can use simply following code,  but I am not sure where to place it, in a separate library file or in Store.php (model for store) or somehwere else. Probably can use it on controller but then data validation is being done in Model. </li>
</ol>
<pre><code class="language-php">         $unit = Units::FindFirstById($unitId);
         $unitExist =  ($unit-&gt;count != 0 ) ? true : false;</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="56477" data-cf-modified-3a233125943f0e79f4b1d649-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="56477" data-cf-modified-3a233125943f0e79f4b1d649-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="56479" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '18</span>
              </span><br/><a name="C56479" href="#C56479">
                <time itemprop="dateCreated" datetime="2018-07-01T14:40:38-07:00" class="action-date">Jul '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><ol>
<li>
<p>Validation is called on update/save/create, yes, it's pretty much one of model events <a href="https://docs.phalcon.io/bs/3.3/db-models-events">https://docs.phalcon.io/bs/3.3/db-models-events</a> here you can learn more about model events.</p>
</li>
<li>The common case for this is to create seperate class called Repository, like UnitsRepository for all queries from database(you can also use it for writes though i don't like it). Also instead of findFirstById you can just do findFirst if $unitId is primary key of model. Also not sure what is count, can't you do it like this:</li>
</ol>
<p><code>$unitExist = Units::count($unitId); &gt; 0</code> </p>
<p>might be enough in your case</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="56479" data-cf-modified-3a233125943f0e79f4b1d649-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="56479" data-cf-modified-3a233125943f0e79f4b1d649-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/cd7b9c404d3f2e981db53d45e1b7c13b?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/10972/iRickyJ" class="user-moderator-N"><span itemprop="name">iRickyJ</span></a>        </span>
        <br>

        <span class="karma">8.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="56481" data-toggle="modal" data-target="#historyModal">
                edited <span>Jul '18</span>
              </span><br/><a name="C56481" href="#C56481">
                <time itemprop="dateCreated" datetime="2018-07-01T15:45:06-07:00" class="action-date">Jul '18</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks again for nice explanation. </p>
<p>Sorry for Naive questions,  but for #2, I am still not sure where to place code you gave , currently I am using StoreController to do things . Since validation() has to be called in model Store, should I simply do this inside store model :</p>
<pre><code class="language-php">public function validation()
    {
    if ((Units::count($this-&gt;unitId)) &gt; 0) {
        $validator = new Validation();
        $validator-&gt;add('unitId', new Uniqueness([
            "message" =&gt; "The unit is already in use",
            "except" =&gt; [
               0
            ]
        ]));
        return $this-&gt;validate($validator); 
        }
        else 
        {
        $this-&gt;getDi()-&gt;flash()-&gt;error('Invalid unit selected');
    }</code></pre>
<p>Now with above problem, there problem as in case of invalid unit, it is showing error but unit is also getting updated in database, only incase of duplicate, its working as expected.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="56481" data-cf-modified-3a233125943f0e79f4b1d649-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="56481" data-cf-modified-3a233125943f0e79f4b1d649-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="18503" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>