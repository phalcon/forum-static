---
layout: default
title: 'Related records - automatically including - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Related records - automatically including</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/1371/david-duncan" class="user-moderator-N"><span itemprop="name">David Duncan</span></a></span>
            <time itemprop="dateCreated" datetime="2014-04-16T13:04:11-07:00">Apr '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-04-16T13:04:11-07:00">Apr '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Apr '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">3</span>
                </td>
                <td>
                    <label>Views</label><br>1277</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/65cc66b2174ca0e8408258408af274c2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/1371/david-duncan" class="user-moderator-N"><span itemprop="name">David Duncan</span></a></span>
                <span class="karma">6.9k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C2104" href="#C2104">
        <time class="action-date">Apr '14</time>
    </a>
</div>
<div class="post-content"><div><p>This is basically the issue from : <a href="https://forum.phalcon.io/discussion/1437/getting-all-children-grandchildren-etc-from-model-with-hasmany-r">https://forum.phalcon.io/discussion/1437/getting-all-children-grandchildren-etc-from-model-with-hasmany-r</a></p>
<p>Is there an easier and less obtuse way to dump the related records of a resultset? </p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7285" href="#C7285">
                <time itemprop="dateCreated" datetime="2014-04-16T15:52:02-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>The first thing that comes to mind is:</p>
<pre><code class="language-php">$p_Customer = Customer::findFirst($id);
$a_Customer = $p_Customer-&gt;toArray();
$a_Customer['orders'] = [];

foreach($p_Customer-&gt;orders as $Order){
    $a_Customer['orders'][] = $Order-&gt;toArray();
}

echo json_encode($a_Customer);</code></pre>
<p>The <code>toArray()</code> function is useful, but unfortunately I don't believe it goes down into related records.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7285" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7285" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/65cc66b2174ca0e8408258408af274c2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1371/david-duncan" class="user-moderator-N"><span itemprop="name">David Duncan</span></a>        </span>
        <br>

        <span class="karma">6.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="7316" data-toggle="modal" data-target="#historyModal">
                edited <span>Apr '14</span>
              </span><br/><a name="C7316" href="#C7316">
                <time itemprop="dateCreated" datetime="2014-04-17T12:10:29-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I'm aware that I can just build up new arrays and do it all myself. Your solution necessitates copy pasting boilerplate all over an API whice violates the DRY principles and is exactly what I am trying to avoid. Furthermore if there are results nested past the first level that solution will quickly become unwieldy. </p>
<p>Thanks for your response but the question asks for an easier way to serialize a resultset.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7316" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7316" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/746a625a9264a203a6ddf711e0c6b120?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/301/quasipickle" class="user-moderator-Y"><span itemprop="name">Dylan Anderson</span></a>        </span>
        <br>

        <span class="karma">125.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7317" href="#C7317">
                <time itemprop="dateCreated" datetime="2014-04-17T12:20:08-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>What I gave you was pretty simple, but admittedly not very automatic.  The other post has a response outlining what can be done as well.</p>
<p>There's no built-in way to do what you ask, so you're going to have to code something yourself.  You might get lucky, but most likely no one is just going to hand you the code.  The first response to your linked post explains exactly what you need to do to abstract out my idea to be more general.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7317" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7317" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/24e438429d975d345e4f99e53b740150?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1487/Conradaek" class="user-moderator-N"><span itemprop="name">Conradaek</span></a>        </span>
        <br>

        <span class="karma">26.3k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7351" href="#C7351">
                <time itemprop="dateCreated" datetime="2014-04-19T07:02:31-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi All!</p>
<p>I have the same problem as david-duncan here and matt-sharp at  <a href="https://forum.phalcon.io/discussion/1437/getting-all-children-grandchildren-etc-from-model-with-hasmany-r"><a href="https://forum.phalcon.io/discussion/1437/getting-all-children-grandchildren-etc-from-model-with-hasmany-r">https://forum.phalcon.io/discussion/1437/getting-all-children-grandchildren-etc-from-model-with-hasmany-r</a></a></p>
<p>In the original post matt-sharp wrote:</p>
<blockquote>
<p>Customer hasMany Order</p>
<p>Order hasMany Product</p>
<p>Product hasMany Part</p>
</blockquote>
<p>My solution for now is:</p>
<p><strong>In a controller:</strong></p>
<pre><code class="language-php">
//obtaining the customer object
$customer = Customer::findFirst($id); 

//obtaining the resultset of all parts that belong to the customer
$his_parts = $customer-&gt;getParts(); 
</code></pre>
<p><strong>In a model:</strong></p>
<p>then in the <code>Customer</code> model I would define the following <code>getParts()</code> method:</p>
<pre><code class="language-php">
public function getParts() {

  //obtain resultset
  $parts = Part::query()
    -&gt;innerJoin('Product')
    -&gt;innerJoin('Order')
    -&gt;innerJoin('Customer')
    -&gt;where("customer_id = :customer_id:")
    -&gt;bind(array("customer_id" =&gt; $this-&gt;getCustomerId()))
    -&gt;execute(); 

  return $parts;

}
</code></pre>
<p>In the above model my id field is <code>customer_id</code> and its getter is <code>getCustomerId()</code> method. I assume that all models has properly defined relations.</p>
<p><strong>Please write what do you think about it? What other solution you are using?</strong></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7351" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7351" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/65cc66b2174ca0e8408258408af274c2?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1371/david-duncan" class="user-moderator-N"><span itemprop="name">David Duncan</span></a>        </span>
        <br>

        <span class="karma">6.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C7353" href="#C7353">
                <time itemprop="dateCreated" datetime="2014-04-19T07:35:08-07:00" class="action-date">Apr '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Innerjoins abstracted into the model is what I have been doing. Seeing as Quasipickle says that there is no automatic phalcon way to do this it looks like your answer is the most correct.</p>
<p>I was hoping there was a flag or parameter I was missing somewhere in a relationship or a call like toArray that would actually serialize down the lineage tree.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="7353" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="7353" data-cf-modified-55dbd1b3b7f9e772349995b0-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="2104" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>