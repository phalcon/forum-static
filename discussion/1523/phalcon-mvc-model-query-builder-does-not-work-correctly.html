---
layout: default
title: 'Phalcon\Mvc\Model\Query\Builder does not work correctly - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="http://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/2/orm">ORM</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Phalcon\Mvc\Model\Query\Builder does not work correctly</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="http://schema.org/Person"><a href="/user/326/temafey" class="user-moderator-N"><span itemprop="name">Artem Onyshchenko</span></a></span>
            <time itemprop="dateCreated" datetime="2014-01-30T03:19:11-07:00">Jan '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-01-30T03:19:11-07:00">Jan '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Jan '14</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>2912</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/3679cf65d70f7f5d0bf1ac09eb91514d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="http://schema.org/Person" class="avatar-name"><a href="/user/326/temafey" class="user-moderator-N"><span itemprop="name">Artem Onyshchenko</span></a></span>
                <span class="karma">10.3k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C1523" href="#C1523">
        <time class="action-date">Jan '14</time>
    </a>
</div>
<div class="post-content"><div><p>My script create sql query with joins, for this it using Phalcon\Mvc\Model\Query\Builder, for each table column script add table name alias, if I want add some filtering in where, script add table alias to this column too automatically, but if in one query two table have column with the same name, like id, name and I want to filtering by this column I have error like 'Column 'id' in where clause is ambiguous', but if I log sql query before execute it query looks like &quot;Select table.id, table.name From table join left tabe2 where table.id = '1' and table.name = 'test';&quot; but in mysql query log this query looks different &quot;Select table.id, table.name From table join left tabe2 where id = '1' and name = 'test';&quot; and of course I have error because column with name id or name have table and table2.</p>
<p>Why Phalcon\Mvc\Model\Query\Builder or maybe after execute method query changing? and how I can switch off this?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5334" href="#C5334">
                <time itemprop="dateCreated" datetime="2014-01-30T03:32:49-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Paste your query, please.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5334" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5334" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/3679cf65d70f7f5d0bf1ac09eb91514d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/326/temafey" class="user-moderator-N"><span itemprop="name">Artem Onyshchenko</span></a>        </span>
        <br>

        <span class="karma">10.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="5335" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '14</span>
              </span><br/><a name="C5335" href="#C5335">
                <time itemprop="dateCreated" datetime="2014-01-30T03:49:11-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><pre><code class="language-php">$queryBuilder-&gt;getPhql();</code></pre>
<pre><code class="language-sql">SELECT event.id AS id, event.name AS name, Member.name AS member, Member.id AS member_id, Location.city AS location, Location.id AS location_id 
FROM [Event\Model\Event] AS [event] 
LEFT JOIN [\Event\Model\Member] AS [Member] ON event.member_id = Member.id 
LEFT JOIN [\Event\Model\Location] AS [Location] ON event.location_id = Location.id 
WHERE ((event.id = '1') OR (event.name LIKE 'test%')) ORDER BY event.id desc</code></pre>
<p>After execute in query log with error</p>
<pre><code class="language-sql">SELECT `event`.`id` AS `id`, `event`.`name` AS `name`, `Member`.`name` AS `member`, `Member`.`id` AS `member_id`, `Location`.`city` AS `location`, `Location`.`id` AS `location_id` 
FROM `event` AS `event` LEFT JOIN `member` AS `Member` ON `event`.`member_id` = `Member`.`id`  
LEFT JOIN `campaign` AS `Campaign` ON `event`.`campaign_id` = `Campaign`.`id`  
LEFT JOIN `location` AS `Location` ON `event`.`location_id` = `Location`.`id`  
WHERE ((`id` = '1') OR (`name` LIKE 'test%')) ORDER BY `id`</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5335" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5335" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5336" href="#C5336">
                <time itemprop="dateCreated" datetime="2014-01-30T04:14:14-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Show your php code of builder this query.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5336" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5336" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/3679cf65d70f7f5d0bf1ac09eb91514d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/326/temafey" class="user-moderator-N"><span itemprop="name">Artem Onyshchenko</span></a>        </span>
        <br>

        <span class="karma">10.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="5346" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '14</span>
              </span><br/><a name="C5346" href="#C5346">
                <time itemprop="dateCreated" datetime="2014-01-31T01:38:11-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><pre><code class="language-php">$dataSource = new \Phalcon\Mvc\Model\Query\Builder();
$dataSource-&gt;addFrom('\Event\Model\Event', 'event');
$dataSource-&gt;columns(['id' =&gt; 'event.id', 'name' =&gt; 'event.name', 'member' =&gt; 'Member.name']);
$dataSource-&gt;leftJoin('\Event\Model\Member', 'Member.id = event.member_id', 'Member');
$dataSource-&gt;where("event.id = '1'");
$dataSource-&gt;andWhere("event.name = 'test'");
$sql = $dataSource-&gt;getPhql();
echo $sql; // print "SELECT event.id AS id, event.name AS name, Member.name AS member, Memebr.id AS mid FROM [\Event\Model\Event] AS [event] LEFT JOIN [\Event\Model\Member] AS [Member] ON Member.id = event.member_id WHERE (event.id = '1') AND (event.name = 'test')"
$dataSource-&gt;getQuery()-&gt;execute(); // [ERROR] SQLSTATE[23000]: Integrity constraint violation: 1052 Column 'id' in where clause is ambiguous
// In sql log "SELECT `event`.`id` AS `id`, `event`.`name` AS `name`, `Member`.`name` AS `member`, `Member`.`id` AS `mid` FROM `event` AS `event` LEFT JOIN `member` AS `Member` ON `Member`.`id` = `event`.`member_id`  WHERE (`id` = '1') AND (`name` = 'test')"</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5346" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5346" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="5347" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '14</span>
              </span><br/><a name="C5347" href="#C5347">
                <time itemprop="dateCreated" datetime="2014-01-31T04:37:29-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Try change</p>
<pre><code class="language-php">$dataSource-&gt;columns(['id' =&gt; 'event.id', 'name' =&gt; 'event.name', 'member' =&gt; 'Member.name']);</code></pre>
<p>to</p>
<pre><code class="language-php">$dataSource-&gt;columns([ 'event.id',  'event.name', 'Member.name']);</code></pre>
<p>and change by replacing addFrom and columns.
Builder work like normal SQL query.
columns --&gt; SELECT
addFrom -- FROM
... and so on
You can use Xdebug for detailed trace. It work nice.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5347" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5347" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/3679cf65d70f7f5d0bf1ac09eb91514d?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/326/temafey" class="user-moderator-N"><span itemprop="name">Artem Onyshchenko</span></a>        </span>
        <br>

        <span class="karma">10.3k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5348" href="#C5348">
                <time itemprop="dateCreated" datetime="2014-01-31T05:44:15-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>but I want add aliases to each column, why script each time replace full column path to alias in where section if don't want it? I think that it is not correct.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5348" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5348" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="http://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/fcae2565ce4d1ed7240231932dec115a?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a href="/user/659/oleg578" class="user-moderator-N"><span itemprop="name">Oleg</span></a>        </span>
        <br>

        <span class="karma">8.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5349" href="#C5349">
                <time itemprop="dateCreated" datetime="2014-01-31T06:18:58-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Then create aliases that do not coincide with the actual field names. Error code you imeeno says about it.
I use Xdebug for tuning SQL queries in Phalcon. It show low level query. It's good assists.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5349" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5349" data-cf-modified-dbbcbd10937bc9a450136c9f-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="1523" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>