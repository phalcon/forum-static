---
layout: default
title: 'To configure a router annotation with multiple modules? - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/13/routing">Routing</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">To configure a router annotation with multiple modules?</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/7797/pedro151" class="user-moderator-N"><span itemprop="name">Pedro Alarcão</span></a></span>
            <time itemprop="dateCreated" datetime="2017-03-17T12:54:39-07:00">Mar '17</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2017-03-17T12:54:39-07:00">Mar '17</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Mar '17</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>804</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/b71aafb58410ea55153f5abf0dd985d3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/7797/pedro151" class="user-moderator-N"><span itemprop="name">Pedro Alarcão</span></a></span>
                <span class="karma">2.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C15749" href="#C15749">
        <time class="action-date">Mar '17</time>
    </a>
</div>
<div class="post-content"><div><p>How do you configure a router annotation with multiple modules?
I tried everything that is way it always gives an error that does not recognize the controller class or controllerbase</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-e6fca54836bd5537c69102e3-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-e6fca54836bd5537c69102e3-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c0ce8f5e133750a4dfea4712e533a178?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/15/le51" class="user-moderator-N"><span itemprop="name">le51</span></a>        </span>
        <br>

        <span class="karma">43.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46709" href="#C46709">
                <time itemprop="dateCreated" datetime="2017-03-18T13:04:13-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hi,</p>
<p>from doc </p>
<blockquote>
<p>If you’re using modules in your application, it is better use the addModuleResource() method:</p>
</blockquote>
<pre><code class="language-php">
&lt;?php

use Phalcon\Mvc\Router\Annotations as RouterAnnotations;

$di["router"] = function () {
    // Use the annotations router
    $router = new RouterAnnotations(false);

    // Read the annotations from Backend\Controllers\ProductsController if the URI starts with /api/products
    $router-&gt;addModuleResource("backend", "Products", "/api/products");

    return $router;
};
</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46709" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46709" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b71aafb58410ea55153f5abf0dd985d3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7797/pedro151" class="user-moderator-N"><span itemprop="name">Pedro Alarcão</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46721" href="#C46721">
                <time itemprop="dateCreated" datetime="2017-03-19T12:36:35-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>It does not work, it says the class does not exist</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46721" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46721" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c0ce8f5e133750a4dfea4712e533a178?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/15/le51" class="user-moderator-N"><span itemprop="name">le51</span></a>        </span>
        <br>

        <span class="karma">43.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46723" href="#C46723">
                <time itemprop="dateCreated" datetime="2017-03-19T13:09:31-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Maybe it's a stupid question: but did you already register all your modules and namespaces ?</p>
<p>If yes, if think I could not help you further without some relevant php code.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46723" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46723" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b71aafb58410ea55153f5abf0dd985d3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7797/pedro151" class="user-moderator-N"><span itemprop="name">Pedro Alarcão</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="46759" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '17</span>
              </span><br/><a name="C46759" href="#C46759">
                <time itemprop="dateCreated" datetime="2017-03-20T07:34:07-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><pre><code class="language-php">
$loader-&gt;registerNamespaces (
    array (
        'Models' =&gt; $config-&gt;application-&gt;modelsDir,
        'Web' =&gt; $config-&gt;application-&gt;libraryDir
    )
)-&gt;register ();

$di = new FactoryDefault();
$di-&gt;setShared (
    'router',
    function () {
        $router = new RouterAnnotations( false );
        $router-&gt;addModuleResource('questionary', 'Web/Questionary/index');
});

$application = new Application();

$application-&gt;registerModules(array(
    'frontend' =&gt; array(
        'className' =&gt; 'Web\Frontend\Module',
        'path' =&gt; __DIR__ . '/../apps/modules/frontend/Module.php'
    ),
    'home' =&gt; array(
        'className' =&gt; 'Web\Home\Module',
        'path' =&gt; __DIR__ . '/../apps/modules/home/Module.php'
    ),
    'questionary' =&gt; array(
        'className' =&gt; 'Web\Questionary\Module',
        'path' =&gt; __DIR__ . '/../apps/modules/questionary/Module.php'
    )
));

$di-&gt;setShared (
    'router',
    function () {
        $router = new RouterAnnotations( false );
        $router-&gt;addModuleResource('questionary', 'Web/Questionary/Categoria');
        /*       $router-&gt;setDefaults (
                   array (
                       'namespace' =&gt; 'Web\Frontend\Controllers',
                       'module'    =&gt; 'frontend',
                   )
               );

               $router-&gt;notFound (
                   array (
                       'controller' =&gt; 'error',
                       'action'     =&gt; 'notfound'
                   )
               );
       */
        return $router;
    }
);

$application-&gt;setDI($di);
echo $application-&gt;handle()-&gt;getContent();
...
</code></pre>
<p>Module.php</p>
<pre><code class="language-php">
...
    public function registerAutoloaders ( DiInterface $di = null )
    {

        $loader = new Loader();

        $loader-&gt;registerNamespaces (
            array (
                'Web\Questionario\Controllers' =&gt; __DIR__ . '/controllers/',
                'Web\Questionario\Models'      =&gt; __DIR__ . '/models/',
                'Web\Questionario\Forms'       =&gt; __DIR__ . '/forms/',
            )
        );

        $loader-&gt;register ();
    }</code></pre>
<p>Result:</p>
<p>Class Web/Questionary/CategoriaController does not exist</p>
<h1>0 [internal function]: ReflectionClass-&gt;__construct('Web/Questionary...')</h1>
<h1>1 [internal function]: Phalcon\Annotations\Reader-&gt;parse('Web/Questionary...')</h1>
<h1>2 [internal function]: Phalcon\Annotations\Adapter-&gt;get('Web/Questionary...')</h1>
<h1>3 [internal function]: Phalcon\Mvc\Router\Annotations-&gt;handle('')</h1>
<h1>4 /var/www/web/public/index.php(48): Phalcon\Mvc\Application-&gt;handle()</h1>
<h1>5 {main}</h1></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46759" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46759" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c0ce8f5e133750a4dfea4712e533a178?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/15/le51" class="user-moderator-N"><span itemprop="name">le51</span></a>        </span>
        <br>

        <span class="karma">43.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46761" href="#C46761">
                <time itemprop="dateCreated" datetime="2017-03-20T07:40:03-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Mybe it is because you load modules after router ....</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46761" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46761" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b71aafb58410ea55153f5abf0dd985d3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7797/pedro151" class="user-moderator-N"><span itemprop="name">Pedro Alarcão</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46773" href="#C46773">
                <time itemprop="dateCreated" datetime="2017-03-20T10:45:19-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>In module it does not work, configure it in a normal way (without module) and maps a global namespace and it worked, so I saw phalcon is not prepared for router annotation with multiple modules, it needs a kludge to work ...</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46773" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46773" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer acceptedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row reply-accepted">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b71aafb58410ea55153f5abf0dd985d3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7797/pedro151" class="user-moderator-N"><span itemprop="name">Pedro Alarcão</span></a>        </span>
        <br>

        <span class="karma">2.8k</span><div class="accepted-reply">
                <span class="glyphicon glyphicon-ok"></span>
                Accepted<br>answer
            </div></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46775" href="#C46775">
                <time itemprop="dateCreated" datetime="2017-03-20T10:47:37-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>it work withou module...</p>
<pre><code class="language-php">
    /**
     * Read auto-loader
     */
    $loader = new \Phalcon\Loader();

    $loader-&gt;registerNamespaces (
        array (
            'Models'                      =&gt; $config-&gt;application-&gt;modelsDir ,
            'Web'                         =&gt; $config-&gt;application-&gt;libraryDir ,
            'Web\Questionary\Controllers' =&gt; $config-&gt;application-&gt;modulesDir . 'questionary/controllers/'
        )
    )-&gt;register ();

    $di = new FactoryDefault();

    $di-&gt;setShared (
        'router' ,
        function ()
        {
            $router = new RouterAnnotations( false );
            $router-&gt;addResource ( 'Web\Questionary\Controllers\Categoria', '/questionary/categoria' );

            return $router;
        } );

    $application = new Application($di);
</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46775" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46775" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/c0ce8f5e133750a4dfea4712e533a178?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/15/le51" class="user-moderator-N"><span itemprop="name">le51</span></a>        </span>
        <br>

        <span class="karma">43.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46815" href="#C46815">
                <time itemprop="dateCreated" datetime="2017-03-21T05:52:28-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>ok, but if doc says that you can handle a multi modules app with annotation router, it should work !!</p>
<p>As I said, did you try, in code you've given, to register your modules before the router (btw, you've registred the router twice in the DI)</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46815" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46815" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b71aafb58410ea55153f5abf0dd985d3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7797/pedro151" class="user-moderator-N"><span itemprop="name">Pedro Alarcão</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C46915" href="#C46915">
                <time itemprop="dateCreated" datetime="2017-03-24T11:23:57-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>It worked, from what I saw in the forum you should do exactly that, declare the global namespace for the controllers and then declare again on each module, the problem is precisely the redundancy that is mandatory and confusing.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46915" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46915" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b71aafb58410ea55153f5abf0dd985d3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/7797/pedro151" class="user-moderator-N"><span itemprop="name">Pedro Alarcão</span></a>        </span>
        <br>

        <span class="karma">2.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="46917" data-toggle="modal" data-target="#historyModal">
                edited <span>Mar '17</span>
              </span><br/><a name="C46917" href="#C46917">
                <time itemprop="dateCreated" datetime="2017-03-24T11:30:49-07:00" class="action-date">Mar '17</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>It worked</p>
<pre><code class="language-php">
/**
     * Read auto-loader
     */
    $loader = new \Phalcon\Loader();

    /**
    * namespace global
    */
    $loader-&gt;registerNamespaces (
        array (
            'Models'                      =&gt; $config-&gt;application-&gt;modelsDir ,
            'Web'                         =&gt; $config-&gt;application-&gt;libraryDir ,
            'Web\Questionary\Controllers' =&gt; $config-&gt;application-&gt;modulesDir . 'questionary/controllers/'
        )
    )-&gt;register ();

    $di = new FactoryDefault();

    $di-&gt;setShared (
        'router' ,
        function ()
        {
            $router = new RouterAnnotations( false );
            $router-&gt;addResource ( 'Web\Questionary\Controllers\Categoria', '/questionary/categoria' );

            return $router;
        } );

    $application = new Application($di);

    /**
    * register modules
    */
    $application-&gt;registerModules(array(
    'Questionary' =&gt; array(
        'className' =&gt; 'Web\Questionary\Module',
        'path' =&gt; $config-&gt;application-&gt;modulesDir . 'questionary/Module.php'
    )
));</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="46917" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="46917" data-cf-modified-e6fca54836bd5537c69102e3-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="15749" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>