---
layout: default
title: 'Broken PDF-File when using $response-&gt;setFileToSend - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/1/mvc">MVC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Broken PDF-File when using $response-&gt;setFileToSend</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/8139/cchyzyk" class="user-moderator-N"><span itemprop="name">Christian</span></a></span>
            <time itemprop="dateCreated" datetime="2016-09-10T10:55:32-07:00">Sep '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-09-10T10:55:32-07:00">Sep '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Nov '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">11</span>
                </td>
                <td>
                    <label>Views</label><br>1648</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">1</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/a572b23e4331f396f0c8ecf11c172ba7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/8139/cchyzyk" class="user-moderator-N"><span itemprop="name">Christian</span></a></span>
                <span class="karma">13.8k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C13633" href="#C13633">
        <time class="action-date">Sep '16</time>
    </a>
</div>
<div class="post-content"><div><p>Hi there,</p>
<p>currently I have a strange problem.</p>
<p>I am using the following lines:</p>
<blockquote>
<p>$filename= &quot;test.pdf&quot;;</p>
<p>$path = &quot;/path/to/test.pdf&quot;</p>
<p>$response = new \Phalcon\Http\Response();</p>
<p>$response-&gt;setHeader(&quot;Cache-Control&quot;, 'must-revalidate, post-check=0, pre-check=0');</p>
<p>$response-&gt;setHeader('Content-Disposition', 'inline; filename=' . urlencode($filename));</p>
<p>$response-&gt;setContentType('application/pdf');</p>
<p>$response-&gt;setFileToSend($path, null, false);</p>
<p>$response-&gt;send();</p>
</blockquote>
<p>In Firefox it works fine and the PDF is shown properly.</p>
<p>But when I call the URL with this method in Chrome, Chrome says &quot;Error while loading file&quot;.</p>
<p>I don't really know what the problem is. Do I have any mistake in my code?</p>
<p>Thanks a lot!</p>
<p>Best</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
        <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="40093" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C40093" href="#C40093">
                <time itemprop="dateCreated" datetime="2016-09-11T13:28:47-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Chrome tries to be 'smart' at times, but turns out to be stupid instead. Try to set Content-Length header. In Phalcon 3.x release, there's a method: <code>public setContentLength (mixed $contentLength)</code>. For 2.0.x you need to set it as raw.</p>
<p>Also, you don't need to <code>urlencode()</code> your file name. Why would you do that at first place? That name is being generated on-the-fly, and does not ever touch web server so it doesn't need to be URL encoded. It is only a hint for a client browser how to save the file on a local computer.</p>
<p>Also, if you use Phalcon method <code>setFileToSend()</code>, you don't need to specify attachment header as it will be set by default. Source: <a href="https://github.com/phalcon/cphalcon/blob/master/phalcon/http/response.zep#L635">https://github.com/phalcon/cphalcon/blob/master/phalcon/http/response.zep#L635</a></p>
<p>Last but not the least, provide here full HTTP response when you GET the file. It must be something wrong in a response.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40093" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40093" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">2</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a572b23e4331f396f0c8ecf11c172ba7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8139/cchyzyk" class="user-moderator-N"><span itemprop="name">Christian</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41153" href="#C41153">
                <time itemprop="dateCreated" datetime="2016-10-01T02:52:44-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Thanks for your answer!</p>
<p>I accomplished all the things you mentioned but error is still the same.</p>
<p>I am using <strong>Phalcon 2.0.x</strong>. Here is the code I tested:</p>
<pre><code>    $path = "test.pdf";

    $filetype = mime_content_type($path);

    $filesize = filesize($path);

    $response = new \Phalcon\Http\Response();
    $response-&gt;setHeader("Cache-Control", 'must-revalidate, post-check=0, pre-check=0');
    $response-&gt;setHeader("Content-Length", $filesize);
    $response-&gt;setContentType('application/pdf');
    $response-&gt;setFileToSend($path, null, false);
    $response-&gt;send();</code></pre>
<p>In FF and Safari it works well. Chrome still shows same error.</p>
<p>What do I do wrong? Don't really get it.</p>
<p>Thanks for your help!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41153" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41153" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41173" href="#C41173">
                <time itemprop="dateCreated" datetime="2016-10-01T15:21:56-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Provide full HTTP header response when you GET the file (from Firefox where you said it's working fine), or provide URL here so we can check directly.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41173" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41173" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a572b23e4331f396f0c8ecf11c172ba7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8139/cchyzyk" class="user-moderator-N"><span itemprop="name">Christian</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41179" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '16</span>
              </span><br/><a name="C41179" href="#C41179">
                <time itemprop="dateCreated" datetime="2016-10-02T02:11:25-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>All from Firefox when I call URL which shows PDF:</p>
<p><strong>Response Header</strong></p>
<p>HTTP/1.1 200 OK</p>
<p>Cache-Control   must-revalidate, post-check=0, pre-check=0</p>
<p>Connection  Keep-Alive</p>
<p>Content-Length  5562052</p>
<p>Content-Type    application/pdf</p>
<p>Date    Sun, 02 Oct 2016 09:08:22 GMT</p>
<p>Expires Thu, 19 Nov 1981 08:52:00 GMT</p>
<p>Keep-Alive  timeout=5, max=100</p>
<p>Pragma  no-cache</p>
<p>Server  Apache/2.4.10 (Unix) OpenSSL/1.0.1j PHP/5.5.19 mod_perl/2.0.8-dev Perl/v5.16.3</p>
<p>X-Powered-By    PHP/5.5.19</p>
<p><strong>Request Header</strong></p>
<p>Accept  text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8</p>
<p>Accept-Encoding gzip, deflate</p>
<p>Accept-Language de,en-US;q=0.7,en;q=0.3</p>
<p>Connection  keep-alive</p>
<p>Cookie  rhCookie=O%3A8%3A%22stdClass%22%3A3%3A%7Bs%3A13%3A%22hideCookieBar%22%3Bi%3A0%3Bs%3A7%3A%22guestid%22
%3Bs%3A32%3A%2271b6f9e624f37319293578584200a592%22%3Bs%3A8%3A%22referral%22%3Bs%3A1%3A%22P%22%3B%7D;
intercom-id=3d67db7c-afff-4c2e-858f-28d22f77830e; intercom-id-ndp9i749=3d67db7c-afff-4c2e-858f-28d22f77830e; __atuvc=16%7C35; PHPSESSID=ucvtjkto738dr3onbshkmfgng6; ck_glue_visit=1</p>
<p>Host    localhost</p>
<p>Upgrade-Insecure-Requests   1</p>
<p>User-Agent  Mozilla/5.0 (Macintosh; Intel Mac OS X 10.12; rv:49.0) Gecko/20100101 Firefox/49.0</p>
<p>Hopefully this helps.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41179" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41179" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41199" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '16</span>
              </span><br/><a name="C41199" href="#C41199">
                <time itemprop="dateCreated" datetime="2016-10-02T14:06:08-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Try with this, it is much more simple:</p>
<pre><code class="language-php">//resolve shared service from static context
//NOTE this was just my example / test, you can use $this-&gt;response or whatever context you're in
       $response = static::$di-&gt;getShared('response'); 

       $absFilePath = APP_PATH . '/Zend-Continuous-Delivery-Blueprint-1013-ENa.pdf'; //will resolve to absolute file path
       //Note: entire absolute path and the file must have READ permission for app server
       $response-&gt;setContentLength(filesize($absFilePath)); //Optional, method exists only in Phalcon 3.0.x

       $response-&gt;setFileToSend($absFilePath, 'fileShownToClients_'.mt_rand(PHP_VERSION_ID, mt_getrandmax()).'.pdf'); // randomize file name each time

       !$response-&gt;isSent() &amp;&amp; $response-&gt;send(); //Finally, sent out the response to the client
</code></pre>
<p>Will produce header response:</p>
<pre><code>Connection: keep-alive
Content-Description: File Transfer
Content-Disposition: attachment; filename=fileShownToClients_158475187.pdf
Content-Length: 6814521
Content-Type: application/octet-stream
Date: Sun, 02 Oct 2016 21:12:15 GMT
Server: nginx
X-Powered-By: COBOL V5.1 revision 0 build 10/10/2 G; 32409. Run Time System RXCVF/AA0/00000N
content-transfer-encoding: binary</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41199" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41199" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a572b23e4331f396f0c8ecf11c172ba7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8139/cchyzyk" class="user-moderator-N"><span itemprop="name">Christian</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41221" href="#C41221">
                <time itemprop="dateCreated" datetime="2016-10-02T23:55:51-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Your code isn't work...to get further, here is the URL which produces the problem:</p>
<p><a href="https://www.reachhero.de/brand/influencerMarketingHandoutDownload?downloadToken=8c68f7589dd9bd4b2f9875784fa26f24">https://www.reachhero.de/brand/influencerMarketingHandoutDownload?downloadToken=8c68f7589dd9bd4b2f9875784fa26f24</a></p>
<p>In FF and Safari it works fine, in Chrome it isn't shown.</p>
<p>My code is the same like before.</p>
<p>Thanks!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41221" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41221" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41231" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '16</span>
              </span><br/><a name="C41231" href="#C41231">
                <time itemprop="dateCreated" datetime="2016-10-03T03:33:13-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>My code <strong>does</strong> work, I tested it prior to posting here. Try it for yourself. If it does not work, pay attention to the comments in the code (i.e. permissions etc).</p>
<p>Now the link you provided is an extermal resource, what's with that? You don't have control over it from your app.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41231" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41231" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a572b23e4331f396f0c8ecf11c172ba7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8139/cchyzyk" class="user-moderator-N"><span itemprop="name">Christian</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41235" href="#C41235">
                <time itemprop="dateCreated" datetime="2016-10-03T04:07:45-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>When I use your code, the PDF will be downloaded. I don't want to download the PDF, it should be shown in browser.</p>
<p><strong>The link I provided is the app</strong>. When you open this link in Chrome, PDF doesn't appear and error will be shown. In other browsers it's working.</p>
<p>What do I have to change in your code that PDF will only be shown and not downloaded?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41235" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41235" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41239" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '16</span>
              </span><br/><a name="C41239" href="#C41239">
                <time itemprop="dateCreated" datetime="2016-10-03T06:39:45-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>That's whole another point/dimension. That's client side interpretation of HTTP response from server. You cannot force it 100% to behave like you want, since each browser has it's own internal PDF (JS) viewer and it will try to optimize as much on it's own etc.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41239" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41239" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41241" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '16</span>
              </span><br/><a name="C41241" href="#C41241">
                <time itemprop="dateCreated" datetime="2016-10-03T06:56:00-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This will work.</p>
<pre><code class="language-php">//resolve shared service from static context
//NOTE this was just my example / test, you can use $this-&gt;response or whatever context you're in
       $response = static::$di-&gt;getShared('response'); 

       $absFilePath = APP_PATH . '/Zend-Continuous-Delivery-Blueprint-1013-ENa.pdf'; //will resolve to absolute file path
       //Note: entire absolute path and the file must have READ permission for app server
       $response-&gt;setContentLength(filesize($absFilePath)); //Optional, method exists only in Phalcon 3.0.x

       $response-&gt;setContentType('application/pdf'); //this is mandatory if you want to trigger internal PDF JS viewer functionality of the browser

       $response-&gt;setFileToSend($absFilePath, 'fileShownToClients_'.mt_rand(PHP_VERSION_ID, mt_getrandmax()).'.pdf', 0x00); // randomize file name each time

       !$response-&gt;isSent() &amp;&amp; $response-&gt;send(); //Finally, sent out the response to the client
</code></pre>
<p>P.S. If that's what you want, the most convinient way is to just link to the file and let web server do the job (i.e. <a href="https://www.reachhero.de/brand/influencerMarketingHandoutDownload.pdf">https://www.reachhero.de/brand/influencerMarketingHandoutDownload.pdf</a>), unless you have a specific reason to present it via application, then use the code above.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41241" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41241" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a572b23e4331f396f0c8ecf11c172ba7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8139/cchyzyk" class="user-moderator-N"><span itemprop="name">Christian</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41261" href="#C41261">
                <time itemprop="dateCreated" datetime="2016-10-04T00:15:28-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>unfortunately this code doesn't work.</p>
<p>We are using Phalcon 2.0.x. There isn't any method like &quot; $response-&gt;setContentLength(filesize($absFilePath));&quot;. So I am using my version with &quot;setHeader&quot;.</p>
<p>Do you have any other ideas how I can resolve it?</p>
<p>Thanks a lot!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41261" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41261" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41277" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '16</span>
              </span><br/><a name="C41277" href="#C41277">
                <time itemprop="dateCreated" datetime="2016-10-04T04:27:32-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I stated that the method <code>setContentLength()</code> is optional, but it still good to use it.</p>
<p>For Phalcon 2.0.x use this:</p>
<pre><code class="language-php">$response-&gt;setHeader('Content-Length', filesize($absFilePath)); //Calculate Content-Length header (Phalcon 2.0.x)</code></pre>
<p>The code I have posted should work 1:1 between Phalcon 2.0.x and 3.0.x with only difference being using new method </p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41277" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41277" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a572b23e4331f396f0c8ecf11c172ba7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8139/cchyzyk" class="user-moderator-N"><span itemprop="name">Christian</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41289" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '16</span>
              </span><br/><a name="C41289" href="#C41289">
                <time itemprop="dateCreated" datetime="2016-10-04T05:30:30-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>This is now the code:</p>
<pre><code>$response = $this-&gt;response;

$absFilePath = $this-&gt;config-&gt;attachmentsDir . "Marketing-DE.pdf"; //will resolve to absolute file path

$response-&gt;setHeader('Content-Length', filesize($absFilePath)); //Calculate Content-Length header (Phalcon 2.0.x)

$response-&gt;setContentType('application/pdf'); //this is mandatory if you want to trigger internal PDF JS viewer functionality of the browser

$response-&gt;setFileToSend($absFilePath, 'fileShownToClients_'.mt_rand(PHP_VERSION_ID, mt_getrandmax()).'.pdf', 0x00); // randomize file name each time

!$response-&gt;isSent() &amp;&amp; $response-&gt;send(); //Finally, sent out the response to the client</code></pre>
<p>It's productive and online. To check it, call this URL:</p>
<p><a href="https://www.reachhero.de/brand/influencerMarketingHandoutDownload?downloadToken=7dca89824cfabe6edb8a4607c5c27b5c">https://www.reachhero.de/brand/influencerMarketingHandoutDownload?downloadToken=7dca89824cfabe6edb8a4607c5c27b5c</a></p>
<p>Isn't working in chrome. Don't really know where the problem is.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41289" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41289" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="41303" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '16</span>
              </span><br/><a name="C41303" href="#C41303">
                <time itemprop="dateCreated" datetime="2016-10-04T07:23:52-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I see, it does not work in Chrome for me either.</p>
<p><strong>Can you try with another, PDF file?</strong>  For example, use this file: <code>https://s3.amazonaws.com/info-mongodb-com/MongoDB_Datasheet.pdf</code></p>
<p>Your PDF file has all empty properties, and format is set to: PDF-0</p>
<p>I'm not sure if that can break Chrome's internal JS viewer. If it does, you'll have to change a way how you generate your PDF's or to fill out those properties.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41303" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41303" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C41385" href="#C41385">
                <time itemprop="dateCreated" datetime="2016-10-06T14:45:53-07:00" class="action-date">Oct '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Have you tried with another PDF file (not generated by your app)? If you generate files with TCPDF, that might be the root cause of Chrome's internal JS viewer.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="41385" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="41385" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a572b23e4331f396f0c8ecf11c172ba7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8139/cchyzyk" class="user-moderator-N"><span itemprop="name">Christian</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C42435" href="#C42435">
                <time itemprop="dateCreated" datetime="2016-11-02T02:48:38-07:00" class="action-date">Nov '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Doesn't work. Internet Explorer 11 has the same problem. There I got a message:</p>
<p>&quot;File does not begin with &quot;%PDF-'.
Local\EWH-2176-0</p>
<p>Do you have any suggestions?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="42435" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="42435" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="42439" data-toggle="modal" data-target="#historyModal">
                edited <span>Nov '16</span>
              </span><br/><a name="C42439" href="#C42439">
                <time itemprop="dateCreated" datetime="2016-11-02T02:53:27-07:00" class="action-date">Nov '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You must have some output buffer before actual content. Try to catch PHP warnings like 'headers already sent' etc. using <code>register_shutdown_function()</code></p>
<p>It might be something really simple like you have blank space somewhere which gets to output before your binary data.</p>
<p>Also, debug with <code>curl</code> (raw) to see the actual output of your application with that PDF files.</p>
<p>One more time - I already asked you - how do you generate those PDF files? Which lib/software? That might be the culprit too.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="42439" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="42439" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/a572b23e4331f396f0c8ecf11c172ba7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/8139/cchyzyk" class="user-moderator-N"><span itemprop="name">Christian</span></a>        </span>
        <br>

        <span class="karma">13.8k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C42593" href="#C42593">
                <time itemprop="dateCreated" datetime="2016-11-04T10:12:32-07:00" class="action-date">Nov '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I'm going crazy, I found the solution!</p>
<p>The only thing you have to add is the following line at start of function:</p>
<pre><code>$this-&gt;view-&gt;setRenderLevel(View::LEVEL_NO_RENDER);</code></pre>
<p>Thanks for your help, you helped me a lot!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="42593" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="42593" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb5cc9f3d1e3c3cab87efd5ac1dc9c7?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4525/stamster" class="user-moderator-N"><span itemprop="name">Jonathan Aaron Steel</span></a>        </span>
        <br>

        <span class="karma">79.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C42595" href="#C42595">
                <time itemprop="dateCreated" datetime="2016-11-04T10:20:53-07:00" class="action-date">Nov '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hm. That means that your view was returning some output before your output headers were set/sent. That's why it is good to test via command line (curl).</p>
<p>In general, it is very wise to completely disable view component on such specific functions:</p>
<pre><code class="language-php">  $this-&gt;view-&gt;disable();</code></pre>
<p>P.S. I'm glad you have finally solved it!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="42595" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="42595" data-cf-modified-8f8a8f2d8d63a61ec70130fe-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="13633" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>