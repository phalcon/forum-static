---
layout: default
title: 'Question about benstalkd queue - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/5/general">General</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Question about benstalkd queue</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/724/miao606" class="user-moderator-N"><span itemprop="name">mia0x75</span></a></span>
            <time itemprop="dateCreated" datetime="2014-01-23T19:17:20-07:00">Jan '14</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2014-01-23T19:17:20-07:00">Jan '14</time>
                </td>
                <td>
                    <label>Last Reply</label><br>None</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">0</span>
                </td>
                <td>
                    <label>Views</label><br>555</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img  src="https://secure.gravatar.com/avatar/42e9570827f219c4f0387eee7e2b6235?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/724/miao606" class="user-moderator-N"><span itemprop="name">mia0x75</span></a></span>
                <span class="karma">29.1k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C1492" href="#C1492">
        <time class="action-date">Jan '14</time>
    </a>
</div>
<div class="post-content"><div><p>I want to add two phase authentication in my website login process, thus I want to send an SMS to my user with random access code, benstalkd can help to asynchronous send the message, and improvement user experience. And you can easy to see, this is a time sensitive process, so it cannot be added into crontab, I want my send process can be notified when a new job put into the queue.</p>
<p>Any idea? Thanks in advanced.</p>
<p>index.php</p>
<pre><code>$di-&gt;set('queue', function() use ($config) {
    $queue = new Phalcon\Queue\Beanstalk(array(
        'host' =&gt; $config-&gt;queue-&gt;host,
        'port' =&gt; $config-&gt;queue-&gt;port
    ));

    return $queue;
});</code></pre></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-76985bb111af9b30b9241a63-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-76985bb111af9b30b9241a63-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/42e9570827f219c4f0387eee7e2b6235?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/724/miao606" class="user-moderator-N"><span itemprop="name">mia0x75</span></a>        </span>
        <br>

        <span class="karma">29.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5242" href="#C5242">
                <time itemprop="dateCreated" datetime="2014-01-23T20:52:27-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>register a callback function or observer? how?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5242" data-cf-modified-76985bb111af9b30b9241a63-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5242" data-cf-modified-76985bb111af9b30b9241a63-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img  src="https://secure.gravatar.com/avatar/42e9570827f219c4f0387eee7e2b6235?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/724/miao606" class="user-moderator-N"><span itemprop="name">mia0x75</span></a>        </span>
        <br>

        <span class="karma">29.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C5250" href="#C5250">
                <time itemprop="dateCreated" datetime="2014-01-24T20:21:06-07:00" class="action-date">Jan '14</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>How about:</p>
<h1>!/usr/local/bin/php -q</h1>
<p>&lt;?php
// Stop the script giving time out errors..
set_time_limit(0);</p>
<p>// Main loop
while(true) {
$queue = new Phalcon\Queue\Beanstalk(array(
'host' =&gt; '127.0.0.1',
'port' =&gt; 11300
));
while (($job = $this-&gt;queue-&gt;peekReady()) !== false) {
$job = $this-&gt;queue-&gt;reserve();
$message = $job-&gt;getBody();</p>
<pre><code>    //...

    $job-&gt;delete();
}
sleep(1);</code></pre>
<p>}</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="5250" data-cf-modified-76985bb111af9b30b9241a63-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="5250" data-cf-modified-76985bb111af9b30b9241a63-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="1492" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>