---
layout: default
title: 'How to &#039;upsert&#039; (update or insert): For Mysql, Postgresql and SQLite (MERGE SQL) - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/29/database">Database</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">How to &#039;upsert&#039; (update or insert): For Mysql, Postgresql and SQLite (MERGE SQL)</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a></span>
            <time itemprop="dateCreated" datetime="2016-09-16T11:42:26-07:00">Sep '16</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2016-09-16T11:42:26-07:00">Sep '16</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Sep '16</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">8</span>
                </td>
                <td>
                    <label>Views</label><br>2608</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a></span>
                <span class="karma">40.0k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C13695" href="#C13695">
        <time class="action-date">Sep '16</time>
    </a>
</div>
<div class="post-content"><div><p>Is there (UPSERT) or (MERGE) in Phalcon?</p>
<p>Compatibily for:</p>
<ul>
<li>Mysql</li>
<li>Postgresql</li>
<li>Sqlite</li>
</ul></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-72cb422acb497626c5e640a2-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-72cb422acb497626c5e640a2-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/b9095cdfa274d5bcc1aec8671313c172?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4527/nsossonko" class="user-moderator-N"><span itemprop="name">nsossonko</span></a>        </span>
        <br>

        <span class="karma">7.1k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40261" href="#C40261">
                <time itemprop="dateCreated" datetime="2016-09-16T12:43:37-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>$model-&gt;save($upsertArray);</p>
<p>See: <a href="https://docs.phalcon.io/en/latest/reference/models.html#creating-updating-records">https://docs.phalcon.io/en/latest/reference/models.html#creating-updating-records</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40261" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40261" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40263" href="#C40263">
                <time itemprop="dateCreated" datetime="2016-09-16T13:06:12-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>what SQL generate?<a href="https://forum.phalcon.io/user/4527/nsossonko"> @nsossonko</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40263" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40263" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40265" href="#C40265">
                <time itemprop="dateCreated" datetime="2016-09-16T13:28:46-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I say something like:</p>
<pre><code class="language-sql"> MERGE INTO table_name_1 USING table_name_2 ON (condition)
   WHEN MATCHED THEN
   UPDATE SET column1 = value1 [, column2 = value2 ...]
   WHEN NOT MATCHED THEN
   INSERT (column1 [, column2 ...]) VALUES (value1 [, value2 ...</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40265" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40265" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/0eb658098a90d286b29e99a38e010df3?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/6067/ntesic" class="user-moderator-N"><span itemprop="name">ntesic</span></a>        </span>
        <br>

        <span class="karma">1.9k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40267" href="#C40267">
                <time itemprop="dateCreated" datetime="2016-09-16T13:54:25-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Is this some PHP framework support even?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40267" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40267" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="40269" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C40269" href="#C40269">
                <time itemprop="dateCreated" datetime="2016-09-16T14:16:08-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Model::save is already checking itself if it's new instance like(<code>new Model()</code>) or already found model using <code>::findFirst()</code> And it will generate update or insert query, but without using merge. Not sure why exactly you need it ? Can you write some example for what exactly you need it ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40269" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40269" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="40275" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C40275" href="#C40275">
                <time itemprop="dateCreated" datetime="2016-09-16T15:35:29-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>info: [<a href="https://en.wikipedia.org/wiki/Merge_(SQL">https://en.wikipedia.org/wiki/Merge_(SQL</a>)]</p>
<ul>
<li>For Mysql: <a href="https://dev.mysql.com/doc/refman/5.7/en/insert-on-duplicate.html">https://dev.mysql.com/doc/refman/5.7/en/insert-on-duplicate.html</a></li>
<li>For Postgresql: <a href="https://wiki.postgresql.org/wiki/UPSERT">https://wiki.postgresql.org/wiki/UPSERT</a></li>
<li>For Sqlite: <a href="https://stackoverflow.com/questions/418898/sqlite-upsert-not-insert-or-replace">https://stackoverflow.com/questions/418898/sqlite-upsert-not-insert-or-replace</a></li>
</ul></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40275" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40275" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40277" href="#C40277">
                <time itemprop="dateCreated" datetime="2016-09-16T15:48:38-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><pre><code class="language-sql">CREATE TABLE public.config
(
  collection character varying(255) NOT NULL DEFAULT ''::character varying, -- Primary Key: Config object collection.
  name character varying(255) NOT NULL DEFAULT ''::character varying, -- Primary Key: Config object name.
  data bytea, -- A serialized configuration object data.
  CONSTRAINT config____pkey PRIMARY KEY (collection, name)
)</code></pre>
<p>I wish to insert or update the fields that were updated, also if you can not replace everything, only they changed.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40277" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40277" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40279" href="#C40279">
                <time itemprop="dateCreated" datetime="2016-09-16T16:23:29-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Then use dynamic update - it will update only fields which were updated in model.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40279" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40279" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40281" href="#C40281">
                <time itemprop="dateCreated" datetime="2016-09-16T19:06:00-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Not with model, one query.</p>
<p>I created a function:</p>
<pre><code class="language-php">
    /**
     * Helper method so we can re-try a write.
     *
     * @param string $name
     *   The config name.
     * @param string $data
     *   The config data, already dumped to a string.
     * @return bool
     * @throws \Exception
     */
    protected function doWrite($name, $data)
    {
        $type = $this-&gt;connection-&gt;getType();
        switch ($type) {
            case 'mysql':
                $sql = 'INSERT INTO config ( collection, name, data ) '
                    . ' VALUES (:collection, :name, :data) '
                    . ' ON DUPLICATE KEY UPDATE '
                    . ' data = VALUES(data);';
                break;
            case 'pgsql':
                $sql = 'INSERT INTO config (collection, name, data) '
                    . 'VALUES (:collection, :name, :data) '
                    . 'ON CONFLICT (collection, name) '
                    . 'DO UPDATE SET data = EXCLUDED.data;';
                break;
            case 'sqlite':
                $sql = 'INSERT OR REPLACE INTO config (collection, name, data) '
                    . 'VALUES (:collection, :name, :data);';
                break;
            default:
                throw new \Exception('Only support Mysql, Postgres and SQLite');
                break;
        }

        return (bool)$this-&gt;connection-&gt;execute(
            $sql,
            [
                'collection' =&gt; $this-&gt;collection,
                'name' =&gt; $name,
                'data' =&gt; $this-&gt;encode($data)
            ],
            [
                Db\Column::BIND_PARAM_STR,
                Db\Column::BIND_PARAM_STR,
                Db\Column::BIND_PARAM_BLOB
            ]
        );
    }</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40281" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40281" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40285" href="#C40285">
                <time itemprop="dateCreated" datetime="2016-09-16T23:26:55-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Oh okay. I would just use Model because it has already dynamic update built-in.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40285" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40285" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span><span itemprop="upvoteCount">1</span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="in-reply-to">
                    <a href="#C40285"><span class="glyphicon glyphicon-chevron-up"></span> in reply to
                        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" width="24" height="24" />                        Wojciech Ślawski                    </a>
                </div><div class="posts-buttons" align="right"><a name="C40289" href="#C40289">
                <time itemprop="dateCreated" datetime="2016-09-17T06:00:21-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Could you give me an example with the model, please.</p>
<p>I want to know the inner workings.</p>
<blockquote>
<p>Oh okay. I would just use Model because it has already dynamic update built-in.</p>
</blockquote></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40289" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40289" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40291" href="#C40291">
                <time itemprop="dateCreated" datetime="2016-09-17T06:02:18-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>is antipattern???</p>
<pre><code class="language-php">// anti pattern to upsert
$fbUser = \App\Models\Profile::findFirst($fbId);

if (empty($fbUser)) {
    $fbUser = new \App\Models\Profile();
    $fbUser-&gt;id = $fbId;
}
// ~ anti pattern to upsert

$fbUser-&gt;status = 2;</code></pre>
<p>See: <a href="https://github.com/phalcon/cphalcon/issues/11101">https://github.com/phalcon/cphalcon/issues/11101</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40291" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40291" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="40293" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C40293" href="#C40293">
                <time itemprop="dateCreated" datetime="2016-09-17T06:33:13-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>You can't set primary keys in phalcon. Dynamic update is for updating rows - for executing query update only with changed fields, not all. Just remove setting id. For me it's not antipattern.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40293" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40293" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40295" href="#C40295">
                <time itemprop="dateCreated" datetime="2016-09-17T07:34:29-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>If exists:</p>
<pre><code class="language-php">$connection-&gt;query();
$connection-&gt;insert();
$connection-&gt;delete();
$connection-&gt;update();</code></pre>
<p>There should be:</p>
<pre><code class="language-php">$connection-&gt;merge();</code></pre></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40295" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40295" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40645" href="#C40645">
                <time itemprop="dateCreated" datetime="2016-09-21T22:37:02-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Phalcon need to implement:</p>
<pre><code class="language-php">$connection-&gt;merge();
$connection-&gt;upsert();</code></pre>
<p>NRF</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40645" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40645" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="40647" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C40647" href="#C40647">
                <time itemprop="dateCreated" datetime="2016-09-21T23:12:18-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Why ? Can you show me other frameworks implementing this ?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40647" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40647" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40663" href="#C40663">
                <time itemprop="dateCreated" datetime="2016-09-22T08:04:23-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><ul>
<li>Drupal 8
<ul>
<li>merge  </li>
<li>upsert</li>
</ul></li>
<li>Doctrine 2
<ul>
<li>upsert (in query builder -&gt;upsert(true))</li>
</ul></li>
</ul>
<p>I am researching. to give examples of code.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40663" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40663" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/bcb86a03b78026a223f83ca3162cf7eb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/4789/xerron" class="user-moderator-N"><span itemprop="name">Edwin Manuel Cerrón Angeles</span></a>        </span>
        <br>

        <span class="karma">40.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C40673" href="#C40673">
                <time itemprop="dateCreated" datetime="2016-09-22T09:43:00-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Example drupal 8 merge query:</p>
<p><a href="https://www.drupal8.ovh/en/tutoriels/46/database-merge-insert-or-update-if-exist">https://www.drupal8.ovh/en/tutoriels/46/database-merge-insert-or-update-if-exist</a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40673" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40673" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/8da15621865643112c6e3243f2ce4ebe?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/3812/Jurigag" class="user-moderator-Y"><span itemprop="name">Wojciech Ślawski</span></a>        </span>
        <br>

        <span class="karma">145.0k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="40675" data-toggle="modal" data-target="#historyModal">
                edited <span>Sep '16</span>
              </span><br/><a name="C40675" href="#C40675">
                <time itemprop="dateCreated" datetime="2016-09-22T10:15:01-07:00" class="action-date">Sep '16</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>If you really wnat this then the best would be just implement it to phalcon, if you don't know zephir then you can just do it for incubator in plain php <a href="https://github.com/phalcon/incubator/tree/master/Library/Phalcon">https://github.com/phalcon/incubator/tree/master/Library/Phalcon</a> and someone will port it to phalcon. I was never using merge/upsert. Don't know how they work exactly and how it should work in active record pattern.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="40675" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="40675" data-cf-modified-72cb422acb497626c5e640a2-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="13695" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>