---
layout: default
title: 'Setting up DI for testing - TestHelper.php example - Discussion'
---

    <div class="container">
        {% include warning.html %}


<div itemscope itemtype="https://schema.org/Question"><ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li><a href="/category/10/di-ioc">DI/IoC</a></li>
</ol>
<div class="row table-title">
    <div class="col-lg-8 col-md-7 col-sm-6 col-xs-12 wrapper-author">
        <h1 class="" itemprop="name">Setting up DI for testing - TestHelper.php example</h1>
        <div class="visible-xs-block mobile-author">
            <span itemprop="author" itemscope itemtype="https://schema.org/Person"><a href="/user/87/noobiwan" class="user-moderator-N"><span itemprop="name">Lewiz</span></a></span>
            <time itemprop="dateCreated" datetime="2015-10-09T18:04:27-07:00">Oct '15</time>
        </div>
    </div>
    <div class="col-lg-4 col-md-5 col-sm-6 hidden-xs text-right wrapper-stats">
        <table class="table-stats" width="100%">
            <tr style="vertical-align: top;">
                <td>
                    <label>Created</label><br>
                    <time itemprop="dateCreated" datetime="2015-10-09T18:04:27-07:00">Oct '15</time>
                </td>
                <td>
                    <label>Last Reply</label><br>Oct '15</td>
                <td>
                    <label>Replies</label><br>
                    <span itemprop="answerCount">4</span>
                </td>
                <td>
                    <label>Views</label><br>486</td>
                <td>
                    <label>Votes</label><br>
                    <span itemprop="upvoteCount">0</span>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="discussion">
        <div class="row reply-block">
            <div class="col-md-1 col-sm-1 hidden-xs text-center">
                <img src="https://secure.gravatar.com/avatar/f995126f75088cac3803b91febd711fb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded avatar" /><br>
                <span itemprop="author" itemscope itemtype="https://schema.org/Person" class="avatar-name"><a href="/user/87/noobiwan" class="user-moderator-N"><span itemprop="name">Lewiz</span></a></span>
                <span class="karma">32.2k</span>
            </div>
            <div class="col-md-11 col-sm-11 col-xs-12 post-body"><div class="posts-date hidden-xs" align="right">
        <a name="C8909" href="#C8909">
        <time class="action-date">Oct '15</time>
    </a>
</div>
<div class="post-content"><div><p>I'm setting up my testing environment and in the docs <a href="https://docs.phalcon.io/en/latest/reference/unit-testing.html">there is an example</a> for a PHPunit helper file.</p>
<p>In this helper file at the end there is </p>
<pre><code class="language-php">$di = new FactoryDefault();
DI::reset();

// Add any needed services to the DI here

DI::setDefault($di);</code></pre>
<p>As far as I understand when a DI is created it registers itselft as the default one, so calling DI::getDefault() will always return the last DI created. So why in the example we have DI:reset() and then a DI::setDefault($di) if we didn't create another DI? </p>
<p>It seems kinda redundant. It would only make sense if Di::setDefault() creates a copy of the container instead of having a reference to it. Am I missing something here?</p></div>                </div>

                <div class="posts-buttons text-right"><a href="#"  class="btn btn-danger btn-xs" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
        <span class="glyphicon glyphicon-thumbs-down"></span></a>
    <a href="#"  class="btn btn-success btn-xs" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
        <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
            </div>
        </div><div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a>        </span>
        <br>

        <span class="karma">47.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C24479" href="#C24479">
                <time itemprop="dateCreated" datetime="2015-10-13T20:37:39-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Hope this helps:</p>
<p><a href="https://forum.phalcon.io/discussion/2089/phpunit-phalcon-di-exception-service-db-was-not-found-in-the-dep"><a href="https://forum.phalcon.io/discussion/2089/phpunit-phalcon-di-exception-service-db-was-not-found-in-the-dep">https://forum.phalcon.io/discussion/2089/phpunit-phalcon-di-exception-service-db-was-not-found-in-the-dep</a></a></p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24479" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24479" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f995126f75088cac3803b91febd711fb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/87/noobiwan" class="user-moderator-N"><span itemprop="name">Lewiz</span></a>        </span>
        <br>

        <span class="karma">32.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="24483" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '15</span>
              </span><br/><a name="C24483" href="#C24483">
                <time itemprop="dateCreated" datetime="2015-10-13T22:35:01-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Not really. I'd like to understand what would be the potential effects of not calling DI:reset() in that context.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24483" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24483" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a>        </span>
        <br>

        <span class="karma">47.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C24499" href="#C24499">
                <time itemprop="dateCreated" datetime="2015-10-14T06:37:49-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>Then why don't you try it?</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24499" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24499" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f995126f75088cac3803b91febd711fb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/87/noobiwan" class="user-moderator-N"><span itemprop="name">Lewiz</span></a>        </span>
        <br>

        <span class="karma">32.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C24505" href="#C24505">
                <time itemprop="dateCreated" datetime="2015-10-14T08:39:07-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I currently ommited DI:reset() without any issues. I'm trying to figure out what's the idea behind it. I imagine some components will use the defaut DI if you don't pass a DI as argument, but if you don't have a default one what happens? Will they fail? And in the case you pass a DI as an argument wouldn't it take precedence over the default one anyway? </p>
<p>I'm looking for places in the source code where having a default DI setup would make a difference, and so far I couldn't find any conclusive information.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24505" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24505" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a>        </span>
        <br>

        <span class="karma">47.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="24511" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '15</span>
              </span><br/><a name="C24511" href="#C24511">
                <time itemprop="dateCreated" datetime="2015-10-14T09:46:03-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>My assumption is that DI:reset() is used in the teardown.</p>
<p>Say you want the reference  to a db service the same but you'd like to test different adapters? Doesn't the DI need to be reset?</p>
<p>Looking at the example code I can see :</p>
<pre><code class="language-php">    $di = new FactoryDefault();</code></pre>
<p>This gives you the full stack of services.</p>
<p>So maybe this is quoted...</p>
<pre><code class="language-php">    DI::reset();</code></pre>
<p>.. to point how you can switch back to a default or bespoke one.</p>
<p>I'm not sure if I am grasping the thrust of what you are saying.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24511" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24511" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/f995126f75088cac3803b91febd711fb?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/87/noobiwan" class="user-moderator-N"><span itemprop="name">Lewiz</span></a>        </span>
        <br>

        <span class="karma">32.2k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><a name="C24513" href="#C24513">
                <time itemprop="dateCreated" datetime="2015-10-14T09:58:33-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>My point is that in the example they are creating a new DI (that becomes the new default), then reseting the default, adding more services to that container and then setting that container as the default again! What effect would having no default DI container have on the new services being created and attached to that same container? That's what is bogging  my mind!</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24513" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24513" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div itemprop="suggestedAnswer" itemscope itemtype="https://schema.org/Answer" class="reply-block row">
    <div class="col-md-1 small" align="center">
        <img src="https://secure.gravatar.com/avatar/e1731ca2cc82170fb565554fd13b9f7c?s=48&amp;r=pg&amp;d=identicon" class="img-rounded" />        <br>

        <span itemprop="author" itemscope itemtype="https://schema.org/Person">
            <a href="/user/1017/baychae" class="user-moderator-N"><span itemprop="name">baychae</span></a>        </span>
        <br>

        <span class="karma">47.7k</span></div>
    <div class="col-md-11"><div class="posts-buttons" align="right"><span class="action-date action-reply-edit" data-id="24515" data-toggle="modal" data-target="#historyModal">
                edited <span>Oct '15</span>
              </span><br/><a name="C24515" href="#C24515">
                <time itemprop="dateCreated" datetime="2015-10-14T10:06:01-07:00" class="action-date">Oct '15</time>
            </a>
        </div>
        <div class="post-content"><div itemprop="text"><p>I'm not sure you are supposed to read it in sequence like that. Maybe its not such a great example.</p>
<p>I think its just there as an illustrative example not a literal one.</p></div></div>
        <div class="posts-buttons" align="right"><a href="#"  class="btn btn-danger btn-xs vote-login" data-id="24515" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-down"></span></a>
                <a href="#"  class="btn btn-success btn-xs vote-login" data-id="24515" data-cf-modified-bfe3bacd943b1418c577bfaa-="">
                    <span class="glyphicon glyphicon-thumbs-up"></span></a></div>
    </div>
</div>
<div class="row"><div class="col-md-1 small" align="center"></div>
        <div class="col-md-11 login-comment">
            
        </div></div>
</div><input type="hidden" id="post-id" name="post-id" value="8909" /><div id="suggested-posts"></div>
    <div id="sticky-progress" style='display:none'></div>
</div>
    </div>